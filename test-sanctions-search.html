<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test FCDO Sanctions Search Iframe</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: rgb(0, 60, 113);
      margin-top: 0;
    }
    
    .info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
      border-left: 4px solid #1976d2;
    }
    
    .controls {
      margin-bottom: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
    }
    
    .controls label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: rgb(0, 60, 113);
    }
    
    .controls input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    
    .controls button {
      background: rgb(0, 60, 113);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      margin-right: 10px;
    }
    
    .controls button:hover {
      background: #004080;
    }
    
    .controls button.secondary {
      background: #888;
    }
    
    .controls button.secondary:hover {
      background: #666;
    }
    
    .iframe-container {
      width: 100%;
      height: 700px;
      border: 2px solid #ddd;
      border-radius: 4px;
      overflow: hidden;
    }
    
    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .log {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .log-entry {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      padding: 5px;
      border-bottom: 1px solid #e0e0e0;
      margin: 0;
    }
    
    .log-entry.received {
      color: #1976d2;
    }
    
    .log-entry.sent {
      color: #2e7d32;
    }
    
    .log-entry.error {
      color: #c62828;
      font-weight: bold;
    }
    
    .instructions {
      background: #fff3e0;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      border-left: 4px solid #f57c00;
    }
    
    .instructions h3 {
      margin-top: 0;
      color: #e65100;
    }
    
    .instructions ol {
      margin: 10px 0;
      padding-left: 20px;
    }
    
    .instructions code {
      background: #ffecb3;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>&#xF0;&#x178;&#xA7;&#xAA; Test FCDO Sanctions Search</h1>
    
    <div class="info">
      <strong>Test Harness for sanctions-search-v2.html</strong><br>
      This page simulates the parent Wix page to test the iframe locally.
    </div>
    
    <div class="controls">
      <label for="testName">Test Client Name:</label>
      <input type="text" id="testName" value="John Smith" placeholder="Enter test name">
      
      <label for="testDOB">Test Client DOB:</label>
      <input type="date" id="testDOB" value="1975-06-15">
      
      <button onclick="sendClientData()">&#xF0;&#x178;&#x201C;&#xA4; Send Client Data to Iframe</button>
      <button onclick="sendMockXML()" class="secondary">&#xF0;&#x178;&#x201C;&#xA6; Send Mock XML to Iframe</button>
      <button onclick="clearLog()" class="secondary">&#xF0;&#x178;&#xA7;&#xB9; Clear Log</button>
    </div>
    
    <div class="iframe-container">
      <iframe id="sanctionsIframe" src="sanctions-search-v2.html"></iframe>
    </div>
    
    <div class="log">
      <h3>&#xF0;&#x178;&#x201C;&#x2039; Message Log</h3>
      <div id="logContainer"></div>
    </div>
    
    <div class="instructions">
      <h3>&#xF0;&#x178;&#x201C;&#x9D; Testing Instructions</h3>
      <ol>
        <li>Make sure <code>sanctions-search-v2.html</code> is in the same directory</li>
        <li>Open <code>test-xml-sample.xml</code> and copy its entire contents</li>
        <li>In <code>sanctions-search-v2.html</code>, set <code>USE_MOCK_DATA = true</code></li>
        <li>Paste the XML into the <code>&lt;script id="mockSanctionsXML"&gt;</code> tag</li>
        <li>Reload this page</li>
        <li>Click "&#xF0;&#x178;&#x201C;&#xA4; Send Client Data to Iframe" to populate the search form</li>
        <li>Click "Search Sanctions List" in the iframe to test search</li>
        <li>Try these test names:
          <ul>
            <li><strong>"John Smith"</strong> - Exact match (TEST001)</li>
            <li><strong>"Jon Smith"</strong> - Alias match (TEST001)</li>
            <li><strong>"Vladimir Petrov"</strong> - Exact match (TEST002)</li>
            <li><strong>"Sarah Williams"</strong> - Exact match (TEST005)</li>
            <li><strong>"Ahmed Rahman"</strong> - Fuzzy match (TEST004)</li>
            <li><strong>"Test Company"</strong> - No match (should show &#xE2;&#x153;&#x2026;)</li>
          </ul>
        </li>
      </ol>
      <p><strong>Note:</strong> PDF generation and S3 upload will not work in this test harness (no real backend).</p>
    </div>
  </div>

  <script>
    const iframe = document.getElementById('sanctionsIframe');
    const logContainer = document.getElementById('logContainer');
    
    // Listen for messages from iframe
    window.addEventListener('message', (event) => {
      // Log all messages from iframe
      logMessage(`&#xE2;&#xAC;&#x2026;&#xEF;&#xB8;&#x8F; RECEIVED: ${event.data.type || 'unknown'}`, 'received');
      console.log('&#xF0;&#x178;&#x201C;&#xAC; Received from iframe:', event.data);
      
      // Handle different message types
      switch (event.data.type) {
        case 'request-sanctions-client-data':
          logMessage('Iframe requested client data', 'received');
          // Auto-send client data
          setTimeout(() => sendClientData(), 500);
          break;
          
        case 'request-sanctions-xml':
          logMessage('Iframe requested sanctions XML (mock response)', 'received');
          // In real implementation, this would call backend
          // For testing, you can manually click "Send Mock XML"
          alert('Iframe is requesting XML from backend.\n\nIn real implementation, this would call getFCDOSanctionsHTML().\n\nFor testing with mock data, make sure USE_MOCK_DATA = true in the iframe.');
          break;
          
        case 'request-s3-upload-url':
          logMessage('Iframe requested S3 upload URL (not implemented in test)', 'received');
          alert('S3 upload requested.\n\nThis test harness does not implement S3 upload.\n\nIn production, parent would call backend to get presigned URL.');
          break;
          
        case 'sanctions-search-complete':
          logMessage('&#xE2;&#x153;&#x2026; Sanctions search completed successfully!', 'received');
          alert('&#xE2;&#x153;&#x2026; Search completed!\n\nIn production, the PDF would be uploaded to S3 now.');
          break;
          
        case 'close-lightbox':
          logMessage('Iframe requested to close lightbox', 'received');
          alert('In production, this would close the Wix lightbox.');
          break;
          
        default:
          logMessage(`Unknown message type: ${event.data.type}`, 'error');
      }
    });
    
    // Send client data to iframe
    function sendClientData() {
      const name = document.getElementById('testName').value;
      const dob = document.getElementById('testDOB').value;
      
      const message = {
        type: 'sanctions-client-data',
        name: name,
        dob: dob
      };
      
      iframe.contentWindow.postMessage(message, '*');
      logMessage(`&#xE2;&#x17E;&#xA1;&#xEF;&#xB8;&#x8F; SENT: sanctions-client-data (${name}, ${dob})`, 'sent');
      console.log('&#xF0;&#x178;&#x201C;&#xA4; Sent to iframe:', message);
    }
    
    // Send mock XML to iframe (for testing without backend)
    function sendMockXML() {
      alert('To use mock XML:\n\n1. Set USE_MOCK_DATA = true in sanctions-search-v2.html\n2. Paste XML from test-xml-sample.xml into the <script id="mockSanctionsXML"> tag\n3. Reload this page\n\nThe iframe will load the mock data automatically.');
    }
    
    // Log a message
    function logMessage(text, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${timestamp}] ${text}`;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }
    
    // Clear log
    function clearLog() {
      logContainer.innerHTML = '';
    }
    
    // Initial log
    logMessage('Test harness initialized', 'info');
    logMessage('Waiting for iframe to load...', 'info');
    
    // Wait for iframe to load
    iframe.addEventListener('load', () => {
      logMessage('&#xE2;&#x153;&#x2026; Iframe loaded successfully', 'info');
    });
  </script>
<!-- IFRAME_VERSION START -->
<script>
  (function() {
    window.__IFRAME_VERSION__ = '91f50c9';
    console.log('[test-sanctions-search] version ' + window.__IFRAME_VERSION__);
  })();
</script>
<!-- IFRAME_VERSION END -->
</body>
</html>


