                                                                                                                                                                                                                                        // =====================================================================
// THIRDFORT CHECKS MANAGER - Main JavaScript
// =====================================================================
// Manages Thirdfort check display in list and detail views
// Communicates with parent via postMessage
// =====================================================================

class ThirdfortChecksManager {
    constructor() {
        this.checks = [];
        this.currentCheck = null;
        this.currentView = 'loading'; // 'loading', 'list', 'detail'
        this.mode = 'edit'; // 'view' or 'edit' - controls interaction permissions
        this.checkIdentityImages = {};
        
        // DOM elements
        this.loadingState = document.getElementById('loading-state');
        this.listView = document.getElementById('list-view');
        this.detailView = document.getElementById('detail-view');
        this.checksList = document.getElementById('checks-list');
        
        // Detail view elements
        this.backBtn = document.getElementById('back-btn');
        this.detailHeader = document.getElementById('detail-header');
        this.monitoringCard = document.getElementById('monitoring-card');
        this.abortCard = document.getElementById('abort-card');
        this.detailsCard = document.getElementById('details-card');
        this.documentDetailsCard = document.getElementById('document-details-card');
        this.pepUpdatesCard = document.getElementById('pep-updates-card');
        this.redFlagsCard = document.getElementById('red-flags-card');
        this.tasksSection = document.getElementById('tasks-section');
        this.updatesSection = document.getElementById('updates-section');
        
        this.init();
    }
    
    init() {
        console.log('&#xD83D;&#xDD0D; Thirdfort Checks Manager initialized');
        
        // Set up event listeners
        this.setupEventListeners();
        
        // Listen for messages from parent
        window.addEventListener('message', (event) => this.handleMessage(event));
        
        // Notify parent that iframe is ready
        this.sendMessage('iframe-ready', {});
    }
    
    setupEventListeners() {
        // Back button
        this.backBtn?.addEventListener('click', () => this.showListView());
    }
    
    // ===================================================================
    // MESSAGE HANDLING
    // ===================================================================
    // Parent sends 'checks-data' message with:
    //   - checks: array of check objects
    //   - mode: 'view' or 'edit' (optional, defaults to 'edit')
    //   - thirdfortEnv: 'sandbox' or 'production' (optional, defaults to 'sandbox')
    //
    // VIEW MODE: Read-only access
    //   - CAN view all check details
    //   - CAN open PDF reports
    //   - CANNOT toggle monitoring
    //   - CANNOT abort checks
    //   - CANNOT open in Thirdfort portal (expand arrow hidden)
    //
    // EDIT MODE: Full access (default)
    //   - All interactions enabled
    //   - Can toggle monitoring
    //   - Can abort checks
    //   - Can open in Thirdfort portal
    //
    // THIRDFORT ENVIRONMENT:
    //   - 'production': Opens transactions at https://app.thirdfort.com
    //   - 'sandbox': Opens transactions at https://sandbox.app.thirdfort.com (default)
    // ===================================================================
    
    handleMessage(event) {
        const { type, data } = event.data;
        
        console.log('&#xD83D;&#xDCE8; Message received:', type, data);
        
        switch (type) {
            case 'checks-data':
                // Close any open overlays and load new data
                this.closeAllOverlays();
                this.mode = data.mode || 'edit';
                console.log(`&#xD83D;&#xDD12; Mode set to: ${this.mode}`);
                this.loadChecks(data.checks || []);
                break;
                
            case 'save-success':
                console.log('&#x2705; Save successful:', data);
                this.handleSaveSuccess(data);
                break;
                
            case 'error':
                console.error('&#x274C; Error from parent:', data.message);
                this.showError(data.message);
                break;
                
            case 'check-images':
                this.handleCheckImages((data && data.images) || []);
                break;
        }
    }
    
    handleSaveSuccess(data) {
        // Handle successful save based on what was saved
        if (this.pendingSave) {
            const saveType = this.pendingSave.type;
            const savedAnnotations = this.pendingSave.annotations; // Store annotations that were just saved
            
            if (saveType === 'consider') {
                // Update local check object with new annotations before generating PDF
                if (savedAnnotations && this.currentCheck) {
                    if (!this.currentCheck.considerAnnotations) {
                        this.currentCheck.considerAnnotations = [];
                    }
                    // Add user info and _id to annotations (matching backend format)
                    const userEmail = data.userEmail || 'unknown';
                    const userName = userEmail.split('@')[0];
                    
                    savedAnnotations.forEach(ann => {
                        this.currentCheck.considerAnnotations.unshift({
                            _id: 'temp_' + Date.now() + Math.random().toString(36).substr(2, 9),
                            taskType: ann.taskType,
                            objectivePath: ann.objectivePath,
                            originalStatus: ann.originalStatus,
                            newStatus: ann.newStatus,
                            reason: ann.reason,
                            timestamp: ann.timestamp,
                            user: userEmail,
                            userName: userName
                        });
                    });
                    console.log(`&#x2705; Added ${savedAnnotations.length} annotations to local check object`);
                    console.log('&#xD83D;&#xDCCA; Total annotations now:', this.currentCheck.considerAnnotations.length);
                }
                
                // Generate PDF and open in popup (auto-save = true)
                console.log('&#xD83D;&#xDCC4; Generating consider annotations PDF...');
                this.generateConsiderPDF(true); // Pass true for auto-save
                // Close overlay after PDF generation starts
                setTimeout(() => this.closeConsiderOverlay(), 500);
            } else if (saveType === 'pep-dismissal') {
                // Update local check object with new dismissals before generating PDF
                if (this.pendingSave.dismissals && this.currentCheck) {
                    if (!this.currentCheck.pepDismissals) {
                        this.currentCheck.pepDismissals = [];
                    }
                    
                    // Add user info and _id to dismissals (matching backend format)
                    const userEmail = data.userEmail || 'unknown';
                    const userName = userEmail.split('@')[0];
                    const timestamp = new Date().toISOString();
                    
                    // Flatten all hits from all dismissal batches
                    this.pendingSave.dismissals.forEach(batch => {
                        batch.hits.forEach(hit => {
                            this.currentCheck.pepDismissals.unshift({
                                _id: 'temp_' + Date.now() + Math.random().toString(36).substr(2, 9),
                                hitId: hit.id,
                                hitName: hit.name,
                                reportId: batch.reportId,
                                reportType: hit.type,
                                reason: batch.reason,
                                timestamp: timestamp,
                                user: userEmail,
                                userName: userName
                            });
                        });
                    });
                    console.log(`&#x2705; Added ${this.pendingSave.dismissals.reduce((sum, b) => sum + b.hits.length, 0)} dismissals to local check object`);
                    console.log('&#xD83D;&#xDCCA; Total dismissals now:', this.currentCheck.pepDismissals.length);
                }
                
                // Generate PDF and open in popup (auto-save = true)
                console.log('&#xD83D;&#xDCC4; Generating PEP dismissals PDF...');
                this.generatePepDismissalsPDF(true); // Pass true for auto-save
                // Close overlay after PDF generation starts
                setTimeout(() => this.closePepOverlay(), 500);
            } else if (saveType === 'sof') {
                // Generate PDF and open in popup (auto-save = true)
                console.log('&#xD83D;&#xDCC4; Generating SoF investigation PDF...');
                this.generateSofPDF(true); // Pass true for auto-save
                // Close overlay after PDF generation starts
                setTimeout(() => this.closeSofOverlay(), 500);
            }
            
            this.pendingSave = null;
        }
    }
    
    showError(message) {
        // Create error banner at top of current view
        const errorBanner = document.createElement('div');
        errorBanner.style.cssText = `
            background: #dc3545;
            color: white;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 8px;
            font-family: 'RotisRegular', sans-serif;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
            animation: slideDown 0.3s ease;
        `;
        
        errorBanner.innerHTML = `
            <div>
                <strong style="display: block; margin-bottom: 5px;">Error</strong>
                ${message || 'An error occurred. Please try again.'}
            </div>
            <button onclick="this.parentElement.remove()" style="
                background: none;
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
                padding: 0 5px;
                line-height: 1;
            ">&#xD7;</button>
        `;
        
        // Add to current visible view
        const activeView = document.querySelector('#list-view:not(.hidden), #detail-view:not(.hidden)');
        if (activeView) {
            activeView.insertBefore(errorBanner, activeView.firstChild);
            
            // Auto-remove after 8 seconds
            setTimeout(() => {
                if (errorBanner.parentElement) {
                    errorBanner.style.opacity = '0';
                    errorBanner.style.transition = 'opacity 0.3s ease';
                    setTimeout(() => errorBanner.remove(), 300);
                }
            }, 8000);
        }
    }
    
    sendMessage(type, data) {
        window.parent.postMessage({ type, data }, '*');
    }
    
    // ===================================================================
    // ACTIONS (Post messages to parent)
    // ===================================================================
    
    abortCheck() {
        if (!this.currentCheck) return;
        
        const checkType = this.currentCheck.transactionId ? 'transaction' : 'check';
        const checkId = this.currentCheck.transactionId || this.currentCheck.checkId;
        
        this.sendMessage('cancel-check', {
            id: checkId,
            type: checkType
        });
    }
    
    toggleMonitoring(enabled) {
        if (!this.currentCheck) return;
        
        const checkType = this.currentCheck.transactionId ? 'transaction' : 'check';
        const checkId = this.currentCheck.transactionId || this.currentCheck.checkId;
        
        this.sendMessage('monitoring-patch', {
            id: checkId,
            type: checkType,
            enabled: enabled
        });
    }
    
    viewPDF(s3Key) {
        this.sendMessage('view-pdf', {
            s3Key: s3Key
        });
    }
    
    // ===================================================================
    // DATA LOADING
    // ===================================================================
    
    loadChecks(checks) {
        console.log('&#xD83D;&#xDCCA; Loading checks:', checks.length);
        
        this.checkIdentityImages = {};
        this.currentCheck = null;
        this.checks = checks;
        
        if (checks.length === 0) {
            this.showEmptyState();
        } else {
            this.renderChecksList();
            this.showListView();
        }
    }
    
    // ===================================================================
    // VIEW MANAGEMENT
    // ===================================================================
    
    /**
     * Centralized view switcher - ensures only ONE view visible at a time
     * @param {string} view - 'loading' | 'empty' | 'list' | 'detail'
     */
    switchView(view) {
        console.log('&#xD83D;&#xDD04; Switching view to:', view);
        
        // Step 1: Hide ALL views
        this.loadingState.classList.add('hidden');
        this.listView.classList.add('hidden');
        this.detailView.classList.add('hidden');
        
        // Step 2: Show requested view
        if (view === 'loading') {
            this.loadingState.classList.remove('hidden');
        } else if (view === 'empty') {
            // Empty state uses list-view container with message
            this.checksList.innerHTML = '<div style="padding: 40px; text-align: center; color: #666;">No Thirdfort checks found</div>';
            this.listView.classList.remove('hidden');
        } else if (view === 'list') {
            this.listView.classList.remove('hidden');
        } else if (view === 'detail') {
            this.detailView.classList.remove('hidden');
        }
        
        // Step 3: Update state
        this.currentView = view;
    }
    
    showListView() {
        // Close any open overlays when going back to list
        this.closeAllOverlays();
        this.switchView('list');
    }
    
    showDetailView(check) {
        this.currentCheck = check;
        this.switchView('detail');
        this.renderDetailView(check);
    }
    
    showEmptyState() {
        this.switchView('empty');
    }
    
    // ===================================================================
    // LIST VIEW RENDERING
    // ===================================================================
    
    renderChecksList() {
        this.checksList.innerHTML = '';
        
        this.checks.forEach(check => {
            const checkElement = this.createCheckListItem(check);
            this.checksList.appendChild(checkElement);
        });
    }
    
    createCheckListItem(check) {
        const container = document.createElement('div');
        container.className = 'check-item';
        container.onclick = () => this.showDetailView(check);
        
        // 1. PEP Icon
        container.appendChild(this.createPepIcon(check));
        
        // 2. Status Icon
        container.appendChild(this.createStatusIcon(check));
        
        // 3. Check Type Section (type, tags, initiated by)
        container.appendChild(this.createCheckTypeSection(check));
        
        // 4. Info/Warning Hints Column
        container.appendChild(this.createHintsColumn(check));
        
        // 5. Last Update Card
        container.appendChild(this.createLastUpdateCard(check));
        
        // 6. Doc Button Column (always present to maintain layout)
        const docButtonColumn = document.createElement('div');
        docButtonColumn.className = 'doc-button-column';
        const docButton = this.createDocButton(check);
        if (docButton) {
            docButtonColumn.appendChild(docButton);
        }
        container.appendChild(docButtonColumn);
        
        return container;
    }
    
    createPepIcon(check) {
        const div = document.createElement('div');
        div.className = 'pep-icon';
        
        if (check.hasMonitoring) {
            const badge = document.createElement('div');
            badge.className = 'pep-badge';
            div.appendChild(badge);
        }
        
        return div;
    }
    
    createStatusIcon(check) {
        const div = document.createElement('div');
        div.className = 'status-icon';
        
        const status = check.status;
        let svg = '';
        
        if (status === 'open' || status === 'processing') {
            // Sandtimer icon (from plan)
            svg = `<svg viewBox="0 0 2016.63 3158.45" xmlns="http://www.w3.org/2000/svg"><g><path d="M176.12 101.62c-40.65 0-73.73 33.08-73.73 73.73v23.06c0 40.65 33.08 73.73 73.73 73.73h1665.16c40.66 0 73.73-33.08 73.73-73.73v-23.06c0-40.65-33.07-73.73-73.73-73.73zm1665.16 272.15H176.12C79.43 373.77.77 295.1.77 198.42v-23.06C.77 78.66 79.43 0 176.12 0h1665.16c96.69 0 175.35 78.66 175.35 175.35v23.06c0 96.69-78.66 175.35-175.35 175.35Z" fill="#143b65"/><path d="M175.35 2886.3c-40.66 0-73.73 33.07-73.73 73.73v23.06c0 40.65 33.08 73.72 73.73 73.72h1665.16c40.66 0 73.73-33.07 73.73-73.72v-23.06c0-40.66-33.07-73.73-73.73-73.73zm1665.16 272.15H175.35C78.66 3158.45 0 3079.79 0 2983.1v-23.06c0-96.69 78.66-175.35 175.35-175.35h1665.16c96.69 0 175.35 78.66 175.35 175.35v23.06c0 96.69-78.66 175.35-175.35 175.35" fill="#143b65"/><path d="M206.07 2886.31c-22.66 0-43.31-15.26-49.19-38.23-14.57-56.94-23.36-121.71-26.85-198.02-3.42-74.76.24-148.23 10.86-218.35 11.36-74.92 30.77-146.49 57.69-212.71 41.27-101.53 107-196.78 190.07-275.45 44.3-41.94 94.02-75.98 142.1-108.89 10.14-6.93 20.62-14.12 30.76-21.17 54.65-38.02 123.28-89.65 169.36-151.87 35.92-48.5 35.92-116.27 0-164.78-46.08-62.21-114.71-113.84-169.36-151.87-10.14-7.04-20.62-14.23-30.75-21.16-48.09-32.92-97.81-66.95-142.1-108.89-83.07-78.67-148.79-173.92-190.07-275.46-26.92-66.22-46.33-137.79-57.69-212.71-10.63-70.12-14.28-143.59-10.86-218.35 3.49-76.31 12.27-141.08 26.85-198.02 6.96-27.19 34.63-43.58 61.82-36.62s43.58 34.64 36.63 61.82c-12.83 50.13-20.61 108.18-23.78 177.47-6.48 141.75 14.1 272.34 61.18 388.15 35.85 88.2 93.19 171.17 165.8 239.94 38.45 36.41 82.74 66.72 129.62 98.81 10.3 7.04 20.94 14.33 31.4 21.6 61.02 42.47 138.11 100.7 192.99 174.81 30.79 41.59 47.07 90.99 47.07 142.87s-16.28 101.28-47.07 142.87c-54.88 74.1-131.96 132.34-192.99 174.8-10.46 7.28-21.11 14.57-31.4 21.61-46.88 32.1-91.17 62.4-129.62 98.82-72.62 68.77-129.95 151.74-165.8 239.94-47.08 115.82-67.66 246.41-61.18 388.16 3.17 69.28 10.95 127.33 23.78 177.47 6.96 27.19-9.44 54.87-36.63 61.82-4.23 1.09-8.46 1.6-12.64 1.6Z" fill="#143b65"/><path d="M1811.34 2886.31c-4.17 0-8.41-.51-12.63-1.6-27.19-6.95-43.58-34.63-36.63-61.82 12.83-50.13 20.61-108.18 23.78-177.47 6.49-141.75-14.1-272.34-61.17-388.16-35.86-88.2-93.19-171.17-165.81-239.94-38.45-36.41-82.73-66.72-129.62-98.82-10.29-7.04-20.94-14.33-31.4-21.61-61.02-42.46-138.1-100.7-192.99-174.8-30.79-41.59-47.07-90.99-47.07-142.87s16.28-101.28 47.07-142.87c54.88-74.11 131.97-132.34 192.99-174.81 10.46-7.27 21.1-14.56 31.4-21.6 46.88-32.1 91.17-62.4 129.62-98.81 72.62-68.77 129.95-151.74 165.81-239.94 47.07-115.81 67.66-246.41 61.17-388.15-3.17-69.29-10.95-127.34-23.78-177.46-6.95-27.19 9.44-54.86 36.63-61.82s54.87 9.44 61.82 36.62c14.57 56.94 23.35 121.71 26.85 198.02 3.42 74.77-.24 148.23-10.87 218.35-11.36 74.92-30.76 146.49-57.69 212.71-41.27 101.54-106.99 196.79-190.06 275.46-44.3 41.94-94.01 75.98-142.1 108.89-10.14 6.93-20.62 14.12-30.75 21.17-54.65 38.02-123.28 89.65-169.37 151.86-35.93 48.51-35.93 116.28 0 164.78 46.08 62.22 114.72 113.85 169.37 151.87 10.14 7.05 20.62 14.23 30.75 21.17 48.09 32.92 97.81 66.95 142.1 108.89 83.07 78.67 148.79 173.92 190.06 275.45 26.93 66.23 46.33 137.8 57.69 212.71 10.63 70.13 14.28 143.59 10.87 218.35-3.5 76.31-12.28 141.09-26.85 198.02-5.88 22.97-26.53 38.23-49.19 38.23" fill="#143b65"/><path d="M1007.89 1675.69c-26.64 0-49.01-20.75-50.67-47.69-8.22-133.84-77.14-242.52-223.46-352.37-3.71-2.79-7.39-5.54-11.05-8.28-33.38-24.95-64.91-48.52-95.74-79.78-35.54-36.01-66.97-74.65-93.4-114.86-6.27-9.54-11.46-19.12-16.03-27.55-5.46-10.09-10.18-18.79-15.63-25.79a50.78 50.78 0 0 1-5.48-53.71c8.62-17.47 26.48-28.46 45.97-28.32 24.83.2 50.19.19 74.7.19h390.85c28.06 0 50.81 22.75 50.81 50.81s-22.75 50.82-50.81 50.82h-374.1c19.32 26.7 41.26 52.53 65.45 77.05 25.47 25.81 54.03 47.16 84.26 69.76 3.71 2.78 7.45 5.57 11.21 8.4 77.86 58.45 136.31 117.27 178.69 179.82 24.7 36.45 44.33 74.95 58.32 114.4 15.01 42.3 24.04 87.11 26.88 133.18 1.72 28.01-19.59 52.11-47.6 53.83-1.06.07-2.11.1-3.16.1Z" fill="#143b65"/><path d="M1007.99 1675.69c-1.06 0-2.1-.03-3.17-.1-28.01-1.72-49.32-25.82-47.6-53.83 2.83-46.07 11.87-90.88 26.87-133.18 13.99-39.45 33.61-77.95 58.32-114.4 42.38-62.55 100.83-121.37 178.68-179.82 3.76-2.83 7.51-5.62 11.22-8.41 30.23-22.59 58.79-43.94 84.25-69.75 24.2-24.53 46.14-50.36 65.47-77.07-96.22-.33-199.46-.2-299.38-.07l-74.68.09h-.05c-28.05 0-50.79-22.72-50.81-50.77-.03-28.06 22.7-50.83 50.76-50.86 24.83-.02 49.75-.06 74.66-.09 102.15-.13 207.8-.26 305.99.09 28.15.1 56.73.04 84.95-.19h.41c19.33 0 36.99 10.97 45.56 28.33 8.62 17.48 6.5 38.34-5.48 53.71-5.45 7-10.16 15.71-15.63 25.79-4.57 8.44-9.75 18.01-16.02 27.55-26.44 40.21-57.87 78.85-93.41 114.86-30.83 31.26-62.35 54.83-95.73 79.77-3.66 2.75-7.35 5.5-11.05 8.29-146.32 109.85-215.24 218.52-223.46 352.37-1.66 26.94-24.03 47.69-50.67 47.69" fill="#143b65"/><path d="M1611.93 2886.31c-23.25 0-44.23-16.06-49.53-39.69-57.58-256.43-290.45-442.54-553.7-442.54s-496.1 186.11-553.68 442.54c-6.15 27.38-33.33 44.59-60.71 38.45-27.38-6.15-44.59-33.33-38.44-60.71 16.54-73.65 45.3-143.51 85.48-207.64 39.42-62.91 88.7-118.52 146.46-165.33 58.3-47.22 123.49-84.03 193.77-109.39 72.73-26.25 149.15-39.54 227.12-39.54s154.4 13.3 227.14 39.54c70.28 25.36 135.47 62.17 193.77 109.39 57.77 46.79 107.04 102.42 146.47 165.33 40.19 64.13 68.94 133.98 85.48 207.64 6.15 27.38-11.06 54.56-38.44 60.71-3.75.84-7.5 1.24-11.18 1.24Z" fill="#143b65"/><path d="M1008.71 1916.54c-18.48 0-33.52 15.04-33.52 33.52s15.03 33.52 33.52 33.52 33.52-15.04 33.52-33.52-15.04-33.52-33.52-33.52m0 101.63c-37.55 0-68.11-30.54-68.11-68.1s30.55-68.1 68.11-68.1 68.1 30.55 68.1 68.1-30.54 68.1-68.1 68.1" fill="#143b65"/><path d="M1008.71 2103.36c-18.48 0-33.52 15.04-33.52 33.52s15.03 33.52 33.52 33.52 33.52-15.04 33.52-33.52-15.04-33.52-33.52-33.52m0 101.62c-37.55 0-68.11-30.55-68.11-68.1s30.55-68.1 68.11-68.1 68.1 30.54 68.1 68.1-30.54 68.1-68.1 68.1" fill="#143b65"/></g></svg>`;
        } else if (status === 'closed') {
            // Tick icon (from plan)
            svg = `<svg viewBox="0 0 3205.06 3205.06" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" stroke="#143b65" stroke-miterlimit="10" stroke-width="141.73" d="M3134.2 1602.53v.01c0 845.912-685.748 1531.66-1531.66 1531.66h-.01c-845.912 0-1531.66-685.748-1531.66-1531.66v-.01c0-845.912 685.748-1531.66 1531.66-1531.66h.01c845.912 0 1531.66 685.748 1531.66 1531.66z"/><path fill="none" stroke="#143b65" stroke-miterlimit="10" stroke-width="141.73" stroke-linecap="round" d="m1386.44 2324.8 827.22-1444.54"/><path fill="none" stroke="#143b65" stroke-miterlimit="10" stroke-width="141.73" stroke-linecap="round" d="M1386.44 2324.8 991.4 1767.73"/></g></svg>`;
        } else if (status === 'aborted') {
            // Cross icon (from plan)
            svg = `<svg viewBox="0 0 3205.06 3205.06" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" stroke="#143b65" stroke-linecap="round" stroke-miterlimit="10" stroke-width="141.73" d="M3134.2 1602.53v.01c0 845.912-685.748 1531.66-1531.66 1531.66h-.01c-845.912 0-1531.66-685.748-1531.66-1531.66v-.01c0-845.912 685.748-1531.66 1531.66-1531.66h.01c845.912 0 1531.66 685.748 1531.66 1531.66z"/><path fill="none" stroke="#143b65" stroke-linecap="round" stroke-miterlimit="10" stroke-width="141.73" d="M826.94 2378.12 2378.12 826.94"/><path fill="none" stroke="#143b65" stroke-linecap="round" stroke-miterlimit="10" stroke-width="141.73" d="M2378.12 2378.12 826.94 826.94"/></g></svg>`;
        }
        
        div.innerHTML = svg;
        return div;
    }
    
    createCheckTypeSection(check) {
        const div = document.createElement('div');
        div.className = 'check-type-section';
        
        // Header with type, tags, and SH icon
        const header = document.createElement('div');
        header.className = 'check-type-header';
        
        // Check type label
        const typeLabel = document.createElement('span');
        typeLabel.className = 'check-type-label';
        typeLabel.textContent = this.getCheckTypeLabel(check);
        header.appendChild(typeLabel);
        
        // CLEAR/CONSIDER tag (only if closed AND PDF ready)
        if (check.status === 'closed' && check.pdfReady) {
            const tag = document.createElement('span');
            tag.className = `outcome-tag ${check.hasAlerts ? 'consider' : 'clear'}`;
            tag.textContent = check.hasAlerts ? 'CONSIDER' : 'CLEAR';
            header.appendChild(tag);
        }
        
        // Safe Harbour icon (only for Enhanced ID that meets criteria)
        if (this.checksSafeHarbour(check)) {
            const shIcon = document.createElement('span');
            shIcon.className = 'safe-harbour-icon';
            shIcon.innerHTML = `<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g><path d="M115.238 149.524H84.762c-13.304 0-24.127-10.823-24.127-24.127V105.08c0-7.702 6.266-13.968 13.968-13.968h50.794c7.702 0 13.968 6.266 13.968 13.968v20.317c0 13.303-10.823 24.127-24.127 24.127zM74.603 98.73a6.356 6.356 0 0 0-6.349 6.349v20.317c0 9.102 7.405 16.508 16.508 16.508h30.476c9.103 0 16.508-7.406 16.508-16.508v-20.317a6.356 6.356 0 0 0-6.349-6.349H74.603z" fill="#112F5B" data-color="1"></path><path d="M125.397 98.73a3.81 3.81 0 0 1-3.81-3.81V74.603c0-9.102-7.405-16.508-16.508-16.508H94.921c-9.103 0-16.508 7.406-16.508 16.508V94.92a3.81 3.81 0 1 1-7.62 0V74.603c0-13.304 10.823-24.127 24.127-24.127h10.159c13.304 0 24.127 10.823 24.127 24.127V94.92a3.809 3.809 0 0 1-3.809 3.81z" fill="#112F5B" data-color="1"></path><path d="M100 129.206a3.81 3.81 0 0 1-3.81-3.81v-10.159a3.81 3.81 0 1 1 7.62 0v10.159a3.81 3.81 0 0 1-3.81 3.81z" fill="#112F5B" data-color="1"></path><path d="M166.032 180H33.968C26.266 180 20 173.734 20 166.032V33.968C20 26.266 26.266 20 33.968 20h132.064C173.734 20 180 26.266 180 33.968v132.064c0 7.702-6.266 13.968-13.968 13.968zM33.968 27.619a6.356 6.356 0 0 0-6.349 6.349v132.064a6.356 6.356 0 0 0 6.349 6.349h132.064a6.356 6.356 0 0 0 6.349-6.349V33.968a6.356 6.356 0 0 0-6.349-6.349H33.968z" fill="#112F5B" data-color="1"></path></g></svg>`;
            shIcon.title = 'Safe Harbour Compliant';
            header.appendChild(shIcon);
        }
        
        div.appendChild(header);
        
        // Initiated by
        const initiatedBy = document.createElement('div');
        initiatedBy.className = 'initiated-by';
        const initiatedDate = new Date(check.initiatedAt).toLocaleDateString('en-GB');
        initiatedBy.innerHTML = `<strong>Initiated by:</strong> <span class="name">${check.initiatedBy}</span> <span class="date">${initiatedDate}</span>`;
        div.appendChild(initiatedBy);
        
        return div;
    }
    
    createHintsColumn(check) {
        const column = document.createElement('div');
        column.className = 'hints-column';
        
        const hints = this.generateHints(check);
        if (hints.length > 0) {
            // Show max 9 hints, prioritized
            hints.slice(0, 9).forEach(hint => {
                const hintElement = document.createElement('div');
                hintElement.className = `hint ${hint.level}`;
                hintElement.innerHTML = `<span class="hint-icon">${this.getHintIcon(hint.level)}</span>${hint.text}`;
                column.appendChild(hintElement);
            });
        }
        
        return column;
    }
    
    createLastUpdateCard(check) {
        const card = document.createElement('div');
        card.className = 'last-update-card';
        
        const updates = check.updates || [];
        const lastUpdate = updates[updates.length - 1];
        
        if (lastUpdate) {
            const date = document.createElement('div');
            date.className = 'last-update-date';
            date.textContent = new Date(lastUpdate.timestamp).toLocaleDateString('en-GB');
            card.appendChild(date);
            
            const message = document.createElement('div');
            message.className = 'last-update-message';
            message.textContent = lastUpdate.update;
            card.appendChild(message);
        } else {
            card.innerHTML = '<div class="last-update-message">No updates</div>';
        }
        
        return card;
    }
    
    createDocButton(check) {
        // Only create button if PDF is available
        if (!check.pdfReady || !check.pdfS3Key) {
            return null;
        }
        
        const btn = document.createElement('button');
        btn.className = 'doc-btn';
        btn.innerHTML = `<svg viewBox="0 0 24 24" fill="#1d71b8"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/></svg>`;
        btn.title = 'View PDF Report';
        btn.onclick = (e) => {
            e.stopPropagation();
            this.viewPDF(check.pdfS3Key);
        };
        
        return btn;
    }
    
    // ===================================================================
    // DETAIL VIEW RENDERING
    // ===================================================================
    
    renderDetailView(check) {
        console.log('&#xD83D;&#xDCCB; Rendering detail view for check:', check);
        
        // Render top action buttons
        this.renderTopActionButtons(check);
        
        // Render abort card FIRST (if applicable) - appears above header
        this.renderAbortCard(check);
        
        // Render header
        this.renderDetailHeader(check);
        
        // Render monitoring card (if applicable)
        this.renderMonitoringCard(check);
        
        // Render client/company details
        this.renderDetailsCard(check);
        
        // Render document details (IDV and electronic-id with detailed properties)
        if (check.checkType === 'idv' || check.checkType === 'electronic-id') {
            this.renderDocumentDetailsCard(check);
        } else {
            // Hide document details card for other check types
            if (this.documentDetailsCard) {
                this.documentDetailsCard.classList.add('hidden');
            }
        }
        
        // Render PEP/Sanctions updates (if any)
        this.renderPepUpdatesCard(check);
        
        // Render red flags card (if any)
        this.renderRedFlagsCard(check);
        
        // Render tasks/reports
        this.renderTasksSection(check);
        
        // Render updates/audit trail
        this.renderUpdatesSection(check);
    }
    
    renderTopActionButtons(check) {
        const actionButtonsContainer = document.querySelector('.detail-action-buttons');
        if (!actionButtonsContainer) return;
        
        let buttons = '';
        
        // Button order: [Add Notes] [Dismiss PEPs] [SoF Investigation] [PDF icon] [Expand icon]
        
        // 1. Consider overlay button (Add Notes) - Text + Icon
        if (check.status === 'closed' && this.hasConsiderFailItems(check)) {
            buttons += `
                <button class="top-action-btn-text" onclick="manager.renderConsiderOverlay(manager.currentCheck)" 
                    title="Annotate Consider/Fail Items">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="rgb(0,60,113)" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    <span>Add Notes</span>
                </button>
            `;
        }
        
        // 2. PEP dismissal overlay button (Dismiss PEPs) - Text + Icon
        if (check.status === 'closed' && this.hasPepSanctionsHits(check)) {
            buttons += `
                <button class="top-action-btn-text" onclick="manager.renderPepDismissalOverlay(manager.currentCheck)" 
                    title="Whitelist PEP/Sanctions Hits">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="rgb(0,60,113)" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                    <span>Dismiss PEPs</span>
                </button>
            `;
        }
        
        // 3. SoF overlay button - Text + Icon
        if (check.status === 'closed' && this.hasSofBankTasks(check)) {
            buttons += `
                <button class="top-action-btn-text" onclick="manager.renderSofOverlay(manager.currentCheck)" 
                    title="Source of Funds Investigation Notes">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="rgb(0,60,113)" stroke-width="2">
                        <line x1="12" y1="1" x2="12" y2="23"/>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                    <span>SoF Investigation</span>
                </button>
            `;
        }
        
        // 4. View Report button - Icon only
        if (check.pdfReady && check.pdfS3Key) {
            buttons += `
                <button class="top-action-btn" onclick="manager.viewPDF('${check.pdfS3Key}')" title="View PDF Report">
                    <svg viewBox="0 0 24 24" fill="#1d71b8">
                        <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
                    </svg>
                </button>
            `;
        }
        
        // 5. Expand button - Icon only
        if (check.transactionId) {
            buttons += `
                <button class="top-action-btn" onclick="manager.openThirdfortTransaction('${check.checkType}', '${check.transactionId}')" title="View in Thirdfort Portal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1d71b8" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3"/>
                    </svg>
                </button>
            `;
        }
        
        actionButtonsContainer.innerHTML = buttons;
    }
    
    openThirdfortTransaction(checkType, transactionId) {
        // Determine environment (sandbox or production)
        // For now, default to sandbox - this should be set from backend via THIRDFORT_ENV secret
        const env = this.thirdfortEnv || 'sandbox';
        
        // Build base URL
        const baseUrl = env === 'production' 
            ? 'https://app.thirdfort.com' 
            : 'https://sandbox.app.thirdfort.com';
        
        // Determine URL path based on check type
        let urlPath;
        if (checkType === 'idv') {
            urlPath = `/documents/${transactionId}`;
        } else if (checkType === 'kyb') {
            urlPath = `/know-your-business/${transactionId}`;
        } else {
            // electronic-id, idv-lite (includes all electronic checks and lite screening)
            urlPath = `/activities/${transactionId}`;
        }
        
        const thirdfortUrl = `${baseUrl}${urlPath}`;
        
        console.log('&#xD83D;&#xDD17; Opening Thirdfort transaction:', {
            checkType,
            transactionId,
            env,
            url: thirdfortUrl
        });
        
        // Open in popup window
        window.open(thirdfortUrl, '_blank', 'width=1400,height=900,resizable=yes,scrollbars=yes');
    }
    
    renderDetailHeader(check) {
        const isEnhanced = this.isEnhancedID(check);
        const isSafeHarbour = this.checksSafeHarbour(check);
        
        let statusTag = '';
        if (check.status === 'processing' || check.status === 'open') {
            statusTag = '<span class="status-tag processing">PROCESSING</span>';
        } else if (check.status === 'aborted') {
            statusTag = '<span class="status-tag cancelled">CANCELLED</span>';
        } else if (check.status === 'closed') {
            // Only show CLEAR/CONSIDER if PDF is ready, otherwise show PROCESSING
            if (check.pdfReady) {
                statusTag = check.hasAlerts 
                    ? '<span class="status-tag consider">CONSIDER</span>' 
                    : '<span class="status-tag clear">CLEAR</span>';
            } else {
                statusTag = '<span class="status-tag processing">PROCESSING</span>';
            }
        }
        
        const pepHitsCount = (check.pepSanctionsUpdates || []).reduce((sum, update) => 
            sum + (update.matchCount || 0), 0
        );
        
        const pepBadge = pepHitsCount > 0 
            ? `<span class="pep-hits-badge">${pepHitsCount} PEP/Sanctions hit${pepHitsCount > 1 ? 's' : ''}</span>` 
            : '';
        
        const shIcon = isSafeHarbour 
            ? `<span class="safe-harbour-icon" title="Safe Harbour Compliant"><svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g><path d="M115.238 149.524H84.762c-13.304 0-24.127-10.823-24.127-24.127V105.08c0-7.702 6.266-13.968 13.968-13.968h50.794c7.702 0 13.968 6.266 13.968 13.968v20.317c0 13.303-10.823 24.127-24.127 24.127zM74.603 98.73a6.356 6.356 0 0 0-6.349 6.349v20.317c0 9.102 7.405 16.508 16.508 16.508h30.476c9.103 0 16.508-7.406 16.508-16.508v-20.317a6.356 6.356 0 0 0-6.349-6.349H74.603z" fill="#112F5B" data-color="1"></path><path d="M125.397 98.73a3.81 3.81 0 0 1-3.81-3.81V74.603c0-9.102-7.405-16.508-16.508-16.508H94.921c-9.103 0-16.508 7.406-16.508 16.508V94.92a3.81 3.81 0 1 1-7.62 0V74.603c0-13.304 10.823-24.127 24.127-24.127h10.159c13.304 0 24.127 10.823 24.127 24.127V94.92a3.809 3.809 0 0 1-3.809 3.81z" fill="#112F5B" data-color="1"></path><path d="M100 129.206a3.81 3.81 0 0 1-3.81-3.81v-10.159a3.81 3.81 0 1 1 7.62 0v10.159a3.81 3.81 0 0 1-3.81 3.81z" fill="#112F5B" data-color="1"></path><path d="M166.032 180H33.968C26.266 180 20 173.734 20 166.032V33.968C20 26.266 26.266 20 33.968 20h132.064C173.734 20 180 26.266 180 33.968v132.064c0 7.702-6.266 13.968-13.968 13.968zM33.968 27.619a6.356 6.356 0 0 0-6.349 6.349v132.064a6.356 6.356 0 0 0 6.349 6.349h132.064a6.356 6.356 0 0 0 6.349-6.349V33.968a6.356 6.356 0 0 0-6.349-6.349H33.968z" fill="#112F5B" data-color="1"></path></g></svg></span>` 
            : '';
        
        const pepMonIcon = check.hasMonitoring ? '<span class="pep-badge" style="margin-right: 8px;"></span>' : '';
        
        // Build meta items dynamically (only show if data exists)
        const metaItems = [];
        
        if (check.initiatedBy) {
            metaItems.push(`
                <div class="meta-item">
                    <div class="meta-label">Initiated By</div>
                    <div class="meta-value">${check.initiatedBy}</div>
                </div>
            `);
        }
        
        if (check.initiatedAt) {
            const initiatedDate = new Date(check.initiatedAt).toLocaleDateString('en-GB');
            metaItems.push(`
                <div class="meta-item">
                    <div class="meta-label">Initiated</div>
                    <div class="meta-value">${initiatedDate}</div>
                </div>
            `);
        }
        
        if (check.updatedAt) {
            const updatedDate = new Date(check.updatedAt).toLocaleDateString('en-GB');
            metaItems.push(`
                <div class="meta-item">
                    <div class="meta-label">Last Updated</div>
                    <div class="meta-value">${updatedDate}</div>
                </div>
            `);
        }
        
        if (check.completedAt) {
            const completedDate = new Date(check.completedAt).toLocaleDateString('en-GB');
            metaItems.push(`
                <div class="meta-item">
                    <div class="meta-label">Completed</div>
                    <div class="meta-value">${completedDate}</div>
                </div>
            `);
        }
        
        // Add Transaction/Check ID for support reference
        const resourceId = check.transactionId || check.checkId;
        const resourceType = check.transactionId ? 'Transaction ID' : 'Check ID';
        if (resourceId) {
            metaItems.push(`
                <div class="meta-item">
                    <div class="meta-label">${resourceType}</div>
                    <div class="meta-value" style="font-family: monospace; user-select: all; cursor: text;" title="Click to select all, then copy">${resourceId}</div>
                </div>
            `);
        }
        
        // Get Thirdfort URL
        const env = 'sandbox'; // TODO: Make this dynamic
        const baseUrl = env === 'production' ? 'https://app.thirdfort.io' : 'https://sandbox.thirdfort.io';
        const thirdfortUrl = check.transactionId 
            ? `${baseUrl}/transactions/${check.transactionId}`
            : `${baseUrl}/checks/${check.checkId}`;
        
        const identityMarkup = this.getIdentityComparisonMarkup(check);

        this.detailHeader.innerHTML = `
            <div class="header-top">
                ${pepMonIcon}
                <span class="check-type-large">${this.getCheckTypeLabel(check)}</span>
                ${statusTag}
                ${shIcon}
                ${pepBadge}
            </div>
            <div class="header-meta-grid">
                ${metaItems.join('')}
            </div>
            ${identityMarkup}
        `;
    }
    
    renderMonitoringCard(check) {
        // Hide in view mode or for IDV (no monitoring option)
        if (this.mode === 'view' || check.checkType === 'idv') {
            this.monitoringCard.classList.add('hidden');
            return;
        }
        
        const hasMonitoring = check.hasMonitoring === true;
        
        // Check if check has PEP/sanctions/screening tasks (required for monitoring)
        const tasks = check.tasks || [];
        const taskOutcomes = check.taskOutcomes || {};
        const hasPepSanctionsTasks = tasks.includes('report:peps') || 
                                     tasks.includes('report:screening:lite') ||
                                     taskOutcomes['peps'] || 
                                     taskOutcomes['sanctions'] ||
                                     taskOutcomes['company:peps'] ||
                                     taskOutcomes['company:sanctions'];
        
        // Can only toggle/show monitoring if check has PEP/sanctions tasks
        const canToggle = (check.checkType === 'electronic-id' || check.checkType === 'lite-screen') 
                          && check.status !== 'aborted'
                          && hasPepSanctionsTasks;
        const canDisable = check.checkType === 'kyb' && hasMonitoring && check.status !== 'aborted';
        
        if (!canToggle && !canDisable) {
            this.monitoringCard.classList.add('hidden');
            return;
        }
        
        this.monitoringCard.classList.remove('hidden');
        this.monitoringCard.className = hasMonitoring ? 'card monitoring-card' : 'card monitoring-card disabled';
        
        const title = hasMonitoring ? 'Ongoing Monitoring' : 'Enable Ongoing Monitoring';
        const description = hasMonitoring 
            ? 'This client will undergo continuous PEP and sanctions monitoring for 12 months. Updates will be sent automatically if their status changes.'
            : 'Turn on monitoring to enable continuous PEP and sanctions screening for this client. You will be notified of any status changes.';
        
        this.monitoringCard.innerHTML = `
            <div class="monitoring-header">
                <div class="monitoring-title">${title}</div>
                <div class="monitoring-toggle ${hasMonitoring ? 'enabled' : ''}" onclick="manager.toggleMonitoring(${hasMonitoring})">
                    <div class="monitoring-toggle-slider"></div>
                </div>
            </div>
            <div class="monitoring-description">${description}</div>
        `;
    }
    
    renderAbortCard(check) {
        // Hide in view mode
        if (this.mode === 'view') {
            this.abortCard.classList.add('hidden');
            return;
        }
        
        // Only show abort for:
        // 1. Status is open or processing
        // 2. It's a v2 transaction (ID starts with 'c')
        // v1 checks (IDV, etc.) and v2 checks (KYB) cannot be aborted via API
        const isOpenStatus = check.status === 'open' || check.status === 'processing';
        
        // Check both transactionId and checkId fields (either could be used)
        const checkId = check.transactionId ? true : false
        const isV2Transaction = checkId
        
        const canAbort = isOpenStatus && isV2Transaction;
        
        console.log('&#xD83D;&#xDD0D; Abort card check:', {
            status: check.status,
            isOpenStatus,
            checkId,
            transactionId: check.transactionId,
            checkIdField: check.checkId,
            isV2Transaction,
            canAbort
        });
        
        if (!canAbort) {
            this.abortCard.classList.add('hidden');
            return;
        }
        
        this.abortCard.classList.remove('hidden');
        this.abortCard.innerHTML = `
            <div class="abort-content">
                <div class="abort-text">
                    <div class="abort-title">Cancel Check</div>
                    <div class="abort-description">If you no longer wish to conduct this check you may cancel it</div>
                </div>
                <button class="abort-btn" onclick="manager.abortCheck()">ABORT CHECK</button>
            </div>
        `;
    }
    
    renderDetailsCard(check) {
        const isPersonCheck = check.checkType === 'electronic-id' || 
                              check.checkType === 'lite-screen' || 
                              check.checkType === 'idv';
        
        let detailsContent = '';
        
        if (isPersonCheck) {
            // Person checks (Electronic ID, Lite Screen, IDV)
            const piiData = check.piiData || {};
            const expectations = check.expectations || {};  // Lite Screen expectations (available before completion)
            
            // For screening:lite checks, get data from the task outcome
            const screeningLiteData = check.taskOutcomes?.['screening:lite']?.data || {};
            const isScreeningLite = screeningLiteData && Object.keys(screeningLiteData).length > 0;
            
            // For IDV checks, also pull data from identity:lite taskOutcomes
            const idvProperties = check.checkType === 'idv' 
                ? check.taskOutcomes?.['identity:lite']?.breakdown?.document?.properties 
                : null;
            
            const consumerName = check.consumerName ? check.consumerName.trim() : '';
            const name = (consumerName || 
                        (isScreeningLite && screeningLiteData['name:lite'] ? 
                            `${screeningLiteData['name:lite'].first || ''} ${screeningLiteData['name:lite'].last || ''}`.trim() : '') ||
                        (idvProperties ? `${idvProperties.first_name || ''} ${idvProperties.last_name || ''}`.trim() : '') ||
                        (expectations.name?.data ? `${expectations.name.data.first || ''} ${expectations.name.data.last || ''}`.trim() : '') ||
                        (piiData.name ? `${piiData.name.first || ''} ${piiData.name.last || ''}`.trim() : '')) || '&#x2014;';
            
            // For screening:lite, use yob (year of birth) instead of full DOB
            const dob = isScreeningLite && screeningLiteData.yob 
                ? screeningLiteData.yob  // Just show the year for screening:lite
                : idvProperties?.date_of_birth 
                    ? new Date(idvProperties.date_of_birth).toLocaleDateString('en-GB')
                    : (expectations.dob?.data ? new Date(expectations.dob.data).toLocaleDateString('en-GB') : '')
                    || (piiData.dob ? new Date(piiData.dob).toLocaleDateString('en-GB') : '&#x2014;');
            
            const mobile = check.consumerPhone || check.thirdfortResponse?.request?.actor?.phone || '&#x2014;';
            const email = check.consumerEmail || check.thirdfortResponse?.request?.actor?.email || '&#x2014;';
            
            // Address - use piiData first, then expectations for lite-screen
            const address = piiData.address || expectations.address?.data || {};
            const fullAddress = [
                address.line1 || (address.building_number || address.building_name ? 
                    [address.building_number, address.building_name, address.street].filter(Boolean).join(', ') : ''),
                address.line2,
                address.town,
                address.postcode,
                address.country
            ].filter(Boolean).join(', ') || '&#x2014;';
            
            const docInfo = check.taskOutcomes?.['document']?.data || {};
            const docNumber = docInfo.number || piiData.document?.number || 
                            (idvProperties?.document_numbers?.[0]?.value) || '&#x2014;';
            const mrz = piiData.document?.mrz_line1 && piiData.document?.mrz_line2
                ? `${piiData.document.mrz_line1}\n${piiData.document.mrz_line2}`
                : '';
            
            // Additional IDV-specific fields
            const documentType = check.documentType || idvProperties?.document_type || '';
            const expiryDate = idvProperties?.date_of_expiry 
                ? new Date(idvProperties.date_of_expiry).toLocaleDateString('en-GB')
                : '';
            const issuingCountry = idvProperties?.issuing_country || '';
            const nationality = idvProperties?.nationality || '';
            
            // Build client details grid items (only show if data exists)
            const gridItems = [];
            
            if (name && name !== '&#x2014;') {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Name</div>
                        <div class="detail-value">${name}</div>
                    </div>
                `);
            }
            
            if (dob && dob !== '&#x2014;') {
                const dobLabel = isScreeningLite ? 'Year of Birth' : 'Date of Birth';
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">${dobLabel}</div>
                        <div class="detail-value">${dob}</div>
                    </div>
                `);
            }
            
            // For screening:lite, show country
            if (isScreeningLite && screeningLiteData.country) {
                const countryCode = screeningLiteData.country;
                const countryNames = {
                    'GBR': 'United Kingdom',
                    'USA': 'United States',
                    'UK': 'United Kingdom',
                    'US': 'United States',
                    'FR': 'France',
                    'DE': 'Germany',
                    'ES': 'Spain',
                    'IT': 'Italy'
                };
                const countryName = countryNames[countryCode] || countryCode;
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Country</div>
                        <div class="detail-value">${countryName}</div>
                    </div>
                `);
            }
            
            if (mobile && mobile !== '&#x2014;' && !isScreeningLite) {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Mobile</div>
                        <div class="detail-value">${mobile}</div>
                    </div>
                `);
            }
            
            if (email && email !== '&#x2014;' && !isScreeningLite) {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Email</div>
                        <div class="detail-value">${email}</div>
                    </div>
                `);
            }
            
            detailsContent = `
                <div class="details-header">
                    <div class="details-title">Client Details</div>
                </div>
                ${gridItems.length > 0 ? `<div class="details-grid">${gridItems.join('')}</div>` : ''}
                ${fullAddress && fullAddress !== '&#x2014;' && check.checkType !== 'idv' && !isScreeningLite ? `
                <div class="detail-item" style="margin-top: 12px;">
                    <div class="detail-label">Address</div>
                    <div class="detail-value">${fullAddress}</div>
                </div>
                ` : ''}
                ${(() => {
                    // Check if detailed document properties exist (like Se/Jacob have)
                    const identityTask = check.taskOutcomes?.identity;
                    const docTask = identityTask?.breakdown?.document;
                    const hasDetailedDocProps = docTask?.properties && Object.keys(docTask.properties).length > 3;
                    
                    // If detailed properties exist, skip showing document number here (will show in document card)
                    if (hasDetailedDocProps) return '';
                    
                    // Otherwise show document number in client details
                    if ((docNumber !== '&#x2014;' || mrz) && check.checkType !== 'idv' && !isScreeningLite) {
                        return `
                            <div class="detail-item" style="margin-top: 12px;">
                                <div class="detail-label">Document Number</div>
                                <div class="detail-value">${docNumber}</div>
                                ${mrz ? `<div class="detail-value" style="font-size: 11px; font-family: monospace; margin-top: 4px; white-space: pre;">${mrz}</div>` : ''}
                            </div>
                        `;
                    }
                    return '';
                })()}
            `;
        } else {
            // KYB Check - Get data from companyData and company:summary if available
            const companyData = check.companyData || {};
            const companySummary = check.taskOutcomes?.['company:summary']?.breakdown || {};
            
            // Prefer data from company:summary as it's more comprehensive
            const companyName = check.companyName || companySummary.name || companyData.name || '&#x2014;';
            const companyNumber = companySummary.registration_number || companyData.number || '&#x2014;';
            const jurisdiction = companyData.jurisdiction || companySummary.country || '&#x2014;';
            const legalForm = companySummary.legal_form || '&#x2014;';
            const status = companySummary.status || companySummary.detailed_operating_status || '&#x2014;';
            const incorporationDate = companySummary.date_of_incorporation 
                ? new Date(companySummary.date_of_incorporation).toLocaleDateString('en-GB') 
                : '&#x2014;';
            
            // Address
            const addr = companySummary.formatted_address || {};
            const fullAddress = [addr.street, addr.city, addr.zip, addr.country]
                .filter(Boolean).join(', ') || '&#x2014;';
            
            const tradingAddr = companySummary.trading_address || {};
            const tradingAddress = [tradingAddr.street, tradingAddr.city, tradingAddr.zip, tradingAddr.country]
                .filter(Boolean).join(', ');
            
            const sicDesc = companySummary.sic_nace_codes_des || '';
            const website = companySummary.url || '';
            const employees = companySummary.number_of_employees || '';
            
            // Build company details grid items (only show if data exists)
            const gridItems = [];
            
            if (companyName && companyName !== '&#x2014;') {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Company Name</div>
                        <div class="detail-value">${companyName}</div>
                    </div>
                `);
            }
            
            if (companyNumber && companyNumber !== '&#x2014;') {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Company Number</div>
                        <div class="detail-value">${companyNumber}</div>
                    </div>
                `);
            }
            
            if (jurisdiction && jurisdiction !== '&#x2014;') {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Jurisdiction</div>
                        <div class="detail-value">${jurisdiction}</div>
                    </div>
                `);
            }
            
            if (legalForm && legalForm !== '&#x2014;') {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Legal Form</div>
                        <div class="detail-value">${legalForm}</div>
                    </div>
                `);
            }
            
            if (status && status !== '&#x2014;') {
                const isActive = status.toLowerCase() === 'active';
                const statusIcon = isActive 
                    ? `<svg class="detail-status-icon" viewBox="0 0 300 300"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>`
                    : `<svg class="detail-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Status</div>
                        <div class="detail-value detail-value-with-icon">${statusIcon}${status.charAt(0).toUpperCase() + status.slice(1)}</div>
                    </div>
                `);
            }
            
            if (incorporationDate && incorporationDate !== '&#x2014;') {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Incorporation Date</div>
                        <div class="detail-value">${incorporationDate}</div>
                    </div>
                `);
            }
            
            if (sicDesc) {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Industry</div>
                        <div class="detail-value">${sicDesc}</div>
                    </div>
                `);
            }
            
            if (employees) {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Employees</div>
                        <div class="detail-value">${employees}</div>
                    </div>
                `);
            }
            
            if (website) {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Website</div>
                        <div class="detail-value">${website}</div>
                    </div>
                `);
            }
            
            detailsContent = `
                <div class="details-header">
                    <div class="details-title">Company Details</div>
                </div>
                ${gridItems.length > 0 ? `<div class="details-grid">${gridItems.join('')}</div>` : ''}
                ${fullAddress && fullAddress !== '&#x2014;' ? `
                <div class="detail-item" style="margin-top: 12px;">
                    <div class="detail-label">Registered Address</div>
                    <div class="detail-value">${fullAddress}</div>
                </div>
                ` : ''}
                ${tradingAddress && tradingAddress !== fullAddress ? `
                <div class="detail-item" style="margin-top: 8px;">
                    <div class="detail-label">Trading Address</div>
                    <div class="detail-value">${tradingAddress}</div>
                </div>
                ` : ''}
            `;
        }
        
        const detailIdentityMarkup = this.getIdentityComparisonMarkup(check, { compact: true, heading: 'Check Images' });
        if (detailIdentityMarkup) {
            detailsContent += detailIdentityMarkup;
        }

        this.detailsCard.innerHTML = detailsContent;
    }

    extractIdentityTimestamp(image) {
        const candidates = [
            image?.recordedAt,
            image?.timestamp,
            image?.lastModified,
            image?.lastModifiedMs,
            image?.data?.lastModified,
            image?.date ? Date.parse(image.date) : null
        ];
        for (const value of candidates) {
            const parsed = Number(value);
            if (!Number.isNaN(parsed) && parsed > 0) {
                return parsed;
            }
        }
        return Date.now();
    }

    normalizeIdentityImages(images) {
        if (!Array.isArray(images)) return {};
        const sorted = images
            .map(image => ({
                ...image,
                url: image.url || image.liveUrl || '',
                recordedAt: image.recordedAt || this.extractIdentityTimestamp(image)
            }))
            .sort((a, b) => (b.recordedAt || 0) - (a.recordedAt || 0));

        const normalized = { raw: sorted };
        sorted.forEach(image => {
            const key = this.getIdentityTypeKey(image);
            if (key && !normalized[key]) {
                normalized[key] = image;
            }
        });

        return normalized;
    }

    getIdentityTypeKey(image) {
        const label = (image?.type || image?.name || '').toLowerCase();
        if (label.includes('passport') || label.includes('face')) {
            return 'faceImage';
        }
        return 'selfie';
    }

    getIdentityImageData(check) {
        if (!check) return null;
        if (check.identityImages) {
            return check.identityImages;
        }
        if (check.transactionId && this.checkIdentityImages[check.transactionId]) {
            return this.checkIdentityImages[check.transactionId];
        }
        return null;
    }

    buildIdentityTileMarkup(image, label, options = {}) {
        if (!image) return '';
        const circleClass = options.compact ? 'identity-circle small' : 'identity-circle';
        const url = image.url || image.liveUrl || '';
        const uploader = image.uploader || 'Thirdfort API';
        const date = image.date || '';
        return `
            <div class="identity-tile">
                <div class="${circleClass}" style="${url ? `background-image: url('${url}')` : ''}"></div>
                <div class="identity-label">${label}</div>
                <div class="identity-meta">${uploader}${date ? `<br>${date}` : ''}</div>
            </div>
        `;
    }

    getIdentityComparisonMarkup(check, options = {}) {
        const identityData = this.getIdentityImageData(check);
        if (!identityData) return '';

        const selfie = identityData.selfie;
        const faceImage = identityData.faceImage;

        if (!selfie && !faceImage) {
            return '';
        }

        const compact = options.compact === true;
        const heading = options.heading ? `<div class="identity-comparison-heading">${options.heading}</div>` : '';

        const tiles = [];
        if (selfie) {
            tiles.push(this.buildIdentityTileMarkup(selfie, 'Selfie', { compact }));
        }
        if (faceImage) {
            tiles.push(this.buildIdentityTileMarkup(faceImage, 'Passport Image', { compact }));
        }

        return `
            <div class="identity-comparison ${compact ? 'compact' : ''}">
                ${heading}
                <div class="identity-tiles">
                    ${tiles.join('')}
                </div>
            </div>
        `;
    }
    
    renderDocumentDetailsCard(check) {
        // For IDV and electronic-id checks with detailed properties
        if (!this.documentDetailsCard) return;
        
        let docProperties = {};
        let nfcData = {};
        
        if (check.checkType === 'idv') {
            // IDV check - get from identity:lite
            docProperties = check.taskOutcomes?.['identity:lite']?.breakdown?.document?.properties || {};
        } else if (check.checkType === 'electronic-id') {
            // Electronic ID check - get from identity.breakdown.document
            const identityTask = check.taskOutcomes?.identity;
            const docTask = identityTask?.breakdown?.document;
            
            // Check for detailed document properties (Se's structure)
            if (docTask?.properties) {
                docProperties = docTask.properties;
            }
            
            // Also check for NFC data (Jacob's structure) - has additional fields
            nfcData = identityTask?.data?.nfc || {};
            
            // If no detailed properties, hide the card
            if (Object.keys(docProperties).length <= 1 && Object.keys(nfcData).length === 0) {
                this.documentDetailsCard.classList.add('hidden');
                return;
            }
        } else {
            this.documentDetailsCard.classList.add('hidden');
            return;
        }
        
        this.documentDetailsCard.classList.remove('hidden');
        
        // Use docProperties as main source (Se's structure)
        const idvProperties = docProperties;
        
        const gridItems = [];
        
        // Name (from NFC chip if available - Jacob's structure)
        if (nfcData.name) {
            gridItems.push(`
                <div class="detail-item">
                    <div class="detail-label">Name (as per chip)</div>
                    <div class="detail-value">${nfcData.name}</div>
                </div>
            `);
        } else if (idvProperties.first_name || idvProperties.last_name) {
            // Se's structure - build from first/last
            const fullName = [idvProperties.first_name, idvProperties.last_name].filter(Boolean).join(' ');
            if (fullName) {
                gridItems.push(`
                    <div class="detail-item">
                        <div class="detail-label">Name</div>
                        <div class="detail-value">${fullName}</div>
                    </div>
                `);
            }
        }
        
        // Document Type
        const documentType = check.documentType || idvProperties.document_type || '';
        if (documentType) {
            gridItems.push(`
                <div class="detail-item">
                    <div class="detail-label">Document Type</div>
                    <div class="detail-value">${documentType.charAt(0).toUpperCase() + documentType.slice(1)}</div>
                </div>
            `);
        }
        
        // Document Number (from properties or fallback to piiData)
        const docNumbers = idvProperties.document_numbers || [];
        let docNumber = '';
        if (docNumbers.length > 0) {
            docNumber = docNumbers[0].value || '';
        } else if (check.piiData?.document?.number) {
            docNumber = check.piiData.document.number;
        }
        
        if (docNumber) {
            gridItems.push(`
                <div class="detail-item">
                    <div class="detail-label">Document Number</div>
                    <div class="detail-value" style="font-family: monospace;">${docNumber}</div>
                </div>
            `);
        }
        
        // Nationality
        if (idvProperties.nationality) {
            gridItems.push(`
                <div class="detail-item">
                    <div class="detail-label">Nationality</div>
                    <div class="detail-value">${idvProperties.nationality}</div>
                </div>
            `);
        }
        
        // Issuing Country
        if (idvProperties.issuing_country) {
            gridItems.push(`
                <div class="detail-item">
                    <div class="detail-label">Issuing Country</div>
                    <div class="detail-value">${idvProperties.issuing_country}</div>
                </div>
            `);
        }
        
        // Issuing Date
        if (idvProperties.issuing_date) {
            const issuingDate = new Date(idvProperties.issuing_date).toLocaleDateString('en-GB');
            gridItems.push(`
                <div class="detail-item">
                    <div class="detail-label">Issuing Date</div>
                    <div class="detail-value">${issuingDate}</div>
                </div>
            `);
        }
        
        // Expiry Date (handle different formats)
        let expiryDate = '';
        if (idvProperties.date_of_expiry) {
            // Se's format: "2031-05-28" (ISO date)
            expiryDate = new Date(idvProperties.date_of_expiry).toLocaleDateString('en-GB');
        } else if (nfcData.date_of_expiry) {
            // Jacob's format: "22.08.2033" (already formatted)
            expiryDate = nfcData.date_of_expiry;
        }
        
        if (expiryDate) {
            gridItems.push(`
                <div class="detail-item">
                    <div class="detail-label">Expiry Date</div>
                    <div class="detail-value">${expiryDate}</div>
                </div>
            `);
        }
        
        // Date of Birth (handle different formats)
        let dob = '';
        if (idvProperties.date_of_birth) {
            // Se's format: "1990-01-01" (ISO date)
            dob = new Date(idvProperties.date_of_birth).toLocaleDateString('en-GB');
        } else if (nfcData.dob) {
            // Jacob's format: "11.01.2001" (already formatted)
            dob = nfcData.dob;
        }
        
        if (dob) {
            gridItems.push(`
                <div class="detail-item">
                    <div class="detail-label">Date of Birth</div>
                    <div class="detail-value">${dob}</div>
                </div>
            `);
        }
        
        // Gender
        if (idvProperties.gender) {
            gridItems.push(`
                <div class="detail-item">
                    <div class="detail-label">Gender</div>
                    <div class="detail-value">${idvProperties.gender.charAt(0).toUpperCase() + idvProperties.gender.slice(1)}</div>
                </div>
            `);
        }
        
        this.documentDetailsCard.innerHTML = `
            <div class="details-header">
                <div class="details-title">Document Details</div>
            </div>
            ${gridItems.length > 0 ? `<div class="details-grid">${gridItems.join('')}</div>` : '<div style="padding: 20px; color: #666;">No document details available</div>'}
        `;
    }
    
    renderPepUpdatesCard(check) {
        const pepUpdates = check.pepSanctionsUpdates || [];
        
        if (pepUpdates.length === 0) {
            this.pepUpdatesCard.classList.add('hidden');
            return;
        }
        
        this.pepUpdatesCard.classList.remove('hidden');
        
        let updatesHtml = '<div class="pep-updates-header">PEP & Sanctions Updates</div>';
        
        // Reverse to show most recent first
        [...pepUpdates].reverse().forEach((update, index) => {
            const isCleared = update.outcome === 'clear';
            const title = isCleared ? 'All Hits Dismissed' : 'Updated PEP/Sanctions Screening';
            const tag = isCleared ? '<span class="outcome-tag clear">CLEAR</span>' : '<span class="outcome-tag consider">CONSIDER</span>';
            const hitCount = update.matchCount || 0;
            const subtitle = isCleared ? '' : `<div class="pep-update-subtitle">${hitCount} new hit${hitCount > 1 ? 's' : ''} for review</div>`;
            const date = new Date(update.timestamp).toLocaleDateString('en-GB');
            
            const matches = update.taskOutcomes?.peps?.data?.matches || 
                           update.taskOutcomes?.sanctions?.data?.matches || [];
            
            let hitsHtml = '';
            if (matches.length > 0 && !isCleared) {
                hitsHtml = '<div class="pep-hits-details">';
                matches.forEach((hit, hitIndex) => {
                    // PEP fields: name, position, country, relationship
                    // Sanctions fields: name, sanctions_list, country, reason
                    const hitName = hit.name || 'Unknown';
                    const hitType = hit.position || hit.sanctions_list || 'Match type unavailable';
                    const hitCountry = hit.country || '';
                    const hitRelationship = hit.relationship || ''; // For PEP (direct/indirect)
                    const hitReason = hit.reason || ''; // For sanctions
                    const hitDetails = hitRelationship || hitReason || '';
                    
                    // Determine risk level (1-4, or critical for sanctions)
                    const riskLevel = this.calculateRiskLevel(hit, update.type);
                    
                    hitsHtml += `
                        <div class="pep-hit-item">
                            <div class="pep-hit-row">
                                <div class="pep-hit-header">${String.fromCharCode(65 + hitIndex)}) ${hitName}</div>
                                ${riskLevel}
                            </div>
                            <div class="pep-hit-type-row">
                                <span class="pep-hit-type">${hitType}</span>
                            </div>
                            ${hitDetails || hitCountry ? `
                            <div class="pep-hit-details">
                                ${hitDetails ? `<div class="pep-hit-label">Details:</div><div class="pep-hit-value">${hitDetails}</div>` : ''}
                                ${hitCountry ? `<div class="pep-hit-label">Country:</div><div class="pep-hit-value">${hitCountry}</div>` : ''}
                            </div>
                            ` : ''}
                        </div>
                    `;
                });
                hitsHtml += '</div>';
            }
            
            updatesHtml += `
                <div class="pep-update-item" onclick="this.classList.toggle('expanded')">
                    <div class="pep-update-header">
                        <div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="pep-update-title">${title}</span>
                                ${tag}
                            </div>
                            ${subtitle}
                        </div>
                        <div class="pep-update-right">
                            <span class="pep-update-date">${date}</span>
                            <button class="pep-report-btn" onclick="event.stopPropagation(); manager.viewPDF('${update.s3Key}')" title="View PEP/Sanctions Report">
                                <svg viewBox="0 0 24 24" fill="#1d71b8">
                                    <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    ${hitsHtml}
                </div>
            `;
        });
        
        this.pepUpdatesCard.innerHTML = updatesHtml;
    }
    
    extractRedFlags(check) {
        // Priority 1: Use pre-calculated red flags from backend (transaction:pdf webhook)
        // These are generated once and stored with the check object
        if (check.redFlags && Array.isArray(check.redFlags) && check.redFlags.length > 0) {
            console.log('&#xD83D;&#xDEA9; Using stored red flags:', check.redFlags.length);
            return check.redFlags;
        }
        
        console.log(' No stored red flags found, checking alternative locations...');
        const allFlags = [];
        const taskOutcomes = check.taskOutcomes || {};
        
        // Fallback: Check in taskOutcomes breakdown (if stored by Thirdfort API directly)
        const sofTask = taskOutcomes['sof:v1'];
        if (sofTask?.breakdown?.red_flags && sofTask.breakdown.red_flags.length > 0) {
            sofTask.breakdown.red_flags.forEach(flag => {
                allFlags.push({
                    source: 'Source of Funds',
                    ...flag
                });
            });
        }
        
        const bankSummary = taskOutcomes['bank:summary'];
        if (bankSummary?.breakdown?.red_flags && bankSummary.breakdown.red_flags.length > 0) {
            bankSummary.breakdown.red_flags.forEach(flag => {
                allFlags.push({
                    source: 'Bank Linking',
                    ...flag
                });
            });
        }
        
        const bankStatement = taskOutcomes['bank:statement'];
        if (bankStatement?.breakdown?.red_flags && bankStatement.breakdown.red_flags.length > 0) {
            bankStatement.breakdown.red_flags.forEach(flag => {
                allFlags.push({
                    source: 'Bank Linking',
                    ...flag
                });
            });
        }
        
        // Additional fallback: Check in reports array
        if (check.reports && Array.isArray(check.reports)) {
            check.reports.forEach(report => {
                if (report.breakdown?.red_flags && report.breakdown.red_flags.length > 0) {
                    const source = report.type === 'sof:v1' ? 'Source of Funds' : 
                                   report.type.includes('bank') ? 'Bank Linking' : 
                                   'Check Report';
                    report.breakdown.red_flags.forEach(flag => {
                        allFlags.push({
                            source: source,
                            ...flag
                        });
                    });
                }
            });
        }
        
        return allFlags;
    }
    
    renderRedFlagsCard(check) {
        const allFlags = this.extractRedFlags(check);
        
        // If no flags, hide the card
        if (allFlags.length === 0) {
            this.redFlagsCard.classList.add('hidden');
            return;
        }
        
        // Show the card
        this.redFlagsCard.classList.remove('hidden');
        
        const taskOutcomes = check.taskOutcomes || {};
        const totalFlags = allFlags.length;
        const flagWord = totalFlags === 1 ? 'flag' : 'flags';
        
        // Build the HTML as a collapsible task card
        let flagsContent = '';
        
        // Process each flag with rich detail
        allFlags.forEach((flag, index) => {
            const flagType = flag.description || '';
            
            let flagHtml = '';
            if (flagType === 'Gifts Received') {
                flagHtml = this.renderGiftFlag(flag, taskOutcomes, check);
            } else if (flagType === 'Declared savings > actual savings' || flagType.includes('savings')) {
                flagHtml = this.renderSavingsFlag(flag, taskOutcomes, check);
            } else if (flagType === 'No Mortgage Used') {
                flagHtml = this.renderNoMortgageFlag(flag, taskOutcomes);
            } else if (flagType === 'Cryptocurrency Funding') {
                flagHtml = this.renderCryptoFlag(flag, taskOutcomes);
            } else if (flagType === 'Funds from Overseas') {
                flagHtml = this.renderOverseasFlag(flag, taskOutcomes);
            } else if (flagType.includes('cash deposit')) {
                flagHtml = this.renderCashDepositFlag(flag, taskOutcomes);
            } else {
                // Generic flag rendering
                flagHtml = this.renderGenericFlag(flag);
            }
            
            // Add investigation notes for this red flag
            const flagAnnotationsHtml = this.renderRedFlagAnnotations(check, index);
            
            // Wrap flag content in a container
            flagsContent += `
                <div class="red-flag-with-annotations">
                    ${flagHtml}
                    ${flagAnnotationsHtml}
                </div>
            `;
        });
        
        // Wrap in task card format (with RED consider status icon)
        const redConsiderIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#d32f2f" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        
        // Build header checks with red flag icon (using custom red consider icon)
        const redCheckIcon = `
            <svg class="task-check-icon" viewBox="0 0 24 24" width="16" height="16">
                <circle cx="12" cy="12" r="10" fill="#d32f2f"/>
                <line x1="7" y1="12" x2="17" y2="12" stroke="#ffffff" stroke-width="2"/>
            </svg>
        `;
        
        const headerChecksHtml = `
            <div class="task-header-checks">
                <div class="task-check-item">
                    ${redCheckIcon}
                    <span class="task-check-text">${totalFlags} Red ${flagWord} identified</span>
                </div>
            </div>
        `;
        
        // Count SOF annotation updates related to red flags
        const sofNotes = (check.sofAnnotations || []);
        let redFlagUpdateCount = 0;
        sofNotes.forEach(ann => {
            const fundingMethods = ann.notes?.fundingMethods || [];
            fundingMethods.forEach(fm => {
                if (fm.redFlags && fm.redFlags.length > 0) {
                    redFlagUpdateCount++;
                }
            });
            const topLevelRedFlags = ann.notes?.redFlags || [];
            if (topLevelRedFlags.length > 0) {
                redFlagUpdateCount++;
            }
        });
        
        const annotationBadge = redFlagUpdateCount > 0 ? `<span class="annotation-count-badge">${redFlagUpdateCount} Update${redFlagUpdateCount > 1 ? 's' : ''}</span>` : '';
        
        // Wrap badge in container for consistent right-alignment
        const badgesHtml = annotationBadge ? `<div class="task-header-badges">${annotationBadge}</div>` : '';
        
        let flagsHtml = `
            <div class="task-card consider" onclick="this.classList.toggle('expanded')">
                <div class="task-header">
                    <div class="task-title">Red Flags</div>
                    ${badgesHtml}
                    ${redConsiderIcon}
                </div>
                ${headerChecksHtml}
                <div class="task-details">
                    ${flagsContent}
                </div>
            </div>
        `;
        
        this.redFlagsCard.innerHTML = flagsHtml;
    }
    
    renderRedFlagAnnotations(check, flagIdx) {
        const sofAnnotations = check.sofAnnotations || [];
        let html = '';
        
        // Filter annotations that have notes for this red flag
        const relevantAnnotations = [];
        
        sofAnnotations.forEach(ann => {
            // Check funding methods for red flag notes
            const fundingMethods = ann.notes?.fundingMethods || [];
            fundingMethods.forEach(fm => {
                const redFlags = fm.redFlags || [];
                const flagNote = redFlags.find(rf => rf.flagIdx === flagIdx.toString());
                if (flagNote) {
                    relevantAnnotations.push({ ann, fundingMethod: fm, flagNote });
                }
            });
            
            // Check top-level red flags
            const topLevelRedFlags = ann.notes?.redFlags || [];
            const topLevelFlagNote = topLevelRedFlags.find(rf => rf.flagIdx === flagIdx.toString());
            if (topLevelFlagNote) {
                relevantAnnotations.push({ ann, fundingMethod: null, flagNote: topLevelFlagNote });
            }
        });
        
        if (relevantAnnotations.length > 0) {
            html = '<div class="red-flag-annotations-section">';
            html += '<div class="red-flag-annotations-header">Investigation Notes</div>';
            
            relevantAnnotations.forEach(({ ann, fundingMethod, flagNote }) => {
                const date = new Date(ann.timestamp).toLocaleString('en-GB', { 
                    day: '2-digit', 
                    month: 'short', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                html += '<div class="annotation-mini-card">';
                html += '<div class="annotation-mini-header">';
                html += '<div class="annotation-mini-meta">';
                html += '<strong>' + (ann.userName || ann.user) + '</strong> &#x2022; ' + date;
                html += '</div>';
                html += '</div>';
                html += '<div class="annotation-mini-body">';
                
                // Show note if exists
                if (flagNote.note) {
                    html += '<p class="annotation-mini-reason">' + flagNote.note + '</p>';
                }
                
                // Show status badge
                if (flagNote.status) {
                    let statusBadge = '';
                    let statusIcon = '';
                    
                    if (flagNote.status === 'confirmed') {
                        statusIcon = '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#d32f2f" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
                        statusBadge = 'Confirmed';
                    } else if (flagNote.status === 'dismissed') {
                        statusIcon = '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                        statusBadge = 'Dismissed';
                    }
                    
                    if (statusBadge) {
                        html += '<div class="annotation-mini-objectives">';
                        html += '<div class="annotation-objective-item">';
                        html += statusIcon;
                        html += '<span class="annotation-objective-label"><strong>Status:</strong> ' + statusBadge + '</span>';
                        html += '</div>';
                        html += '</div>';
                    }
                }
                
                html += '</div></div>';
            });
            
            html += '</div>';
        }
        
        return html;
    }
    
    renderGiftFlag(flag, taskOutcomes, check) {
        const sofTask = taskOutcomes['sof:v1'];
        if (!sofTask?.breakdown?.funds) return '';
        
        // Find gift funding methods
        const giftFunds = sofTask.breakdown.funds.filter(f => f.type === 'fund:gift');
        if (giftFunds.length === 0) return '';
        
        let html = `<div class="red-flag-section">`;
        html += `<div class="red-flag-title">Gift</div>`;
        
        giftFunds.forEach(giftFund => {
            const amount = giftFund.data?.amount || 0;
            const giftor = giftFund.data?.giftor || {};
            const giftFundIndex = sofTask.breakdown.funds.findIndex(f => f === giftFund);
            
            html += `<div class="red-flag-amount">&#xA3;${(amount / 100).toLocaleString()}</div>`;
            
            // Giftor details
            if (giftor.name) {
                html += `<div class="red-flag-detail-section">`;
                html += `<div class="red-flag-detail-title">Giftor Details</div>`;
                html += `<div class="red-flag-detail-item"><strong>Name:</strong> ${giftor.name}</div>`;
                if (giftor.relationship) html += `<div class="red-flag-detail-item"><strong>Relationship:</strong> ${giftor.relationship}</div>`;
                if (giftor.phone) html += `<div class="red-flag-detail-item"><strong>Phone:</strong> ${giftor.phone}</div>`;
                if (giftor.contactable !== undefined) html += `<div class="red-flag-detail-item"><strong>Contactable:</strong> ${giftor.contactable ? 'Yes' : 'No'}</div>`;
                html += `</div>`;
            }
            
            // Get accounts for transaction lookup
            const bankStatement = taskOutcomes['bank:statement'];
            const bankSummary = taskOutcomes['bank:summary'];
            const docsBankStatement = taskOutcomes['documents:bank-statement'];
            const accounts = bankStatement?.breakdown?.accounts || 
                           bankSummary?.breakdown?.accounts || 
                           docsBankStatement?.breakdown?.accounts || 
                           {};
            
            // Get sof_matches from any source
            const sofMatches = bankSummary?.breakdown?.analysis?.sof_matches ||
                              bankStatement?.breakdown?.analysis?.sof_matches ||
                              docsBankStatement?.breakdown?.analysis?.sof_matches ||
                              {};
            
            // Use comprehensive getMatchedTransactions to get ALL linked transactions
            const matchedTxIds = this.getMatchedTransactions('fund:gift', sofMatches, giftFund, giftFundIndex, check);
            
            // Collect bank analysis items linked to this gift funding
            const linkedBankAnalysisItems = [];
            if (check) {
                const sofAnnotations = check.sofAnnotations || [];
                sofAnnotations.forEach(ann => {
                    const bankAnalysisItems = ann.notes?.bankAnalysisItems || [];
                    bankAnalysisItems.forEach(item => {
                        if (item.linkedToFundIdx === giftFundIndex.toString()) {
                            linkedBankAnalysisItems.push({
                                ...item,
                                userName: ann.userName || ann.user,
                                timestamp: ann.timestamp
                            });
                        }
                    });
                });
            }
            
            // Check for gift transaction matches
            if (matchedTxIds.length > 0) {
                html += `<div class="matched-transactions-section" style="margin-top: 16px;">`;
                html += `<div class="matched-tx-label">Potential Gift Deposits:</div>`;
                
                // Helper to get transaction details from ID
                const getTransactionById = (txId) => {
                    for (const [accountId, accountData] of Object.entries(accounts)) {
                        const statement = accountData.statement || [];
                        const tx = statement.find(t => t.id === txId);
                        if (tx) {
                            const accountInfo = accountData.info || accountData;
                            return { ...tx, accountName: accountInfo.name || 'Account', accountId };
                        }
                    }
                    return null;
                };
                
                // Show matched gift transactions using comprehensive annotations
                matchedTxIds.forEach(txId => {
                    const tx = getTransactionById(txId);
                    if (tx) {
                        const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                        const currencySymbol = '&#xA3;';
                        const txAmount = tx.amount >= 0 ? '+' : '';
                        
                        // Get comprehensive annotations for this transaction
                        const txAnnotations = this.getTransactionAnnotations(txId, check);
                        
                        // Check if this transaction has a marker
                        const marker = txAnnotations.marker;
                        let markerBadge = '';
                        if (marker === 'accepted') {
                            markerBadge = '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                        } else if (marker === 'rejected') {
                            markerBadge = '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                        }
                        
                        // Check if has flag
                        const flag = txAnnotations.flag;
                        let flagBadge = '';
                        if (flag === 'cleared') {
                            flagBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e8f5e9; color: #4caf50; border: 1px solid #4caf50; margin-left: 4px;">&#x25CB; Cleared</span>';
                        } else if (flag === 'suspicious') {
                            flagBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #ffebee; color: #f44336; border: 1px solid #f44336; margin-left: 4px;">&#x2717; Suspicious</span>';
                        } else if (flag === 'review') {
                            flagBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #fff3e0; color: #ff9800; border: 1px solid #ff9800; margin-left: 4px;">&#x2014; Review</span>';
                        } else if (flag === 'linked') {
                            flagBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e3f2fd; color: #2196f3; border: 1px solid #2196f3; margin-left: 4px;">&#x2713; Linked</span>';
                        }
                        
                        // Check if transaction is part of repeating group and get user comment
                        let repeatingBadge = '';
                        let userNoteBadge = '';
                        
                        const analysis = bankStatement?.breakdown?.analysis || bankSummary?.breakdown?.analysis || docsBankStatement?.breakdown?.analysis;
                        if (analysis && analysis.repeating_transactions) {
                            analysis.repeating_transactions.forEach((group, groupIdx) => {
                                if (group.items && group.items.includes(txId)) {
                                    // Add repeating badge
                                    repeatingBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f3e5f5; color: #9c27b0; border: 1px solid #9c27b0; margin-left: 4px;">Repeating</span>';
                                    
                                    // Check for user comment on this repeating group
                                    if (check && check.sofAnnotations) {
                                        check.sofAnnotations.forEach(ann => {
                                            const items = ann.notes?.bankAnalysisItems || [];
                                            items.forEach(item => {
                                                if (item.type === 'repeating-group' && item.groupIndex === groupIdx && item.comment) {
                                                    userNoteBadge = `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #eceff1; color: #607d8b; border: 1px solid #607d8b; margin-left: 4px;"><svg viewBox="0 0 24 24" style="width: 10px; height: 10px; margin-right: 3px; vertical-align: middle;"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>${item.comment}</span>`;
                                                }
                                            });
                                        });
                                    }
                                }
                            });
                        }
                        
                        html += `
                            <div class="matched-tx-row ${marker ? 'marked-' + marker : ''}">
                                <span class="matched-tx-date">${date}</span>
                                <span class="matched-tx-desc">${tx.description || tx.merchant_name || 'Gift'}${markerBadge}${flagBadge}${repeatingBadge}${userNoteBadge}</span>
                                <span class="matched-tx-account">${tx.accountName}</span>
                                <span class="matched-tx-amount">${txAmount}${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>
                            </div>
                        `;
                    }
                });
                
                html += `</div>`;
            } else if (Object.keys(accounts).length > 0) {
                // No matched transactions but we have bank data - check if gift document uploaded
                const hasGiftDocument = check.taskOutcomes && check.taskOutcomes['documents:gift'] && 
                                       check.taskOutcomes['documents:gift'].status === 'closed';
                
                // Only show hint if no gift document uploaded
                if (!hasGiftDocument) {
                    const considerIcon = `<svg class="task-status-icon" viewBox="0 0 300 300" style="width: 20px; height: 20px; margin-right: 8px;"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
                    
                    html += `
                        <div class="matched-transactions-section" style="margin-top: 16px;">
                            <div class="matched-tx-label">Potential Gift Deposits:</div>
                            <div class="no-matches-hint">
                                ${considerIcon}
                                <span>No linked bank transactions detected, manual review required</span>
                            </div>
                        </div>
                    `;
                }
            }
        });
        
        html += `</div>`;
        return html;
    }
    
    renderSavingsFlag(flag, taskOutcomes, check) {
        const sofTask = taskOutcomes['sof:v1'];
        const bankStatement = taskOutcomes['bank:statement'];
        const bankSummary = taskOutcomes['bank:summary'];
        const docsBankStatement = taskOutcomes['documents:bank-statement'];
        
        if (!sofTask?.breakdown?.funds) return '';
        
        // Find savings funding method
        const savingsFunds = sofTask.breakdown.funds.filter(f => f.type === 'fund:savings');
        if (savingsFunds.length === 0) return '';
        
        let html = `<div class="red-flag-section">`;
        html += `<div class="red-flag-title">Savings</div>`;
        html += `<div class="red-flag-subtitle">Declared savings less than actual</div>`;
        
        // Declared savings
        let totalDeclared = 0;
        savingsFunds.forEach(fund => {
            totalDeclared += fund.data?.amount || 0;
        });
        
        html += `<div class="red-flag-subsection">`;
        html += `<div class="red-flag-detail-title">Declared Savings</div>`;
        html += `<div class="red-flag-amount">&#xA3;${(totalDeclared / 100).toLocaleString()}</div>`;
        
        // Show people contributing to savings
        savingsFunds.forEach(fund => {
            if (fund.data?.people && fund.data.people.length > 0) {
                html += `<div class="people-grid people-grid-${fund.data.people.length}">`;
                
                fund.data.people.forEach(person => {
                    const isActor = person.actor ? 'Primary' : 'Joint';
                    const employmentStatus = person.employment_status === 'independent' ? 'Self-employed' : 
                                            person.employment_status ? person.employment_status.charAt(0).toUpperCase() + person.employment_status.slice(1) : '';
                    
                    html += `<div class="person-card">`;
                    html += `<div class="person-card-name">${person.name}</div>`;
                    html += `<div class="person-card-role">${isActor}</div>`;
                    if (employmentStatus) {
                        html += `<div class="person-card-item">${employmentStatus}</div>`;
                    }
                    if (person.incomes && person.incomes.length > 0) {
                        person.incomes.forEach(income => {
                            html += `<div class="person-card-item">Income: ${income.source || 'N/A'}</div>`;
                            html += `<div class="person-card-item">Frequency: ${income.frequency || 'N/A'}</div>`;
                            if (income.reference) {
                                html += `<div class="person-card-item">Payslip Ref: ${income.reference}</div>`;
                            }
                        });
                    }
                    html += `</div>`;
                });
                
                html += `</div>`;
            }
        });
        html += `</div>`;
        
        // Actual savings from bank accounts
        html += `<div class="red-flag-subsection">`;
        html += `<div class="red-flag-detail-title">Actual Savings</div>`;
        
        const accounts = bankStatement?.breakdown?.accounts || 
                        bankSummary?.breakdown?.accounts || 
                        docsBankStatement?.breakdown?.accounts || 
                        {};
        let totalActual = 0;
        const providerTotals = {};
        
        Object.values(accounts).forEach(account => {
            // Handle both nested (bank:statement) and flat (bank:summary) structures
            const accountInfo = account.info || account;
            const balance = accountInfo.balance?.current || accountInfo.balance?.available || 0;
            
            if (balance > 0) {
                totalActual += balance;
                
                const providerName = accountInfo.provider?.name || 'Unknown Provider';
                const providerId = accountInfo.provider?.id || providerName;
                
                if (!providerTotals[providerId]) {
                    providerTotals[providerId] = {
                        name: providerName,
                        total: 0,
                        accounts: []
                    };
                }
                providerTotals[providerId].total += balance;
                providerTotals[providerId].accounts.push({
                    name: accountInfo.name || accountInfo.account_name || accountInfo.type || 'Account',
                    balance: balance
                });
            }
        });
        
        html += `<div class="red-flag-amount">&#xA3;${totalActual.toLocaleString()}</div>`;
        
        // Breakdown by provider
        Object.values(providerTotals).forEach(provider => {
            const logoHtml = this.getBankLogo(provider.name, provider.name);
            const hasLogo = logoHtml.includes('<img');
            
            html += `<div class="red-flag-provider-item">`;
            
            // If logo exists, show it at 80x80px on left, total and accounts on right stacked
            if (hasLogo) {
                html += `<div class="red-flag-bank-logo">${logoHtml}</div>`;
                html += `<div class="red-flag-provider-details">`;
                html += `<div class="red-flag-provider-total">&#xA3;${provider.total.toLocaleString()}</div>`;
                provider.accounts.forEach(acc => {
                    html += `<div class="red-flag-provider-account">${acc.name}: &#xA3;${acc.balance.toLocaleString()}</div>`;
                });
                html += `</div>`;
            } else {
                // No logo - show name and accounts
                html += `<div class="red-flag-provider-details-full">`;
                html += `<div class="red-flag-provider-name-header">${provider.name}</div>`;
                html += `<div class="red-flag-provider-total">&#xA3;${provider.total.toLocaleString()}</div>`;
                provider.accounts.forEach(acc => {
                    html += `<div class="red-flag-provider-account">${acc.name}: &#xA3;${acc.balance.toLocaleString()}</div>`;
                });
                html += `</div>`;
            }
            
            html += `</div>`;
        });
        
        // Get sof_matches from any source
        const sofMatches = bankStatement?.breakdown?.analysis?.sof_matches ||
                          bankSummary?.breakdown?.analysis?.sof_matches ||
                          docsBankStatement?.breakdown?.analysis?.sof_matches ||
                          {};
        
        // Helper to get transaction details from ID
        const getTransactionById = (txId) => {
            for (const [accountId, accountData] of Object.entries(accounts)) {
                const statement = accountData.statement || [];
                const tx = statement.find(t => t.id === txId);
                if (tx) {
                    const accountInfo = accountData.info || accountData;
                    return { ...tx, accountName: accountInfo.name || 'Account', accountId };
                }
            }
            return null;
        };
        
        // Use comprehensive getMatchedTransactions for ALL savings funds
        const allSalaryTxIds = new Set();
        const autoMatchedTxIds = new Set();
        
        // Get auto-matched salary transactions
        if (sofMatches.salary_transactions) {
            sofMatches.salary_transactions.forEach(txId => {
                allSalaryTxIds.add(txId);
                autoMatchedTxIds.add(txId);
            });
        }
        
        // For each savings fund, get ALL matched transactions including from bank analysis
        savingsFunds.forEach((fund, idx) => {
            const fundIndex = sofTask.breakdown.funds.findIndex(f => f === fund);
            const matchedForThisFund = this.getMatchedTransactions('fund:savings', sofMatches, fund, fundIndex, check);
            matchedForThisFund.forEach(txId => allSalaryTxIds.add(txId));
        });
        
        // Collect bank analysis items linked to any savings funding
        const linkedBankAnalysisItems = [];
        if (check) {
            const sofAnnotations = check.sofAnnotations || [];
            sofAnnotations.forEach(ann => {
                const bankAnalysisItems = ann.notes?.bankAnalysisItems || [];
                bankAnalysisItems.forEach(item => {
                    // Check if linked to any savings funding method
                    const linkedFundIdx = parseInt(item.linkedToFundIdx);
                    const linkedFund = sofTask.breakdown.funds[linkedFundIdx];
                    if (linkedFund && linkedFund.type === 'fund:savings') {
                        linkedBankAnalysisItems.push({
                            ...item,
                            userName: ann.userName || ann.user,
                            timestamp: ann.timestamp
                        });
                    }
                });
            });
        }
        
        if (allSalaryTxIds.size > 0) {
            html += `<div class="matched-transactions-section" style="margin-top: 16px;">`;
            html += `<div class="matched-tx-label">Verified Salary Deposits:</div>`;
            
            // Show all salary transactions with comprehensive annotations
            Array.from(allSalaryTxIds).forEach(txId => {
                const tx = getTransactionById(txId);
                if (tx) {
                    const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                    const currencySymbol = '&#xA3;';
                    const txAmount = tx.amount >= 0 ? '+' : '';
                    
                    // Get comprehensive annotations
                    const txAnnotations = this.getTransactionAnnotations(txId, check);
                    
                    // Check if linked to any savings funding
                    const isLinkedToSavings = txAnnotations.linkedFundingMethods.some(fundIdxStr => {
                        const fund = sofTask.breakdown.funds[parseInt(fundIdxStr)];
                        return fund && fund.type === 'fund:savings';
                    });
                    
                    // Add source badge
                    const isAutoMatched = autoMatchedTxIds.has(txId);
                    let sourceBadge = '';
                    if (isLinkedToSavings && !isAutoMatched) {
                        sourceBadge = '<span class="tx-source-badge user-linked">&#xD83D;&#xDC64; User Linked</span>';
                    } else if (isLinkedToSavings && isAutoMatched) {
                        sourceBadge = '<span class="tx-source-badge both-matched">&#x2713; Confirmed</span>';
                    }
                    
                    // Check if has marker
                    const marker = txAnnotations.marker;
                    let markerBadge = '';
                    if (marker === 'accepted') {
                        markerBadge = '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                    } else if (marker === 'rejected') {
                        markerBadge = '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                    }
                    
                    // Check if has flag
                    const flag = txAnnotations.flag;
                    let flagBadge = '';
                    if (flag === 'cleared') {
                        flagBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e8f5e9; color: #4caf50; border: 1px solid #4caf50; margin-left: 4px;">&#x25CB; Cleared</span>';
                    } else if (flag === 'suspicious') {
                        flagBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #ffebee; color: #f44336; border: 1px solid #f44336; margin-left: 4px;">&#x2717; Suspicious</span>';
                    } else if (flag === 'review') {
                        flagBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #fff3e0; color: #ff9800; border: 1px solid #ff9800; margin-left: 4px;">&#x2014; Review</span>';
                    } else if (flag === 'linked') {
                        flagBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e3f2fd; color: #2196f3; border: 1px solid #2196f3; margin-left: 4px;">&#x2713; Linked</span>';
                    }
                    
                    // Check if transaction is part of repeating group and get user comment
                    let repeatingBadge = '';
                    let userNoteBadge = '';
                    
                    const analysis = bankStatement?.breakdown?.analysis || bankSummary?.breakdown?.analysis || docsBankStatement?.breakdown?.analysis;
                    if (analysis && analysis.repeating_transactions) {
                        analysis.repeating_transactions.forEach((group, groupIdx) => {
                            if (group.items && group.items.includes(txId)) {
                                // Add repeating badge
                                repeatingBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f3e5f5; color: #9c27b0; border: 1px solid #9c27b0; margin-left: 4px;">Repeating</span>';
                                
                                // Check for user comment on this repeating group
                                if (check && check.sofAnnotations) {
                                    check.sofAnnotations.forEach(ann => {
                                        const items = ann.notes?.bankAnalysisItems || [];
                                        items.forEach(item => {
                                            if (item.type === 'repeating-group' && item.groupIndex === groupIdx && item.comment) {
                                                userNoteBadge = `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #eceff1; color: #607d8b; border: 1px solid #607d8b; margin-left: 4px;"><svg viewBox="0 0 24 24" style="width: 10px; height: 10px; margin-right: 3px; vertical-align: middle;"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>${item.comment}</span>`;
                                            }
                                        });
                                    });
                                }
                            }
                        });
                    }
                    
                    html += `
                        <div class="matched-tx-row">
                            <span class="matched-tx-date">${date}</span>
                            <span class="matched-tx-desc">${tx.description || tx.merchant_name || 'Salary'}${markerBadge}${flagBadge}${sourceBadge}${repeatingBadge}${userNoteBadge}</span>
                            <span class="matched-tx-account">${tx.accountName}</span>
                            <span class="matched-tx-amount">${txAmount}${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>
                            </div>
                        `;
                }
            });
            
            html += `</div>`;
        } else if (Object.keys(accounts).length > 0) {
            // No matched salary transactions but we have bank data
            // For savings, always show hint when no matches (even if savings document uploaded)
            // because we need to verify the income SOURCE, not just the balance
            const considerIcon = `<svg class="task-status-icon" viewBox="0 0 300 300" style="width: 20px; height: 20px; margin-right: 8px;"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
            
            html += `
                <div class="matched-transactions-section" style="margin-top: 16px;">
                    <div class="matched-tx-label">Verified Salary Deposits:</div>
                    <div class="no-matches-hint">
                        ${considerIcon}
                        <span>No linked bank transactions detected, manual review required</span>
                    </div>
                </div>
            `;
        }
        
        html += `</div>`;
        html += `</div>`;
        return html;
    }
    
    renderNoMortgageFlag(flag, taskOutcomes) {
        const sofTask = taskOutcomes['sof:v1'];
        if (!sofTask?.breakdown) return '';
        
        const property = sofTask.breakdown.property || {};
        const funds = sofTask.breakdown.funds || [];
        
        let html = `<div class="red-flag-section">`;
        html += `<div class="red-flag-title">No Mortgage Used</div>`;
        
        const propertyPrice = property.price || 0;
        html += `<div class="red-flag-detail-section">`;
        html += `<div class="red-flag-detail-title">Property Details</div>`;
        html += `<div class="red-flag-amount">&#xA3;${(propertyPrice / 100).toLocaleString()}</div>`;
        if (property.address) {
            const addr = property.address;
            html += `<div class="red-flag-detail-item">${addr.building_number || ''} ${addr.street || ''}, ${addr.town || ''}, ${addr.postcode || ''}</div>`;
        }
        html += `<div class="red-flag-detail-item">Funded entirely without mortgage</div>`;
        html += `</div>`;
        
        html += `</div>`;
        return html;
    }
    
    renderCryptoFlag(flag, taskOutcomes) {
        const sofTask = taskOutcomes['sof:v1'];
        if (!sofTask?.breakdown?.funds) return '';
        
        const cryptoFunds = sofTask.breakdown.funds.filter(f => f.type === 'fund:crypto' || f.type === 'fund:cryptocurrency');
        if (cryptoFunds.length === 0) return '';
        
        let html = `<div class="red-flag-section">`;
        html += `<div class="red-flag-title">Cryptocurrency</div>`;
        
        cryptoFunds.forEach(fund => {
            const amount = fund.data?.amount || 0;
            html += `<div class="red-flag-amount">&#xA3;${(amount / 100).toLocaleString()}</div>`;
            if (fund.data?.description) {
                html += `<div class="red-flag-detail-item">${fund.data.description}</div>`;
            }
        });
        
        html += `</div>`;
        return html;
    }
    
    renderOverseasFlag(flag, taskOutcomes) {
        const sofTask = taskOutcomes['sof:v1'];
        if (!sofTask?.breakdown?.funds) return '';
        
        const overseasFunds = sofTask.breakdown.funds.filter(f => {
            const loc = f.data?.location;
            return loc && loc !== 'GBR' && loc !== 'GB' && loc !== 'UK';
        });
        
        if (overseasFunds.length === 0) return '';
        
        let html = `<div class="red-flag-section">`;
        html += `<div class="red-flag-title">Funds from Overseas</div>`;
        
        overseasFunds.forEach(fund => {
            const amount = fund.data?.amount || 0;
            const location = fund.data?.location || '';
            html += `<div class="red-flag-amount">&#xA3;${(amount / 100).toLocaleString()}</div>`;
            html += `<div class="red-flag-detail-item">Source: ${location}</div>`;
        });
        
        html += `</div>`;
        return html;
    }
    
    renderCashDepositFlag(flag, taskOutcomes) {
        let html = `<div class="red-flag-section">`;
        html += `<div class="red-flag-title">Cash Deposits</div>`;
        html += `<div class="red-flag-detail-section">`;
        html += `<div class="red-flag-detail-item">${flag.supporting_data || ''}</div>`;
        html += `<div class="red-flag-detail-item">${flag.threshold_amount || ''}</div>`;
        html += `</div>`;
        html += `</div>`;
        return html;
    }
    
    renderGenericFlag(flag) {
        let html = `<div class="red-flag-section">`;
        html += `<div class="red-flag-title">${flag.description || 'Flag'}</div>`;
        if (flag.supporting_data) html += `<div class="red-flag-detail-item">${flag.supporting_data}</div>`;
        if (flag.threshold_amount) html += `<div class="red-flag-detail-item">${flag.threshold_amount}</div>`;
        html += `</div>`;
        return html;
    }
    
    renderTasksSection(check) {
        const taskOutcomes = check.taskOutcomes || {};
        const isOpen = check.status === 'open' || check.status === 'processing';
        
        console.log('&#xD83C;&#xDFAF; renderTasksSection called');
        console.log('  - Check status:', check.status);
        console.log('  - taskOutcomes keys:', Object.keys(taskOutcomes));
        console.log('  - taskOutcomes:', taskOutcomes);
        
        // For open checks, show minimized task cards based on requested tasks
        if (isOpen && Object.keys(taskOutcomes).length === 0) {
            const requestTasks = check.thirdfortResponse?.request?.tasks || check.tasks || [];
            
            if (requestTasks.length === 0) {
                this.tasksSection.innerHTML = '';
                return;
            }
            
            let tasksHtml = '<div class="tasks-open-header">Requested Tasks (Processing)</div>';
            
            // Track unique task types (merge bank tasks)
            const displayedTasks = new Set();
            
            requestTasks.forEach(task => {
                const taskType = typeof task === 'string' ? task : task.type;
                // Convert task type to display format
                const displayType = this.normalizeTaskType(taskType);
                
                // Skip if already displayed (for bank tasks)
                if (displayedTasks.has(displayType)) {
                    return;
                }
                
                displayedTasks.add(displayType);
                tasksHtml += this.createOpenTaskCard(displayType);
            });
            
            this.tasksSection.innerHTML = tasksHtml;
            return;
        }
        
        // For closed checks or checks with outcomes
        if (Object.keys(taskOutcomes).length === 0) {
            console.log('&#x274C; No taskOutcomes found - returning early');
            this.tasksSection.innerHTML = '';
            return;
        }
        
        console.log('&#x2705; Processing taskOutcomes for closed check');
        
        // Convert screening:lite or peps to screening (combined PEP + Sanctions + Adverse Media for individuals)
        // For individual checks, PEP and Sanctions are combined into "Screening"
        if (taskOutcomes['screening:lite']) {
            taskOutcomes['screening'] = taskOutcomes['screening:lite'];
        } else if (taskOutcomes['peps'] && !taskOutcomes['company:peps']) {
            // If it's a standalone peps task (not company peps), rename to screening
            taskOutcomes['screening'] = taskOutcomes['peps'];
            delete taskOutcomes['peps'];
        }
        
        // Combine identity sub-tasks into identity.breakdown for electronic-id v2 checks
        if (taskOutcomes['identity']) {
            taskOutcomes['identity'].breakdown = taskOutcomes['identity'].breakdown || {};
            const breakdown = taskOutcomes['identity'].breakdown;
            
            // Move sub-tasks into identity breakdown (only if not already there)
            if (taskOutcomes['document'] && !breakdown.document) {
                breakdown.document = taskOutcomes['document'];
            }
            if (taskOutcomes['facial_similarity'] && !breakdown.facial_similarity) {
                breakdown.facial_similarity = taskOutcomes['facial_similarity'];
            }
            // Also handle facial_similarity_video (same as facial_similarity)
            if (taskOutcomes['facial_similarity_video'] && !breakdown.facial_similarity_video) {
                breakdown.facial_similarity_video = taskOutcomes['facial_similarity_video'];
            }
            if (taskOutcomes['nfc'] && !breakdown.nfc) {
                breakdown.nfc = taskOutcomes['nfc'];
            }
            if (taskOutcomes['biometrics'] && !breakdown.biometrics) {
                breakdown.biometrics = taskOutcomes['biometrics'];
            }
            if (taskOutcomes['liveness'] && !breakdown.liveness) {
                breakdown.liveness = taskOutcomes['liveness'];
            }
            
            // Delete top-level tasks after moving (they're now in breakdown)
            delete taskOutcomes['document'];
            delete taskOutcomes['facial_similarity'];
            delete taskOutcomes['facial_similarity_video'];
            delete taskOutcomes['nfc'];
            delete taskOutcomes['biometrics'];
            delete taskOutcomes['liveness'];
        }
        
        // Use footprint for address verification (skip separate address card)
        if (taskOutcomes['footprint']) {
            taskOutcomes['address'] = taskOutcomes['footprint'];
            delete taskOutcomes['footprint'];
        }
        
        // Get requested tasks and check for skipped tasks
        const requestTasks = check.thirdfortResponse?.request?.tasks || [];
        const requestedTaskTypes = new Set();
        requestTasks.forEach(task => {
            const taskType = typeof task === 'string' ? task : task.type;
            const normalizedType = this.normalizeTaskType(taskType);
            requestedTaskTypes.add(normalizedType);
        });
        
        // Add skipped task placeholders for requested tasks not in outcomes
        requestedTaskTypes.forEach(taskType => {
            // Skip bank tasks - they're handled specially
            if (taskType === 'bank') {
                if (!taskOutcomes['bank:summary'] && !taskOutcomes['bank:statement']) {
                    taskOutcomes[taskType] = {
                        result: 'fail',
                        status: 'skipped',
                        data: {},
                        documents: []
                    };
                }
            } else if (!taskOutcomes[taskType]) {
                // Task was requested but not completed - consumer skipped
                taskOutcomes[taskType] = {
                    result: 'fail',
                    status: 'skipped',
                    data: {},
                    documents: []
                };
            }
        });
        
        let tasksHtml = '';
        
        // Define task order
        const taskOrder = [
            'address', 'screening', 'peps', 'sanctions',
            'identity', 'identity:lite',
            'sof:v1', 'bank', // Combined bank task
            'documents:poa', 'documents:poo', 'documents:savings', 'documents:cryptocurrency', 'documents:other',
            'company:summary', 'company:sanctions', 'company:peps', 
            'company:ubo', 'company:beneficial-check', 'company:shareholders'
        ];
        
        taskOrder.forEach(taskKey => {
            // Special handling for bank task - combines bank:summary, bank:statement, or documents:bank-statement
            if (taskKey === 'bank') {
                let bankSummary = taskOutcomes['bank:summary'];
                let bankStatement = taskOutcomes['bank:statement'];
                const docsBankStatement = taskOutcomes['documents:bank-statement'];
                const sofTask = taskOutcomes['sof:v1']; // Get SoF data for linking
                
                // If bank:summary and bank:statement are rejected/unavailable, check for documents:bank-statement
                // (consumer uploaded PDFs instead of linking)
                if (docsBankStatement && docsBankStatement.breakdown?.accounts) {
                    // Use documents:bank-statement data if available
                    if (!bankStatement || bankStatement.status === 'rejected' || bankStatement.status === 'skipped') {
                        bankStatement = docsBankStatement;
                    }
                }
                
                if (bankSummary || bankStatement) {
                    tasksHtml += this.createBankTaskCard(bankSummary, bankStatement, sofTask, check);
                }
            } else if (taskOutcomes[taskKey]) {
                tasksHtml += this.createTaskCard(taskKey, taskOutcomes[taskKey], check);
            }
        });
        
        this.tasksSection.innerHTML = tasksHtml;
    }
    
    normalizeTaskType(taskType) {
        // Convert API task types to our internal format
        const typeMap = {
            'report:identity': 'identity',
            'report:footprint': 'address',
            'report:peps': 'screening',
            'report:sanctions': 'sanctions',
            'report:screening:lite': 'screening',
            'report:sof-v1': 'sof:v1',
            'report:bank-statement': 'bank',  // Both bank tasks map to 'bank'
            'report:bank-summary': 'bank'      // Merged into single card
        };
        
        return typeMap[taskType] || taskType;
    }
    
    createOpenTaskCard(taskType) {
        const taskTitle = this.getTaskTitle(taskType);
        
        return `
            <div class="task-card open-task non-expandable">
                <div class="task-header">
                    <div class="task-title">${taskTitle}</div>
                    <svg class="task-status-icon" viewBox="0 0 300 300">
                        <path fill="#999" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/>
                        <circle cx="150" cy="150" r="30" fill="#fff"/>
                    </svg>
                </div>
                <div class="task-summary-inline">Task in progress</div>
            </div>
        `;
    }
    
    renderChainColumn(chain, flag) {
        let html = `<div class="chain-column">`;
        html += this.renderChainColumnContent(chain, flag);
        html += `</div>`;
        return html;
    }
    
    renderChainColumnContent(chain, flag) {
        // Renders just the content of a chain column (for use in overlay with controls)
        let html = '';
        
        // Step 1: Source income (if exists)
        if (chain.source) {
            const sourceDate = new Date(chain.source.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
            const sourceAmount = Math.abs(chain.source.amount).toFixed(2);
            
            html += `
                <div class="chain-card">
                    <span class="chain-card-date">${sourceDate}</span>
                    <span class="chain-card-desc">${chain.source.description || chain.source.merchant_name || 'Income'}</span>
                    <span class="chain-card-account">${chain.source.accountName}</span>
                    <span class="chain-card-amount positive">+${flag}${sourceAmount}</span>
                </div>
                <div class="chain-connector">&#x2193;</div>
            `;
        }
        
        // Step 2: Transfer out / Payment
        const outDate = new Date(chain.out.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
        const outAmount = Math.abs(chain.out.amount).toFixed(2);
        
        html += `
            <div class="chain-card">
                <span class="chain-card-date">${outDate}</span>
                <span class="chain-card-desc">${chain.out.description || chain.out.merchant_name || 'Payment'}</span>
                <span class="chain-card-account">${chain.out.accountName}</span>
                <span class="chain-card-amount negative">${flag}${outAmount}</span>
            </div>
        `;
        
        // Step 3: Transfer in (if cross-account)
        if (chain.in) {
            const inDate = new Date(chain.in.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
            const inAmount = Math.abs(chain.in.amount).toFixed(2);
            
            html += `
                <div class="chain-connector">&#x2193;</div>
                <div class="chain-card">
                    <span class="chain-card-date">${inDate}</span>
                    <span class="chain-card-desc">${chain.in.description || chain.in.merchant_name || 'Transfer'}</span>
                    <span class="chain-card-account">${chain.in.accountName}</span>
                    <span class="chain-card-amount positive">+${flag}${inAmount}</span>
                </div>
            `;
        }
        
        // Step 4: Subsequent payment (if exists)
        if (chain.payment) {
            const paymentDate = new Date(chain.payment.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
            const paymentAmount = Math.abs(chain.payment.amount).toFixed(2);
            
            html += `
                <div class="chain-connector">&#x2193;</div>
                <div class="chain-card">
                    <span class="chain-card-date">${paymentDate}</span>
                    <span class="chain-card-desc">${chain.payment.description || chain.payment.merchant_name || 'Payment'}</span>
                    <span class="chain-card-account">${chain.payment.accountName}</span>
                    <span class="chain-card-amount negative">${flag}${paymentAmount}</span>
                </div>
            `;
        }
        
        return html;
    }
    
    createBankAnalysisSections(analysis, accounts = {}, sofTask = null, check = null) {
        // Create analysis sections: repeating transactions, large one-offs, SoF matches
        if (!analysis) return '';
        
        let html = '';
        
        // Extract SoF funding details for linking
        const sofFunds = sofTask?.breakdown?.funds || [];
        
        // Get bank analysis flags from sofAnnotations
        const sofAnnotations = check?.sofAnnotations || [];
        
        // Helper to generate unique chain ID from transaction IDs
        const getChainId = (chain) => {
            const ids = [];
            if (chain.source) ids.push(chain.source.id);
            ids.push(chain.out.id);
            if (chain.in) ids.push(chain.in.id);
            if (chain.payment) ids.push(chain.payment.id);
            return ids.join('|'); // Use pipe separator to create unique ID
        };
        
        // Helper to get existing flags/comments for items from sofAnnotations
        const getItemAnnotation = (itemType, itemKey) => {
            for (const ann of sofAnnotations) {
                const items = ann.notes?.bankAnalysisItems || [];
                const found = items.find(item => {
                    if (itemType === 'repeating-group' && item.type === 'repeating-group') {
                        return item.groupIndex === itemKey;
                    } else if (itemType === 'chain' && item.type === 'chain') {
                        return item.chainId === itemKey; // Use chainId for consistency
                    } else if (itemType === 'transaction' && item.type === 'transaction') {
                        return item.transactionId === itemKey;
                    }
                    return false;
                });
                if (found) {
                    // Return the found item along with user info and timestamp from the annotation
                    return { 
                        flag: found.flag, 
                        comment: found.comment, 
                        linkedToFundIdx: found.linkedToFundIdx,
                        userName: ann.userName || ann.user,
                        timestamp: ann.timestamp
                    };
                }
            }
            return null;
        };
        
        // Helper to get transaction details from ID
        const getTransactionById = (txId) => {
            for (const [accountId, accountData] of Object.entries(accounts)) {
                const statement = accountData.statement || [];
                const tx = statement.find(t => t.id === txId);
                if (tx) {
                    const accountInfo = accountData.info || accountData;
                    return { ...tx, accountName: accountInfo.name || 'Account', accountId };
                }
            }
            return null;
        };
        
        // 1. Repeating Transactions Section
        if (analysis.repeating_transactions && analysis.repeating_transactions.length > 0) {
            let repeatingHtml = '';
            
            analysis.repeating_transactions.forEach((group, index) => {
                const amount = group.sort_score;
                const frequency = group.items.length;
                const currencySymbol = this.getCurrencyFlag('GBP');
                
                // Get all transaction details
                const transactions = group.items.map(id => getTransactionById(id)).filter(tx => tx);
                if (transactions.length === 0) return;
                
                // Separate into incoming and outgoing
                const incomingTxs = transactions.filter(tx => tx.amount > 0);
                const outgoingTxs = transactions.filter(tx => tx.amount < 0);
                
                // Apply chain detection
                const matched = [];
                const chains = [];
                
                // Pass 1: Exact cross-account transfers (same day)
                outgoingTxs.forEach(outTx => {
                    if (matched.includes(outTx.id)) return;
                    const outDate = new Date(outTx.timestamp);
                    
                    const match = incomingTxs.find(inTx => {
                        if (matched.includes(inTx.id)) return false;
                        const inDate = new Date(inTx.timestamp);
                        return inDate.toDateString() === outDate.toDateString() && 
                               inTx.account_id !== outTx.account_id;
                    });
                    
                    if (match) {
                        matched.push(match.id);
                        matched.push(outTx.id);
                        chains.push({ out: outTx, in: match });
                    }
                });
                
                // Pass 2: Same-account flows
                outgoingTxs.forEach(outTx => {
                    if (matched.includes(outTx.id)) return;
                    const outDate = new Date(outTx.timestamp);
                    
                    const match = incomingTxs.find(inTx => {
                        if (matched.includes(inTx.id)) return false;
                        const inDate = new Date(inTx.timestamp);
                        const daysDiff = (outDate - inDate) / (1000 * 60 * 60 * 24);
                        
                        return inTx.account_id === outTx.account_id && 
                               daysDiff >= 0 && daysDiff <= 3;
                    });
                    
                    if (match) {
                        matched.push(match.id);
                        matched.push(outTx.id);
                        chains.push({ source: match, out: outTx, in: null });
                    }
                });
                
                // Build chains HTML (2 per row)
                let chainsHtml = '';
                for (let i = 0; i < chains.length; i += 2) {
                    const chain1 = chains[i];
                    const chain2 = chains[i + 1];
                    
                    chainsHtml += `<div class="chains-row">`;
                    if (chain1) chainsHtml += this.renderChainColumn(chain1, currencySymbol);
                    if (chain2) chainsHtml += this.renderChainColumn(chain2, currencySymbol);
                    chainsHtml += `</div>`;
                }
                
                // Build unmatched transactions in columns
                const unmatchedIn = incomingTxs.filter(tx => !matched.includes(tx.id));
                const unmatchedOut = outgoingTxs.filter(tx => !matched.includes(tx.id));
                
                let incomingHtml = '';
                unmatchedIn.forEach(tx => {
                    const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
                    
                    // Get comprehensive annotations for this transaction
                    const txAnnotations = check ? this.getTransactionAnnotations(tx.id, check) : { flag: '', note: '', marker: '' };
                    
                    // Build badges
                    let badgesHtml = '';
                    
                    // Marker badges
                    if (txAnnotations.marker === 'accepted') {
                        badgesHtml += '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                    } else if (txAnnotations.marker === 'rejected') {
                        badgesHtml += '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                    }
                    
                    // Flag badges
                    if (txAnnotations.flag === 'cleared') {
                        badgesHtml += '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                    } else if (txAnnotations.flag === 'suspicious') {
                        badgesHtml += '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                    } else if (txAnnotations.flag === 'review') {
                        badgesHtml += '<span class="tx-marker-badge review">&#x2014; Review</span>';
                    } else if (txAnnotations.flag === 'linked') {
                        badgesHtml += '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                    }
                    
                    // User note badge
                    if (txAnnotations.note) {
                        badgesHtml += `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f5f5f5; color: #666; border: 1px solid #ddd; margin-left: 4px;">&#xD83D;&#xDCDD; ${txAnnotations.note}</span>`;
                    }
                    
                    incomingHtml += `
                        <div class="transaction-row incoming">
                            <span class="transaction-date">${date}</span>
                            <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}${badgesHtml}</span>
                            <span class="account-badge">${tx.accountName}</span>
                            <span class="transaction-amount positive">${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>
                        </div>
                    `;
                });
                
                let outgoingHtml = '';
                unmatchedOut.forEach(tx => {
                    const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
                    
                    // Get comprehensive annotations for this transaction
                    const txAnnotations = check ? this.getTransactionAnnotations(tx.id, check) : { flag: '', note: '', marker: '' };
                    
                    // Build badges
                    let badgesHtml = '';
                    
                    // Marker badges
                    if (txAnnotations.marker === 'accepted') {
                        badgesHtml += '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                    } else if (txAnnotations.marker === 'rejected') {
                        badgesHtml += '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                    }
                    
                    // Flag badges
                    if (txAnnotations.flag === 'cleared') {
                        badgesHtml += '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                    } else if (txAnnotations.flag === 'suspicious') {
                        badgesHtml += '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                    } else if (txAnnotations.flag === 'review') {
                        badgesHtml += '<span class="tx-marker-badge review">&#x2014; Review</span>';
                    } else if (txAnnotations.flag === 'linked') {
                        badgesHtml += '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                    }
                    
                    // User note badge
                    if (txAnnotations.note) {
                        badgesHtml += `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f5f5f5; color: #666; border: 1px solid #ddd; margin-left: 4px;">&#xD83D;&#xDCDD; ${txAnnotations.note}</span>`;
                    }
                    
                    outgoingHtml += `
                        <div class="transaction-row outgoing">
                            <span class="transaction-date">${date}</span>
                            <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}${badgesHtml}</span>
                            <span class="account-badge">${tx.accountName}</span>
                            <span class="transaction-amount negative">${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>
                        </div>
                    `;
                });
                
                // Build columns section
                let columnsHtml = '';
                const hasIncoming = incomingHtml.trim().length > 0;
                const hasOutgoing = outgoingHtml.trim().length > 0;
                
                if (hasIncoming || hasOutgoing) {
                    if (hasIncoming && hasOutgoing) {
                        columnsHtml = `
                            <div class="transactions-columns">
                                <div class="transactions-column">
                                    <div class="column-header incoming-header">Incoming</div>
                                    ${incomingHtml}
                                </div>
                                <div class="transactions-column">
                                    <div class="column-header outgoing-header">Outgoing</div>
                                    ${outgoingHtml}
                                </div>
                            </div>
                        `;
                    } else if (hasIncoming) {
                        columnsHtml = `
                            <div class="transactions-columns single-column">
                                <div class="transactions-column">
                                    <div class="column-header incoming-header">Incoming</div>
                                    ${incomingHtml}
                                </div>
                            </div>
                        `;
                    } else {
                        columnsHtml = `
                            <div class="transactions-columns single-column">
                                <div class="transactions-column">
                                    <div class="column-header outgoing-header">Outgoing</div>
                                    ${outgoingHtml}
                                </div>
                            </div>
                        `;
                    }
                }
                
                const accountsSet = [...new Set(transactions.map(tx => tx.accountName))];
                
                // Check for flags on this repeating group
                const groupAnnotation = getItemAnnotation('repeating-group', index);
                let groupBadge = '';
                let annotationBar = '';
                
                if (groupAnnotation && groupAnnotation.flag) {
                    if (groupAnnotation.flag === 'cleared') {
                        groupBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e8f5e9; color: #4caf50; border: 1px solid #4caf50; margin-left: 8px;">&#x2713; Cleared</span>';
                    } else if (groupAnnotation.flag === 'suspicious') {
                        groupBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #ffebee; color: #f44336; border: 1px solid #f44336; margin-left: 8px;">&#x2717; Suspicious</span>';
                    } else if (groupAnnotation.flag === 'review') {
                        groupBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #fff3e0; color: #ff9800; border: 1px solid #ff9800; margin-left: 8px;">&#x2014; Review</span>';
                    }
                }
                
                // Build annotation bar with new format if annotation exists
                if (groupAnnotation && (groupAnnotation.userName || groupAnnotation.timestamp)) {
                    const date = new Date(groupAnnotation.timestamp).toLocaleString('en-GB', { 
                        day: '2-digit', 
                        month: 'short',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    let userName = groupAnnotation.userName || groupAnnotation.user || 'Unknown';
                    // Format user name
                    if (userName && userName.includes('.') && !userName.includes(' ')) {
                        userName = userName.split('@')[0]
                            .split('.').join(' ')
                            .split('-').join(' ')
                            .replace(/\b\w/g, l => l.toUpperCase());
                    }
                    
                    // Get linked funding method info
                    let fundingBadge = '';
                    if (groupAnnotation.linkedToFundIdx) {
                        const fundIdx = parseInt(groupAnnotation.linkedToFundIdx);
                        const fund = sofTask?.breakdown?.funds?.[fundIdx];
                        if (fund) {
                            const fundType = fund.type || '';
                            const fundLabel = fundType.replace('fund:', '').replace(/[-:_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            fundingBadge = `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e3f2fd; color: #2196f3; border: 1px solid #2196f3; margin-right: 4px;">${fundLabel}</span>`;
                        }
                    }
                    
                    // Get status badge
                    let statusBadge = '';
                    if (groupAnnotation.flag === 'cleared') {
                        statusBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e8f5e9; color: #4caf50; border: 1px solid #4caf50;">Cleared</span>';
                    } else if (groupAnnotation.flag === 'suspicious') {
                        statusBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #ffebee; color: #f44336; border: 1px solid #f44336;">Suspicious</span>';
                    } else if (groupAnnotation.flag === 'review') {
                        statusBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #fff3e0; color: #ff9800; border: 1px solid #ff9800;">Review</span>';
                    }
                    
                    annotationBar = `
                        <div class="bank-analysis-link-row" style="border-left: 4px solid #2196f3; padding: 6px 10px; margin: 6px 0; background: #f5f5f5; border-radius: 3px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;">
                                <div style="flex: 1; min-width: 150px; font-size: 11px;">
                                    <strong>${userName}</strong> &#x2022; ${date}
                                </div>
                                <div style="display: flex; gap: 4px; flex-wrap: wrap; align-items: center;">
                                    ${fundingBadge}
                                    ${statusBadge}
                                </div>
                            </div>
                            ${groupAnnotation.comment ? `
                                <div style="margin-top: 4px; color: #666; font-size: 11px; font-style: italic;">
                                    ${groupAnnotation.comment}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
                
                repeatingHtml += `
                    <div class="analysis-item-card">
                        <div class="analysis-card-header">
                            <div class="analysis-card-title">
                                ${currencySymbol}${Math.abs(amount).toFixed(2)} &#xD7; ${frequency}
                                ${groupBadge}
                            </div>
                            <div class="analysis-card-meta">
                                ${accountsSet.length > 1 ? `Between: ${accountsSet.join(' &#x2194; ')}` : `Account: ${accountsSet[0]}`}
                            </div>
                        </div>
                        ${annotationBar}
                        ${chainsHtml ? `
                            <div class="internal-transfers-label">Linked Transactions</div>
                            ${chainsHtml}
                        ` : ''}
                        ${columnsHtml}
                    </div>
                `;
            });
            
            html += `
                <div class="bank-analysis-section collapsed" onclick="event.stopPropagation(); this.classList.toggle('collapsed');">
                    <div class="analysis-section-header">
                        <span class="analysis-section-title">Repeating Transactions (${analysis.repeating_transactions.length} patterns)</span>
                        <span class="expand-indicator">&#x25BC;</span>
                    </div>
                    <div class="analysis-section-content">
                        ${repeatingHtml}
                    </div>
                </div>
            `;
        }
        
        // 2. Large One-off Transactions Section
        if (analysis.large_one_off_transactions && analysis.large_one_off_transactions.length > 0) {
            // Get all large one-off transactions
            const oneOffTxs = analysis.large_one_off_transactions
                .map(txId => getTransactionById(txId))
                .filter(tx => tx);
            
            // Separate into incoming and outgoing
            const oneOffIn = oneOffTxs.filter(tx => tx.amount > 0);
            const oneOffOut = oneOffTxs.filter(tx => tx.amount < 0);
            
            // Apply same three-pass chain detection logic
            const matched = [];
            const transferPairs = [];
            const chains = [];
            
            // First pass: Exact cross-account transfers
            oneOffOut.forEach(outTx => {
                if (matched.includes(outTx.id)) return;
                const outDate = new Date(outTx.timestamp);
                const outAmount = Math.abs(outTx.amount);
                
                const match = oneOffIn.find(inTx => {
                    if (matched.includes(inTx.id)) return false;
                    const inDate = new Date(inTx.timestamp);
                    const inAmount = Math.abs(inTx.amount);
                    
                    return Math.abs(inAmount - outAmount) < 0.01 && 
                           inTx.account_id !== outTx.account_id && 
                           inDate.toDateString() === outDate.toDateString();
                });
                
                if (match) {
                    matched.push(match.id);
                    matched.push(outTx.id);
                    transferPairs.push({ out: outTx, in: match });
                }
            });
            
            // Second pass: Same-account flows
            oneOffOut.forEach(outTx => {
                if (matched.includes(outTx.id)) return;
                const outDate = new Date(outTx.timestamp);
                const outAmount = Math.abs(outTx.amount);
                
                const match = oneOffIn.find(inTx => {
                    if (matched.includes(inTx.id)) return false;
                    const inDate = new Date(inTx.timestamp);
                    const inAmount = Math.abs(inTx.amount);
                    const daysDiff = (outDate - inDate) / (1000 * 60 * 60 * 24);
                    
                    return inTx.account_id === outTx.account_id && 
                           daysDiff >= 0 && daysDiff <= 3 &&
                           inAmount >= outAmount &&
                           (inAmount - outAmount) <= Math.max(500, inAmount * 0.2);
                });
                
                if (match) {
                    matched.push(match.id);
                    matched.push(outTx.id);
                    chains.push({ 
                        source: match, 
                        out: outTx, 
                        in: null
                    });
                }
            });
            
            // Third pass: Extend transfer pairs with preceding income / subsequent payment
            const extendedChains = [];
            transferPairs.forEach(pair => {
                const candidateIncomes = oneOffIn.filter(precedingTx => {
                    if (matched.includes(precedingTx.id)) return false;
                    const precedingDate = new Date(precedingTx.timestamp);
                    const outDate = new Date(pair.out.timestamp);
                    const daysDiff = (outDate - precedingDate) / (1000 * 60 * 60 * 24);
                    
                    return precedingTx.account_id === pair.out.account_id && 
                           daysDiff >= 0 && daysDiff <= 3;
                });
                
                const precedingIncome = candidateIncomes.length > 0
                    ? candidateIncomes.reduce((largest, tx) => 
                        Math.abs(tx.amount) > Math.abs(largest.amount) ? tx : largest
                      )
                    : null;
                
                const subsequentPayment = oneOffOut.find(paymentTx => {
                    if (matched.includes(paymentTx.id)) return false;
                    const paymentDate = new Date(paymentTx.timestamp);
                    const inDate = new Date(pair.in.timestamp);
                    const daysDiff = (paymentDate - inDate) / (1000 * 60 * 60 * 24);
                    
                    return paymentTx.account_id === pair.in.account_id && 
                           daysDiff >= 0 && daysDiff <= 2;
                });
                
                if (precedingIncome || subsequentPayment) {
                    if (precedingIncome) matched.push(precedingIncome.id);
                    if (subsequentPayment) matched.push(subsequentPayment.id);
                    
                    extendedChains.push({
                        source: precedingIncome,
                        out: pair.out,
                        in: pair.in,
                        payment: subsequentPayment
                    });
                    pair.extended = true;
                }
            });
            
            // Combine all chains (extended first, then basic chains, then unextended pairs)
            const allOneOffChains = [...extendedChains, ...chains, ...transferPairs.filter(p => !p.extended)];
            
            // Build chains HTML (2 per row)
            let chainsHtml = '';
            for (let i = 0; i < allOneOffChains.length; i += 2) {
                const chain1 = allOneOffChains[i];
                const chain2 = allOneOffChains[i + 1];
                const flag = this.getCurrencyFlag((chain1.source?.currency || chain1.out.currency) || 'GBP');
                
                chainsHtml += `<div class="chains-row">`;
                
                // Left column - Chain 1
                chainsHtml += this.renderChainColumn(chain1, flag);
                
                // Right column - Chain 2 (if exists)
                if (chain2) {
                    const flag2 = this.getCurrencyFlag((chain2.source?.currency || chain2.out.currency) || 'GBP');
                    chainsHtml += this.renderChainColumn(chain2, flag2);
                }
                
                chainsHtml += `</div>`;
            }
            
            // Build unmatched transactions in columns
            const unmatchedIn = oneOffIn.filter(tx => !matched.includes(tx.id));
            const unmatchedOut = oneOffOut.filter(tx => !matched.includes(tx.id));
            
            let incomingHtml = '';
            unmatchedIn.forEach(tx => {
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
                const flag = this.getCurrencyFlag(tx.currency || 'GBP');
                
                incomingHtml += `
                    <div class="transaction-row incoming">
                        <span class="transaction-date">${date}</span>
                        <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}</span>
                        <span class="account-badge">${tx.accountName}</span>
                        <span class="transaction-amount positive">${flag}${Math.abs(tx.amount).toFixed(2)}</span>
                    </div>
                `;
            });
            
            let outgoingHtml = '';
            unmatchedOut.forEach(tx => {
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
                const flag = this.getCurrencyFlag(tx.currency || 'GBP');
                
                outgoingHtml += `
                    <div class="transaction-row outgoing">
                        <span class="transaction-date">${date}</span>
                        <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}</span>
                        <span class="account-badge">${tx.accountName}</span>
                        <span class="transaction-amount negative">${flag}${Math.abs(tx.amount).toFixed(2)}</span>
                    </div>
                `;
            });
            
            // Build columns section
            let columnsHtml = '';
            const hasIncoming = incomingHtml.trim().length > 0;
            const hasOutgoing = outgoingHtml.trim().length > 0;
            
            if (hasIncoming || hasOutgoing) {
                if (hasIncoming && hasOutgoing) {
                    columnsHtml = `
                        <div class="transactions-columns">
                            <div class="transactions-column">
                                <div class="column-header incoming-header">Incoming</div>
                                ${incomingHtml}
                            </div>
                            <div class="transactions-column">
                                <div class="column-header outgoing-header">Outgoing</div>
                                ${outgoingHtml}
                            </div>
                        </div>
                    `;
                } else if (hasIncoming) {
                    columnsHtml = `
                        <div class="transactions-columns single-column">
                            <div class="transactions-column">
                                <div class="column-header incoming-header">Incoming</div>
                                ${incomingHtml}
                            </div>
                        </div>
                    `;
                } else {
                    columnsHtml = `
                        <div class="transactions-columns single-column">
                            <div class="transactions-column">
                                <div class="column-header outgoing-header">Outgoing</div>
                                ${outgoingHtml}
                            </div>
                        </div>
                    `;
                }
            }
            
            html += `
                <div class="bank-analysis-section collapsed" onclick="event.stopPropagation(); this.classList.toggle('collapsed');">
                    <div class="analysis-section-header">
                        <span class="analysis-section-title">Large One-off Transactions (${analysis.large_one_off_transactions.length})</span>
                        <span class="expand-indicator">&#x25BC;</span>
                    </div>
                    <div class="analysis-section-content">
                        ${chainsHtml ? `
                            <div class="internal-transfers-label">Linked Transactions</div>
                            ${chainsHtml}
                        ` : ''}
                        ${columnsHtml}
                    </div>
                </div>
            `;
        }
        
        // 3. SoF Matches Section
        if (analysis.sof_matches && Object.keys(analysis.sof_matches).length > 0) {
            let sofMatchesHtml = '';
            
            // Build a map of funding types to their transaction IDs (auto + user-linked)
            const allSofMatches = {};
            
            // Start with Thirdfort automatic matches
            for (const [sofType, txIds] of Object.entries(analysis.sof_matches)) {
                allSofMatches[sofType] = {
                    autoMatched: new Set(txIds),
                    userLinked: new Set()
                };
            }
            
            // Add user-linked transactions from SOF annotations (direct links AND bank analysis items)
            if (check) {
                const sofAnnotations = check.sofAnnotations || [];
                sofAnnotations.forEach(ann => {
                    // Direct transaction links
                    const transactions = ann.notes?.transactions || [];
                    transactions.forEach(tx => {
                        if (tx.linkedToFunds && tx.linkedToFunds.length > 0) {
                            tx.linkedToFunds.forEach(fundIdxStr => {
                                const fundIdx = parseInt(fundIdxStr);
                                const fund = sofFunds[fundIdx];
                                if (fund) {
                                    const fundTypeMap = {
                                        'fund:gift': 'gift',
                                        'fund:mortgage': 'mortgage',
                                        'fund:savings': 'savings',
                                        'fund:property_sale': 'property_sale',
                                        'fund:sale:property': 'property_sale',
                                        'fund:asset_sale': 'asset_sale',
                                        'fund:sale:assets': 'asset_sale',
                                        'fund:htb_lisa': 'htb_lisa',
                                        'fund:htb': 'htb_lisa',
                                        'fund:inheritance': 'inheritance'
                                    };
                                    const sofType = fundTypeMap[fund.type];
                                    if (sofType) {
                                        if (!allSofMatches[sofType]) {
                                            allSofMatches[sofType] = {
                                                autoMatched: new Set(),
                                                userLinked: new Set()
                                            };
                                        }
                                        allSofMatches[sofType].userLinked.add(tx.txId);
                                    }
                                }
                            });
                        }
                    });
                    
                    // Bank analysis items linked to funding methods
                    const bankAnalysisItems = ann.notes?.bankAnalysisItems || [];
                    bankAnalysisItems.forEach(item => {
                        if (item.linkedToFundIdx) {
                            const fundIdx = parseInt(item.linkedToFundIdx);
                            const fund = sofFunds[fundIdx];
                            if (fund) {
                                const fundTypeMap = {
                                    'fund:gift': 'gift',
                                    'fund:mortgage': 'mortgage',
                                    'fund:savings': 'savings',
                                    'fund:property_sale': 'property_sale',
                                    'fund:sale:property': 'property_sale',
                                    'fund:asset_sale': 'asset_sale',
                                    'fund:sale:assets': 'asset_sale',
                                    'fund:htb_lisa': 'htb_lisa',
                                    'fund:htb': 'htb_lisa',
                                    'fund:inheritance': 'inheritance'
                                };
                                const sofType = fundTypeMap[fund.type];
                                if (sofType) {
                                    if (!allSofMatches[sofType]) {
                                        allSofMatches[sofType] = {
                                            autoMatched: new Set(),
                                            userLinked: new Set()
                                        };
                                    }
                                    
                                    // Add all transactions from this bank analysis item
                                    if (item.type === 'transaction' && item.transactionId) {
                                        allSofMatches[sofType].userLinked.add(item.transactionId);
                                    } else if (item.type === 'chain' && item.chainId) {
                                        const chainTxIds = item.chainId.split('|');
                                        chainTxIds.forEach(txId => allSofMatches[sofType].userLinked.add(txId));
                                    } else if (item.type === 'repeating-group' && item.groupIndex !== undefined) {
                                        if (analysis.repeating_transactions) {
                                            const group = analysis.repeating_transactions[item.groupIndex];
                                            if (group && group.items) {
                                                group.items.forEach(txId => allSofMatches[sofType].userLinked.add(txId));
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    });
                });
            }
            
            for (const [sofType, matchSets] of Object.entries(allSofMatches)) {
                const sofLabels = {
                    'gift': 'Gift Funding',
                    'mortgage': 'Mortgage',
                    'savings': 'Savings',
                    'property_sale': 'Property Sale',
                    'asset_sale': 'Asset Sale',
                    'htb_lisa': 'Help to Buy / LISA',
                    'inheritance': 'Inheritance'
                };
                
                const label = sofLabels[sofType] || sofType;
                
                // Find matching funding method in SoF task
                const matchingFund = sofFunds.find(fund => {
                    const fundTypeMap = {
                        'fund:gift': 'gift',
                        'fund:mortgage': 'mortgage',
                        'fund:savings': 'savings',
                        'fund:property_sale': 'property_sale',
                        'fund:sale:property': 'property_sale',
                        'fund:asset_sale': 'asset_sale',
                        'fund:sale:assets': 'asset_sale',
                        'fund:htb_lisa': 'htb_lisa',
                        'fund:htb': 'htb_lisa',
                        'fund:inheritance': 'inheritance'
                    };
                    return fundTypeMap[fund.type] === sofType;
                });
                
                // Build funding details card
                let fundDetailsHtml = '';
                if (matchingFund) {
                    const fundData = matchingFund.data || {};
                    const fundAmount = fundData.amount ? `&#xA3;${(fundData.amount / 100).toLocaleString()}` : '';
                    
                    let detailsContent = '';
                    
                    // Gift details
                    if (matchingFund.type === 'fund:gift') {
                        if (fundData.giftor) {
                            if (fundData.giftor.name) {
                                detailsContent += `<div class="sof-fund-detail"><strong>Giftor:</strong> ${fundData.giftor.name}</div>`;
                            }
                            if (fundData.giftor.relationship) {
                                detailsContent += `<div class="sof-fund-detail"><strong>Relationship:</strong> ${fundData.giftor.relationship}</div>`;
                            }
                            if (fundData.giftor.phone) {
                                detailsContent += `<div class="sof-fund-detail"><strong>Phone:</strong> ${fundData.giftor.phone}</div>`;
                            }
                            if (typeof fundData.giftor.contactable !== 'undefined') {
                                detailsContent += `<div class="sof-fund-detail"><strong>Contactable:</strong> ${fundData.giftor.contactable ? 'Yes' : 'No'}</div>`;
                            }
                        }
                        if (typeof fundData.repayable !== 'undefined') {
                            detailsContent += `<div class="sof-fund-detail"><strong>Repayable:</strong> ${fundData.repayable ? 'Yes' : 'No'}</div>`;
                        }
                        
                        // Document status
                        const hasDoc = matchingFund.documents && matchingFund.documents.length > 0;
                        const docIcon = hasDoc ? this.getTaskCheckIcon('CL') : this.getTaskCheckIcon('CO');
                        const docText = hasDoc ? 'Evidence document uploaded' : 'Check the report pdf for evidence or obtain from the client and review manually';
                        detailsContent += `
                            <div class="sof-fund-detail" style="margin-top: 8px; display: flex; align-items: center; gap: 6px;">
                                ${docIcon}
                                <span style="font-size: 11px;">${docText}</span>
                            </div>
                        `;
                    }
                    
                    // Property sale details
                    if (matchingFund.type === 'fund:sale:property') {
                        if (fundData.date) {
                            const saleDate = new Date(fundData.date).toLocaleDateString('en-GB');
                            detailsContent += `<div class="sof-fund-detail"><strong>Sale Date:</strong> ${saleDate}</div>`;
                        }
                        if (fundData.status) {
                            detailsContent += `<div class="sof-fund-detail"><strong>Status:</strong> ${fundData.status}</div>`;
                        }
                        if (fundData.lawyer) {
                            detailsContent += `<div class="sof-fund-detail"><strong>Lawyer:</strong> ${fundData.lawyer}</div>`;
                        }
                        
                        // Document status
                        const hasDoc = check.taskOutcomes?.['documents:sale-property'];
                        const docIcon = hasDoc ? this.getTaskCheckIcon('CL') : this.getTaskCheckIcon('CO');
                        const docText = hasDoc ? 'Evidence document uploaded' : 'Check the report pdf for evidence or obtain from the client and review manually';
                        detailsContent += `
                            <div class="sof-fund-detail" style="margin-top: 8px; display: flex; align-items: center; gap: 6px;">
                                ${docIcon}
                                <span style="font-size: 11px;">${docText}</span>
                            </div>
                        `;
                    }
                    
                    // Asset sale details
                    if (matchingFund.type === 'fund:sale:assets') {
                        if (fundData.description) {
                            detailsContent += `<div class="sof-fund-detail"><strong>Asset:</strong> ${fundData.description}</div>`;
                        }
                        if (fundData.date) {
                            const saleDate = new Date(fundData.date).toLocaleDateString('en-GB');
                            detailsContent += `<div class="sof-fund-detail"><strong>Sale Date:</strong> ${saleDate}</div>`;
                        }
                        
                        // Document status
                        const hasDoc = check.taskOutcomes?.['documents:sale-assets'];
                        const docIcon = hasDoc ? this.getTaskCheckIcon('CL') : this.getTaskCheckIcon('CO');
                        const docText = hasDoc ? 'Evidence document uploaded' : 'Check the report pdf for evidence or obtain from the client and review manually';
                        detailsContent += `
                            <div class="sof-fund-detail" style="margin-top: 8px; display: flex; align-items: center; gap: 6px;">
                                ${docIcon}
                                <span style="font-size: 11px;">${docText}</span>
                            </div>
                        `;
                    }
                    
                    // Savings details
                    if (matchingFund.type === 'fund:savings') {
                        if (fundData.people && fundData.people.length > 0) {
                            detailsContent += `<div class="people-grid people-grid-${fundData.people.length}">`;
                            
                            fundData.people.forEach(person => {
                                if (person.name) {
                                    const isActor = person.actor ? 'Primary' : 'Joint';
                                    const employmentStatus = person.employment_status === 'independent' ? 'Self-employed' : 
                                                            person.employment_status ? person.employment_status.charAt(0).toUpperCase() + person.employment_status.slice(1) : '';
                                    
                                    detailsContent += `<div class="person-card">`;
                                    detailsContent += `<div class="person-card-name">${person.name}</div>`;
                                    detailsContent += `<div class="person-card-role">${isActor}</div>`;
                                    if (employmentStatus) {
                                        detailsContent += `<div class="person-card-item">${employmentStatus}</div>`;
                                    }
                                    if (person.incomes && person.incomes.length > 0) {
                                        person.incomes.forEach(income => {
                                            detailsContent += `<div class="person-card-item">Income: ${income.source || 'N/A'}</div>`;
                                            detailsContent += `<div class="person-card-item">Frequency: ${income.frequency || 'N/A'}</div>`;
                                            if (income.reference) {
                                                detailsContent += `<div class="person-card-item">Payslip Ref: ${income.reference}</div>`;
                                            }
                                        });
                                    }
                                    detailsContent += `</div>`;
                                }
                            });
                            
                            detailsContent += `</div>`;
                        }
                        
                        // Document status
                        const hasDoc = check.taskOutcomes?.['documents:savings'];
                        const docIcon = hasDoc ? this.getTaskCheckIcon('CL') : this.getTaskCheckIcon('CO');
                        const docText = hasDoc ? 'Evidence document uploaded' : 'Check the report pdf for evidence or obtain from the client and review manually';
                        detailsContent += `
                            <div class="sof-fund-detail" style="margin-top: 8px; display: flex; align-items: center; gap: 6px;">
                                ${docIcon}
                                <span style="font-size: 11px;">${docText}</span>
                            </div>
                        `;
                    }
                    
                    // Mortgage details
                    if (matchingFund.type === 'fund:mortgage') {
                        if (fundData.lender) {
                            detailsContent += `<div class="sof-fund-detail"><strong>Lender:</strong> ${fundData.lender}</div>`;
                        }
                        
                        // Document status
                        const hasDoc = check.taskOutcomes?.['documents:mortgage'];
                        const docIcon = hasDoc ? this.getTaskCheckIcon('CL') : this.getTaskCheckIcon('CO');
                        const docText = hasDoc ? 'Evidence document uploaded' : 'Check the report pdf for evidence or obtain from the client and review manually';
                        detailsContent += `
                            <div class="sof-fund-detail" style="margin-top: 8px; display: flex; align-items: center; gap: 6px;">
                                ${docIcon}
                                <span style="font-size: 11px;">${docText}</span>
                            </div>
                        `;
                    }
                    
                    // HTB/LISA details
                    if (matchingFund.type === 'fund:htb') {
                        if (fundData.provider) {
                            detailsContent += `<div class="sof-fund-detail"><strong>Provider:</strong> ${fundData.provider}</div>`;
                        }
                        if (typeof fundData.is_owner !== 'undefined') {
                            detailsContent += `<div class="sof-fund-detail"><strong>Beneficiary:</strong> ${fundData.is_owner ? 'Primary' : 'Secondary'}</div>`;
                        }
                        
                        // Document status
                        const hasDoc = check.taskOutcomes?.['documents:htb'];
                        const docIcon = hasDoc ? this.getTaskCheckIcon('CL') : this.getTaskCheckIcon('CO');
                        const docText = hasDoc ? 'Evidence document uploaded' : 'Check the report pdf for evidence or obtain from the client and review manually';
                        detailsContent += `
                            <div class="sof-fund-detail" style="margin-top: 8px; display: flex; align-items: center; gap: 6px;">
                                ${docIcon}
                                <span style="font-size: 11px;">${docText}</span>
                            </div>
                        `;
                    }
                    
                    // Inheritance details
                    if (matchingFund.type === 'fund:inheritance') {
                        if (fundData.deceased) {
                            detailsContent += `<div class="sof-fund-detail"><strong>Deceased:</strong> ${fundData.deceased}</div>`;
                        }
                        if (fundData.date_of_death) {
                            const deathDate = new Date(fundData.date_of_death).toLocaleDateString('en-GB');
                            detailsContent += `<div class="sof-fund-detail"><strong>Date of Death:</strong> ${deathDate}</div>`;
                        }
                        if (fundData.relationship) {
                            detailsContent += `<div class="sof-fund-detail"><strong>Relationship:</strong> ${fundData.relationship}</div>`;
                        }
                        
                        // Document status
                        const hasDoc = check.taskOutcomes?.['documents:inheritance'];
                        const docIcon = hasDoc ? this.getTaskCheckIcon('CL') : this.getTaskCheckIcon('CO');
                        const docText = hasDoc ? 'Evidence document uploaded' : 'Check the report pdf for evidence or obtain from the client and review manually';
                        detailsContent += `
                            <div class="sof-fund-detail" style="margin-top: 8px; display: flex; align-items: center; gap: 6px;">
                                ${docIcon}
                                <span style="font-size: 11px;">${docText}</span>
                            </div>
                        `;
                    }
                    
                    if (fundAmount || detailsContent) {
                        fundDetailsHtml = `
                            <div class="sof-fund-details-card">
                                ${fundAmount ? `<div class="sof-fund-amount">${fundAmount}</div>` : ''}
                                ${detailsContent}
                            </div>
                        `;
                    }
                }
                
                // Get transaction markers from SOF annotations for this funding type
                const sofAnnotations = check?.sofAnnotations || [];
                const transactionMarkers = {};
                const fundIndex = sofFunds.findIndex(f => f === matchingFund);
                sofAnnotations.forEach(ann => {
                    const fundingMethods = ann.notes?.fundingMethods || [];
                    fundingMethods.forEach(fm => {
                        if (fm.fundIdx === fundIndex.toString()) {
                            Object.assign(transactionMarkers, fm.transactionMarkers || {});
                        }
                    });
                });
                
                // Merge auto-matched and user-linked transactions
                const allTxIds = [...matchSets.autoMatched, ...matchSets.userLinked];
                
                let txListHtml = '';
                allTxIds.forEach(txId => {
                    const tx = getTransactionById(txId);
                    if (!tx) return;
                    
                    const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                    const amount = tx.amount;
                    const amountClass = amount >= 0 ? 'positive' : 'negative';
                    const sign = amount >= 0 ? '+' : '';
                    const currencySymbol = this.getCurrencyFlag(tx.currency || 'GBP');
                    
                    // Get comprehensive annotations for this transaction
                    const txAnnotations = this.getTransactionAnnotations(txId, check);
                    
                    // Check if this transaction has a marker
                    const marker = txAnnotations.marker;
                    let markerBadge = '';
                    let markerClass = '';
                    if (marker === 'accepted') {
                        markerBadge = '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                    } else if (marker === 'rejected') {
                        markerBadge = '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                        markerClass = ' marked-rejected';
                    }
                    
                    // Check if this transaction has a flag (from bank analysis or direct links)
                    const flag = txAnnotations.flag;
                    let flagBadge = '';
                    if (flag === 'cleared') {
                        flagBadge = '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                    } else if (flag === 'suspicious') {
                        flagBadge = '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                    } else if (flag === 'review') {
                        flagBadge = '<span class="tx-marker-badge review">&#x2014; Review</span>';
                    } else if (flag === 'linked') {
                        flagBadge = '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                    }
                    
                    // Add source badge
                    const isAutoMatched = matchSets.autoMatched.has(txId);
                    const isUserLinked = matchSets.userLinked.has(txId);
                    let sourceBadge = '';
                    if (isUserLinked && !isAutoMatched) {
                        sourceBadge = '<span class="tx-source-badge user-linked">&#xD83D;&#xDC64; User Linked</span>';
                    } else if (isUserLinked && isAutoMatched) {
                        sourceBadge = '<span class="tx-source-badge both-matched">&#x2713; Confirmed</span>';
                    }
                    
                    // Check if this transaction is part of a repeating group
                    let repeatingBadge = '';
                    let userNoteBadge = '';
                    if (analysis && analysis.repeating_transactions) {
                        for (const group of analysis.repeating_transactions) {
                            if (group.items && group.items.includes(txId)) {
                                repeatingBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f3e5f5; color: #9c27b0; border: 1px solid #9c27b0; margin-left: 4px;">Repeating</span>';
                                break;
                            }
                        }
                    }
                    
                    // Get transaction note and create user note badge
                    const txNote = txAnnotations.note || '';
                    if (txNote) {
                        userNoteBadge = `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f5f5f5; color: #666; border: 1px solid #ddd; margin-left: 4px;">&#xD83D;&#xDCDD; ${txNote}</span>`;
                    }
                    
                    txListHtml += `
                        <div class="sof-match-tx-row${markerClass}">
                            <span class="sof-match-date">${date}</span>
                            <span class="sof-match-desc">${tx.description || tx.merchant_name || 'Transaction'}${markerBadge}${flagBadge}${sourceBadge}${repeatingBadge}${userNoteBadge}</span>
                            <span class="sof-match-account">${tx.accountName}</span>
                            <span class="sof-match-amount ${amountClass}">${sign}${currencySymbol}${Math.abs(amount).toFixed(2)}</span>
                        </div>
                    `;
                });
                
                if (txListHtml) {
                    sofMatchesHtml += `
                        <div class="sof-match-group">
                            <div class="sof-match-label">${label}</div>
                            ${fundDetailsHtml}
                            ${txListHtml}
                        </div>
                    `;
                }
            }
            
            if (sofMatchesHtml) {
                html += `
                    <div class="bank-analysis-section collapsed" onclick="event.stopPropagation(); this.classList.toggle('collapsed');">
                        <div class="analysis-section-header">
                            <span class="analysis-section-title">Potential SoF Matches</span>
                            <span class="expand-indicator">&#x25BC;</span>
                        </div>
                        <div class="analysis-section-content">
                            ${sofMatchesHtml}
                        </div>
                    </div>
                `;
            }
        }
        
        // 4. Flagged/Commented/Linked Transactions Summary Section
        // Only show transactions where the USER has taken action (flag, comment, marker, or link)
        if (check) {
            const sofAnnotations = check.sofAnnotations || [];
            const userInteractedTxIds = new Set();
            
            // Collect only transactions where USER has added flags, comments, links, or markers
            sofAnnotations.forEach(ann => {
                // Direct transaction annotations (always user-created)
                const transactions = ann.notes?.transactions || [];
                transactions.forEach(tx => {
                    // Include if user added flag, note, or link
                    if (tx.flag || tx.note || (tx.linkedToFunds && tx.linkedToFunds.length > 0)) {
                        userInteractedTxIds.add(tx.txId);
                    }
                });
                
                // Funding method transaction markers (user accepted/rejected)
                const fundingMethods = ann.notes?.fundingMethods || [];
                fundingMethods.forEach(fm => {
                    const markers = fm.transactionMarkers || {};
                    Object.keys(markers).forEach(txId => {
                        // These are always user interactions
                        userInteractedTxIds.add(txId);
                    });
                });
                
                // Bank analysis items (user flagged/commented/linked)
                const bankAnalysisItems = ann.notes?.bankAnalysisItems || [];
                bankAnalysisItems.forEach(item => {
                    // Individual transactions
                    if (item.type === 'transaction' && item.transactionId) {
                        if (item.flag || item.comment || item.linkedToFundIdx) {
                            userInteractedTxIds.add(item.transactionId);
                        }
                    }
                    // Expand repeating groups if flagged or linked
                    else if (item.type === 'repeating-group' && (item.flag || item.comment || item.linkedToFundIdx)) {
                        if (analysis.repeating_transactions && analysis.repeating_transactions[item.groupIndex]) {
                            const group = analysis.repeating_transactions[item.groupIndex];
                            if (group.items) {
                                group.items.forEach(txId => userInteractedTxIds.add(txId));
                            }
                        }
                    }
                    // Expand chains if flagged or linked
                    else if (item.type === 'chain' && (item.flag || item.comment || item.linkedToFundIdx)) {
                        if (item.chainId) {
                            const chainTxIds = item.chainId.split('|');
                            chainTxIds.forEach(txId => userInteractedTxIds.add(txId));
                        }
                    }
                });
            });
            
            if (userInteractedTxIds.size > 0) {
                let flaggedTxHtml = '';
                
                // Group transactions by who annotated them (most recent annotation wins)
                const txAnnotationInfo = new Map();
                
                Array.from(userInteractedTxIds).forEach(txId => {
                    const transaction = getTransactionById(txId);
                    if (!transaction) return;
                    
                    // Find the most recent annotation for this transaction
                    let mostRecentAnn = null;
                    let mostRecentTime = 0;
                    
                    sofAnnotations.forEach(ann => {
                        const annTime = new Date(ann.timestamp).getTime();
                        
                        // Check all sources
                        const txs = ann.notes?.transactions || [];
                        const fms = ann.notes?.fundingMethods || [];
                        const items = ann.notes?.bankAnalysisItems || [];
                        
                        // Check if this annotation touches this transaction
                        let touchesThisTx = txs.some(t => t.txId === txId);
                        if (!touchesThisTx) {
                            touchesThisTx = fms.some(fm => fm.transactionMarkers && fm.transactionMarkers[txId]);
                        }
                        if (!touchesThisTx) {
                            touchesThisTx = items.some(item => {
                                if (item.type === 'transaction') return item.transactionId === txId;
                                if (item.type === 'chain') return item.chainId && item.chainId.split('|').includes(txId);
                                if (item.type === 'repeating-group' && analysis.repeating_transactions) {
                                    const group = analysis.repeating_transactions[item.groupIndex];
                                    return group && group.items && group.items.includes(txId);
                                }
                                return false;
                            });
                        }
                        
                        if (touchesThisTx && annTime > mostRecentTime) {
                            mostRecentTime = annTime;
                            mostRecentAnn = ann;
                        }
                    });
                    
                    if (mostRecentAnn) {
                        txAnnotationInfo.set(txId, {
                            transaction,
                            userName: mostRecentAnn.userName || mostRecentAnn.user,
                            timestamp: mostRecentAnn.timestamp
                        });
                    }
                });
                
                txAnnotationInfo.forEach(({transaction, userName, timestamp}, txId) => {
                    // For flagged/commented section, get ONLY direct annotations (not inherited from groups)
                    // Don't use getTransactionAnnotations() here as it includes inherited links from groups
                    const directAnnotations = {
                        flag: '',
                        note: '',
                        linkedFundingMethods: [],
                        marker: ''
                    };
                    
                    const notes = [];
                    
                    sofAnnotations.forEach(ann => {
                        // Only check DIRECT transaction annotations
                        const transactions = ann.notes?.transactions || [];
                        transactions.forEach(tx => {
                            if (tx.txId === txId) {
                                if (tx.flag) directAnnotations.flag = tx.flag;
                                if (tx.note) notes.push(tx.note);
                                if (tx.linkedToFunds && Array.isArray(tx.linkedToFunds)) {
                                    tx.linkedToFunds.forEach(fundIdx => {
                                        if (!directAnnotations.linkedFundingMethods.includes(fundIdx)) {
                                            directAnnotations.linkedFundingMethods.push(fundIdx);
                                        }
                                    });
                                }
                            }
                        });
                        
                        // Check funding method markers
                        const fundingMethods = ann.notes?.fundingMethods || [];
                        fundingMethods.forEach(fm => {
                            if (fm.transactionMarkers && fm.transactionMarkers[txId]) {
                                directAnnotations.marker = fm.transactionMarkers[txId];
                                if (fm.fundIdx && !directAnnotations.linkedFundingMethods.includes(fm.fundIdx)) {
                                    directAnnotations.linkedFundingMethods.push(fm.fundIdx);
                                }
                            }
                        });
                        
                        // Check ONLY individual transaction bank analysis items (not groups/chains)
                        const bankAnalysisItems = ann.notes?.bankAnalysisItems || [];
                        bankAnalysisItems.forEach(item => {
                            if (item.type === 'transaction' && item.transactionId === txId) {
                                if (item.flag) directAnnotations.flag = item.flag;
                                if (item.comment) notes.push(item.comment);
                                if (item.linkedToFundIdx && !directAnnotations.linkedFundingMethods.includes(item.linkedToFundIdx)) {
                                    directAnnotations.linkedFundingMethods.push(item.linkedToFundIdx);
                                }
                            }
                        });
                    });
                    
                    directAnnotations.note = notes.join(' | ');
                    
                    const txDate = new Date(transaction.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                    const amount = transaction.amount;
                    const amountClass = amount >= 0 ? 'positive' : 'negative';
                    const sign = amount >= 0 ? '+' : '';
                    const currencySymbol = this.getCurrencyFlag(transaction.currency || 'GBP');
                    
                    // Format annotation date/time
                    const annDate = new Date(timestamp).toLocaleString('en-GB', { 
                        day: '2-digit', 
                        month: 'short',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // Format user name
                    let formattedUserName = userName || 'Unknown';
                    if (formattedUserName && formattedUserName.includes('.') && !formattedUserName.includes(' ')) {
                        formattedUserName = formattedUserName.split('@')[0]
                            .split('.').join(' ')
                            .split('-').join(' ')
                            .replace(/\b\w/g, l => l.toUpperCase());
                    }
                    
                    // Build badges (using account-tag pill style)
                    let badgesHtml = '';
                    
                    // Linked funding badges (one per funding method) - ONLY direct links
                    if (directAnnotations.linkedFundingMethods && directAnnotations.linkedFundingMethods.length > 0) {
                        directAnnotations.linkedFundingMethods.forEach(fundIdxStr => {
                                const fund = sofFunds[parseInt(fundIdxStr)];
                                if (fund) {
                                    const typeMap = {
                                        'fund:mortgage': 'Mortgage',
                                        'fund:savings': 'Savings',
                                        'fund:gift': 'Gift',
                                        'fund:sale:property': 'Property Sale',
                                        'fund:sale:assets': 'Asset Sale',
                                        'fund:inheritance': 'Inheritance',
                                        'fund:htb': 'Help to Buy / LISA',
                                        'fund:income': 'Income'
                                    };
                                const fundLabel = typeMap[fund.type] || fund.type.replace('fund:', '');
                                badgesHtml += `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e3f2fd; color: #2196f3; border: 1px solid #2196f3;">${fundLabel}</span>`;
                            }
                        });
                    }
                    
                    // Flag badge
                    if (directAnnotations.flag) {
                        if (directAnnotations.flag === 'suspicious') {
                            badgesHtml += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #ffebee; color: #f44336; border: 1px solid #f44336;">Suspicious</span>';
                        } else if (directAnnotations.flag === 'review') {
                            badgesHtml += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #fff3e0; color: #ff9800; border: 1px solid #ff9800;">Review</span>';
                        } else if (directAnnotations.flag === 'cleared') {
                            badgesHtml += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e8f5e9; color: #4caf50; border: 1px solid #4caf50;">Cleared</span>';
                        } else if (directAnnotations.flag === 'linked') {
                            badgesHtml += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e3f2fd; color: #2196f3; border: 1px solid #2196f3;">Linked</span>';
                        }
                    }
                    
                    // Marker badge
                    if (directAnnotations.marker) {
                        if (directAnnotations.marker === 'accepted') {
                            badgesHtml += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e8f5e9; color: #388e3c; border: 1px solid #388e3c;">Accepted</span>';
                        } else if (directAnnotations.marker === 'rejected') {
                            badgesHtml += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #ffebee; color: #d32f2f; border: 1px solid #d32f2f;">Rejected</span>';
                        }
                    }
                    
                    // Build transaction inline badges (for nested card)
                    let txInlineBadges = '';
                    
                    // Marker badges for transaction
                    if (directAnnotations.marker) {
                        if (directAnnotations.marker === 'accepted') {
                            txInlineBadges += '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                        } else if (directAnnotations.marker === 'rejected') {
                            txInlineBadges += '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                        }
                    }
                    
                    // Flag badges for transaction
                    if (directAnnotations.flag) {
                        if (directAnnotations.flag === 'cleared') {
                            txInlineBadges += '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                        } else if (directAnnotations.flag === 'suspicious') {
                            txInlineBadges += '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                        } else if (directAnnotations.flag === 'review') {
                            txInlineBadges += '<span class="tx-marker-badge review">&#x2014; Review</span>';
                        } else if (directAnnotations.flag === 'linked') {
                            txInlineBadges += '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                        }
                    }
                    
                    // Linked funding method badges for transaction
                    if (directAnnotations.linkedFundingMethods && directAnnotations.linkedFundingMethods.length > 0) {
                        directAnnotations.linkedFundingMethods.forEach(fundIdxStr => {
                            const fund = sofFunds[parseInt(fundIdxStr)];
                            if (fund) {
                                const typeMap = {
                                    'fund:mortgage': 'Mortgage',
                                    'fund:savings': 'Savings',
                                    'fund:gift': 'Gift',
                                    'fund:sale:property': 'Property Sale',
                                    'fund:sale:assets': 'Asset Sale',
                                    'fund:inheritance': 'Inheritance',
                                    'fund:htb': 'Help to Buy / LISA',
                                    'fund:income': 'Income'
                                };
                                const fundLabel = typeMap[fund.type] || fund.type.replace('fund:', '');
                                txInlineBadges += `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e3f2fd; color: #2196f3; border: 1px solid #2196f3; margin-left: 4px;">&#xD83D;&#xDD17; ${fundLabel}</span>`;
                            }
                        });
                    }
                    
                    // Check if transaction is part of repeating group and build badge
                    let repeatingBadge = '';
                    let repeatingNoteText = '';
                    if (analysis && analysis.repeating_transactions) {
                        analysis.repeating_transactions.forEach((group, groupIdx) => {
                            if (group.items && group.items.includes(txId)) {
                                repeatingBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f3e5f5; color: #9c27b0; border: 1px solid #9c27b0; margin-left: 4px;">Repeating</span>';
                                const groupAnnotation = getItemAnnotation('repeating-group', groupIdx);
                                if (groupAnnotation && groupAnnotation.comment) {
                                    repeatingNoteText = groupAnnotation.comment;
                                }
                            }
                        });
                    }
                    
                    // User note badge for transaction (from repeating group or direct)
                    let userNoteBadge = '';
                    if (repeatingNoteText) {
                        userNoteBadge = `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f5f5f5; color: #666; border: 1px solid #ddd; margin-left: 4px;">&#xD83D;&#xDCDD; ${repeatingNoteText}</span>`;
                    }
                    
                    flaggedTxHtml += `
                        <div style="margin: 12px 0; padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px; background: #fafafa;">
                            <!-- Header row with user, badges, and timestamp -->
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: ${directAnnotations.note ? '8px' : '12px'};">
                                <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                                    <strong style="font-size: 12px; color: #333;">${formattedUserName}</strong>
                                    ${badgesHtml ? `<div style="display: flex; gap: 4px; flex-wrap: wrap;">${badgesHtml}</div>` : ''}
                                </div>
                                <span style="font-size: 11px; color: #666; white-space: nowrap;">${annDate}</span>
                            </div>
                            
                            <!-- User note -->
                            ${directAnnotations.note ? `
                                <div style="margin-bottom: 12px; padding: 8px 10px; background: #fff3cd; border-left: 3px solid #ffc107; border-radius: 3px; font-size: 12px; color: #856404;">
                                    ${directAnnotations.note}
                                </div>
                            ` : ''}
                            
                            <!-- Nested transaction data card -->
                            <div style="padding: 10px; background: white; border: 1px solid #e0e0e0; border-radius: 4px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                    <span style="font-size: 11px; color: #666;">${txDate}</span>
                                    <span style="font-size: 13px; font-weight: 600; color: ${amount >= 0 ? '#4caf50' : '#f44336'};">${sign}${currencySymbol}${Math.abs(amount).toFixed(2)}</span>
                                </div>
                                <div style="font-size: 13px; font-weight: 500; color: #333; margin-bottom: 4px;">
                                    ${transaction.description || transaction.merchant_name || 'Transaction'}${txInlineBadges}${repeatingBadge}${userNoteBadge}
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px; font-size: 11px; color: #666;">
                                    <strong>${transaction.accountName}</strong>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                    <div class="bank-analysis-section collapsed" onclick="event.stopPropagation(); this.classList.toggle('collapsed');">
                        <div class="analysis-section-header">
                            <span class="analysis-section-title">Flagged & Commented Transactions (${userInteractedTxIds.size})</span>
                            <span class="expand-indicator">&#x25BC;</span>
                        </div>
                        <div class="analysis-section-content">
                            ${flaggedTxHtml}
                        </div>
                    </div>
                `;
            }
        }
        
        return html;
    }
    
    createBiggestTransactionsSection(summaryByCcy, accounts = {}, check = null) {
        const currencyFlag = this.getCurrencyFlag.bind(this);
        
        // Create a map of account IDs to account names for quick lookup
        const accountNames = {};
        const accountColors = ['#93C5FD', '#86EFAC', '#FCA5A5', '#C4B5FD', '#FDBA74', '#A5F3FC', '#D1D5DB'];
        let colorIndex = 0;
        
        for (const [accountId, accountData] of Object.entries(accounts)) {
            const info = accountData.info || accountData;
            const name = info.name || 'Account';
            accountNames[accountId] = {
                name: name,
                color: accountColors[colorIndex % accountColors.length]
            };
            colorIndex++;
        }
        
        let currenciesHtml = '';
        
        for (const [currency, data] of Object.entries(summaryByCcy)) {
            const topIn = data.top_in || [];
            const topOut = data.top_out || [];
            const flag = currencyFlag(currency);
            
            // Filter transactions to only include those that actually match this currency
            let filteredTopIn = topIn.filter(tx => tx.currency === currency).slice(0, 5);
            let filteredTopOut = topOut.filter(tx => tx.currency === currency).slice(0, 5);
            
            // Enrich transactions with account names
            filteredTopIn = filteredTopIn.map(tx => ({
                ...tx,
                accountName: accountNames[tx.account_id]?.name || 'Account'
            }));
            filteredTopOut = filteredTopOut.map(tx => ({
                ...tx,
                accountName: accountNames[tx.account_id]?.name || 'Account'
            }));
            
            // Skip this currency if no matching transactions
            if (filteredTopIn.length === 0 && filteredTopOut.length === 0) {
                continue;
            }
            
            // Match internal transfers and transaction chains
            const matched = [];
            const transferPairs = [];
            const transactionChains = [];
            
            // First pass: Find exact cross-account transfers (same amount, same day, different accounts)
            filteredTopOut.forEach(outTx => {
                if (matched.includes(outTx.id)) return;
                const outDate = new Date(outTx.timestamp);
                const outAmount = Math.abs(outTx.amount);
                
                const match = filteredTopIn.find(inTx => {
                    if (matched.includes(inTx.id)) return false;
                    const inDate = new Date(inTx.timestamp);
                    const inAmount = Math.abs(inTx.amount);
                    
                    // Exact transfer: same amount, same day, different accounts
                    return Math.abs(inAmount - outAmount) < 0.01 && 
                           inTx.account_id !== outTx.account_id && 
                           inDate.toDateString() === outDate.toDateString();
                });
                
                if (match) {
                    matched.push(match.id);
                    matched.push(outTx.id);
                    transferPairs.push({ out: outTx, in: match });
                }
            });
            
            // Second pass: Find same-account flows (income &#x2192; payment from same account)
            filteredTopOut.forEach(outTx => {
                if (matched.includes(outTx.id)) return;
                const outDate = new Date(outTx.timestamp);
                const outAmount = Math.abs(outTx.amount);
                
                const match = filteredTopIn.find(inTx => {
                    if (matched.includes(inTx.id)) return false;
                    const inDate = new Date(inTx.timestamp);
                    const inAmount = Math.abs(inTx.amount);
                    const daysDiff = (outDate - inDate) / (1000 * 60 * 60 * 24);
                    
                    // Same account flow: income before payment, within 3 days
                    return inTx.account_id === outTx.account_id && 
                           daysDiff >= 0 && daysDiff <= 3 &&
                           inAmount >= outAmount &&
                           (inAmount - outAmount) <= Math.max(500, inAmount * 0.2);
                });
                
                if (match) {
                    matched.push(match.id);
                    matched.push(outTx.id);
                    transactionChains.push({ 
                        source: match, 
                        out: outTx, 
                        in: null  // Same account, no cross-transfer
                    });
                }
            });
            
            // Third pass: Look for extended chains (income &#x2192; transfer out &#x2192; transfer in &#x2192; payment)
            const extendedChains = [];
            transferPairs.forEach(pair => {
                // Check for preceding income to the outgoing account
                const candidateIncomes = filteredTopIn.filter(precedingTx => {
                    if (matched.includes(precedingTx.id)) return false;
                    const precedingDate = new Date(precedingTx.timestamp);
                    const outDate = new Date(pair.out.timestamp);
                    const daysDiff = (outDate - precedingDate) / (1000 * 60 * 60 * 24);
                    
                    return precedingTx.account_id === pair.out.account_id && 
                           daysDiff >= 0 && daysDiff <= 3;
                });
                
                const precedingIncome = candidateIncomes.length > 0
                    ? candidateIncomes.reduce((largest, tx) => 
                        Math.abs(tx.amount) > Math.abs(largest.amount) ? tx : largest
                      )
                    : null;
                
                // Check for subsequent payment from the incoming account
                const subsequentPayment = filteredTopOut.find(paymentTx => {
                    if (matched.includes(paymentTx.id)) return false;
                    const paymentDate = new Date(paymentTx.timestamp);
                    const inDate = new Date(pair.in.timestamp);
                    const daysDiff = (paymentDate - inDate) / (1000 * 60 * 60 * 24);
                    
                    return paymentTx.account_id === pair.in.account_id && 
                           daysDiff >= 0 && daysDiff <= 2;
                });
                
                if (precedingIncome || subsequentPayment) {
                    if (precedingIncome) matched.push(precedingIncome.id);
                    if (subsequentPayment) matched.push(subsequentPayment.id);
                    
                    extendedChains.push({
                        source: precedingIncome,
                        out: pair.out,
                        in: pair.in,
                        payment: subsequentPayment
                    });
                    pair.extended = true; // Mark as processed
                }
            });
            
            // Create transaction chains and pairs - display 2 per row
            let transfersHtml = '';
            const allChains = [...extendedChains, ...transactionChains, ...transferPairs.filter(p => !p.extended)];
            
            for (let i = 0; i < allChains.length; i += 2) {
                const chain1 = allChains[i];
                const chain2 = allChains[i + 1];
                
                transfersHtml += `<div class="chains-row">`;
                
                // Left column - Chain 1
                if (chain1) {
                    const flag1 = this.getCurrencyFlag((chain1.source?.currency || chain1.out.currency) || currency);
                    transfersHtml += this.renderChainColumn(chain1, flag1);
                }
                
                // Right column - Chain 2
                if (chain2) {
                    const flag2 = this.getCurrencyFlag((chain2.source?.currency || chain2.out.currency) || currency);
                    transfersHtml += this.renderChainColumn(chain2, flag2);
                }
                
                transfersHtml += `</div>`;
            }
            
            // Create unmatched transaction rows
            let incomingHtml = '';
            filteredTopIn.forEach(tx => {
                if (matched.includes(tx.id)) return;
                
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
                const amount = tx.amount.toFixed(2);
                const description = tx.description || tx.merchant_name || 'Transaction';
                const accountInfo = accountNames[tx.account_id];
                const accountBadge = accountInfo ? accountInfo.name : '';
                
                // Get comprehensive annotations for this transaction
                const txAnnotations = check ? this.getTransactionAnnotations(tx.id, check) : { flag: '', note: '', marker: '' };
                
                // Build badges
                let badgesHtml = '';
                
                // Marker badges
                if (txAnnotations.marker === 'accepted') {
                    badgesHtml += '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                } else if (txAnnotations.marker === 'rejected') {
                    badgesHtml += '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                }
                
                // Flag badges
                if (txAnnotations.flag === 'cleared') {
                    badgesHtml += '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                } else if (txAnnotations.flag === 'suspicious') {
                    badgesHtml += '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                } else if (txAnnotations.flag === 'review') {
                    badgesHtml += '<span class="tx-marker-badge review">&#x2014; Review</span>';
                } else if (txAnnotations.flag === 'linked') {
                    badgesHtml += '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                }
                
                // User note badge
                if (txAnnotations.note) {
                    badgesHtml += `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f5f5f5; color: #666; border: 1px solid #ddd; margin-left: 4px;">&#xD83D;&#xDCDD; ${txAnnotations.note}</span>`;
                }
                
                incomingHtml += `
                    <div class="transaction-row incoming">
                        <span class="transaction-date">${date}</span>
                        <span class="transaction-description">${description}${badgesHtml}</span>
                        ${accountBadge ? `<span class="account-badge">${accountBadge}</span>` : ''}
                        <span class="transaction-amount positive">${flag}${amount}</span>
                    </div>
                `;
            });
            
            let outgoingHtml = '';
            filteredTopOut.forEach(tx => {
                if (matched.includes(tx.id)) return;
                
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
                const amount = Math.abs(tx.amount).toFixed(2);
                const description = tx.description || tx.merchant_name || 'Transaction';
                const accountInfo = accountNames[tx.account_id];
                const accountBadge = accountInfo ? accountInfo.name : '';
                
                // Get comprehensive annotations for this transaction
                const txAnnotations = check ? this.getTransactionAnnotations(tx.id, check) : { flag: '', note: '', marker: '' };
                
                // Build badges
                let badgesHtml = '';
                
                // Marker badges
                if (txAnnotations.marker === 'accepted') {
                    badgesHtml += '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                } else if (txAnnotations.marker === 'rejected') {
                    badgesHtml += '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                }
                
                // Flag badges
                if (txAnnotations.flag === 'cleared') {
                    badgesHtml += '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                } else if (txAnnotations.flag === 'suspicious') {
                    badgesHtml += '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                } else if (txAnnotations.flag === 'review') {
                    badgesHtml += '<span class="tx-marker-badge review">&#x2014; Review</span>';
                } else if (txAnnotations.flag === 'linked') {
                    badgesHtml += '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                }
                
                // User note badge
                if (txAnnotations.note) {
                    badgesHtml += `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f5f5f5; color: #666; border: 1px solid #ddd; margin-left: 4px;">&#xD83D;&#xDCDD; ${txAnnotations.note}</span>`;
                }
                
                outgoingHtml += `
                    <div class="transaction-row outgoing">
                        <span class="transaction-date">${date}</span>
                        <span class="transaction-description">${description}${badgesHtml}</span>
                        ${accountBadge ? `<span class="account-badge">${accountBadge}</span>` : ''}
                        <span class="transaction-amount negative">${flag}${amount}</span>
                    </div>
                `;
            });
            
            // Build the columns section only if there are unmatched transactions
            let columnsHtml = '';
            const hasIncoming = incomingHtml.trim().length > 0;
            const hasOutgoing = outgoingHtml.trim().length > 0;
            
            if (hasIncoming || hasOutgoing) {
                if (hasIncoming && hasOutgoing) {
                    // Both columns
                    columnsHtml = `
                        <div class="transactions-columns">
                            <div class="transactions-column">
                                <div class="column-header incoming-header">Largest Incoming</div>
                                ${incomingHtml}
                            </div>
                            <div class="transactions-column">
                                <div class="column-header outgoing-header">Largest Outgoing</div>
                                ${outgoingHtml}
                            </div>
                        </div>
                    `;
                } else if (hasIncoming) {
                    // Only incoming
                    columnsHtml = `
                        <div class="transactions-columns single-column">
                            <div class="transactions-column">
                                <div class="column-header incoming-header">Largest Incoming</div>
                                ${incomingHtml}
                            </div>
                        </div>
                    `;
                } else {
                    // Only outgoing
                    columnsHtml = `
                        <div class="transactions-columns single-column">
                            <div class="transactions-column">
                                <div class="column-header outgoing-header">Largest Outgoing</div>
                                ${outgoingHtml}
                            </div>
                        </div>
                    `;
                }
            }
            
            currenciesHtml += `
                <div class="currency-transactions-row">
                    <div class="currency-label">${flag} ${currency}</div>
                    ${transfersHtml ? `
                        <div class="internal-transfers-section">
                            <div class="internal-transfers-label">Internal Transfers</div>
                            ${transfersHtml}
                        </div>
                    ` : ''}
                    ${columnsHtml}
                </div>
            `;
        }
        
        return `
            <div class="biggest-transactions-container collapsed" onclick="event.stopPropagation(); this.classList.toggle('collapsed');">
                <div class="biggest-transactions-header">
                    <span class="biggest-transactions-title">Biggest Transactions by Currency</span>
                    <span class="expand-indicator">&#x25BC;</span>
                </div>
                <div class="biggest-transactions-content">
                    ${currenciesHtml}
                </div>
            </div>
        `;
    }
    
    createBankTaskCard(bankSummary, bankStatement, sofTask = null, check = null) {
        // Combined bank task card - handles both linking (summary) and PDF upload (statement)
        const hasSummary = bankSummary && bankSummary.status === 'closed';
        const hasStatement = bankStatement && bankStatement.status === 'closed';
        
        // Check if this is documents:bank-statement (uploaded PDFs with OCR data)
        const isDocumentUpload = bankStatement && bankStatement.breakdown?.accounts && bankStatement.breakdown?.documents;
        
        // Check if linking was requested but skipped (rejected status)
        const linkingSkipped = (bankSummary && bankSummary.status === 'rejected') || 
                               (bankStatement && bankStatement.status === 'rejected' && !isDocumentUpload);
        
        // Determine overall status
        let borderClass = 'clear';
        let statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>`;
        let inlineWarning = '';
        
        // If linking was skipped but documents were uploaded and scanned, show as clear with warning
        if (linkingSkipped && isDocumentUpload) {
            borderClass = 'clear';
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>`;
            inlineWarning = 'Bank linking skipped but documents uploaded and scanned';
        } else if (hasSummary && bankSummary.result === 'consider') {
            borderClass = 'consider';
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        } else if (hasSummary && bankSummary.result === 'fail') {
            borderClass = 'alert';
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>`;
        } else if (hasStatement && !hasSummary && !isDocumentUpload) {
            // PDF upload only without OCR data - always consider (manual review)
            borderClass = 'consider';
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        } else if (!hasSummary && !hasStatement) {
            // Neither provided - fail
            borderClass = 'alert';
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>`;
        }
        
        // Get accounts count for header display
        let accounts = {};
        let accountsHtml = '';
        let isManualUpload = false;
        if (hasStatement && bankStatement.breakdown && bankStatement.breakdown.accounts) {
            accounts = bankStatement.breakdown.accounts;
            isManualUpload = true; // Manual PDF upload
            
            // DEDUPLICATE all account statements for manual uploads
            // This ensures all analysis (repeating transactions, largest transactions, etc.) uses clean data
            accounts = this.deduplicateAccountsData(accounts);
        } else if (hasSummary && bankSummary.breakdown && bankSummary.breakdown.accounts) {
            accounts = bankSummary.breakdown.accounts;
            isManualUpload = false; // Open Banking linking
        }
        const accountCount = Object.keys(accounts).length;
        
        // Build header checks (visible when collapsed)
        let headerChecksHtml = '<div class="task-header-checks">';
        
        if (linkingSkipped && isDocumentUpload) {
            // Bank linking skipped but statements uploaded
            headerChecksHtml += `
                <div class="task-check-item">
                    ${this.getTaskCheckIcon('CO')}
                    <span class="task-check-text">Bank linking skipped</span>
                </div>
                <div class="task-check-item">
                    ${this.getTaskCheckIcon('CL')}
                    <span class="task-check-text">Statements uploaded and scanned</span>
                </div>
            `;
        } else if (hasSummary) {
            // Bank linking completed
            const summaryStatus = bankSummary.result === 'clear' ? 'CL' : (bankSummary.result === 'fail' ? 'AL' : 'CO');
            headerChecksHtml += `
                <div class="task-check-item">
                    ${this.getTaskCheckIcon(summaryStatus)}
                    <span class="task-check-text">Bank linking completed via Open Banking</span>
                </div>
            `;
            if (accountCount > 0) {
                headerChecksHtml += `
                    <div class="task-check-item">
                        ${this.getTaskCheckIcon('CL')}
                        <span class="task-check-text">${accountCount} account${accountCount !== 1 ? 's' : ''} linked</span>
                    </div>
                `;
            }
        } else if (hasStatement && !hasSummary) {
            // PDF upload only
            headerChecksHtml += `
                <div class="task-check-item">
                    ${this.getTaskCheckIcon('CO')}
                    <span class="task-check-text">Bank linking declined - Statements uploaded for manual review</span>
                </div>
            `;
        } else if (!hasSummary && !hasStatement) {
            // Neither provided - task skipped
            headerChecksHtml += `
                <div class="task-check-item">
                    ${this.getTaskCheckIcon('AL')}
                    <span class="task-check-text">Task skipped</span>
                </div>
            `;
        }
        
        headerChecksHtml += '</div>';
        
        // Build detail checks (visible when expanded)
        let checksHtml = '';
        
        // Add linked accounts section (already retrieved accounts above for header)
        
        if (Object.keys(accounts).length > 0) {
            accountsHtml = '<div class="bank-accounts-container">';
            accountsHtml += '<div class="bank-accounts-title">Linked Accounts</div>';
            
            for (const [accountId, accountData] of Object.entries(accounts)) {
                accountsHtml += this.createBankAccountCard(accountId, accountData, isManualUpload, check);
            }
            
            accountsHtml += '</div>';
        }
        
        // Add biggest transactions by currency section
        let biggestTransactionsHtml = '';
        const summaryByCcy = (hasSummary && bankSummary.breakdown && bankSummary.breakdown.summary && bankSummary.breakdown.summary.by_ccy) 
            ? bankSummary.breakdown.summary.by_ccy 
            : null;
        
        if (summaryByCcy && Object.keys(summaryByCcy).length > 0) {
            biggestTransactionsHtml = this.createBiggestTransactionsSection(summaryByCcy, accounts, check);
        }
        
        // Add analysis sections if available
        let analysisHtml = '';
        if (bankStatement?.breakdown?.analysis) {
            analysisHtml = this.createBankAnalysisSections(bankStatement.breakdown.analysis, accounts, sofTask, check);
        }
        
        // Add annotations display if check provided
        const annotationsHtml = check ? this.renderTaskAnnotations('bank', check) : '';
        
        // Calculate summary badges
        let totalLinkedTxs = 0;
        let totalReviewedAccounts = 0;
        let totalSuspiciousTxs = 0;
        
        if (check) {
            // Count reviewed accounts
            if (check.sofAnnotations) {
                const reviewedAccountIds = new Set();
                check.sofAnnotations.forEach(ann => {
                    const accounts = ann.notes?.accounts || [];
                    accounts.forEach(acc => {
                        if (acc.reviewed) {
                            reviewedAccountIds.add(acc.accountId);
                        }
                    });
                });
                totalReviewedAccounts = reviewedAccountIds.size;
            }
            
            // Count linked and suspicious transactions across all accounts
            Object.values(accounts).forEach(accountData => {
                const statement = accountData.statement || [];
                statement.forEach(tx => {
                    const txAnnotations = this.getTransactionAnnotations(tx.id, check);
                    if (txAnnotations.linkedFundingMethods.length > 0) totalLinkedTxs++;
                    if (txAnnotations.flag === 'suspicious') totalSuspiciousTxs++;
                });
            });
        }
        
        // Build badges HTML
        let badgesHtml = '';
        if (totalReviewedAccounts > 0) {
            badgesHtml += `<span class="annotation-count-badge">${totalReviewedAccounts} Account${totalReviewedAccounts > 1 ? 's' : ''} Reviewed</span>`;
        }
        if (totalLinkedTxs > 0) {
            badgesHtml += `<span class="annotation-count-badge">${totalLinkedTxs} Transaction${totalLinkedTxs > 1 ? 's' : ''} Linked</span>`;
        }
        if (totalSuspiciousTxs > 0) {
            badgesHtml += `<span class="annotation-count-badge" style="background: #ffebee; color: #d32f2f;">${totalSuspiciousTxs} Suspicious</span>`;
        }
        
        const badgesContainer = badgesHtml ? `<div class="task-header-badges">${badgesHtml}</div>` : '';
        
        return `
            <div class="task-card ${borderClass}" onclick="this.classList.toggle('expanded')">
                <div class="task-header">
                    <div class="task-title">Bank Summary</div>
                    ${badgesContainer}
                    ${statusIcon}
                </div>
                ${headerChecksHtml}
                <div class="task-details">
                    ${accountsHtml}
                    ${biggestTransactionsHtml}
                    ${analysisHtml}
                    ${annotationsHtml}
                </div>
            </div>
        `;
    }
    
    getBankBrandColors(providerId, providerName) {
        // Map of UK banks to their official brand colors (gradient pairs)
        const bankColors = {
            // High Street Banks
            'ob-barclays': { from: '#00AEEF', to: '#008CB8' },
            'barclays': { from: '#00AEEF', to: '#008CB8' },
            'ob-hsbc': { from: '#DB0011', to: '#A30009' },
            'hsbc': { from: '#DB0011', to: '#A30009' },
            'hsbc uk': { from: '#DB0011', to: '#A30009' },
            'ob-lloyds': { from: '#006F62', to: '#004D43' },
            'lloyds': { from: '#006F62', to: '#004D43' },
            'lloyds bank': { from: '#006F62', to: '#004D43' },
            'ob-halifax': { from: '#0076BE', to: '#005691' },
            'halifax': { from: '#0076BE', to: '#005691' },
            'ob-natwest': { from: '#5A287F', to: '#42205F' },
            'natwest': { from: '#5A287F', to: '#42205F' },
            'ob-rbs': { from: '#003C71', to: '#002952' },
            'rbs': { from: '#003C71', to: '#002952' },
            'royal bank of scotland': { from: '#003C71', to: '#002952' },
            'ob-santander': { from: '#EC0000', to: '#B30000' },
            'santander': { from: '#EC0000', to: '#B30000' },
            'santander uk': { from: '#EC0000', to: '#B30000' },
            'ob-nationwide': { from: '#0C2340', to: '#081629' },
            'nationwide': { from: '#0C2340', to: '#081629' },
            'nationwide building society': { from: '#0C2340', to: '#081629' },
            'ob-bankofscotland': { from: '#005EB8', to: '#004489' },
            'bank of scotland': { from: '#005EB8', to: '#004489' },
            'ob-tsb': { from: '#00A1DE', to: '#0078A8' },
            'tsb': { from: '#00A1DE', to: '#0078A8' },
            'tsb bank': { from: '#00A1DE', to: '#0078A8' },
            'ob-cooperative': { from: '#00B1E7', to: '#0088B5' },
            'cooperative bank': { from: '#00B1E7', to: '#0088B5' },
            'the co-operative bank': { from: '#00B1E7', to: '#0088B5' },
            'ob-metro': { from: '#951B81', to: '#6E1460' },
            'metro': { from: '#951B81', to: '#6E1460' },
            'metro bank': { from: '#951B81', to: '#6E1460' },
            'ob-virginmoney': { from: '#E30613', to: '#B0050F' },
            'virgin money': { from: '#E30613', to: '#B0050F' },
            'ob-firstdirect': { from: '#242833', to: '#13161E' },
            'first direct': { from: '#242833', to: '#13161E' },
            
            // Digital/Fintech Banks
            'ob-monzo': { from: '#EB3C53', to: '#D5447E' },
            'monzo': { from: '#EB3C53', to: '#D5447E' },
            'ob-starling': { from: '#6935D3', to: '#4F1FA8' },
            'starling': { from: '#6935D3', to: '#4F1FA8' },
            'starling bank': { from: '#6935D3', to: '#4F1FA8' },
            'ob-revolut': { from: '#242833', to: '#13161E' },
            'revolut': { from: '#242833', to: '#13161E' },
            'ob-chase': { from: '#117ACA', to: '#0D5C9C' },
            'chase': { from: '#117ACA', to: '#0D5C9C' },
            'chase uk': { from: '#117ACA', to: '#0D5C9C' },
            'ob-tide': { from: '#FF6B00', to: '#CC5500' },
            'tide': { from: '#FF6B00', to: '#CC5500' },
            'ob-curve': { from: '#2E3192', to: '#1F2166' },
            'curve': { from: '#2E3192', to: '#1F2166' },
            
            // Building Societies
            'ob-yorkshire': { from: '#002B5C', to: '#001A3A' },
            'yorkshire': { from: '#002B5C', to: '#001A3A' },
            'yorkshire building society': { from: '#002B5C', to: '#001A3A' },
            'ob-coventry': { from: '#E41937', to: '#B4142C' },
            'coventry': { from: '#E41937', to: '#B4142C' },
            'coventry building society': { from: '#E41937', to: '#B4142C' },
            
            // Irish Banks
            'ob-bankofireland': { from: '#005EB8', to: '#004489' },
            'bank of ireland': { from: '#005EB8', to: '#004489' },
            'bank of ireland uk': { from: '#005EB8', to: '#004489' },
            'ob-aib': { from: '#00A3E0', to: '#007DB0' },
            'aib': { from: '#00A3E0', to: '#007DB0' },
            'allied irish bank': { from: '#00A3E0', to: '#007DB0' },
            'ob-danske': { from: '#003755', to: '#00253B' },
            'danske': { from: '#003755', to: '#00253B' },
            'danske bank': { from: '#003755', to: '#00253B' },
            'ob-ulster': { from: '#E30613', to: '#B0050F' },
            'ulster': { from: '#E30613', to: '#B0050F' },
            'ulster bank': { from: '#E30613', to: '#B0050F' },
            
            // Retail Banks
            'ob-tesco': { from: '#00539F', to: '#003D75' },
            'tesco': { from: '#00539F', to: '#003D75' },
            'tesco bank': { from: '#00539F', to: '#003D75' },
            'ob-sainsburys': { from: '#F06C00', to: '#C45500' },
            'sainsburys': { from: '#F06C00', to: '#C45500' },
            'sainsburys bank': { from: '#F06C00', to: '#C45500' },
            'ob-marks': { from: '#334A2C', to: '#243520' },
            'm&s bank': { from: '#334A2C', to: '#243520' },
            'marks and spencer': { from: '#334A2C', to: '#243520' },
            
            // International/Specialist
            'ob-clydesdale': { from: '#002855', to: '#001A38' },
            'clydesdale': { from: '#002855', to: '#001A38' },
            'clydesdale bank': { from: '#002855', to: '#001A38' },
            'ob-handelsbanken': { from: '#003C71', to: '#002952' },
            'handelsbanken': { from: '#003C71', to: '#002952' },
            'handelsbanken uk': { from: '#003C71', to: '#002952' },
            'ob-clearbank': { from: '#00A3E0', to: '#007DB0' },
            'clearbank': { from: '#00A3E0', to: '#007DB0' }
        };
        
        const colors = bankColors[providerId?.toLowerCase()] || bankColors[providerName?.toLowerCase()];
        
        if (colors) {
            return colors;
        }
        // Default fallback - your current blue
        return { from: '#1d71b8', to: '#155a94' };
    }
    
    getBankLogo(providerId, providerName) {
        // Map of common UK banks to their official logo URLs
        const bankLogos = {
            // High Street Banks
            'ob-barclays': 'https://www.openbanking.org.uk/wp-content/uploads/barclays-1024x397.png',
            'barclays': 'https://www.openbanking.org.uk/wp-content/uploads/barclays-1024x397.png',
            'ob-hsbc': 'https://upload.wikimedia.org/wikipedia/commons/f/f5/HSBC_UK_logo.svg',
            'hsbc': 'https://upload.wikimedia.org/wikipedia/commons/f/f5/HSBC_UK_logo.svg',
            'hsbc uk': 'https://upload.wikimedia.org/wikipedia/commons/f/f5/HSBC_UK_logo.svg',
            'ob-lloyds': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSyy7vaJz0i2F4dovIfcwWCdqeedJQM9qlSzQ&s',
            'lloyds': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSyy7vaJz0i2F4dovIfcwWCdqeedJQM9qlSzQ&s',
            'lloyds bank': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSyy7vaJz0i2F4dovIfcwWCdqeedJQM9qlSzQ&s',
            'ob-halifax': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_h9upkpUUtuAGtTSdTLbeAV0piA87sav6aw&s',
            'halifax': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_h9upkpUUtuAGtTSdTLbeAV0piA87sav6aw&s',
            'ob-rbs': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTuXPyc9O-r79u9oluVWXq5LAet4o_RtAkb-w&s',
            'rbs': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTuXPyc9O-r79u9oluVWXq5LAet4o_RtAkb-w&s',
            'royal bank of scotland': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTuXPyc9O-r79u9oluVWXq5LAet4o_RtAkb-w&s',
            'ob-natwest': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRVjny8JmpgBKI6JIDQSOfeoi-4_LLQMPj-Eg&s',
            'natwest': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRVjny8JmpgBKI6JIDQSOfeoi-4_LLQMPj-Eg&s',
            'ob-bankofscotland': 'https://www.lloydsbankinggroup.com/assets/images/site-wide/logos/bank-of-scotland.png',
            'bank of scotland': 'https://www.lloydsbankinggroup.com/assets/images/site-wide/logos/bank-of-scotland.png',
            'ob-santander': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Banco_Santander_Logotipo.svg/1280px-Banco_Santander_Logotipo.svg.png',
            'santander': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Banco_Santander_Logotipo.svg/1280px-Banco_Santander_Logotipo.svg.png',
            'santander uk': 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Banco_Santander_Logotipo.svg/1280px-Banco_Santander_Logotipo.svg.png',
            'ob-nationwide': 'https://www.inbenta.com/wp-content/uploads/2024/11/BrandLogo.org-Nationwide-Building-Society-Logo.png',
            'nationwide': 'https://www.inbenta.com/wp-content/uploads/2024/11/BrandLogo.org-Nationwide-Building-Society-Logo.png',
            'nationwide building society': 'https://www.inbenta.com/wp-content/uploads/2024/11/BrandLogo.org-Nationwide-Building-Society-Logo.png',
            'ob-tsb': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTMk_WcrzS3Y8kEZ42JhexEc_ZNbTp0_IlK0w&s',
            'tsb': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTMk_WcrzS3Y8kEZ42JhexEc_ZNbTp0_IlK0w&s',
            'tsb bank': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTMk_WcrzS3Y8kEZ42JhexEc_ZNbTp0_IlK0w&s',
            'ob-virginmoney': 'https://pentagram-production.imgix.net/147ad8a8-ed8d-46b0-89ee-673690e12b4d/01_VM_HeroLogo.png?auto=compress%2Cformat&crop=entropy&fit=crop&fm=jpg&h=470&q=80&rect=0%2C172%2C4133%2C2584&w=900',
            'virgin money': 'https://pentagram-production.imgix.net/147ad8a8-ed8d-46b0-89ee-673690e12b4d/01_VM_HeroLogo.png?auto=compress%2Cformat&crop=entropy&fit=crop&fm=jpg&h=470&q=80&rect=0%2C172%2C4133%2C2584&w=900',
            'ob-cooperative': 'https://www.moneyandmentalhealth.org/wp-content/uploads/2023/07/coop-bank-logo.png',
            'cooperative bank': 'https://www.moneyandmentalhealth.org/wp-content/uploads/2023/07/coop-bank-logo.png',
            'the co-operative bank': 'https://www.moneyandmentalhealth.org/wp-content/uploads/2023/07/coop-bank-logo.png',
            'ob-metro': 'https://cdn-ukwest.onetrust.com/logos/6dc470d7-9576-47d4-a63b-95cced3c427e/bf7bb4ec-806f-4b15-b89c-ad14cdef2bf0/9d9d405e-b98c-4c8d-8708-66860b4cd96a/Metro_Bank_Logo_-_Secondary_(black).png',
            'metro': 'https://cdn-ukwest.onetrust.com/logos/6dc470d7-9576-47d4-a63b-95cced3c427e/bf7bb4ec-806f-4b15-b89c-ad14cdef2bf0/9d9d405e-b98c-4c8d-8708-66860b4cd96a/Metro_Bank_Logo_-_Secondary_(black).png',
            'metro bank': 'https://cdn-ukwest.onetrust.com/logos/6dc470d7-9576-47d4-a63b-95cced3c427e/bf7bb4ec-806f-4b15-b89c-ad14cdef2bf0/9d9d405e-b98c-4c8d-8708-66860b4cd96a/Metro_Bank_Logo_-_Secondary_(black).png',
            'ob-bankofireland': 'https://d1pt6w2mt2xqso.cloudfront.net/AcuCustom/Sitename/DAM/047/LOGO-bank-of-ireland-copy-e1573823492597.png',
            'bank of ireland': 'https://d1pt6w2mt2xqso.cloudfront.net/AcuCustom/Sitename/DAM/047/LOGO-bank-of-ireland-copy-e1573823492597.png',
            'bank of ireland uk': 'https://d1pt6w2mt2xqso.cloudfront.net/AcuCustom/Sitename/DAM/047/LOGO-bank-of-ireland-copy-e1573823492597.png',
            'ob-aib': 'https://aibgb.co.uk/content/dam/gb/business/business-images/aib-logo@2x.png',
            'aib': 'https://aibgb.co.uk/content/dam/gb/business/business-images/aib-logo@2x.png',
            'allied irish bank': 'https://aibgb.co.uk/content/dam/gb/business/business-images/aib-logo@2x.png',
            'ob-danske': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Danske_Bank_logo.svg/2560px-Danske_Bank_logo.svg.png',
            'danske': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Danske_Bank_logo.svg/2560px-Danske_Bank_logo.svg.png',
            'danske bank': 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9f/Danske_Bank_logo.svg/2560px-Danske_Bank_logo.svg.png',
            'ob-ulster': 'https://upload.wikimedia.org/wikipedia/commons/8/81/Ulsterbank_logo.gif',
            'ulster': 'https://upload.wikimedia.org/wikipedia/commons/8/81/Ulsterbank_logo.gif',
            'ulster bank': 'https://upload.wikimedia.org/wikipedia/commons/8/81/Ulsterbank_logo.gif',
            'ob-yorkshire': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR9PPhhvh95D4l0lPgy4nRU3U1a3iDihjhbGA&s',
            'yorkshire': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR9PPhhvh95D4l0lPgy4nRU3U1a3iDihjhbGA&s',
            'yorkshire building society': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR9PPhhvh95D4l0lPgy4nRU3U1a3iDihjhbGA&s',
            'ob-coventry': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQB9GBYoP8kSjhhDbY4OvFF8UPAcyA_Tq-qaA&s',
            'coventry': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQB9GBYoP8kSjhhDbY4OvFF8UPAcyA_Tq-qaA&s',
            'coventry building society': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQB9GBYoP8kSjhhDbY4OvFF8UPAcyA_Tq-qaA&s',
            'ob-tesco': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRXmS_yihuCLWL6sjW_-fYnCzij03VWojI9Gw&s',
            'tesco': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRXmS_yihuCLWL6sjW_-fYnCzij03VWojI9Gw&s',
            'tesco bank': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRXmS_yihuCLWL6sjW_-fYnCzij03VWojI9Gw&s',
            'ob-sainsburys': 'https://www.sainsburysbank.co.uk/dam/jcr:f4cf6e1c-fdfb-4595-89f0-fa3a2fa1b1cd/Sept%202022%20stacked%20logo%20clearance.png',
            'sainsburys': 'https://www.sainsburysbank.co.uk/dam/jcr:f4cf6e1c-fdfb-4595-89f0-fa3a2fa1b1cd/Sept%202022%20stacked%20logo%20clearance.png',
            'sainsburys bank': 'https://www.sainsburysbank.co.uk/dam/jcr:f4cf6e1c-fdfb-4595-89f0-fa3a2fa1b1cd/Sept%202022%20stacked%20logo%20clearance.png',
            'ob-marks': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQDkOm1IEkSw1L4Vq5sQB19-0RdPozPgVxGAA&s',
            'm&s bank': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQDkOm1IEkSw1L4Vq5sQB19-0RdPozPgVxGAA&s',
            'marks and spencer': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQDkOm1IEkSw1L4Vq5sQB19-0RdPozPgVxGAA&s',
            'ob-firstdirect': 'https://upload.wikimedia.org/wikipedia/commons/6/6e/First_direct_vertical_whiteonblack_logo.svg',
            'first direct': 'https://upload.wikimedia.org/wikipedia/commons/6/6e/First_direct_vertical_whiteonblack_logo.svg',
            'ob-clydesdale': 'https://upload.wikimedia.org/wikipedia/de/0/05/Clydesdale_Bank_logo.svg',
            'clydesdale': 'https://upload.wikimedia.org/wikipedia/de/0/05/Clydesdale_Bank_logo.svg',
            'clydesdale bank': 'https://upload.wikimedia.org/wikipedia/de/0/05/Clydesdale_Bank_logo.svg',
            'ob-handelsbanken': 'https://www.handelsbanken.co.uk/tron/gbpu/info/contents/v1/document/52-99616',
            'handelsbanken': 'https://www.handelsbanken.co.uk/tron/gbpu/info/contents/v1/document/52-99616',
            'handelsbanken uk': 'https://www.handelsbanken.co.uk/tron/gbpu/info/contents/v1/document/52-99616',
            
            // Digital/Fintech Banks
            'ob-monzo': 'https://upload.wikimedia.org/wikipedia/en/3/3a/Monzo_logo.png',
            'monzo': 'https://upload.wikimedia.org/wikipedia/en/3/3a/Monzo_logo.png',
            'ob-starling': 'https://upload.wikimedia.org/wikipedia/commons/f/f3/Starling_Bank_Logo.png',
            'starling': 'https://upload.wikimedia.org/wikipedia/commons/f/f3/Starling_Bank_Logo.png',
            'starling bank': 'https://upload.wikimedia.org/wikipedia/commons/f/f3/Starling_Bank_Logo.png',
            'ob-revolut': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSniinv2w7NpY0MolekyzxIkf_JMXRgz29w-A&s',
            'revolut': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSniinv2w7NpY0MolekyzxIkf_JMXRgz29w-A&s',
            'ob-chase': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQDnutej6BLaFcdWo53jMYVP1NL2rhdMI4-iQ&s',
            'chase': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQDnutej6BLaFcdWo53jMYVP1NL2rhdMI4-iQ&s',
            'chase uk': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQDnutej6BLaFcdWo53jMYVP1NL2rhdMI4-iQ&s',
            'ob-tide': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRnYAN0m6Nw6v4vrf_P17bXALc7NdnRnWU2wQ&s',
            'tide': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRnYAN0m6Nw6v4vrf_P17bXALc7NdnRnWU2wQ&s',
            'ob-curve': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTwMpHQa1OrmCghoFn6ReBgRsPScG_GOYHCmw&s',
            'curve': 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTwMpHQa1OrmCghoFn6ReBgRsPScG_GOYHCmw&s',
            'ob-clearbank': 'https://www.deloitte.co.uk/fast50/assets/img/logos-winners/2021/clearbank-logo.jpg',
            'clearbank': 'https://www.deloitte.co.uk/fast50/assets/img/logos-winners/2021/clearbank-logo.jpg'
        };
        
        const logoUrl = bankLogos[providerId?.toLowerCase()] || bankLogos[providerName?.toLowerCase()];
        
        if (logoUrl) {
            return `<img src="${logoUrl}" alt="${providerName}" class="bank-logo" onerror="this.style.display='none'">`;
        }
        return '';
    }
    
    getCurrencyFlag(currency) {
        // Map currency codes to country flags
        const currencyFlags = {
            'GBP': '&#xD83C;&#xDDEC;&#xD83C;&#xDDE7;',
            'EUR': '&#xD83C;&#xDDEA;&#xD83C;&#xDDFA;',
            'USD': '&#xD83C;&#xDDFA;&#xD83C;&#xDDF8;',
            'CHF': '&#xD83C;&#xDDE8;&#xD83C;&#xDDED;',
            'JPY': '&#xD83C;&#xDDEF;&#xD83C;&#xDDF5;',
            'CAD': '&#xD83C;&#xDDE8;&#xD83C;&#xDDE6;',
            'AUD': '&#xD83C;&#xDDE6;&#xD83C;&#xDDFA;',
            'NZD': '&#xD83C;&#xDDF3;&#xD83C;&#xDDFF;',
            'SGD': '&#xD83C;&#xDDF8;&#xD83C;&#xDDEC;',
            'HKD': '&#xD83C;&#xDDED;&#xD83C;&#xDDF0;',
            'SEK': '&#xD83C;&#xDDF8;&#xD83C;&#xDDEA;',
            'NOK': '&#xD83C;&#xDDF3;&#xD83C;&#xDDF4;',
            'DKK': '&#xD83C;&#xDDE9;&#xD83C;&#xDDF0;',
            'PLN': '&#xD83C;&#xDDF5;&#xD83C;&#xDDF1;',
            'CZK': '&#xD83C;&#xDDE8;&#xD83C;&#xDDFF;',
            'HUF': '&#xD83C;&#xDDED;&#xD83C;&#xDDFA;',
            'RON': '&#xD83C;&#xDDF7;&#xD83C;&#xDDF4;'
        };
        return currencyFlags[currency] || '&#xD83D;&#xDCB1;';
    }
    
    deduplicateTransactions(transactions) {
        // Remove duplicate transactions that occur when the same statement is uploaded multiple times
        // When a PDF is uploaded twice, Thirdfort OCR assigns different transaction IDs to each instance
        // So we match on: timestamp (date only), amount, description, account_id, category
        // We DON'T use tx.id or tx.reference as these are system-generated per upload
        const seen = new Map();
        const unique = [];
        
        for (const tx of transactions) {
            // Normalize the timestamp to date only (ignore time/milliseconds)
            // This catches duplicates even if OCR processing times differ slightly
            const dateOnly = tx.timestamp ? new Date(tx.timestamp).toISOString().split('T')[0] : '';
            
            // Normalize description (trim, collapse whitespace, lowercase for comparison)
            const normalizedDesc = (tx.description || tx.merchant_name || '').trim().replace(/\s+/g, ' ').toLowerCase();
            
            // Create a unique key based on actual transaction properties
            // This will catch true duplicates from same statement uploaded twice
            const key = [
                dateOnly,               // Date only (YYYY-MM-DD) - allows same-day recurring payments to still be unique by time
                tx.amount,              // Exact amount
                normalizedDesc,         // Normalized description
                tx.account_id || '',    // Account ID
                tx.currency || 'GBP',   // Currency
                tx.category || '',      // Transaction category (DD, SO, DEBIT, CREDIT, etc.)
                tx.type || ''           // Transaction type (DEBIT/CREDIT)
            ].join('|');
            
            if (!seen.has(key)) {
                seen.set(key, true);
                unique.push(tx);
            }
        }
        
        return unique;
    }
    
    deduplicateAccountsData(accounts) {
        // Deep clone and deduplicate all transactions within all accounts
        // This ensures all downstream analysis uses clean data
        const deduplicatedAccounts = {};
        
        for (const [accountId, accountData] of Object.entries(accounts)) {
            // Clone the account data
            deduplicatedAccounts[accountId] = JSON.parse(JSON.stringify(accountData));
            
            // Deduplicate the statement array
            if (deduplicatedAccounts[accountId].statement) {
                deduplicatedAccounts[accountId].statement = this.deduplicateTransactions(deduplicatedAccounts[accountId].statement);
            }
        }
        
        return deduplicatedAccounts;
    }
    
    createBankAccountCard(accountId, accountData, isManualUpload = false, check = null) {
        // Handle both possible data structures - nested 'info' or direct properties
        const info = accountData.info || accountData;
        const number = info.number || {};
        const balance = info.balance || {};
        const provider = info.provider || {};
        const accountName = info.name || 'Bank Account';
        const accountType = info.type || 'TRANSACTION';
        const currency = info.currency || balance.currency || 'GBP';
        const statement = accountData.statement || [];
        
        // Check if this account has been reviewed in SOF annotations
        let isReviewed = false;
        if (check && check.sofAnnotations) {
            isReviewed = check.sofAnnotations.some(ann => {
                const accounts = ann.notes?.accounts || [];
                return accounts.some(acc => acc.accountId === accountId && acc.reviewed);
            });
        }
        
        // Deduplicate transactions ONLY for manual uploads (PDF statements)
        // Open Banking linking won't have duplicates
        const deduplicatedStatement = isManualUpload ? this.deduplicateTransactions(statement) : statement;
        
        // Calculate transaction annotation counts for badges
        let linkedCount = 0;
        let reviewCount = 0;
        let flaggedCount = 0;
        
        if (check) {
            deduplicatedStatement.forEach(tx => {
                const txAnnotations = this.getTransactionAnnotations(tx.id, check);
                
                if (txAnnotations.linkedFundingMethods.length > 0) linkedCount++;
                if (txAnnotations.flag === 'review') reviewCount++;
                if (txAnnotations.flag === 'suspicious') flaggedCount++;
            });
        }
        
        // Get account number details
        const accountNumber = number.number || 'N/A';
        const sortCode = number.sort_code || 'N/A';
        const iban = number.iban || '';
        const swiftBic = number.swift_bic || '';
        
        // Get account holder details (from nested info array)
        let accountHolderName = '';
        if (Array.isArray(info.info) && info.info.length > 0) {
            accountHolderName = info.info[0].full_name || '';
        }
        
        // Get balance amounts
        const availableBalance = balance.available || 0;
        const currentBalance = balance.current || 0;
        const overdraft = balance.overdraft || 0;
        
        // Transaction count (after deduplication)
        const txCount = deduplicatedStatement.length;
        
        // Get bank logo
        const bankLogo = this.getBankLogo(provider.id, provider.name);
        
        // Get currency flag
        const currencyFlag = this.getCurrencyFlag(currency);
        
        // Store the full data in a data attribute for the lightbox
        const accountDataJson = JSON.stringify({accountId, accountData}).replace(/"/g, '&quot;');
        
        // Format the collapsed text based on whether we have a logo
        let collapsedTextHtml;
        if (bankLogo) {
            collapsedTextHtml = `<span class="account-name-text">${accountName}</span>${accountHolderName ? ` - <span class="account-holder-text">${accountHolderName}</span>` : ''}`;
        } else {
            const prefix = `${provider.name || 'Bank'} - `;
            collapsedTextHtml = `<span class="account-name-text">${prefix}${accountName}</span>${accountHolderName ? ` - <span class="account-holder-text">${accountHolderName}</span>` : ''}`;
        }
        
        // Build account summary badges
        let accountBadgesHtml = '';
        
        if (isReviewed) {
            accountBadgesHtml += `<span class="account-tag reviewed">&#x2713; Reviewed</span>`;
        }
        if (linkedCount > 0) {
            accountBadgesHtml += `<span class="account-tag linked">${linkedCount} transaction${linkedCount > 1 ? 's' : ''} linked</span>`;
        }
        if (reviewCount > 0) {
            accountBadgesHtml += `<span class="account-tag review">${reviewCount} review pending</span>`;
        }
        if (flaggedCount > 0) {
            accountBadgesHtml += `<span class="account-tag flagged">${flaggedCount} flagged</span>`;
        }
        
        const badgesContainer = accountBadgesHtml ? `<div class="account-summary-tags" style="margin-top: 4px;">${accountBadgesHtml}</div>` : '';
        
        return `
            <div class="bank-account-card collapsed" data-account-data="${accountDataJson}" data-is-manual-upload="${isManualUpload}" onclick="event.stopPropagation();">
                <!-- Collapsed/Minimized Header -->
                <div class="account-collapsed-header" onclick="event.stopPropagation(); this.closest('.bank-account-card').classList.toggle('collapsed');">
                    <div class="account-header-left">
                        ${bankLogo ? bankLogo : ''}
                        <div style="display: flex; flex-direction: column; flex: 1;">
                        <span class="account-collapsed-text">${collapsedTextHtml}</span>
                            ${badgesContainer}
                        </div>
                    </div>
                    ${txCount > 0 ? `
                        <button class="view-statement-mini-btn" onclick="event.stopPropagation(); window.thirdfortManager.showBankStatement('${accountId}', this.closest('.bank-account-card').dataset.accountData, this.closest('.bank-account-card').dataset.isManualUpload === 'true');">
                            View transactions
                        </button>
                    ` : ''}
                </div>
                
                <!-- Expanded Details -->
                <div class="account-expanded-details">
                    <div class="account-expanded-columns">
                        <div class="account-details-column">
                            <div class="account-detail-row">
                                <span class="account-detail-label">Sort Code:</span>
                                <span class="account-detail-value">${sortCode}</span>
                            </div>
                            <div class="account-detail-row">
                                <span class="account-detail-label">Account:</span>
                                <span class="account-detail-value">${accountNumber}</span>
                            </div>
                            ${iban ? `
                                <div class="account-detail-row">
                                    <span class="account-detail-label">IBAN:</span>
                                    <span class="account-detail-value">${iban}</span>
                                </div>
                            ` : ''}
                            ${swiftBic ? `
                                <div class="account-detail-row">
                                    <span class="account-detail-label">SWIFT:</span>
                                    <span class="account-detail-value">${swiftBic}</span>
                                </div>
                            ` : ''}
                            <div class="account-detail-row">
                                <span class="account-detail-label">Currency:</span>
                                <span class="account-detail-value">${currencyFlag} ${currency}</span>
                            </div>
                        </div>
                        
                        <div class="account-balance-column">
                            <div class="balance-compact-card">
                                <div class="balance-compact-title">Balance</div>
                                <div class="balance-compact-item">
                                    <span class="balance-compact-label">Available:</span>
                                    <span class="balance-compact-value">${currency} ${availableBalance.toFixed(2)}</span>
                                </div>
                                <div class="balance-compact-item">
                                    <span class="balance-compact-label">Current:</span>
                                    <span class="balance-compact-value">${currency} ${currentBalance.toFixed(2)}</span>
                                </div>
                                <div class="balance-compact-item">
                                    <span class="balance-compact-label">Overdraft:</span>
                                    <span class="balance-compact-value">${overdraft > 0 ? `${currency} ${overdraft.toFixed(2)}` : 'None'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    showBankStatement(accountId, accountDataStr, isManualUpload = false) {
        // Parse the account data
        const data = JSON.parse(accountDataStr.replace(/&quot;/g, '"'));
        const accountData = data.accountData;
        const statement = accountData.statement || accountData.transactions || [];
        const info = accountData.info || accountData;
        const number = info.number || {};
        const balance = info.balance || {};
        const provider = info.provider || {};
        const accountName = info.name || 'Bank Account';
        const currency = info.currency || 'GBP';
        const currencyFlag = this.getCurrencyFlag(currency);
        const currencySymbol = currency === 'GBP' ? '&#xA3;' : currency === 'EUR' ? '&#x20AC;' : currency === 'USD' ? '$' : currency;
        
        // Get bank logo and brand colors
        const bankLogo = this.getBankLogo(provider.id, provider.name);
        const brandColors = this.getBankBrandColors(provider.id, provider.name);
        
        // Get transaction annotations from current check using comprehensive helper
        const check = this.currentCheck;
        const transactionFlags = {};
        const transactionNotes = {};
        const transactionLinks = {};
        
        if (check) {
            // Use getTransactionAnnotations which checks ALL sources:
            // - Direct transaction links
            // - Funding method markers
            // - Bank analysis items (chains, repeating groups)
            statement.forEach(tx => {
                const txAnnotations = this.getTransactionAnnotations(tx.id, check);
                if (txAnnotations.flag) transactionFlags[tx.id] = txAnnotations.flag;
                if (txAnnotations.note) transactionNotes[tx.id] = txAnnotations.note;
                if (txAnnotations.linkedFundingMethods.length > 0) {
                    transactionLinks[tx.id] = txAnnotations.linkedFundingMethods;
                }
            });
        }
        
        // DEDUPLICATE transactions ONLY for manual uploads (same PDF statement uploaded multiple times)
        // Bank linking via Open Banking API won't have duplicates
        const deduplicatedStatement = isManualUpload ? this.deduplicateTransactions(statement) : statement;
        
        // Sort transactions by timestamp (oldest first for running balance calculation)
        const sortedTransactions = [...deduplicatedStatement].sort((a, b) => 
            new Date(a.timestamp) - new Date(b.timestamp)
        );
        
        // Calculate running balances if not provided
        let runningBalance = balance.current || 0;
        if (sortedTransactions.length > 0) {
            // Work backwards from current balance
            for (let i = sortedTransactions.length - 1; i >= 0; i--) {
                if (!sortedTransactions[i].running_balance) {
                    sortedTransactions[i].running_balance = runningBalance;
                }
                runningBalance -= sortedTransactions[i].amount;
            }
        }
        
        // Reverse for display (newest first)
        sortedTransactions.reverse();
        
        // Build transactions HTML - modern statement style
        let transactionsHtml = '';
        sortedTransactions.forEach((tx, index) => {
            const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { 
                day: '2-digit', 
                month: 'short', 
                year: 'numeric' 
            });
            const description = tx.description || tx.merchant_name || 'Transaction';
            const isDebit = tx.amount < 0;
            const amountOut = isDebit ? Math.abs(tx.amount).toFixed(2) : '';
            const amountIn = !isDebit ? tx.amount.toFixed(2) : '';
            const runningBal = tx.running_balance ? tx.running_balance.toFixed(2) : '&#x2014;';
            const amountClass = isDebit ? 'negative' : 'positive';
            
            // Check for annotations on this transaction
            const hasFlag = transactionFlags[tx.id];
            const hasNote = transactionNotes[tx.id];
            const hasLinks = transactionLinks[tx.id];
            const hasAnnotations = hasFlag || hasNote || hasLinks;
            
            // Build annotation badges
            let annotationBadges = '';
            if (hasFlag) {
                let flagIcon = '';
                let flagClass = '';
                if (hasFlag === 'linked') {
                    flagIcon = '<svg viewBox="0 0 300 300" style="width: 12px; height: 12px;"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                    flagClass = 'linked';
                } else if (hasFlag === 'suspicious') {
                    flagIcon = '<svg viewBox="0 0 300 300" style="width: 12px; height: 12px;"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>';
                    flagClass = 'suspicious';
                } else if (hasFlag === 'review') {
                    flagIcon = '<svg viewBox="0 0 300 300" style="width: 12px; height: 12px;"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
                    flagClass = 'review';
                } else if (hasFlag === 'cleared') {
                    flagIcon = '<svg viewBox="0 0 300 300" style="width: 12px; height: 12px;"><path fill="#1976d2" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><circle cx="150" cy="150" r="50" fill="none" stroke="#ffffff" stroke-width="20"/></svg>';
                    flagClass = 'cleared';
                }
                annotationBadges += `<span class="statement-tx-badge ${flagClass}">${flagIcon}</span>`;
            }
            if (hasNote) {
                annotationBadges += '<span class="statement-tx-badge note" title="Has investigation note"><svg viewBox="0 0 24 24" style="width: 12px; height: 12px;"><path fill="currentColor" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg></span>';
            }
            if (hasLinks) {
                annotationBadges += '<span class="statement-tx-badge link" title="Linked to funding method"><svg viewBox="0 0 24 24" style="width: 12px; height: 12px;"><path fill="currentColor" d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg></span>';
            }
            
            const highlightClass = hasAnnotations ? ' has-annotations' : '';
            
            // Build expanded details section
            let expandedDetailsHtml = '';
            if (hasAnnotations) {
                expandedDetailsHtml = '<div class="statement-tx-expanded" onclick="event.stopPropagation();">';
                
                // Show linked funding methods
                if (hasLinks && hasLinks.length > 0) {
                    const sofTask = check.taskOutcomes?.['sof:v1'];
                    const funds = sofTask?.breakdown?.funds || [];
                    
                    expandedDetailsHtml += '<div class="tx-expanded-section">';
                    expandedDetailsHtml += '<strong>Linked to Funding Methods:</strong>';
                    expandedDetailsHtml += '<div style="margin-top: 4px;">';
                    
                    hasLinks.forEach(fundIdxStr => {
                        const fund = funds[parseInt(fundIdxStr)];
                        if (fund) {
                            const fundType = fund.type || '';
                            const fundAmount = fund.data?.amount ? `&#xA3;${(fund.data.amount / 100).toLocaleString()}` : '';
                            const fundLabel = fundType.replace('fund:', '').replace(/[-:_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            expandedDetailsHtml += `<div class="tx-linked-fund-item" style="padding: 4px 8px; background: #e3f2fd; border-radius: 3px; margin-bottom: 4px;">
                                <svg viewBox="0 0 24 24" style="width: 14px; height: 14px; margin-right: 4px; vertical-align: middle;"><path fill="#1976d2" d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                                ${fundLabel} ${fundAmount}
                            </div>`;
                        }
                    });
                    
                    expandedDetailsHtml += '</div></div>';
                }
                
                // Show status/flag
                if (hasFlag) {
                    expandedDetailsHtml += '<div class="tx-expanded-section">';
                    expandedDetailsHtml += '<strong>Status:</strong> ';
                    
                    let statusText = hasFlag.charAt(0).toUpperCase() + hasFlag.slice(1);
                    let statusColor = hasFlag === 'linked' || hasFlag === 'cleared' ? '#4caf50' : 
                                     hasFlag === 'suspicious' ? '#f44336' : '#ff9800';
                    
                    expandedDetailsHtml += `<span style="color: ${statusColor}; font-weight: 600;">${statusText}</span>`;
                    expandedDetailsHtml += '</div>';
                }
                
                // Show note
                if (hasNote) {
                    expandedDetailsHtml += '<div class="tx-expanded-section">';
                    expandedDetailsHtml += '<strong>Investigation Note:</strong>';
                    expandedDetailsHtml += `<div style="margin-top: 4px; padding: 8px; background: #fff3e0; border-radius: 3px; font-style: italic; color: #666;">
                        ${hasNote}
                    </div>`;
                    expandedDetailsHtml += '</div>';
                }
                
                expandedDetailsHtml += '</div>';
            }
            
            transactionsHtml += `
                <div class="statement-transaction-row ${amountClass}${highlightClass}" onclick="event.stopPropagation(); this.classList.toggle('expanded');" style="cursor: ${hasAnnotations ? 'pointer' : 'default'};">
                    <div class="statement-tx-date">${date}</div>
                    <div class="statement-tx-description">
                        ${description}
                        ${annotationBadges ? `<span class="statement-tx-badges">${annotationBadges}</span>` : ''}
                    </div>
                    <div class="statement-tx-out">${amountOut ? currencySymbol + amountOut : '&#x2014;'}</div>
                    <div class="statement-tx-in">${amountIn ? currencySymbol + amountIn : '&#x2014;'}</div>
                    <div class="statement-tx-balance">${currencySymbol}${runningBal}</div>
                </div>
                ${expandedDetailsHtml}
            `;
        });
        
        // Create modern bank statement overlay
        const lightbox = document.createElement('div');
        lightbox.className = 'bank-statement-lightbox';
        lightbox.innerHTML = `
            <div class="lightbox-overlay" onclick="this.parentElement.remove()"></div>
            <div class="statement-container">
                <div class="statement-header-modern" style="background: linear-gradient(135deg, ${brandColors.from} 0%, ${brandColors.to} 100%);">
                    <div class="statement-header-top">
                        ${bankLogo ? `<div class="statement-bank-logo">${bankLogo}</div>` : ''}
                        <div class="statement-header-info">
                            <h2 class="statement-account-name">${accountName}</h2>
                            <div class="statement-provider">${provider.name || 'Bank'}</div>
                        </div>
                        <button class="statement-close-btn" onclick="this.closest('.bank-statement-lightbox').remove()">&#x2715;</button>
                    </div>
                    <div class="statement-account-details">
                        ${number.sort_code ? `<span>Sort Code: ${number.sort_code}</span>` : ''}
                        ${number.number ? `<span>Account: ${number.number}</span>` : ''}
                        ${number.iban ? `<span>IBAN: ${number.iban}</span>` : ''}
                        <span>${currencyFlag} ${currency}</span>
                    </div>
                    <div class="statement-balance-summary">
                        <div class="balance-summary-item">
                            <span class="balance-summary-label">Current Balance</span>
                            <span class="balance-summary-amount">${currencySymbol}${(balance.current || 0).toFixed(2)}</span>
                        </div>
                        <div class="balance-summary-item">
                            <span class="balance-summary-label">Available</span>
                            <span class="balance-summary-amount">${currencySymbol}${(balance.available || 0).toFixed(2)}</span>
                        </div>
                        ${balance.overdraft && balance.overdraft > 0 ? `
                            <div class="balance-summary-item">
                                <span class="balance-summary-label">Overdraft Limit</span>
                                <span class="balance-summary-amount">${currencySymbol}${balance.overdraft.toFixed(2)}</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
                <div class="statement-transactions-list">
                    <div class="statement-list-header">
                        <h3>Transactions</h3>
                        <span class="transaction-count">${sortedTransactions.length} transaction${sortedTransactions.length !== 1 ? 's' : ''}</span>
                    </div>
                    <div class="statement-column-headers">
                        <div class="header-date">Date</div>
                        <div class="header-description">Description</div>
                        <div class="header-out">Amount Out</div>
                        <div class="header-in">Amount In</div>
                        <div class="header-balance">Balance</div>
                    </div>
                    ${transactionsHtml}
                </div>
            </div>
        `;
        
        document.body.appendChild(lightbox);
    }
    
    buildFundingDetailContent(fund, { originBadge = '' } = {}) {
        if (!fund) return '';
        const type = fund.type || 'unknown';
        const data = fund.data || {};
        const htmlParts = [];
        const renderIncomeRow = (label, value, { allowEmpty = false } = {}) => {
            if (!value && !allowEmpty) return '';
            const display = value || 'Not provided';
            return `<div class="income-card-row"><span class="income-label">${label}</span><span class="income-value">${display}</span></div>`;
        };
        const renderIncomeCards = (incomes = [], sizeClass = 'full') => {
            if (!Array.isArray(incomes) || incomes.length === 0) return '';
            return incomes.map(income => {
                if (!income) return '';
                const isSalary = (income.source || '').toLowerCase() === 'salary';
                const title = isSalary ? 'Salary' : (income.description || income.source || 'Other Income');
                const frequency = this.formatFundingFrequency(income.frequency);
                const amount = this.formatCurrencyMinor(income.annual_total, { fallback: 'Not provided' });
                const reference = income.reference ? income.reference : '';
                const description = income.description ? income.description : '';
                let rows = '';
                if (isSalary) {
                    rows += renderIncomeRow('Pay Cycle', frequency, { allowEmpty: true });
                    rows += renderIncomeRow('Payment Ref', reference, { allowEmpty: true });
                    rows += renderIncomeRow('Annual Amount', amount, { allowEmpty: true });
                } else {
                    rows += renderIncomeRow('Pay Cycle', frequency, { allowEmpty: true });
                    rows += renderIncomeRow('Annual Amount', amount, { allowEmpty: true });
                    if (reference) {
                        rows += renderIncomeRow('Reference', reference);
                    }
                }
                // Determine income card width based on person card width and number of incomes
                let incomeCardClass = '';
                if (sizeClass === 'full') {
                    // Full width person card: 2 incomes = 50/50, 1 income = 100%
                    incomeCardClass = incomes.length === 2 ? 'half' : 'full';
                } else {
                    // Half width person card: incomes are stacked (full width each)
                    incomeCardClass = 'full';
                }
                return `
                    <div class="income-card ${isSalary ? 'salary' : 'other'} ${incomeCardClass}">
                        <div class="income-card-title">${title}</div>
                        ${rows}
                    </div>
                `;
            }).join('');
        };
        const renderSavingsPerson = (person, { isPrimary = false, sizeClass = 'full' } = {}) => {
            if (!person) return '';
            const role = person.actor ? 'Primary Applicant' : 'Joint Contributor';
            let status = '';
            if (person.employment_status) {
                const statusRaw = String(person.employment_status).toLowerCase();
                if (statusRaw === 'independent' || statusRaw === 'independant') {
                    status = 'Self-Employed';
                } else {
                    status = this.formatFundingLabel(person.employment_status);
                }
            }
            const contactPhone = person.phone || '';
            const contactEmail = person.email || '';
            const personOriginBadge = this.getFundingOriginBadge(person.location);
            let meta = '';
            if (status) meta += this.renderMetaRow('Status', status, { className: 'compact' });
            if (personOriginBadge) {
                meta += this.renderMetaRow('Location', personOriginBadge, { raw: true, className: 'compact' });
            }
            if (contactPhone) meta += this.renderMetaRow('Phone', contactPhone, { className: 'compact' });
            if (contactEmail) meta += this.renderMetaRow('Email', contactEmail, { className: 'compact' });
            const incomeCards = renderIncomeCards(person.incomes, sizeClass);
            const cardClasses = ['funding-person-card', sizeClass];
            if (isPrimary) cardClasses.push('primary');
            return `
                <div class="${cardClasses.join(' ')}">
                    <div class="funding-person-header">
                        <div class="funding-person-name">${person.name || 'Unknown Person'}</div>
                        <div class="funding-person-role">${role}</div>
                    </div>
                    ${meta}
                    ${incomeCards ? `<div class="income-card-list">${incomeCards}</div>` : ''}
                </div>
            `;
        };

        switch (type) {
            case 'fund:mortgage': {
                const lenderName = data.lender ? this.formatFundingLabel(data.lender) : '';
                const displayLender = lenderName || data.lender || '';
                const bankLogo = data.lender ? this.getBankLogo(data.lender, displayLender || data.lender) : '';
                if (displayLender || bankLogo) {
                    htmlParts.push(`
                        <div class="funding-bank-card">
                            ${bankLogo ? `<div class="funding-bank-logo">${bankLogo}</div>` : ''}
                            <div class="funding-bank-copy">
                                <div class="funding-bank-label">Mortgage Lender</div>
                                <div class="funding-bank-name">${displayLender || 'Not provided'}</div>
                            </div>
                        </div>
                    `);
                }
                if (data.mortgage_type) {
                    htmlParts.push(this.renderMetaRow('Product', this.formatFundingLabel(data.mortgage_type)));
                }
                if (data.account_name) {
                    htmlParts.push(this.renderMetaRow('Account Name', data.account_name));
                }
                if (data.reference) {
                    htmlParts.push(this.renderMetaRow('Reference', data.reference));
                }
                break;
            }
            case 'fund:htb':
            case 'fund:htb_lisa': {
                if (data.account_name) {
                    htmlParts.push(this.renderMetaRow('Account Name', data.account_name));
                }
                if (data.provider) {
                    htmlParts.push(this.renderMetaRow('Provider', this.formatFundingLabel(data.provider)));
                }
                if (data.reference) {
                    htmlParts.push(this.renderMetaRow('Reference', data.reference));
                }
                break;
            }
            case 'fund:savings': {
                htmlParts.push('<div class="funding-section-heading">Contributors</div>');
                if (Array.isArray(data.people) && data.people.length > 0) {
                    // Determine layout based on number of people
                    const peopleCount = data.people.length;
                    let peopleCards = '';
                    
                    if (peopleCount === 1) {
                        // 1 person: full width
                        peopleCards = renderSavingsPerson(data.people[0], { isPrimary: true, sizeClass: 'full' });
                    } else if (peopleCount === 2) {
                        // 2 people: 50/50
                        peopleCards = data.people.map((person, idx) => 
                            renderSavingsPerson(person, { isPrimary: idx === 0, sizeClass: 'half' })
                        ).join('');
                    } else {
                        // 3+ people: primary full width, others 50/50 below
                        peopleCards = renderSavingsPerson(data.people[0], { isPrimary: true, sizeClass: 'full' });
                        if (peopleCount > 1) {
                            const others = data.people.slice(1);
                            others.forEach((person, idx) => {
                                peopleCards += renderSavingsPerson(person, { isPrimary: false, sizeClass: 'half' });
                            });
                        }
                    }
                    
                    htmlParts.push(`<div class="funding-people-list">${peopleCards}</div>`);
                } else {
                    htmlParts.push('<div class="funding-meta-empty">No contributor details provided.</div>');
                }
                break;
            }
            case 'fund:gift': {
                const giftor = data.giftor || {};
                const cardTitle = giftor.name || 'Giftor';
                let detailRows = '';
                if (giftor.relationship) {
                    detailRows += this.renderMetaRow('Relationship', this.formatFundingLabel(giftor.relationship), { className: 'compact' });
                }
                if (typeof giftor.contactable === 'boolean') {
                    detailRows += this.renderMetaRow('Contactable', giftor.contactable ? 'Yes' : 'No', { className: 'compact' });
                }
                if (typeof data.repayable === 'boolean') {
                    detailRows += this.renderMetaRow('Repayable', data.repayable ? 'Yes' : 'No', { className: 'compact' });
                }
                if (giftor.phone) {
                    detailRows += this.renderMetaRow('Phone', giftor.phone, { className: 'compact' });
                }
                if (giftor.email) {
                    detailRows += this.renderMetaRow('Email', giftor.email, { className: 'compact' });
                }
                if (!detailRows) {
                    detailRows = '<div class="funding-meta-empty">No additional giftor details recorded.</div>';
                }
                // Add consider message for giftor checks
                const considerIcon = this.getTaskCheckIcon('CO');
                const giftorCheckMessage = '<div class="giftor-check-message" style="margin-top: 12px; padding: 10px; background: #fff8e6; border: 1px solid #ffd966; border-radius: 6px; display: flex; align-items: flex-start; gap: 8px; font-size: 12px; color: #856404;">' +
                    considerIcon +
                    '<span>Ensure the gifter undergoes their own AML, ID and SoF/SoW Checks</span>' +
                    '</div>';
                htmlParts.push(`
                    <div class="funding-detail-card">
                        <div class="funding-detail-card-title">${cardTitle}</div>
                        ${detailRows}
                        ${giftorCheckMessage}
                    </div>
                `);
                break;
            }
            case 'fund:sale:property':
            case 'fund:property_sale': {
                const completion = this.formatShortDate(data.date);
                if (completion) {
                    htmlParts.push(this.renderMetaRow('Completion Date', completion));
                }
                if (data.status) {
                    htmlParts.push(this.renderMetaRow('Status', this.formatFundingLabel(data.status)));
                }
                if (data.lawyer || data.conveyancer) {
                    htmlParts.push(this.renderMetaRow('Conveyancer', data.lawyer || data.conveyancer));
                }
                if (data.property) {
                    htmlParts.push(this.renderMetaRow('Property', data.property));
                }
                break;
            }
            case 'fund:sale:assets':
            case 'fund:asset_sale': {
                if (data.description) {
                    htmlParts.push(this.renderMetaRow('Asset Description', data.description));
                }
                if (data.status) {
                    htmlParts.push(this.renderMetaRow('Status', this.formatFundingLabel(data.status)));
                }
                break;
            }
            case 'fund:inheritance': {
                if (data.from) {
                    htmlParts.push(this.renderMetaRow('Inherited From', data.from));
                }
                const inheritDate = this.formatShortDate(data.date || data.received_at);
                if (inheritDate) {
                    htmlParts.push(this.renderMetaRow('Inherited On', inheritDate));
                }
                if (data.account_name) {
                    htmlParts.push(this.renderMetaRow('Account Name', data.account_name));
                }
                if (typeof data.is_owner === 'boolean') {
                    htmlParts.push(this.renderMetaRow('Beneficiary', data.is_owner ? 'Applicant' : 'Third Party'));
                }
                break;
            }
            case 'fund:divorce': {
                if (data.account_name) {
                    htmlParts.push(this.renderMetaRow('Account Name', data.account_name));
                }
                if (data.lawyer) {
                    htmlParts.push(this.renderMetaRow('Conveyancer/Lawyer', data.lawyer));
                }
                const settlementDate = this.formatShortDate(data.settlement_date || data.date);
                if (settlementDate) {
                    htmlParts.push(this.renderMetaRow('Settlement Date', settlementDate));
                }
                if (typeof data.is_owner === 'boolean') {
                    htmlParts.push(this.renderMetaRow('Beneficiary', data.is_owner ? 'Applicant' : 'Third Party'));
                }
                break;
            }
            case 'fund:cryptocurrency': {
                if (data.description) {
                    htmlParts.push(this.renderMetaRow('Asset', data.description));
                }
                if (data.exchange) {
                    htmlParts.push(this.renderMetaRow('Exchange', this.formatFundingLabel(data.exchange)));
                }
                if (data.wallet_provider) {
                    htmlParts.push(this.renderMetaRow('Wallet Provider', this.formatFundingLabel(data.wallet_provider)));
                }
                break;
            }
            default: {
                const handledKeys = new Set(['amount', 'location', 'people', 'giftor', 'metadata']);
                let hasDetails = false;
                Object.entries(data || {}).forEach(([key, value]) => {
                    if (handledKeys.has(key)) return;
                    if (value === undefined || value === null) return;
                    if (typeof value === 'object') return;
                    const label = this.formatFundingLabel(key.replace(/[:_]/g, ' ')) || this.formatFundingLabel(key);
                    htmlParts.push(this.renderMetaRow(label || this.formatFundingLabel(key), value));
                    hasDetails = true;
                });
                if (!hasDetails) {
                    htmlParts.push('<div class="funding-meta-empty">No additional funding details provided.</div>');
                }
                break;
            }
        }
        return htmlParts.filter(Boolean).join('');
    }
    
    createFundingSourceCard(fund, check, index, sofMatches = {}, accounts = {}) {
        const type = fund.type || 'unknown';
        const data = fund.data || {};
        const amount = data.amount ? `&#xA3;${(data.amount / 100).toLocaleString()}` : 'Not specified';
        const originBadge = this.getFundingOriginBadge(data.location);
        
        // Get matched bank transactions for this funding type
        // Map all possible funding types to their SOF match keys
        const fundTypeMap = {
            // Standard mappings
            'fund:gift': ['gift', 'gift_transactions'],
            'fund:mortgage': ['mortgage', 'mortgage_transactions'],
            'fund:savings': ['savings', 'savings_transactions', 'salary_transactions'],
            'fund:property_sale': ['property_sale', 'property_sale_transactions'],
            'fund:sale:property': ['property_sale', 'property_sale_transactions'],
            'fund:asset_sale': ['asset_sale', 'asset_sale_transactions'],
            'fund:sale:assets': ['asset_sale', 'asset_sale_transactions'],
            'fund:htb': ['htb_lisa', 'htb_transactions', 'htb_lisa_transactions'],
            'fund:htb_lisa': ['htb_lisa', 'htb_transactions', 'htb_lisa_transactions'],
            'fund:inheritance': ['inheritance', 'inheritance_transactions'],
            'fund:income': ['salary_transactions', 'income_transactions'],
            'fund:loan': ['loan', 'loan_transactions'],
            'fund:investment': ['investment', 'investment_transactions'],
            'fund:business': ['business', 'business_transactions'],
            'fund:other': ['other', 'other_transactions']
        };
        
        // For savings with people/incomes data, prioritize salary_transactions
        let matchKeys = fundTypeMap[type] || [];
        if (type === 'fund:savings' && data.people && data.people.some(p => p.incomes && p.incomes.length > 0)) {
            matchKeys = ['salary_transactions', ...matchKeys];  // Prioritize salary for income-based savings
        }
        
        // Try all possible match keys and combine results
        let matchedTxIds = [];
        for (const key of matchKeys) {
            if (sofMatches[key] && Array.isArray(sofMatches[key])) {
                matchedTxIds = [...matchedTxIds, ...sofMatches[key]];
            }
        }
        
        // Add user-linked transactions from SOF annotations
        if (check) {
            const sofAnnotations = check.sofAnnotations || [];
            sofAnnotations.forEach(ann => {
                const transactions = ann.notes?.transactions || [];
                transactions.forEach(tx => {
                    if (tx.linkedToFunds && tx.linkedToFunds.includes(index.toString())) {
                        matchedTxIds.push(tx.txId);
                    }
                });
            });
        }
        
        // Collect bank analysis items (repeating groups, chains) linked to this funding method
        const linkedBankAnalysisItems = [];
        if (check) {
            const sofAnnotations = check.sofAnnotations || [];
            sofAnnotations.forEach(ann => {
                const bankAnalysisItems = ann.notes?.bankAnalysisItems || [];
                bankAnalysisItems.forEach(item => {
                    if (item.linkedToFundIdx === index.toString()) {
                        linkedBankAnalysisItems.push({
                            ...item,
                            userName: ann.userName || ann.user,
                            timestamp: ann.timestamp
                        });
                        
                        // Also add the individual transactions from this item to the matched list
                        if (item.type === 'transaction' && item.transactionId) {
                            matchedTxIds.push(item.transactionId);
                        } else if (item.type === 'chain' && item.chainId) {
                            // Chain IDs are composite of transaction IDs separated by |
                            const chainTxIds = item.chainId.split('|');
                            matchedTxIds.push(...chainTxIds);
                        } else if (item.type === 'repeating-group' && item.groupIndex !== undefined) {
                            // Get all transactions in this repeating group
                            const taskOutcomes = check.taskOutcomes || {};
                            const bankStatement = taskOutcomes['bank:statement'];
                            const bankSummary = taskOutcomes['bank:summary'];
                            const docsBankStatement = taskOutcomes['documents:bank-statement'];
                            const analysis = bankStatement?.breakdown?.analysis || 
                                           bankSummary?.breakdown?.analysis || 
                                           docsBankStatement?.breakdown?.analysis;
                            
                            if (analysis && analysis.repeating_transactions) {
                                const group = analysis.repeating_transactions[item.groupIndex];
                                if (group && group.items) {
                                    matchedTxIds.push(...group.items);
                                }
                            }
                        }
                    }
                });
            });
        }
        
        // Remove duplicates
        matchedTxIds = [...new Set(matchedTxIds)];
        
        // Map funding type to display name (handle fund: prefix) - needed for cleanType later
        const cleanType = type.replace('fund:', '').replace(/:/g, '-');
        
        // Build matched transactions HTML
        const hasMatches = matchedTxIds.length > 0;
        let matchedTxHtml = '';
        const labelMap = {
            'fund:gift': 'Potential Gift Deposits',
            'fund:mortgage': 'Potential Mortgage Deposits',
            'fund:savings': 'Verified Salary Deposits',
            'fund:income': 'Verified Salary Deposits',
            'fund:property_sale': 'Potential Property Sale Proceeds',
            'fund:sale:property': 'Potential Property Sale Proceeds',
            'fund:asset_sale': 'Potential Asset Sale Proceeds',
            'fund:sale:assets': 'Potential Asset Sale Proceeds',
            'fund:htb': 'Potential Lifetime ISA Deposits',
            'fund:htb_lisa': 'Potential Lifetime ISA Deposits',
            'fund:inheritance': 'Potential Inheritance Deposits',
            'fund:loan': 'Potential Loan Deposits',
            'fund:investment': 'Potential Investment Deposits',
            'fund:business': 'Potential Business Income',
            'fund:other': 'Potential Matched Transactions'
        };
        const matchLabel = labelMap[type] || 'Potential Matched Transactions';

        // Determine label based on funding type
        if (hasMatches) {
            matchedTxHtml = `<div class="funding-matched-section"><div class="funding-matched-header">${matchLabel} (${matchedTxIds.length})</div><div class="funding-matched-list">`;
            // Get transaction markers, notes, and links from ALL sources using comprehensive function
            const transactionMarkers = {};
            const transactionNotes = {};
            const transactionFlags = {};
            const userLinkedTxIds = new Set();
            const autoMatchedTxIds = new Set();
            
            // Get auto-matched IDs
            for (const key of matchKeys) {
                if (sofMatches[key] && Array.isArray(sofMatches[key])) {
                    sofMatches[key].forEach(txId => autoMatchedTxIds.add(txId));
                }
            }
            
            // For each matched transaction, get ALL annotations from all sources
            matchedTxIds.forEach(txId => {
                const txAnnotations = this.getTransactionAnnotations(txId, check);
                
                // Store marker (from funding method markers)
                if (txAnnotations.marker) {
                    transactionMarkers[txId] = txAnnotations.marker;
                }
                
                // Store flag (from bank analysis items or direct links)
                if (txAnnotations.flag) {
                    transactionFlags[txId] = txAnnotations.flag;
                }
                
                // Store note (combined from all sources)
                if (txAnnotations.note) {
                    transactionNotes[txId] = txAnnotations.note;
                }
                
                // Check if user-linked to THIS funding method
                if (txAnnotations.linkedFundingMethods.includes(index.toString())) {
                    userLinkedTxIds.add(txId);
                }
            });
            
            matchedTxIds.forEach(txId => {
                // Find transaction in accounts
                let tx = null;
                for (const [accountId, accountData] of Object.entries(accounts)) {
                    const statement = accountData.statement || [];
                    tx = statement.find(t => t.id === txId);
                    if (tx) {
                        tx.accountName = (accountData.info || accountData).name || 'Account';
                        break;
                    }
                }
                
                if (tx) {
                    const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                    const currencySymbol = this.getCurrencyFlag(tx.currency || 'GBP');
                    const txAmount = tx.amount >= 0 ? '+' : '';
                    
                    // Check if this transaction has a marker (from funding method)
                    const marker = transactionMarkers[txId];
                    let markerBadge = '';
                    if (marker === 'accepted') {
                        markerBadge = '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                    } else if (marker === 'rejected') {
                        markerBadge = '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                    }
                    
                    // Check if this transaction has a flag (from bank analysis or direct links)
                    const flag = transactionFlags[txId];
                    let flagBadge = '';
                    if (flag === 'cleared') {
                        flagBadge = '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                    } else if (flag === 'suspicious') {
                        flagBadge = '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                    } else if (flag === 'review') {
                        flagBadge = '<span class="tx-marker-badge review">&#x2014; Review</span>';
                    } else if (flag === 'linked') {
                        flagBadge = '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                    }
                    
                    // Add source badge
                    const isUserLinked = userLinkedTxIds.has(txId);
                    const isAutoMatched = autoMatchedTxIds.has(txId);
                    let sourceBadge = '';
                    if (isUserLinked && !isAutoMatched) {
                        sourceBadge = '<span class="tx-source-badge user-linked">&#xD83D;&#xDC64; User Linked</span>';
                    } else if (isUserLinked && isAutoMatched) {
                        sourceBadge = '<span class="tx-source-badge both-matched">&#x2713; Confirmed</span>';
                    }
                    
                    // Check if this transaction is part of a repeating group
                    let repeatingBadge = '';
                    let userNoteBadge = '';
                    const taskOutcomes = check.taskOutcomes || {};
                    const bankStatement = taskOutcomes['bank:statement'];
                    const bankSummary = taskOutcomes['bank:summary'];
                    const docsBankStatement = taskOutcomes['documents:bank-statement'];
                    const analysis = bankStatement?.breakdown?.analysis || 
                                   bankSummary?.breakdown?.analysis || 
                                   docsBankStatement?.breakdown?.analysis;
                    
                    if (analysis && analysis.repeating_transactions) {
                        for (const group of analysis.repeating_transactions) {
                            if (group.items && group.items.includes(txId)) {
                                repeatingBadge = '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f3e5f5; color: #9c27b0; border: 1px solid #9c27b0; margin-left: 4px;">Repeating</span>';
                                break;
                            }
                        }
                    }
                    
                    // Get transaction note and create user note badge
                    const txNote = transactionNotes[txId] || '';
                    if (txNote) {
                        userNoteBadge = `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f5f5f5; color: #666; border: 1px solid #ddd; margin-left: 4px;">&#xD83D;&#xDCDD; ${txNote}</span>`;
                    }
                    
                    matchedTxHtml += `
                        <div class="matched-tx-row ${marker ? 'marked-' + marker : ''}">
                            <span class="matched-tx-date">${date}</span>
                            <span class="matched-tx-desc">${tx.description || tx.merchant_name || 'Transaction'}${markerBadge}${flagBadge}${sourceBadge}${repeatingBadge}${userNoteBadge}</span>
                            <span class="matched-tx-account">${tx.accountName}</span>
                            <span class="matched-tx-amount">${txAmount}${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>
                            </div>
                        `;
                }
            });
            
            matchedTxHtml += '</div></div>';
        }
        
        // Map funding type display names
        const typeNames = {
            'mortgage': 'Mortgage',
            'savings': 'Savings',
            'gift': 'Gift',
            'sale-property': 'Sale of Property',
            'sale-assets': 'Sale of Assets',
            'inheritance': 'Inheritance',
            'divorce': 'Divorce',
            'cryptocurrency': 'Cryptocurrency',
            'htb': 'Lifetime ISA',
            'htb_lisa': 'Lifetime ISA',
            'investment': 'Investment',
            'business': 'Business Income',
            'loan': 'Loan',
            'income': 'Income',
            'other': 'Other'
        };
        const typeName = typeNames[cleanType] || cleanType;
        
        // Check if corresponding document exists in taskOutcomes
        const docTaskKey = `documents:${cleanType}`;
        const docOutcome = check.taskOutcomes ? check.taskOutcomes[docTaskKey] : null;
        const documentCount = this.getDocumentCount(docOutcome);
        const hasDocuments = documentCount > 0;
        const docLines = [];
        const defaultReminder = 'Check the report pdf for evidence or obtain from the client and review manually';
        const hasLinkedTx = hasMatches;
        const shouldShowManualReview = !hasLinkedTx && type !== 'fund:mortgage';

        if (hasDocuments) {
            const uploadedLabel = `${documentCount} document${documentCount === 1 ? '' : 's'} uploaded`;
            docLines.push({ status: 'clear', text: uploadedLabel });
            } else {
            docLines.push({ status: 'consider', text: defaultReminder });
        }

        if (shouldShowManualReview) {
            docLines.push({ status: 'consider', text: 'No linked bank transactions detected, manual review required.' });
        }

        if (docLines.length === 0) {
            docLines.push({ status: hasDocuments ? 'clear' : 'consider', text: defaultReminder });
        }

        const docStatusLines = docLines.map(line => {
            const icon = this.getTaskCheckIcon(line.status === 'clear' ? 'CL' : line.status === 'fail' ? 'FA' : 'CO');
            return `<div class="doc-status-line">${icon}<span>${line.text}</span></div>`;
        }).join('');
        
        // Build detailed information based on fund type
        const detailsHtml = this.buildFundingDetailContent(fund, { originBadge });
        
        // Get SOF annotations for this specific funding method
        const sofAnnotations = check.sofAnnotations || [];
        let fundAnnotationsHtml = '';
        
        if (sofAnnotations.length > 0) {
            // Filter annotations that affect this funding method
            const relevantAnnotations = sofAnnotations.filter(ann => {
                const fundingMethods = ann.notes?.fundingMethods || [];
                return fundingMethods.some(fm => 
                    fm.fundType === type && fm.fundIdx === index.toString()
                );
            });
            
            if (relevantAnnotations.length > 0) {
                fundAnnotationsHtml = '<div class="funding-annotations-section">';
                fundAnnotationsHtml += '<div class="funding-annotations-header">Investigation Notes</div>';
                
                relevantAnnotations.forEach(ann => {
                    const date = new Date(ann.timestamp).toLocaleString('en-GB', { 
                        day: '2-digit', 
                        month: 'short', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    // Find the specific funding method note
                    const fundingMethod = ann.notes.fundingMethods.find(fm => 
                        fm.fundType === type && fm.fundIdx === index.toString()
                    );
                    
                    if (fundingMethod) {
                        // Only show if there's actual content (note or verified items)
                        const hasNote = fundingMethod.note && fundingMethod.note.trim();
                        const hasVerified = fundingMethod.verified && fundingMethod.verified.length > 0;
                        
                        if (hasNote || hasVerified) {
                            fundAnnotationsHtml += '<div class="annotation-mini-card">';
                            fundAnnotationsHtml += '<div class="annotation-mini-header">';
                            fundAnnotationsHtml += '<div class="annotation-mini-meta">';
                            fundAnnotationsHtml += '<strong>' + (ann.userName || ann.user) + '</strong> &#x2022; ' + date;
                            fundAnnotationsHtml += '</div>';
                            fundAnnotationsHtml += '</div>';
                            fundAnnotationsHtml += '<div class="annotation-mini-body">';
                            
                            // Show note if exists
                            if (hasNote) {
                                fundAnnotationsHtml += '<p class="annotation-mini-reason">' + fundingMethod.note + '</p>';
                            }
                            
                            // Show verified items
                            if (hasVerified) {
                                fundAnnotationsHtml += '<div class="annotation-mini-objectives">';
                                fundingMethod.verified.forEach(item => {
                                    const verifiedIcon = '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                                    const label = item.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                                    fundAnnotationsHtml += '<div class="annotation-objective-item">';
                                    fundAnnotationsHtml += verifiedIcon;
                                    fundAnnotationsHtml += '<span class="annotation-objective-label">' + label + '</span>';
                                    fundAnnotationsHtml += '</div>';
                                });
                                fundAnnotationsHtml += '</div>';
                            }
                            
                            fundAnnotationsHtml += '</div></div>';
                        }
                    }
                });
                
                fundAnnotationsHtml += '</div>';
            }
        }
        
        return `
            <div class="funding-source-card">
                <div class="funding-header">
                    <div class="funding-type">${typeName}</div>
                    <div class="funding-header-meta">
                        ${originBadge || ''}
                        <span class="funding-amount">${amount}</span>
                    </div>
                </div>
                ${detailsHtml}
                ${matchedTxHtml}
                ${fundAnnotationsHtml}
                <div class="funding-doc-status">
                    <div class="doc-status-text">${docStatusLines}</div>
                </div>
            </div>
        `;
    }
    
    createSOFTaskCard(outcome, check, sofMatches = {}) {
        const result = outcome.result || 'clear';
        const breakdown = outcome.breakdown || {};
        const property = breakdown.property || {};
        const funds = breakdown.funds || [];
        
        // Get bank statement accounts for transaction lookup - check both bank:statement and documents:bank-statement
        const bankStatement = check.taskOutcomes?.['bank:statement'];
        const docsBankStatement = check.taskOutcomes?.['documents:bank-statement'];
        const accounts = bankStatement?.breakdown?.accounts || docsBankStatement?.breakdown?.accounts || {};
        
        // Determine border class and status icon
        let borderClass = result === 'clear' ? 'clear' : (result === 'fail' ? 'alert' : 'consider');
        let statusIcon = '';
        if (result === 'clear') {
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>`;
        } else if (result === 'consider' || result === 'alert') {
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        } else {
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>`;
        }
        
        // Property details as bullet points
        let propertyDetailsHtml = '';
        if (property.address) {
            const addr = property.address;
            const fullAddress = `${addr.building_number || ''} ${addr.street || ''}, ${addr.town || ''}, ${addr.postcode || ''}`.trim();
            const price = property.price ? `&#xA3;${(property.price / 100).toLocaleString()}` : 'Not specified';
            const sdlt = property.stamp_duty ? `&#xA3;${(property.stamp_duty / 100).toLocaleString()}` : 'Not specified';
            const newBuild = property.new_build ? 'Yes' : 'No';
            
            // Check for property SOF annotations
            const sofAnnotations = check?.sofAnnotations || [];
            let propertyAnnotationsHtml = '';
            
            if (sofAnnotations.length > 0) {
                // Find all annotations with property reviews
                const propertyAnnotations = sofAnnotations.filter(ann => 
                    ann.notes?.property && (ann.notes.property.reviewed || ann.notes.property.note)
                );
                
                if (propertyAnnotations.length > 0) {
                    propertyAnnotationsHtml = '<div class="funding-annotations-section" style="margin-top: 12px;">';
                    propertyAnnotationsHtml += '<div class="funding-annotations-header">Investigation Notes</div>';
                    
                    propertyAnnotations.forEach(ann => {
                        const date = new Date(ann.timestamp).toLocaleString('en-GB', { 
                            day: '2-digit', 
                            month: 'short', 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        });
                        
                        // Format user name
                        let userName = ann.userName || ann.user;
                        if (userName && userName.includes('.') && !userName.includes(' ')) {
                            userName = userName.split('@')[0]
                                .split('.').join(' ')
                                .split('-').join(' ')
                                .replace(/\b\w/g, l => l.toUpperCase());
                        }
                        
                        const propertyNote = ann.notes.property;
                        
                        propertyAnnotationsHtml += '<div class="annotation-mini-card">';
                        propertyAnnotationsHtml += '<div class="annotation-mini-header">';
                        propertyAnnotationsHtml += '<div class="annotation-mini-meta">';
                        propertyAnnotationsHtml += '<strong>' + userName + '</strong> &#x2022; ' + date;
                        propertyAnnotationsHtml += '</div>';
                        propertyAnnotationsHtml += '</div>';
                        propertyAnnotationsHtml += '<div class="annotation-mini-body">';
                        
                        if (propertyNote.note) {
                            propertyAnnotationsHtml += '<p class="annotation-mini-reason">' + propertyNote.note + '</p>';
                        }
                        
                        if (propertyNote.reviewed) {
                            propertyAnnotationsHtml += '<div class="annotation-mini-objectives">';
                            const reviewedIcon = '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                            propertyAnnotationsHtml += '<div class="annotation-objective-item">';
                            propertyAnnotationsHtml += reviewedIcon;
                            propertyAnnotationsHtml += '<span class="annotation-objective-label"><strong>Status:</strong> Reviewed</span>';
                            propertyAnnotationsHtml += '</div>';
                            propertyAnnotationsHtml += '</div>';
                        }
                        
                        propertyAnnotationsHtml += '</div></div>';
                    });
                    
                    propertyAnnotationsHtml += '</div>';
                }
            }
            
            propertyDetailsHtml = `
                <div class="sof-property-details">
                    <div class="property-bullet">&#xD83D;&#xDCCD; <strong>Property:</strong> ${fullAddress}</div>
                    <div class="property-bullet">&#xD83D;&#xDCB7; <strong>Purchase Price:</strong> ${price}</div>
                    <div class="property-bullet">&#xD83D;&#xDCCB; <strong>Stamp Duty:</strong> ${sdlt}</div>
                    <div class="property-bullet"> <strong>New Build:</strong> ${newBuild}</div>
                    ${propertyAnnotationsHtml}
                </div>
            `;
        }
        
        // Chart iframe (shown when expanded)
        const chartData = this.prepareSOFChartData(breakdown);
        const chartIframeId = `sof-chart-${outcome.id || Math.random().toString(36).substr(2, 9)}`;
        const chartHtml = `
            <div class="sof-chart-container">
                <iframe 
                    id="${chartIframeId}" 
                    src="single-chart-viewer.html" 
                    style="width: 100%; height: 300px; border: none;"
                    onload="this.contentWindow.postMessage({type: 'chart-data', ...${JSON.stringify(chartData).replace(/"/g, '&quot;')}}, '*')"
                ></iframe>
            </div>
        `;
        
        // Individual funding source cards
        let fundingCardsHtml = '<div class="funding-sources-container">';
        funds.forEach((fund, index) => {
            fundingCardsHtml += this.createFundingSourceCard(fund, check, index, sofMatches, accounts);
        });
        fundingCardsHtml += '</div>';
        
        // Build header checks (visible when collapsed)
        const fundCount = funds.length;
        const fundStatus = fundCount === 0 ? 'AL' : 'CL';
        const fundText = fundCount === 0 ? 'Task skipped' : `${fundCount} funding method${fundCount !== 1 ? 's' : ''} identified`;
        
        const headerChecksHtml = `
            <div class="task-header-checks">
                <div class="task-check-item">
                    ${this.getTaskCheckIcon(fundStatus)}
                    <span class="task-check-text">${fundText}</span>
                </div>
            </div>
        `;
        
        // Count SoF annotation GROUPS for badge
        const sofNotes = (check.sofAnnotations || []);
        const sofAnnotationCount = sofNotes.length;
        const annotationBadge = sofAnnotationCount > 0 ? `<span class="annotation-count-badge">${sofAnnotationCount} Update${sofAnnotationCount > 1 ? 's' : ''}</span>` : '';
        
        // Wrap badge in container for consistent right-alignment
        const badgesHtml = annotationBadge ? `<div class="task-header-badges">${annotationBadge}</div>` : '';
        
        // Add annotations display
        const annotationsHtml = this.renderTaskAnnotations('sof:v1', check);
        
        return `
            <div class="task-card ${borderClass}" onclick="this.classList.toggle('expanded')">
                <div class="task-header">
                    <div class="task-title">Source of Funds Questionnaire</div>
                    ${badgesHtml}
                    ${statusIcon}
                </div>
                ${headerChecksHtml}
                <div class="task-details">
                    <div class="sof-top-section">
                        ${propertyDetailsHtml}
                        ${chartHtml}
                    </div>
                    ${fundingCardsHtml}
                    ${annotationsHtml}
                </div>
            </div>
        `;
    }
    
    createTaskCard(taskType, outcome, check) {
        const status = outcome.status || '';
        
        // Recalculate identity result BEFORE reading it
        if (taskType === 'identity' && outcome.breakdown) {
            const breakdown = outcome.breakdown;
            
            // First, recalculate document result if it has breakdown categories
            let docResult = breakdown.document?.result || '';
            if (breakdown.document?.breakdown) {
                const docBreakdown = breakdown.document.breakdown;
                let hasConsider = false;
                let hasFail = false;
                Object.values(docBreakdown).forEach(category => {
                    const catResult = category?.result || '';
                    if (catResult === 'fail') hasFail = true;
                    if (catResult === 'consider') hasConsider = true;
                });
                if (hasFail) docResult = 'fail';
                else if (hasConsider) docResult = 'consider';
                // Update the document result
                if (breakdown.document) {
                    breakdown.document.result = docResult;
                }
            }
            
            const faceResult = breakdown.facial_similarity?.result || breakdown.facial_similarity_video?.result || '';
            
            // Clear if document + facial_similarity are both clear (Original standard)
            if (docResult === 'clear' && faceResult === 'clear') {
                outcome.result = 'clear';
            } else if (docResult === 'consider' || faceResult === 'consider' || docResult === 'fail' || faceResult === 'fail') {
                outcome.result = 'consider';
            }
        }
        
        const result = outcome.result || 'unknown';
        let borderClass = '';
        let statusIcon = '';
        
        // Handle unobtainable status explicitly
        if (status === 'unobtainable') {
            borderClass = 'consider';
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        } else if (result === 'clear') {
            borderClass = 'clear';
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>`;
        } else if (result === 'consider' || result === 'alert') {
            borderClass = 'consider';
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        } else if (result === 'fail') {
            borderClass = 'alert';
            statusIcon = `<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>`;
        }
        
        const taskTitle = this.getTaskTitle(taskType);
        const taskChecks = this.getTaskChecks(taskType, outcome, check);

        // Proof of Savings evidence is displayed inside the Source of Funds task card
        // so we can skip rendering the standalone documents:savings card when SoF exists.
        if (taskType === 'documents:savings' && check?.taskOutcomes?.['sof:v1']) {
            return '';
        }
        
        // Document tasks (PoA, PoO, Savings, Crypto, Other) - Expandable if has annotations, otherwise non-expandable
        const isDocumentTask = taskType === 'documents:poa' || taskType === 'documents:poo' || 
                               taskType === 'documents:savings' || taskType === 'documents:cryptocurrency' || 
                               taskType === 'documents:other';
        
        if (isDocumentTask) {
            // Get document count from documents array or breakdown.documents array
            const docCount = outcome.documents?.length || outcome.breakdown?.documents?.length || outcome.data?.document_count || 0;
            const isSkipped = status === 'skipped';
            
            // Determine status based on document count
            // 0 docs or skipped = fail/alert, 1 doc = consider, 2+ docs = clear
            let docStatus = 'AL';
            let docText = '';
            
            if (isSkipped) {
                docStatus = 'AL';
                docText = 'Consumer skipped in app';
            } else if (docCount === 0) {
                docStatus = 'AL';
                docText = 'No documents uploaded';
            } else if (docCount === 1) {
                docStatus = 'CO';
                docText = '1 document uploaded';
            } else {
                docStatus = 'CL';
                docText = `${docCount} documents uploaded`;
            }
            
            const headerChecksHtml = `
                <div class="task-header-checks">
                    <div class="task-check-item">
                        ${this.getTaskCheckIcon(docStatus)}
                        <span class="task-check-text">${docText}</span>
                    </div>
                </div>
            `;
            
            // Count annotation GROUPS for this task
            const taskAnnotations = (check.considerAnnotations || []).filter(ann => ann.taskType === taskType);
            const annotationGroups = {};
            taskAnnotations.forEach(ann => {
                const groupKey = `${ann.user}_${ann.timestamp}_${ann.newStatus}`;
                if (!annotationGroups[groupKey]) {
                    annotationGroups[groupKey] = true;
                }
            });
            const taskAnnotationCount = Object.keys(annotationGroups).length;
            
            // If there are annotations, make it expandable with badge and annotations
            if (taskAnnotationCount > 0) {
                // Get latest annotation status for badge color
                let badgeClass = '';
                if (taskAnnotations.length > 0) {
                    const latestStatus = taskAnnotations[0].newStatus;
                    if (latestStatus === 'clear') badgeClass = ' badge-clear';
                    else if (latestStatus === 'consider') badgeClass = ' badge-consider';
                    else if (latestStatus === 'fail') badgeClass = ' badge-fail';
                }
                
                const annotationBadge = `<span class="annotation-count-badge${badgeClass}">${taskAnnotationCount} Update${taskAnnotationCount > 1 ? 's' : ''}</span>`;
                const badgesHtml = `<div class="task-header-badges">${annotationBadge}</div>`;
                const annotationsHtml = this.renderTaskAnnotations(taskType, check);
                
                return `
                    <div class="task-card ${borderClass}" onclick="this.classList.toggle('expanded')">
                        <div class="task-header">
                            <div class="task-title">${taskTitle}</div>
                            ${badgesHtml}
                            ${statusIcon}
                        </div>
                        ${headerChecksHtml}
                        <div class="task-details">
                            ${annotationsHtml}
                        </div>
                    </div>
                `;
            } else {
                // No annotations - keep it non-expandable
                return `
                    <div class="task-card ${borderClass} non-expandable">
                        <div class="task-header">
                            <div class="task-title">${taskTitle}</div>
                            ${statusIcon}
                        </div>
                        ${headerChecksHtml}
                    </div>
                `;
            }
        }
        
        // Special handling for Source of Funds (sof:v1)
        if (taskType === 'sof:v1' && outcome.breakdown) {
            // Get bank analysis for SoF matching - check bank:summary, bank:statement, and documents:bank-statement
            const bankSummary = check.taskOutcomes?.['bank:summary'];
            const bankStatement = check.taskOutcomes?.['bank:statement'];
            const docsBankStatement = check.taskOutcomes?.['documents:bank-statement'];
            
            // Get sof_matches from analysis (if available from Open Banking)
            let sofMatches = bankSummary?.breakdown?.analysis?.sof_matches || 
                            bankStatement?.breakdown?.analysis?.sof_matches ||
                            docsBankStatement?.breakdown?.analysis?.sof_matches || 
                            {};
            
            // Get accounts from any source
            const accounts = bankStatement?.breakdown?.accounts || 
                           bankSummary?.breakdown?.accounts || 
                           docsBankStatement?.breakdown?.accounts || 
                           {};
            
            // Note: Manual SOF matching logic removed - can be added back if needed
            // For now, just use the automatic matches from the API
            
            return this.createSOFTaskCard(outcome, check, sofMatches);
        }
        
        // Handle skipped tasks
        if (status === 'skipped') {
            return `
                <div class="task-card ${borderClass} non-expandable">
                    <div class="task-header">
                        <div class="task-title">${taskTitle}</div>
                        ${statusIcon}
                    </div>
                    <div class="task-summary-inline">Consumer skipped in app</div>
                </div>
            `;
        }
        
        // Standard expandable task card
        let taskSummary = outcome.result ? this.formatResult(outcome.result) : 'Pending';
        
        // Add status information for unobtainable tasks
        if (outcome.status === 'unobtainable') {
            taskSummary = `<span style="color: #f7931e;">Unobtainable</span> - Some information may still be available`;
        }
        
        // Separate header checks (show when collapsed) from detail checks (show when expanded)
        const headerChecks = taskChecks.filter(c => !c.indented && !c.isPersonCard && !c.isHitCard && !c.isNestedCard);
        const detailChecks = taskChecks.filter(c => c.indented || c.isPersonCard || c.isHitCard || c.isNestedCard);
        
        let headerChecksHtml = '';
        if (headerChecks.length > 0) {
            headerChecksHtml = '<div class="task-header-checks">';
            headerChecks.forEach(check => {
                const checkIcon = this.getTaskCheckIcon(check.status);
                const indentStyle = check.isChildItem ? 'style="padding-left: 24px;"' : '';
                
                headerChecksHtml += `
                    <div class="task-check-item" ${indentStyle}>
                        ${checkIcon}
                        <span class="task-check-text">${check.text}</span>
                    </div>
                `;
            });
            headerChecksHtml += '</div>';
        }
        
        let checksHtml = '';
        if (detailChecks.length > 0) {
            checksHtml = '<div class="task-checks-grid">';
            detailChecks.forEach((check, index) => {
                // Handle person profile cards - NO ICONS
                if (check.isPersonCard === true && check.personData) {
                    console.log(`Rendering person card ${index}:`, check.personData.name || check.personData.fullName);
                    checksHtml += this.createPersonProfileCard(check.personData);
                } else if (check.isHitCard === true && check.hitData) {
                    // Handle screening hit cards (PEP, Sanctions, Adverse Media)
                    checksHtml += this.createScreeningHitCard(check.hitData);
                } else if (check.isNestedCard === true) {
                    // Handle nested collapsible cards (for identity sub-tasks)
                    checksHtml += this.createNestedTaskCard(check);
                } else {
                    // Standard check item with icon
                    const checkIcon = this.getTaskCheckIcon(check.status);
                    const indentedClass = check.indented ? ' indented' : '';
                    const sectionHeaderClass = check.isSectionHeader ? ' section-header' : '';
                    checksHtml += `
                        <div class="task-check-item${indentedClass}${sectionHeaderClass}">
                            ${checkIcon}
                            <span class="task-check-text">${check.text}</span>
                        </div>
                    `;
                }
            });
            checksHtml += '</div>';
        }
        
        // Add header check for unobtainable status
        if (outcome.status === 'unobtainable') {
            taskChecks.unshift({
                status: 'CO',
                text: 'Unobtainable - Some information may still be available'
            });
        }
        
        // Count annotation GROUPS (cards) for this task, not individual annotations
        const taskAnnotations = (check.considerAnnotations || []).filter(ann => ann.taskType === taskType);
        const annotationGroups = {};
        taskAnnotations.forEach(ann => {
            const groupKey = `${ann.user}_${ann.timestamp}_${ann.newStatus}`;
            if (!annotationGroups[groupKey]) {
                annotationGroups[groupKey] = true;
            }
        });
        const taskAnnotationCount = Object.keys(annotationGroups).length;
        
        // Get latest annotation status (first in array since we use unshift) for badge color
        let badgeClass = '';
        if (taskAnnotations.length > 0) {
            const latestStatus = taskAnnotations[0].newStatus;
            if (latestStatus === 'clear') badgeClass = ' badge-clear';
            else if (latestStatus === 'consider') badgeClass = ' badge-consider';
            else if (latestStatus === 'fail') badgeClass = ' badge-fail';
        }
        
        const annotationBadge = taskAnnotationCount > 0 ? `<span class="annotation-count-badge${badgeClass}">${taskAnnotationCount} Update${taskAnnotationCount > 1 ? 's' : ''}</span>` : '';
        
        // Extract dismissed/outstanding counts for badge rendering in task header (screening tasks only)
        let dismissedBadge = '';
        let outstandingBadge = '';
        if (headerChecks.length > 0 && headerChecks[0].dismissedCount !== undefined) {
            if (headerChecks[0].dismissedCount > 0) {
                dismissedBadge = `<span class="hit-count-badge badge-dismissed">${headerChecks[0].dismissedCount} Dismissed</span>`;
            }
            if (headerChecks[0].outstandingCount > 0) {
                outstandingBadge = `<span class="hit-count-badge badge-outstanding">${headerChecks[0].outstandingCount} Outstanding</span>`;
            }
        }
        
        // Always create badge container if ANY badge exists (ensures consistent right-alignment)
        const badgesHtml = (annotationBadge || dismissedBadge || outstandingBadge)
            ? `<div class="task-header-badges">${annotationBadge}${dismissedBadge}${outstandingBadge}</div>` 
            : '';
        
        // Add annotations display
        const annotationsHtml = this.renderTaskAnnotations(taskType, check);
        
        return `
            <div class="task-card ${borderClass}" onclick="this.classList.toggle('expanded')">
                <div class="task-header">
                    <div class="task-title">${taskTitle}</div>
                    ${badgesHtml}
                    ${statusIcon}
                </div>
                ${headerChecksHtml}
                ${outcome.status === 'closed' || outcome.status === 'unobtainable' ? `
                <div class="task-details">
                    ${outcome.status !== 'unobtainable' ? `<div class="task-summary">${taskSummary}</div>` : ''}
                    ${checksHtml}
                    ${annotationsHtml}
                </div>
                ` : ''}
            </div>
        `;
    }
    
    createNestedTaskCard(nestedTask) {
        const { title, result, items, isUnobtainable } = nestedTask;
        
        // Determine status icon
        let statusIcon = '';
        if (isUnobtainable) {
            statusIcon = `<svg class="nested-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        } else if (result === 'clear') {
            statusIcon = `<svg class="nested-status-icon" viewBox="0 0 300 300"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>`;
        } else if (result === 'consider') {
            statusIcon = `<svg class="nested-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        } else if (result === 'fail') {
            statusIcon = `<svg class="nested-status-icon" viewBox="0 0 300 300"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>`;
        }
        
        // If unobtainable or no items, make it non-expandable
        const hasItems = items && items.length > 0;
        const expandableClass = hasItems ? 'expandable' : 'non-expandable';
        
        // Auto-expand if result is consider or fail (to show the issues)
        const autoExpandClass = (result === 'consider' || result === 'fail') && hasItems ? ' expanded' : '';
        
        let itemsHtml = '';
        if (hasItems) {
            items.forEach(item => {
                const itemIcon = this.getTaskCheckIcon(item.status);
                const parentClass = item.isParent ? ' nested-parent' : '';
                const indentedClass = item.isIndented ? ' nested-indented' : '';
                itemsHtml += `
                    <div class="nested-item${parentClass}${indentedClass}">
                        ${itemIcon}
                        <span>${item.text}</span>
                    </div>
                `;
            });
        }
        
        let unobtainableText = '';
        if (isUnobtainable) {
            unobtainableText = '<div class="nested-unobtainable">Unobtainable</div>';
        }
        
        return `
            <div class="nested-task-card ${expandableClass}${autoExpandClass}" onclick="event.stopPropagation(); this.classList.toggle('expanded')">
                <div class="nested-header">
                    <span class="nested-title">${title}</span>
                    ${statusIcon}
                </div>
                ${unobtainableText}
                ${hasItems ? `
                <div class="nested-items">
                    ${itemsHtml}
                </div>
                ` : ''}
            </div>
        `;
    }
    
    renderUpdatesSection(check) {
        const updates = check.updates || [];
        
        if (updates.length === 0) {
            this.updatesSection.innerHTML = '';
            return;
        }
        
        let updatesHtml = '<div class="updates-header">Audit Trail</div>';
        
        // Show in reverse order (most recent first)
        [...updates].reverse().forEach(update => {
            const date = new Date(update.timestamp).toLocaleDateString('en-GB');
            updatesHtml += `
                <div class="update-card">
                    <div class="update-header">
                        <div class="update-message">${update.update}</div>
                        <div class="update-date">${date}</div>
                    </div>
                </div>
            `;
        });
        
        this.updatesSection.innerHTML = updatesHtml;
    }
    
    // ===================================================================
    // HELPER FUNCTIONS
    // ===================================================================
    
    getCheckTypeLabel(check) {
        const labels = {
            'kyb': 'Know Your Business',
            'lite-screen': 'Lite Screen',
            'idv': 'Identity Document Verification'
        };
        
        if (check.checkType === 'electronic-id') {
            // Determine if it's Enhanced, Original, or Additional Tasks Only
            const idType = this.getElectronicIDType(check);
            
            if (idType === 'enhanced') {
                return 'Enhanced ID Check';
            } else if (idType === 'original') {
                return 'Original ID Check';
            } else if (idType && idType !== 'additional') {
                // Specific additional task name(s)
                return idType;
            } else {
                return 'Additional Tasks';
            }
        }
        
        return labels[check.checkType] || 'Thirdfort Check';
    }
    
    getElectronicIDType(check) {
        if (check.checkType !== 'electronic-id') return null;
        
        // Check for identity task in outcomes (closed checks) or request (open checks)
        const taskOutcomes = check.taskOutcomes || {};
        const requestTasks = check.thirdfortResponse?.request?.tasks || [];
        
        // Check if identity task exists
        const hasIdentityOutcome = taskOutcomes['identity'] || taskOutcomes['nfc'];
        const hasIdentityRequest = requestTasks.find(task => task.type === 'report:identity');
        
        // If no identity task at all, determine specific additional task name
        if (!hasIdentityOutcome && !hasIdentityRequest) {
            return this.getAdditionalTasksLabel(check);
        }
        
        // For closed checks: check NFC outcome
        const nfcReport = taskOutcomes['nfc'];
        if (nfcReport) {
            return nfcReport.status !== 'unobtainable' ? 'enhanced' : 'original';
        }
        
        // For open checks: check if NFC preferred was requested
        if (hasIdentityRequest && hasIdentityRequest.opts && hasIdentityRequest.opts.nfc === 'preferred') {
            return 'enhanced';
        }
        
        // If identity task exists but no NFC, it's Original
        return 'original';
    }
    
    getAdditionalTasksLabel(check) {
        // Get all non-identity tasks from check
        const requestTasks = check.thirdfortResponse?.request?.tasks || [];
        const tasks = check.tasks || [];
        
        // Filter out identity/footprint/peps tasks to get only additional tasks
        const additionalTasks = requestTasks.filter(task => {
            const type = typeof task === 'string' ? task : task.type;
            return !['report:identity', 'report:footprint', 'report:peps', 'report:sanctions'].includes(type);
        }).map(task => typeof task === 'string' ? task : task.type);
        
        // If no additional tasks found in requestTasks, check tasks array
        if (additionalTasks.length === 0) {
            const taskTypes = tasks.filter(t => 
                !['report:identity', 'report:footprint', 'report:peps', 'report:sanctions'].includes(t)
            );
            additionalTasks.push(...taskTypes);
        }
        
        const hasPoA = additionalTasks.includes('documents:poa');
        const hasPoO = additionalTasks.includes('documents:poo');
        const hasSavings = additionalTasks.includes('documents:savings');
        const hasCrypto = additionalTasks.includes('documents:cryptocurrency');
        const hasSoF = additionalTasks.includes('report:sof-v1');
        const hasBank = additionalTasks.some(t => t.includes('bank'));
        
        // Single task scenarios
        if (additionalTasks.length === 1) {
            const taskNames = {
                'documents:poa': 'Proof of Address',
                'documents:poo': 'Proof of Ownership',
                'documents:savings': 'Proof of Savings',
                'documents:cryptocurrency': 'Proof of Cryptocurrency',
                'report:sof-v1': 'Source of Funds Questionnaire',
                'report:bank-statement': 'Bank Summary',
                'report:bank-summary': 'Bank Summary',
                'bank': 'Bank Summary'
            };
            return taskNames[additionalTasks[0]] || 'Additional Tasks';
        }
        
        // Combination scenarios
        if (hasPoA && hasPoO && !hasSoF && !hasBank) {
            return 'Proof of Ownership & Address';
        }
        
        if ((hasSoF || hasBank) && !hasPoA && !hasPoO) {
            if (hasSoF && hasBank) {
                return 'Source of Funds Questionnaire & Bank Summary';
            } else if (hasSoF) {
                return 'Source of Funds Questionnaire';
            } else {
                return 'Bank Summary';
            }
        }
        
        // Mixed proof tasks with SoF/bank tasks
        return 'Additional Tasks';
    }
    
    isEnhancedID(check) {
        return this.getElectronicIDType(check) === 'enhanced';
    }
    
    checksSafeHarbour(check) {
        if (check.checkType !== 'electronic-id') return false;
        
        const taskOutcomes = check.taskOutcomes || {};
        const considerReasons = check.considerReasons || [];
        
        const nfcReport = taskOutcomes['nfc'];
        const isEnhanced = nfcReport && nfcReport.status !== 'unobtainable';
        
        if (!isEnhanced) return false;
        
        const addressClear = !taskOutcomes['address'] || taskOutcomes['address'].result === 'clear';
        const pepClear = !taskOutcomes['peps'] || taskOutcomes['peps'].result === 'clear';
        const identityClear = !taskOutcomes['identity'] || taskOutcomes['identity'].result === 'clear';
        const nfcConfirmed = nfcReport.result === 'clear' || nfcReport.status === 'closed';
        const livenessClear = !taskOutcomes['liveness'] || taskOutcomes['liveness'].result === 'clear';
        const pooNotSkipped = !considerReasons.includes('skipped proof of ownership');
        
        return addressClear && pepClear && identityClear && nfcConfirmed && livenessClear && pooNotSkipped;
    }
    
    generateHints(check) {
        const hints = [];
        const considerReasons = check.considerReasons || [];
        
        // Map each consider reason to a hint with proper categorization
        considerReasons.forEach(reason => {
            const lowerReason = reason.toLowerCase();
            let hint = { level: 'info', text: reason, priority: 2 };
            
            // Alert/Fail level (priority 0)
            if (lowerReason.includes('document integrity') || 
                lowerReason.includes('nfc mismatch') || 
                lowerReason.includes('nfc chip') ||
                lowerReason.includes('document expired') ||
                lowerReason.includes('no address match')) {
                hint = { level: 'alert', text: this.formatHintText(reason), priority: 0 };
            }
            // Warning/Consider level (priority 1)
            else if (lowerReason.includes('pep') || 
                     lowerReason.includes('sanction') ||
                     lowerReason.includes('address quality') ||
                     lowerReason.includes('address verification') ||
                     lowerReason.includes('facial similarity') ||
                     lowerReason.includes('image quality') ||
                     lowerReason.includes('mortality') ||
                     lowerReason.includes('dob match') ||
                     lowerReason.includes('bank link') ||
                     lowerReason.includes('high-risk') ||
                     lowerReason.includes('adverse media') ||
                     lowerReason.includes('ubo')) {
                hint = { level: 'warning', text: this.formatHintText(reason), priority: 1 };
            }
            // Info level (priority 2) - already set as default
            else {
                hint = { level: 'info', text: this.formatHintText(reason), priority: 2 };
            }
            
            hints.push(hint);
        });
        
        // Check for Enhanced downgrade (from taskOutcomes)
        const nfcReport = check.taskOutcomes?.['nfc'];
        if (check.checkType === 'electronic-id' && nfcReport && nfcReport.status === 'unobtainable') {
            // Only add if not already in considerReasons
            if (!considerReasons.some(r => r.toLowerCase().includes('enhanced downgrade'))) {
                hints.push({ level: 'info', text: 'Enhanced Downgrade', priority: 2 });
            }
        }
        
        // Sort by priority (alert > warning > info)
        return hints.sort((a, b) => a.priority - b.priority);
    }
    
    formatHintText(reason) {
        // Capitalize first letter and clean up text
        return reason.charAt(0).toUpperCase() + reason.slice(1);
    }
    
    formatResult(result) {
        // Format result string (capitalize first letter)
        return result.charAt(0).toUpperCase() + result.slice(1);
    }
    
    prepareSOFChartData(sofBreakdown) {
        const funds = sofBreakdown.funds || [];
        const fundingLabels = [];
        const fundingAmounts = [];
        const fundingColors = {
            'fund:mortgage': '#93C5FD',        // Pastel Blue
            'fund:savings': '#86EFAC',         // Pastel Green
            'fund:gift': '#FCA5A5',            // Pastel Pink/Red
            'fund:sale:property': '#C4B5FD',   // Pastel Purple
            'fund:sale:assets': '#FDBA74',     // Pastel Orange
            'fund:asset_sale': '#FDBA74',
            'fund:htb': '#A5F3FC',             // Pastel Cyan
            'fund:htb_lisa': '#A5F3FC',
            'fund:inheritance': '#FDE68A',     // Pastel Yellow
            'fund:divorce': '#FBCFE8',         // Pastel Pink
            'fund:cryptocurrency': '#99F6E4',  // Pastel Teal
            'fund:crypto': '#99F6E4',
            'fund:loan': '#FDE68A',
            'fund:investment': '#BBF7D0',
            'fund:business': '#DDD6FE',
            'fund:income': '#A7F3D0',
            'fund:other': '#E5E7EB'
        };
        
        const typeLabels = {
            'fund:mortgage': 'Mortgage',
            'fund:savings': 'Savings',
            'fund:gift': 'Gift',
            'fund:sale:property': 'Property Sale',
            'fund:property_sale': 'Property Sale',
            'fund:sale:assets': 'Asset Sale',
            'fund:asset_sale': 'Asset Sale',
            'fund:htb': 'Lifetime ISA',
            'fund:htb_lisa': 'Lifetime ISA',
            'fund:inheritance': 'Inheritance',
            'fund:divorce': 'Divorce Settlement',
            'fund:cryptocurrency': 'Cryptocurrency',
            'fund:crypto': 'Cryptocurrency',
            'fund:loan': 'Loan',
            'fund:investment': 'Investment',
            'fund:business': 'Business Income',
            'fund:income': 'Income',
            'fund:other': 'Other'
        };
        
        funds.forEach(fund => {
            const label = typeLabels[fund.type] || this.formatFundingLabel(fund.type?.replace('fund:', '') || 'Other');
            const amountMinor = typeof fund.data.amount === 'number' ? fund.data.amount : 0;
            const amount = amountMinor / 100; // Convert pence to pounds
            fundingLabels.push(label);
            fundingAmounts.push(amount);
        });
        
        return {
            chartType: 'doughnut',
            title: 'Funding Breakdown',
            chartData: {
                labels: fundingLabels,
                datasets: [{
                    data: fundingAmounts,
                    backgroundColor: funds.map(f => fundingColors[f.type] || '#6B7280')
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const value = context.parsed;
                                return `${context.label}: &#xA3;${value.toLocaleString()}`;
                            }
                        }
                    }
                }
            }
        };
    }
    
    createPersonProfileCard(personData) {
        // Create a profile card for officers, PSCs, beneficial owners, etc.
        const name = personData.name || personData.fullName || personData.organizationName || 'Unknown';
        const isIndividual = personData.beneficiaryType === 'Individual' || personData.birthDate || personData.dob;
        const isBusiness = personData.businessEntityType || personData.beneficiaryType === 'Business';
        
        // Determine role badges
        let badges = '';
        const roleLabels = new Set(); // Use Set to avoid duplicates
        
        // Officer/Director/Member role from position or category
        const position = personData.position || personData.category || '';
        if (position) {
            if (position.toLowerCase().includes('director')) {
                roleLabels.add('Director');
            } else if (position.toLowerCase().includes('member')) {
                roleLabels.add('Member');
            } else {
                roleLabels.add(position);
            }
        }
        
        // PSC indicator (from nature of control types)
        if (personData.natureOfControlTypes && personData.natureOfControlTypes.length > 0) {
            roleLabels.add('PSC');
        }
        
        // UBO indicator (ultimate beneficial owner)
        if (personData.is_ubo === true) {
            roleLabels.add('UBO');
        }
        
        // Beneficial Owner (from beneficiaryType)
        if ((personData.beneficiaryType === 'Business' || personData.beneficiaryType === 'Individual') && !personData.is_ubo) {
            roleLabels.add('Beneficial Owner');
        }
        
        // Create badge HTML
        roleLabels.forEach(label => {
            let badgeClass = 'badge-officer'; // Default
            
            if (label === 'Director') {
                badgeClass = 'badge-director';
            } else if (label === 'PSC' || label === 'UBO' || label === 'Beneficial Owner') {
                badgeClass = 'badge-psc';
            } else if (label === 'Trustee') {
                badgeClass = 'badge-trustee';
            } else if (label.toLowerCase().includes('member')) {
                badgeClass = 'badge-officer';
            }
            
            badges += `<span class="people-card-badge ${badgeClass}">${label}</span>`;
        });
        
        // Build profile details HTML
        let detailsHtml = '';
        
        // Date of Birth
        const dob = personData.dob || personData.birthDate || '';
        if (dob) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">DOB:</span> ${dob}</div>`;
        }
        
        // Nationality
        const nationality = personData.nationality || '';
        if (nationality) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Nationality:</span> ${nationality}</div>`;
        }
        
        // Residence Country
        const residenceCountry = personData.residenceCountryName || '';
        if (residenceCountry && residenceCountry !== nationality) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Residence:</span> ${residenceCountry}</div>`;
        }
        
        // Business Entity Type
        if (isBusiness && personData.businessEntityType) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Entity Type:</span> ${personData.businessEntityType}</div>`;
        }
        
        // Beneficiary Type
        if (personData.beneficiaryType && !isBusiness) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Type:</span> ${personData.beneficiaryType}</div>`;
        }
        
        // Country (for businesses)
        const country = personData.country || '';
        if (country) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Country:</span> ${country}</div>`;
        }
        
        // Appointment Date
        const startDate = personData.start_date || personData.natureOfControlStartDate || '';
        if (startDate) {
            const appointDate = new Date(startDate).toLocaleDateString('en-GB');
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Appointed:</span> ${appointDate}</div>`;
        }
        
        // End Date / Resignation
        const endDate = personData.end_date || '';
        if (endDate) {
            const resignDate = new Date(endDate).toLocaleDateString('en-GB');
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Resigned:</span> ${resignDate}</div>`;
        }
        
        // Address
        let addressStr = '';
        if (typeof personData.address === 'string') {
            addressStr = personData.address;
        } else if (personData.address && typeof personData.address === 'object') {
            const addr = personData.address;
            addressStr = [addr.street, addr.city, addr.zip, addr.country]
                .filter(Boolean).join(', ');
        }
        if (addressStr) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Address:</span> ${addressStr}</div>`;
        }
        
        // DUNS Number
        if (personData.duns) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">DUNS:</span> ${personData.duns}</div>`;
        }
        
        // Member ID
        if (personData.memberID) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Member ID:</span> ${personData.memberID}</div>`;
        }
        
        // Associations
        if (personData.associations && personData.associations !== null) {
            detailsHtml += `<div class="profile-detail-row"><span class="profile-detail-label">Associations:</span> ${personData.associations}</div>`;
        }
        
        // Flags/Warnings
        let warnings = '';
        if (personData.is_disqualified_director) {
            warnings += '<div class="person-warning"> DISQUALIFIED DIRECTOR</div>';
        }
        if (personData.has_bankruptcy_history) {
            warnings += '<div class="person-warning"> BANKRUPTCY HISTORY</div>';
        }
        if (personData.isOutOfBusiness) {
            warnings += '<div class="person-warning"> OUT OF BUSINESS</div>';
        }
        
        // Ownership/Share information with Nature of Control
        let shareInfo = '';
        const shareDetails = [];
        
        // Ownership percentages
        const beneficialPct = personData.beneficialOwnershipPercentage || 0;
        const directPct = personData.directOwnershipPercentage || 0;
        const indirectPct = personData.indirectOwnershipPercentage || 0;
        const ownershipPct = personData.ownershipPercentage || 0;
        const votingPct = personData.votingPercentageHigh || 0;
        
        if (beneficialPct > 0) shareDetails.push(`${beneficialPct}% beneficial`);
        if (directPct > 0) shareDetails.push(`${directPct}% direct`);
        if (indirectPct > 0) shareDetails.push(`${indirectPct}% indirect`);
        if (ownershipPct > 0 && beneficialPct === 0 && directPct === 0) shareDetails.push(`${ownershipPct}% ownership`);
        if (votingPct > 0) shareDetails.push(`${votingPct}% voting rights`);
        
        // Nature of Control
        if (personData.natureOfControlTypes && Array.isArray(personData.natureOfControlTypes) && personData.natureOfControlTypes.length > 0) {
            const controls = this.formatNatureOfControl(personData.natureOfControlTypes);
            if (controls) {
                shareDetails.push(controls);
            }
        }
        
        if (shareDetails.length > 0) {
            shareInfo = `<div class="people-card-share">&#xD83D;&#xDCCA; ${shareDetails.join(' | ')}</div>`;
        }
        
        return `
            <div class="person-profile-card">
                <div class="people-card-header">
                    <div class="people-card-name">${name}</div>
                    <div style="display: flex; gap: 4px; flex-wrap: wrap;">${badges}</div>
                </div>
                <div class="people-card-details">
                    ${detailsHtml}
                </div>
                ${shareInfo}
                ${warnings}
            </div>
        `;
    }
    
    getTaskCheckIcon(status, isRed = false) {
        // Return colored circle icons for task objectives
        if (status === 'CL') {
            // Green circle with checkmark
            return `<svg class="objective-icon" viewBox="0 0 300 300"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>`;
        } else if (status === 'CO' || status === 'CN') {
            // Orange or Red circle with minus (for red flags)
            const color = isRed ? '#d32f2f' : '#f7931e';
            return `<svg class="objective-icon" viewBox="0 0 300 300"><path fill="${color}" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        } else if (status === 'AL' || status === 'FA') {
            // Red circle with X
            return `<svg class="objective-icon" viewBox="0 0 300 300"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>`;
        }
        return '';
    }
    
    // CSS-based icons for PDF generation (html2pdf doesn't handle SVG well)
    getTaskCheckIconCSS(status, isRed = false) {
        if (status === 'CL') {
            // Green circle with white checkmark using pseudo-elements
            return `<div style="width: 16px; height: 16px; border-radius: 50%; background: #39b549; position: relative; flex-shrink: 0; margin-top: 2px; display: flex; align-items: center; justify-content: center;"><span style="color: white; font-size: 12px; font-weight: bold; line-height: 1;">&#x2713;</span></div>`;
        } else if (status === 'CO' || status === 'CN') {
            const color = isRed ? '#d32f2f' : '#f7931e';
            return `<div style="width: 16px; height: 16px; border-radius: 50%; background: ${color}; position: relative; flex-shrink: 0; margin-top: 2px; display: flex; align-items: center; justify-content: center;"><span style="color: white; font-size: 16px; font-weight: bold; line-height: 1;">&#x2212;</span></div>`;
        } else if (status === 'AL' || status === 'FA') {
            return `<div style="width: 16px; height: 16px; border-radius: 50%; background: #ff0000; position: relative; flex-shrink: 0; margin-top: 2px; display: flex; align-items: center; justify-content: center;"><span style="color: white; font-size: 14px; font-weight: bold; line-height: 1;">&#xD7;</span></div>`;
        }
        return '';
    }
    
    // CSS-based status icons for PDF (larger size for task headers)
    getStatusIconCSS(status) {
        if (status === 'clear') {
            return `<div style="width: 20px; height: 20px; border-radius: 50%; background: #39b549; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"><span style="color: white; font-size: 14px; font-weight: bold; line-height: 1;">&#x2713;</span></div>`;
        } else if (status === 'consider') {
            return `<div style="width: 20px; height: 20px; border-radius: 50%; background: #f7931e; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"><span style="color: white; font-size: 18px; font-weight: bold; line-height: 1;">&#x2212;</span></div>`;
        } else if (status === 'fail') {
            return `<div style="width: 20px; height: 20px; border-radius: 50%; background: #ff0000; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"><span style="color: white; font-size: 16px; font-weight: bold; line-height: 1;">&#xD7;</span></div>`;
        }
        return '';
    }
    
    getStatusIconSVG(status) {
        // Return smaller circular status icons for annotation objectives
        // Matches the status result strings: 'clear', 'consider', 'fail'
        if (status === 'clear') {
            // Green circle with checkmark
            return `<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>`;
        } else if (status === 'consider') {
            // Orange circle with minus
            return `<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>`;
        } else if (status === 'fail') {
            // Red circle with X
            return `<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>`;
        }
        return '';
    }
    
    createScreeningHitCard(hitData) {
        const {
            name, dob, hitType, hitIcon, score, flagTypes, positions, countries, aka, media, associates, fields, match_types, dismissal
        } = hitData;
        
        const uniqueId = `hit-${Math.random().toString(36).substr(2, 9)}`;
        const isDismissed = dismissal !== undefined && dismissal !== null;
        
        let html = `
            <div class="screening-hit-card ${isDismissed ? 'dismissed-hit' : ''}">
                <div class="screening-hit-header">
                    <div class="screening-hit-name">
                        ${name}
                        ${isDismissed ? `<span class="dismissal-badge">
                            <svg viewBox="0 0 300 300" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>
                            Dismissed
                        </span>` : ''}
                    </div>
                    <div class="screening-hit-badges">
        `;
        
        // Organize badges by type for separate rows
        const pepBadges = [];
        const sanctionBadges = [];
        const adverseBadges = [];
        const otherBadges = [];
        
        if (flagTypes && flagTypes.length > 0) {
            const uniqueFlags = [...new Set(flagTypes)];
            uniqueFlags.forEach(flag => {
                let badgeText = flag.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                if (flag.includes('pep')) {
                    // Extract PEP class if available
                    if (flag.includes('class-1')) badgeText = 'PEP Class 1';
                    else if (flag.includes('class-2')) badgeText = 'PEP Class 2';
                    else if (flag.includes('class-3')) badgeText = 'PEP Class 3';
                    else if (flag.includes('class-4')) badgeText = 'PEP Class 4';
                    else if (flag === 'pep') badgeText = 'PEP';
                    pepBadges.push(badgeText);
                } else if (flag.includes('sanction')) {
                    sanctionBadges.push(badgeText);
                } else if (flag.includes('adverse-media')) {
                    adverseBadges.push(badgeText);
                } else {
                    otherBadges.push(badgeText);
                }
            });
        }
        
        // PEP badges row (purple)
        if (pepBadges.length > 0) {
            html += '<div class="hit-badge-row">';
            pepBadges.forEach(badge => {
                html += `<span class="hit-badge hit-badge-pep">${badge}</span>`;
            });
            html += '</div>';
        }
        
        // Sanctions badges row (red)
        if (sanctionBadges.length > 0) {
            html += '<div class="hit-badge-row">';
            sanctionBadges.forEach(badge => {
                html += `<span class="hit-badge hit-badge-sanction">${badge}</span>`;
            });
            html += '</div>';
        }
        
        // Adverse Media badges row (blue)
        if (adverseBadges.length > 0) {
            html += '<div class="hit-badge-row">';
            adverseBadges.forEach(badge => {
                html += `<span class="hit-badge hit-badge-adverse">${badge}</span>`;
            });
            html += '</div>';
        }
        
        // Match types row (green)
        if (match_types && match_types.length > 0) {
            html += '<div class="hit-badge-row">';
            match_types.forEach(matchType => {
                const matchText = matchType.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                html += `<span class="hit-badge hit-badge-match">${matchText}</span>`;
            });
            html += '</div>';
        }
        
        // Other badges row
        if (otherBadges.length > 0) {
            html += '<div class="hit-badge-row">';
            otherBadges.forEach(badge => {
                html += `<span class="hit-badge hit-badge-default">${badge}</span>`;
            });
            html += '</div>';
        }
        
        html += `
                    </div>
                </div>
                <div class="screening-hit-body">
                    <div class="hit-main-column">
        `;
        
        // Date of Birth
        if (dob) {
            html += `<div class="hit-info-row"><span class="hit-info-label">Date of Birth:</span> <span class="hit-info-value">${dob}</span></div>`;
        }
        
        // Positions - show all
        if (positions && positions.length > 0) {
            html += `<div class="hit-info-row"><span class="hit-info-label">Position${positions.length > 1 ? 's' : ''}:</span> <span class="hit-info-value">${positions.join(', ')}</span></div>`;
        }
        
        // AKA - show all
        if (aka && aka.length > 0) {
            html += `<div class="hit-info-row"><span class="hit-info-label">Also Known As:</span> <span class="hit-info-value">${aka.join(', ')}</span></div>`;
        }
        
        // Countries with flag emojis - show all
        if (countries && countries.length > 0) {
            html += `<div class="hit-info-row"><span class="hit-info-label">Countries:</span> <div class="hit-countries">`;
            countries.forEach(country => {
                const flagEmoji = this.getCountryFlag(country);
                html += `<span class="country-tag">${flagEmoji} ${country}</span>`;
            });
            html += `</div></div>`;
        }
        
        // Number of sources
        if (fields && fields.length > 0) {
            html += `<div class="hit-info-row"><span class="hit-info-label">Data Sources:</span> <span class="hit-info-value">${fields.length} source${fields.length !== 1 ? 's' : ''}</span></div>`;
        }
        
        // Media articles - expandable
        if (media && media.length > 0) {
            html += `
                <div class="hit-info-row hit-media-section">
                    <span class="hit-info-label">Media Articles:</span> 
                    <span class="hit-info-value hit-media-toggle" onclick="document.getElementById('${uniqueId}-media').classList.toggle('expanded'); event.stopPropagation();">
                        ${media.length} article${media.length !== 1 ? 's' : ''} &#x25BC;
                    </span>
                </div>
                <div id="${uniqueId}-media" class="hit-media-list">
            `;
            // Show first 10 articles
            media.slice(0, 10).forEach((article, idx) => {
                const date = article.date && article.date !== '0001-01-01T00:00:00Z' ? new Date(article.date).toLocaleDateString() : 'Unknown date';
                const title = article.title || 'Untitled';
                const snippet = article.snippet ? article.snippet.substring(0, 200) + '...' : '';
                const url = article.url || '';
                html += `
                    <div class="media-article">
                        ${url ? `<a href="${url}" target="_blank" class="media-article-title" onclick="event.stopPropagation(); window.open('${url}', '_blank', 'width=900,height=700,scrollbars=yes,resizable=yes'); return false;">${title}</a>` : `<div class="media-article-title">${title}</div>`}
                        ${snippet ? `<div class="media-article-snippet">${snippet}</div>` : ''}
                        <div class="media-article-date">${date}</div>
                    </div>
                `;
            });
            
            // Additional articles shown when expanded
            if (media.length > 10) {
                html += `<div id="${uniqueId}-media-extra" class="hit-media-list-extra">`;
                media.slice(10).forEach((article, idx) => {
                    const date = article.date && article.date !== '0001-01-01T00:00:00Z' ? new Date(article.date).toLocaleDateString() : 'Unknown date';
                    const title = article.title || 'Untitled';
                    const snippet = article.snippet ? article.snippet.substring(0, 200) + '...' : '';
                    const url = article.url || '';
                    html += `
                        <div class="media-article">
                            ${url ? `<a href="${url}" target="_blank" class="media-article-title" onclick="event.stopPropagation(); window.open('${url}', '_blank', 'width=900,height=700,scrollbars=yes,resizable=yes'); return false;">${title}</a>` : `<div class="media-article-title">${title}</div>`}
                            ${snippet ? `<div class="media-article-snippet">${snippet}</div>` : ''}
                            <div class="media-article-date">${date}</div>
                        </div>
                    `;
                });
                html += `</div>`;
                html += `<div class="media-article-more" onclick="document.getElementById('${uniqueId}-media-extra').classList.toggle('expanded'); this.textContent = this.textContent.startsWith('+') ? 'Show less' : '+ ${media.length - 10} more article${media.length - 10 !== 1 ? 's' : ''}'; event.stopPropagation();">+ ${media.length - 10} more article${media.length - 10 !== 1 ? 's' : ''}</div>`;
            }
            html += `</div>`;
        }
        
        html += `
                    </div>
        `;
        
        // Associates column
        if (associates && associates.length > 0) {
            const hasMany = associates.length >= 6;
            html += `
                    <div class="hit-associates-column${hasMany ? ' has-many' : ''}">
                        <div class="associates-header">Associates (${associates.length})</div>
                        <div class="associates-grid">
            `;
            associates.forEach(assoc => {
                const assocName = assoc.name || 'Unknown';
                const assocRelation = assoc.association || 'Unknown relation';
                html += `
                    <div class="associate-card">
                        <span class="associate-name">${assocName}</span>
                        <span class="associate-badge">${assocRelation}</span>
                    </div>
                `;
            });
            html += `
                        </div>
                    </div>
            `;
        }
        
        // Dismissal information (if hit was dismissed)
        if (isDismissed) {
            const dismissalDate = new Date(dismissal.timestamp).toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
            const dismissalTime = new Date(dismissal.timestamp).toLocaleTimeString('en-GB', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Format user name
            const dismissedBy = dismissal.userName || dismissal.user || 'Unknown';
            const formattedUser = dismissedBy
                .split(/[-._@]/)
                .slice(0, -1) // Remove domain
                .map(part => part.charAt(0).toUpperCase() + part.slice(1).toLowerCase())
                .join(' ');
            
            html += `
                <div class="dismissal-info-section">
                    <div class="dismissal-info-header">
                        <svg viewBox="0 0 300 300" style="width: 16px; height: 16px; margin-right: 6px;"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>
                        <strong>Dismissed by ${formattedUser}</strong>
                        <span class="dismissal-date">${dismissalDate} at ${dismissalTime}</span>
                    </div>
                    <div class="dismissal-reason">${dismissal.reason}</div>
                </div>
            `;
        }
        
        html += `
                </div>
            </div>
        `;
        
        return html;
    }
    
    getCountryFlag(countryName) {
        // Map country names to flag emojis
        const flagMap = {
            'United Kingdom': '&#xD83C;&#xDDEC;&#xD83C;&#xDDE7;', 'UK': '&#xD83C;&#xDDEC;&#xD83C;&#xDDE7;', 'Great Britain': '&#xD83C;&#xDDEC;&#xD83C;&#xDDE7;', 'GB': '&#xD83C;&#xDDEC;&#xD83C;&#xDDE7;',
            'United States': '&#xD83C;&#xDDFA;&#xD83C;&#xDDF8;', 'USA': '&#xD83C;&#xDDFA;&#xD83C;&#xDDF8;', 'US': '&#xD83C;&#xDDFA;&#xD83C;&#xDDF8;',
            'France': '&#xD83C;&#xDDEB;&#xD83C;&#xDDF7;', 'FR': '&#xD83C;&#xDDEB;&#xD83C;&#xDDF7;',
            'Germany': '&#xD83C;&#xDDE9;&#xD83C;&#xDDEA;', 'DE': '&#xD83C;&#xDDE9;&#xD83C;&#xDDEA;',
            'Spain': '&#xD83C;&#xDDEA;&#xD83C;&#xDDF8;', 'ES': '&#xD83C;&#xDDEA;&#xD83C;&#xDDF8;',
            'Italy': '&#xD83C;&#xDDEE;&#xD83C;&#xDDF9;', 'IT': '&#xD83C;&#xDDEE;&#xD83C;&#xDDF9;',
            'Belgium': '&#xD83C;&#xDDE7;&#xD83C;&#xDDEA;', 'BE': '&#xD83C;&#xDDE7;&#xD83C;&#xDDEA;',
            'Brazil': '&#xD83C;&#xDDE7;&#xD83C;&#xDDF7;', 'BR': '&#xD83C;&#xDDE7;&#xD83C;&#xDDF7;',
            'Iran': '&#xD83C;&#xDDEE;&#xD83C;&#xDDF7;', 'IR': '&#xD83C;&#xDDEE;&#xD83C;&#xDDF7;',
            'Japan': '&#xD83C;&#xDDEF;&#xD83C;&#xDDF5;', 'JP': '&#xD83C;&#xDDEF;&#xD83C;&#xDDF5;',
            'Malta': '&#xD83C;&#xDDF2;&#xD83C;&#xDDF9;', 'MT': '&#xD83C;&#xDDF2;&#xD83C;&#xDDF9;',
            'Sri Lanka': '&#xD83C;&#xDDF1;&#xD83C;&#xDDF0;', 'LK': '&#xD83C;&#xDDF1;&#xD83C;&#xDDF0;',
            'Ireland': '&#xD83C;&#xDDEE;&#xD83C;&#xDDEA;', 'IE': '&#xD83C;&#xDDEE;&#xD83C;&#xDDEA;'
        };
        return flagMap[countryName] || '&#xD83C;&#xDF0D;';
    }

    handleCheckImages(images) {
        if (!Array.isArray(images)) {
            return;
        }

        const groupedByTransaction = {};
        images.forEach(image => {
            const transactionId = image?.transactionId || image?.thirdfortTransactionId;
            if (!transactionId) return;
            if (!groupedByTransaction[transactionId]) {
                groupedByTransaction[transactionId] = [];
            }
            groupedByTransaction[transactionId].push({
                ...image,
                url: image.url || image.liveUrl || '',
                recordedAt: this.extractIdentityTimestamp(image)
            });
        });

        Object.keys(groupedByTransaction).forEach(transactionId => {
            const normalized = this.normalizeIdentityImages(groupedByTransaction[transactionId]);
            this.checkIdentityImages[transactionId] = normalized;

            const check = this.checks.find(c => c.transactionId === transactionId);
            if (check) {
                check.identityImages = normalized;
            }

            if (this.currentCheck && this.currentCheck.transactionId === transactionId) {
                this.currentCheck.identityImages = normalized;
                this.renderDetailView(this.currentCheck);
            }
        });
    }

    formatFundingLabel(value) {
        if (value === undefined || value === null) return '';
        if (typeof value !== 'string') value = String(value);
        const trimmed = value.trim();
        if (!trimmed) return '';
        const acronyms = new Set(['hsbc', 'tsb', 'rbs', 'uk', 'usa', 'isa', 'lisa', 'htb', 'aml', 'sow', 'kyc', 'pep', 'ltd']);
        return trimmed.split(/[\s_\-]+/).map(part => {
            const lower = part.toLowerCase();
            if (acronyms.has(lower) || lower.length <= 3) {
                return lower.toUpperCase();
            }
            return lower.charAt(0).toUpperCase() + lower.slice(1);
        }).join(' ');
    }

    formatFundingFrequency(value) {
        if (!value) return '';
        return this.formatFundingLabel(value);
    }

    formatCurrencyMinor(amount, { fallback = 'Not provided', currency = '&#xA3;' } = {}) {
        if (typeof amount !== 'number' || Number.isNaN(amount)) return fallback;
        const isWhole = amount % 100 === 0;
        const absolute = amount / 100;
        const options = {
            minimumFractionDigits: isWhole ? 0 : 2,
            maximumFractionDigits: isWhole ? 0 : 2
        };
        return `${currency}${absolute.toLocaleString('en-GB', options)}`;
    }

    formatShortDate(value) {
        if (!value) return '';
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) return '';
        return date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
    }

    getIso2FromLocation(location) {
        if (!location) return '';
        const trimmed = location.trim();
        if (!trimmed) return '';
        const upper = trimmed.toUpperCase();
        const iso3ToIso2 = {
            'GBR': 'GB',
            'IRL': 'IE',
            'USA': 'US',
            'CAN': 'CA',
            'AUS': 'AU',
            'NZL': 'NZ',
            'FRA': 'FR',
            'DEU': 'DE',
            'ESP': 'ES',
            'ITA': 'IT',
            'PRT': 'PT',
            'CHE': 'CH',
            'SGP': 'SG',
            'HKG': 'HK',
            'ARE': 'AE',
            'QAT': 'QA',
            'BHR': 'BH',
            'KWT': 'KW',
            'SAU': 'SA',
            'ZAF': 'ZA',
            'BRA': 'BR',
            'ARG': 'AR',
            'MEX': 'MX',
            'BEL': 'BE',
            'NLD': 'NL',
            'SWE': 'SE',
            'NOR': 'NO',
            'DNK': 'DK',
            'POL': 'PL',
            'CZE': 'CZ',
            'HUN': 'HU',
            'ROU': 'RO',
            'ISL': 'IS',
            'JPN': 'JP',
            'CHN': 'CN',
            'IND': 'IN',
            'PAK': 'PK',
            'KEN': 'KE',
            'GHA': 'GH',
            'NGA': 'NG',
            'UGA': 'UG',
            'ZMB': 'ZM',
            'ZWE': 'ZW'
        };
        if (iso3ToIso2[upper]) return iso3ToIso2[upper];
        if (upper.length === 2) return upper;
        const nameToIso2 = {
            'UNITED KINGDOM': 'GB',
            'GREAT BRITAIN': 'GB',
            'ENGLAND': 'GB',
            'SCOTLAND': 'GB',
            'WALES': 'GB',
            'NORTHERN IRELAND': 'GB',
            'UK': 'GB',
            'UNITED STATES': 'US',
            'UNITED STATES OF AMERICA': 'US',
            'AMERICA': 'US',
            'IRELAND': 'IE',
            'REPUBLIC OF IRELAND': 'IE',
            'FRANCE': 'FR',
            'GERMANY': 'DE',
            'SPAIN': 'ES',
            'ITALY': 'IT',
            'PORTUGAL': 'PT',
            'AUSTRALIA': 'AU',
            'CANADA': 'CA',
            'NEW ZEALAND': 'NZ',
            'SINGAPORE': 'SG',
            'HONG KONG': 'HK',
            'SWITZERLAND': 'CH',
            'SOUTH AFRICA': 'ZA',
            'INDIA': 'IN',
            'JAPAN': 'JP',
            'UNITED ARAB EMIRATES': 'AE',
            'UAE': 'AE'
        };
        if (nameToIso2[upper]) return nameToIso2[upper];
        return '';
    }

    countryCodeToEmoji(code) {
        if (!code || code.length !== 2) return '';
        return code.toUpperCase().split('').map(char => {
            const base = 127397;
            return String.fromCodePoint(base + char.charCodeAt(0));
        }).join('');
    }

    getLocationDisplay(location) {
        if (!location) return '';
        const trimmed = location.trim();
        if (!trimmed) return '';
        const iso2 = this.getIso2FromLocation(trimmed);
        const upper = trimmed.toUpperCase();
        const displayCode = upper.length === 2 || upper.length === 3 ? upper : (iso2 || upper);
        if (!displayCode) return '';
        const flag = iso2 ? this.countryCodeToEmoji(iso2) : '';
        return `${flag || '&#xD83C;&#xDF0D;'} ${displayCode}`;
    }

    getFundingOriginBadge(location) {
        const display = this.getLocationDisplay(location);
        if (!display) return '';
        return `<span class="funding-origin-badge">${display}</span>`;
    }

    renderMetaRow(label, value, { raw = false, className = '' } = {}) {
        if (value === undefined || value === null) return '';
        let content = raw ? value : String(value);
        if (!raw) {
            content = content.trim();
            if (!content) return '';
        }
        return `<div class="funding-meta-row${className ? ' ' + className : ''}"><span class="funding-meta-label">${label}</span><span class="funding-meta-value">${content}</span></div>`;
    }

    renderOriginMetaRow(location) {
        const badge = this.getFundingOriginBadge(location);
        if (!badge) return '';
        return this.renderMetaRow('Origin', badge, { raw: true });
    }

    getDocumentCount(outcome) {
        if (!outcome) return 0;
        if (Array.isArray(outcome.documents)) return outcome.documents.length;
        if (Array.isArray(outcome.breakdown?.documents)) return outcome.breakdown.documents.length;
        if (typeof outcome.breakdown?.document_count === 'number') return outcome.breakdown.document_count;
        if (typeof outcome.data?.document_count === 'number') return outcome.data.document_count;
        if (Array.isArray(outcome.data?.documents)) return outcome.data.documents.length;
        return 0;
    }

    formatFundingLabel(value) {
        if (value === undefined || value === null) return '';
        if (typeof value !== 'string') {
            value = String(value);
        }
        const trimmed = value.trim();
        if (!trimmed) {
            return '';
        }
        const acronyms = new Set(['hsbc', 'tsb', 'rbs', 'lloyds', 'natwest', 'uk', 'usa', 'isa', 'lisa', 'psa', 'sow', 'aml', 'ftb', 'htb', 'fca', 'sra']);
        return trimmed.split(/[\s_\-]+/).map(part => {
            const lower = part.toLowerCase();
            if (acronyms.has(lower) || lower.length <= 3) {
                return lower.toUpperCase();
            }
            return lower.charAt(0).toUpperCase() + lower.slice(1);
        }).join(' ');
    }

    formatFundingFrequency(value) {
        if (!value) return '';
        return this.formatFundingLabel(value);
    }

    formatCurrencyMinor(amount, { fallback = 'Not provided', currency = '&#xA3;' } = {}) {
        if (typeof amount !== 'number' || Number.isNaN(amount)) {
            return fallback;
        }
        const isWhole = amount % 100 === 0;
        const absolute = amount / 100;
        const options = {
            minimumFractionDigits: isWhole ? 0 : 2,
            maximumFractionDigits: isWhole ? 0 : 2
        };
        return `${currency}${absolute.toLocaleString('en-GB', options)}`;
    }

    formatShortDate(value) {
        if (!value) return '';
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) {
            return '';
        }
        return date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
    }

    getIso2FromLocation(location) {
        if (!location) return '';
        const trimmed = location.trim();
        if (!trimmed) return '';
        const upper = trimmed.toUpperCase();
        const iso3ToIso2 = {
            'GBR': 'GB',
            'IRL': 'IE',
            'USA': 'US',
            'CAN': 'CA',
            'AUS': 'AU',
            'NZL': 'NZ',
            'FRA': 'FR',
            'DEU': 'DE',
            'ESP': 'ES',
            'ITA': 'IT',
            'PRT': 'PT',
            'CHE': 'CH',
            'SGP': 'SG',
            'HKG': 'HK',
            'ARE': 'AE',
            'QAT': 'QA',
            'BHR': 'BH',
            'KWT': 'KW',
            'SAU': 'SA',
            'ZAF': 'ZA',
            'BRA': 'BR',
            'ARG': 'AR',
            'MEX': 'MX',
            'BEL': 'BE',
            'NLD': 'NL',
            'SWE': 'SE',
            'NOR': 'NO',
            'DNK': 'DK',
            'POL': 'PL',
            'CZE': 'CZ',
            'HUN': 'HU',
            'ROU': 'RO',
            'ISL': 'IS',
            'JPN': 'JP',
            'CHN': 'CN',
            'IND': 'IN',
            'PAK': 'PK',
            'KEN': 'KE',
            'GHA': 'GH',
            'NGA': 'NG',
            'UGA': 'UG',
            'ZMB': 'ZM',
            'ZWE': 'ZW'
        };
        if (iso3ToIso2[upper]) {
            return iso3ToIso2[upper];
        }
        if (upper.length === 2) {
            return upper;
        }
        const nameToIso2 = {
            'UNITED KINGDOM': 'GB',
            'GREAT BRITAIN': 'GB',
            'ENGLAND': 'GB',
            'SCOTLAND': 'GB',
            'WALES': 'GB',
            'NORTHERN IRELAND': 'GB',
            'UK': 'GB',
            'UNITED STATES': 'US',
            'UNITED STATES OF AMERICA': 'US',
            'AMERICA': 'US',
            'IRELAND': 'IE',
            'REPUBLIC OF IRELAND': 'IE',
            'FRANCE': 'FR',
            'GERMANY': 'DE',
            'SPAIN': 'ES',
            'ITALY': 'IT',
            'PORTUGAL': 'PT',
            'AUSTRALIA': 'AU',
            'CANADA': 'CA',
            'NEW ZEALAND': 'NZ',
            'SINGAPORE': 'SG',
            'HONG KONG': 'HK',
            'SWITZERLAND': 'CH',
            'SOUTH AFRICA': 'ZA',
            'INDIA': 'IN',
            'JAPAN': 'JP',
            'UNITED ARAB EMIRATES': 'AE',
            'UAE': 'AE'
        };
        if (nameToIso2[upper]) {
            return nameToIso2[upper];
        }
        return '';
    }

    countryCodeToEmoji(code) {
        if (!code || code.length !== 2) return '';
        return code.toUpperCase().split('').map(char => {
            const base = 127397;
            return String.fromCodePoint(base + char.charCodeAt(0));
        }).join('');
    }

    getLocationDisplay(location) {
        if (!location) return '';
        const trimmed = location.trim();
        if (!trimmed) return '';
        const iso2 = this.getIso2FromLocation(trimmed);
        const upper = trimmed.toUpperCase();
        const displayCode = upper.length === 2 || upper.length === 3 ? upper : (iso2 || upper);
        if (!displayCode) return '';
        const flag = iso2 ? this.countryCodeToEmoji(iso2) : '';
        return `${flag || '&#xD83C;&#xDF0D;'} ${displayCode}`;
    }

    getFundingOriginBadge(location) {
        const display = this.getLocationDisplay(location);
        if (!display) return '';
        return `<span class="funding-origin-badge">${display}</span>`;
    }

    renderMetaRow(label, value, { raw = false, className = '' } = {}) {
        if (value === undefined || value === null) return '';
        let content = raw ? value : String(value);
        if (!raw) {
            content = content.trim();
            if (!content) return '';
        }
        return `<div class="funding-meta-row${className ? ' ' + className : ''}"><span class="funding-meta-label">${label}</span><span class="funding-meta-value">${content}</span></div>`;
    }

    renderOriginMetaRow(location) {
        const badge = this.getFundingOriginBadge(location);
        if (!badge) return '';
        return this.renderMetaRow('Origin', badge, { raw: true });
    }

    getDocumentCount(outcome) {
        if (!outcome) return 0;
        if (Array.isArray(outcome.documents)) {
            return outcome.documents.length;
        }
        if (Array.isArray(outcome.breakdown?.documents)) {
            return outcome.breakdown.documents.length;
        }
        if (typeof outcome.breakdown?.document_count === 'number') {
            return outcome.breakdown.document_count;
        }
        if (typeof outcome.data?.document_count === 'number') {
            return outcome.data.document_count;
        }
        if (Array.isArray(outcome.data?.documents)) {
            return outcome.data.documents.length;
        }
        return 0;
    }
    
    deduplicatePeople(owners, officers) {
        // Remove owners who are already listed as officers (same person in multiple roles)
        // Match by name and date of birth (if available)
        if (!officers || !Array.isArray(officers) || officers.length === 0) {
            return owners;
        }
        
        const officerNames = new Set();
        officers.forEach(officer => {
            const name = officer.name?.toLowerCase().trim();
            const dob = officer.dob;
            if (name) {
                // Create a unique key combining name and DOB (if available)
                const key = dob ? `${name}|${dob}` : name;
                officerNames.add(key);
            }
        });
        
        return owners.filter(owner => {
            const name = (owner.fullName || owner.organizationName || '').toLowerCase().trim();
            const dob = owner.dateOfBirth;
            if (!name) return true; // Keep if no name
            
            const key = dob ? `${name}|${dob}` : name;
            return !officerNames.has(key);
        });
    }
    
    formatNatureOfControl(controlTypes) {
        // Simplify long nature of control descriptions
        if (!controlTypes || !Array.isArray(controlTypes) || controlTypes.length === 0) {
            return '';
        }
        
        return controlTypes.map(control => {
            // Simplify common patterns
            return control
                .replace(/Ownership of (\d+% to \d+%|\d+%) of voting rights/gi, '$1 voting rights')
                .replace(/Right to share (\d+% to \d+%|\d+%) of surplus assets/gi, '$1 surplus assets')
                .replace(/Right to appoint and remove directors/gi, 'Appoint/remove directors')
                .replace(/Right to appoint and remove members/gi, 'Appoint/remove members')
                .replace(/Significant influence or control/gi, 'Significant influence')
                .replace(/of a limited liability partnership/gi, '(LLP)')
                .replace(/of a company/gi, '');
        }).join('; ');
    }
    
    calculateRiskLevel(hit, updateType) {
        // For sanctions, always show as critical
        if (updateType === 'sanctions') {
            return '<span class="risk-level critical">CRITICAL</span>';
        }
        
        // For PEP, categorize based on position (following ComplyAdvantage levels)
        const position = (hit.position || '').toLowerCase();
        
        // Level 1: High Risk - Heads of state, government, national parliament
        const level1Keywords = ['head of state', 'head of government', 'royal family', 'president', 'prime minister', 
                               'minister', 'member of parliament', 'mp ', 'senator', 'central bank', 'military', 
                               'judiciary', 'supreme court', 'political party'];
        if (level1Keywords.some(kw => position.includes(kw))) {
            return '<span class="risk-level level-1">LEVEL 1</span>';
        }
        
        // Level 2: Medium Risk - Regional government, international organizations, diplomats
        const level2Keywords = ['regional', 'ambassador', 'consul', 'diplomat', 'international', 'supranational', 
                               'united nations', 'european commission', 'high commissioner'];
        if (level2Keywords.some(kw => position.includes(kw))) {
            return '<span class="risk-level level-2">LEVEL 2</span>';
        }
        
        // Level 3: Medium Risk - State-owned enterprises, regional institutions
        const level3Keywords = ['state-owned', 'state owned', 'regional government', 'agency head', 
                               'board of directors'];
        if (level3Keywords.some(kw => position.includes(kw))) {
            return '<span class="risk-level level-3">LEVEL 3</span>';
        }
        
        // Level 4: Low Risk - Local government, local judiciary
        return '<span class="risk-level level-4">LEVEL 4</span>';
    }
    
    getHintIcon(level) {
        const icons = {
            // Info icon (blue square with i)
            info: `<svg viewBox="0 0 156.11 156.11" xmlns="http://www.w3.org/2000/svg"><g><path fill="none" stroke="#1d71b8" stroke-linecap="round" stroke-linejoin="round" stroke-width="8.11" d="M152.05 9.72v136.66a5.67 5.67 0 0 1-5.67 5.67H9.72a5.67 5.67 0 0 1-5.67-5.67V9.72a5.67 5.67 0 0 1 5.67-5.67h136.66a5.67 5.67 0 0 1 5.67 5.67"/><path d="M88.45 39.72c.12 4.61-1.43 8.2-4.65 10.78-7.39 2.94-12.61 1.14-15.68-5.39-1.63-7.35.98-12.08 7.84-14.21 6.74-.12 10.9 2.82 12.49 8.82M73.02 58.34h14.21v66.87H68.86V58.34z" fill="#1d71b8"/></g></svg>`,
            // Warning/Consider icon (orange triangle with !)
            warning: `<svg viewBox="0 0 159.77 154.5" xmlns="http://www.w3.org/2000/svg"><g><path stroke="#f39200" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="8.5" d="m79.88 4.25-75.63 146h151.27z"/><path d="M73.63 124c0-3.37 2.78-6.35 6.25-6.35s6.25 2.98 6.25 6.35-2.78 6.25-6.25 6.25-6.25-2.88-6.25-6.25Zm11.71-56.95c0 3.67-1.09 13.1-2.38 26.99l-1.29 13.79H78.1l-1.29-13.79c-1.29-13.89-2.38-23.32-2.38-26.99 0-4.27 2.08-6.05 5.46-6.05s5.46 1.79 5.46 6.05Z" fill="#f39200" stroke-miterlimit="10" stroke-width="5.67" stroke="#f39200"/></g></svg>`,
            // Alert/Fail icon (red circle with X cross)
            alert: `<svg viewBox="0 0 156.11 156.11" xmlns="http://www.w3.org/2000/svg"><g><path stroke="#e30613" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke-width="8.11" d="M152.05 78.05c0 40.87-33.13 74-74 74q0 0 0 0c-40.87 0-74-33.13-74-74q0 0 0 0c0-40.87 33.13-74 74-74q0 0 0 0c40.87 0 74 33.13 74 74"/><path fill="#1d1d1b" stroke-width="11.34" stroke="#e30613" stroke-linecap="round" stroke-linejoin="round" d="m44.82 44.82 66.47 66.47"/><path fill="#1d1d1b" stroke-width="11.34" stroke="#e30613" stroke-linecap="round" stroke-linejoin="round" d="m111.29 44.82-66.47 66.47"/></g></svg>`
        };
        return icons[level] || '';
    }
    
    getTaskTitle(taskType) {
        const titles = {
            'address': 'Address Verification',
            'footprint': 'Digital Footprint',
            'screening': 'Screening',
            'peps': 'PEP Screening',
            'sanctions': 'Sanctions Screening',
            'identity': 'Identity Verification',
            'identity:lite': 'Document Verification',
            'nfc': 'NFC Chip Verification',
            'liveness': 'Liveness Check',
            'facial_similarity': 'Facial Similarity',
            'document': 'Document Authenticity',
            'sof:v1': 'Source of Funds Questionnaire',
            'bank': 'Bank Summary',
            'bank:statement': 'Bank Summary',
            'bank:summary': 'Bank Summary',
            'documents:poa': 'Proof of Address',
            'documents:poo': 'Proof of Ownership',
            'documents:savings': 'Proof of Savings',
            'documents:cryptocurrency': 'Proof of Cryptocurrency',
            'documents:other': 'Additional Documents',
            'company:summary': 'Company Summary',
            'company:sanctions': 'Company Sanctions',
            'company:peps': 'Company PEP Screening',
            'company:ubo': 'Ultimate Beneficial Owner',
            'company:beneficial-check': 'PSC Extract',
            'company:shareholders': 'Shareholders'
        };
        return titles[taskType] || taskType;
    }
    
    getTaskSummary(taskType, outcome) {
        const result = outcome.result;
        
        if (result === 'clear') {
            return 'All checks sufficient';
        } else if (result === 'consider') {
            return 'Some concerns identified - review required';
        } else if (result === 'fail') {
            return 'Verification failed - manual review required';
        }
        
        return 'Processing...';
    }
    
    getTaskChecks(taskType, outcome, check) {
        const checks = [];
        const data = outcome.data || {};
        
        // Task-specific checks based on type
        if (taskType === 'document') {
            // Document objectives: authenticity, integrity, compromised, consistency, validation
            if (data.authenticity) {
                const isGenuine = data.authenticity === 'genuine';
                checks.push({
                    status: isGenuine ? 'CL' : 'AL',
                    text: `Authenticity: ${data.authenticity}`
                });
            }
            
            if (data.integrity) {
                const isPassed = data.integrity === 'passed';
                checks.push({
                    status: isPassed ? 'CL' : 'AL',
                    text: `Integrity: ${data.integrity}`
                });
            }
            
            if (data.compromised) {
                const isNotCompromised = data.compromised === 'no' || data.compromised === 'false';
                checks.push({
                    status: isNotCompromised ? 'CL' : 'AL',
                    text: `Compromised check: ${data.compromised}`
                });
            }
            
            if (data.consistency) {
                checks.push({
                    status: data.consistency === 'consistent' ? 'CL' : 'CO',
                    text: `Consistency: ${data.consistency}`
                });
            }
            
            if (data.validation) {
                checks.push({
                    status: data.validation === 'valid' ? 'CL' : 'AL',
                    text: `Validation: ${data.validation}`
                });
            }
        }
        else if (taskType === 'facial_similarity') {
            // Facial similarity objectives: comparison, authenticity, integrity, variant
            if (data.comparison) {
                const isGoodMatch = data.comparison === 'good_match';
                checks.push({
                    status: isGoodMatch ? 'CL' : 'CO',
                    text: `Comparison: ${data.comparison.replace('_', ' ')}`
                });
            }
            
            if (data.authenticity) {
                checks.push({
                    status: data.authenticity === 'genuine' ? 'CL' : 'AL',
                    text: `Authenticity: ${data.authenticity}`
                });
            }
            
            if (data.integrity) {
                checks.push({
                    status: data.integrity === 'passed' ? 'CL' : 'AL',
                    text: `Integrity: ${data.integrity}`
                });
            }
            
            if (data.variant) {
                checks.push({
                    status: 'CN',
                    text: `Variant: ${data.variant}`
                });
            }
        }
        else if (taskType === 'peps' || taskType === 'sanctions' || 
                 taskType === 'company:peps' || taskType === 'company:sanctions') {
            const breakdown = outcome.breakdown || {};
            const totalHits = breakdown.total_hits || data.total_hits || 0;
            const hits = breakdown.hits || data.hits || [];
            const matches = breakdown.matches || data.matches || [];
            
            checks.push({
                status: totalHits === 0 ? 'CL' : 'CO',
                text: `${totalHits} match${totalHits !== 1 ? 'es' : ''} found`
            });
            
            // Show individual hits if available
            const hitsList = hits.length > 0 ? hits : matches;
            if (hitsList.length > 0) {
                hitsList.forEach(hit => {
                    const name = hit.name || 'Unknown';
                    const list = hit.sanctions_list || hit.position || '';
                    const country = hit.country || '';
                    const reason = hit.reason || hit.relationship || '';
                    
                    let hitText = name;
                    if (list) hitText += ` - ${list}`;
                    if (country) hitText += ` [${country}]`;
                    if (reason) hitText += ` | ${reason}`;
                    
                    checks.push({
                        status: 'CO',
                        text: hitText,
                        indented: true
                    });
                });
            }
            
            if (data.monitored !== undefined || breakdown.monitored !== undefined) {
                const isMonitored = data.monitored || breakdown.monitored;
                checks.push({
                    status: isMonitored ? 'CL' : 'AL',
                    text: isMonitored ? 'Ongoing monitoring enabled' : 'Monitoring disabled'
                });
            }
        }
        else if (taskType === 'nfc') {
            // NFC chip verification with detailed breakdown
            const breakdown = outcome.breakdown || {};
            
            // Check for chip data
            if (breakdown.chip) {
                const chipBreakdown = breakdown.chip.breakdown || {};
                
                // Clone detection
                if (chipBreakdown.clone_detection) {
                    const result = chipBreakdown.clone_detection.result || '';
                    checks.push({
                        status: result === 'clear' ? 'CL' : 'AL',
                        text: 'Clone Detection'
                    });
                }
                
                // Chip verification
                if (chipBreakdown.verification) {
                    const result = chipBreakdown.verification.result || '';
                    checks.push({
                        status: result === 'clear' ? 'CL' : 'AL',
                        text: 'Chip Verification'
                    });
                }
            }
            
            // Data comparison
            if (breakdown.data_comparison) {
                const compBreakdown = breakdown.data_comparison.breakdown || {};
                
                // DOB comparison
                if (compBreakdown.dob) {
                    const result = compBreakdown.dob.result || '';
                    const daysDiff = compBreakdown.dob.properties?.days_difference;
                    let text = 'Date of Birth Match';
                    if (daysDiff !== undefined && daysDiff !== 0) {
                        text += ` (${daysDiff} days difference)`;
                    }
                    checks.push({
                        status: result === 'clear' ? 'CL' : 'CO',
                        text: text
                    });
                }
                
                // Name comparison
                if (compBreakdown.name) {
                    const result = compBreakdown.name.result || '';
                    const levenshtein = compBreakdown.name.properties?.levenshtein_pct;
                    let text = 'Name Match';
                    if (levenshtein !== undefined) {
                        text += ` (${levenshtein}% similarity)`;
                    }
                    checks.push({
                        status: result === 'clear' ? 'CL' : 'CO',
                        text: text
                    });
                }
            }
            
            // Fallback for simple data
            if (!breakdown.chip && !breakdown.data_comparison && data.chip_read !== undefined) {
                checks.push({
                    status: data.chip_read ? 'CL' : 'AL',
                    text: data.chip_read ? 'NFC chip successfully read' : 'Could not read NFC chip'
                });
            }
        }
        else if (taskType === 'biometrics') {
            // Biometric verification (liveness detection)
            const breakdown = outcome.breakdown || {};
            
            if (breakdown.attempts && Array.isArray(breakdown.attempts) && breakdown.attempts.length > 0) {
                breakdown.attempts.forEach((attempt, index) => {
                    const passed = attempt.passed;
                    const status_val = attempt.status || '';
                    checks.push({
                        status: passed ? 'CL' : 'AL',
                        text: `Liveness Attempt ${index + 1}: ${status_val === 'complete' ? 'Completed' : status_val}`
                    });
                });
            } else {
                // Simple status
                checks.push({
                    status: outcome.result === 'clear' ? 'CL' : 'CO',
                    text: outcome.result === 'clear' ? 'Biometric verification passed' : 'Biometric verification requires review'
                });
            }
        }
        else if (taskType === 'identity') {
            // Identity verification (overall check) with detailed breakdown
            const breakdown = outcome.breakdown || {};
            
            // Add header checks for NFC and Biometrics status
            const nfcTask = breakdown.nfc;
            const biometricsTask = breakdown.biometrics;
            
            // Check if Enhanced ID was requested
            const requestTasks = check.thirdfortResponse?.request?.tasks || [];
            const identityRequest = requestTasks.find(t => t.type === 'report:identity');
            const nfcPreferred = identityRequest?.opts?.nfc === 'preferred';
            
            // If Enhanced ID was requested, show NFC status and Original ID status
            if (nfcPreferred) {
                // Show NFC status
                if (nfcTask?.status === 'unobtainable') {
                    checks.push({
                        status: 'CO',
                        text: 'NFC Scan unobtainable'
                    });
                } else if (nfcTask?.result === 'consider') {
                    checks.push({
                        status: 'CO',
                        text: 'NFC verification requires review'
                    });
                } else if (nfcTask?.result === 'clear') {
                    checks.push({
                        status: 'CL',
                        text: 'NFC Scan completed'
                    });
                }
                
                // Show Biometrics status if unobtainable
                if (biometricsTask?.status === 'unobtainable') {
                    checks.push({
                        status: 'CO',
                        text: 'Biometric Scan unobtainable'
                    });
                }
                
                // Always show Original ID completion status when Enhanced was requested
                if (breakdown.document) {
                    const docResult = breakdown.document.result || 'clear';
                    const docStatus = docResult === 'clear' ? 'CL' : (docResult === 'fail' ? 'AL' : 'CO');
                    checks.push({
                        status: docStatus,
                        text: 'Original ID completed'
                    });
                }
            }
            
            // 1. Document Verification (nested collapsible card)
            if (breakdown.document) {
                const docData = breakdown.document.data || {};
                const docBreakdown = breakdown.document.breakdown || {};
                let docResult = breakdown.document.result || '';
                
                // Recalculate document result based on breakdown categories
                if (Object.keys(docBreakdown).length > 0) {
                    let hasConsider = false;
                    let hasFail = false;
                    Object.values(docBreakdown).forEach(category => {
                        const catResult = category.result || '';
                        if (catResult === 'fail') hasFail = true;
                        if (catResult === 'consider') hasConsider = true;
                    });
                    if (hasFail) docResult = 'fail';
                    else if (hasConsider) docResult = 'consider';
                }
                
                const docObjectives = [];
                
                // Check for detailed breakdown structure (like Se's check)
                if (Object.keys(docBreakdown).length > 0) {
                    // Helper function to process category and show nested items when needed
                    const processCategory = (category, categoryName) => {
                        if (!category) return;
                        
                        const catBreakdown = category.breakdown || {};
                        const catResult = category.result || '';
                        
                        // If category has nested breakdown
                        if (Object.keys(catBreakdown).length > 0) {
                            // If parent category is consider/fail, show parent + ALL nested items indented
                            if (catResult !== 'clear') {
                                // Add parent category header
                                docObjectives.push({
                                    status: catResult === 'fail' ? 'AL' : 'CO',
                                    text: categoryName,
                                    isParent: true
                                });
                                
                                // Add all nested items indented
                                Object.entries(catBreakdown).forEach(([key, subCheck]) => {
                                    const subResult = subCheck.result || '';
                                    const formattedKey = key.replace(/_/g, ' ')
                                        .split(' ')
                                        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                                        .join(' ');
                                    docObjectives.push({
                                        status: subResult === 'clear' ? 'CL' : (subResult === 'fail' ? 'AL' : 'CO'),
                                        text: formattedKey,
                                        isIndented: true
                                    });
                                });
                            } else {
                                // Parent is clear - just show the category name
                                docObjectives.push({
                                    status: 'CL',
                                    text: categoryName
                                });
                            }
                        } else {
                            // No nested breakdown, show the category itself
                            docObjectives.push({
                                status: catResult === 'clear' ? 'CL' : (catResult === 'fail' ? 'AL' : 'CO'),
                                text: categoryName
                            });
                        }
                    };
                    
                    // Process all document categories
                    processCategory(docBreakdown.visual_authenticity, 'Visual Authenticity');
                    processCategory(docBreakdown.image_integrity, 'Image Integrity');
                    processCategory(docBreakdown.data_validation, 'Data Validation');
                    processCategory(docBreakdown.data_consistency, 'Data Consistency');
                    processCategory(docBreakdown.data_comparison, 'Data Comparison');
                    processCategory(docBreakdown.compromised_document, 'Compromised Check');
                    processCategory(docBreakdown.age_validation, 'Age Validation');
                    processCategory(docBreakdown.police_record, 'Police Record');
                } else if (Object.keys(docData).length > 0) {
                    // Simple data structure (like Benjamin's check)
                    if (docData.authenticity) {
                        docObjectives.push({ status: docData.authenticity === 'clear' ? 'CL' : 'AL', text: 'Authenticity' });
                    }
                    if (docData.integrity) {
                        docObjectives.push({ status: docData.integrity === 'clear' ? 'CL' : 'AL', text: 'Integrity' });
                    }
                    if (docData.compromised) {
                        docObjectives.push({ status: docData.compromised === 'clear' ? 'CL' : 'AL', text: 'Compromised Check' });
                    }
                    if (docData.consistency) {
                        docObjectives.push({ status: docData.consistency === 'clear' ? 'CL' : 'CO', text: 'Consistency' });
                    }
                    if (docData.validation) {
                        docObjectives.push({ status: docData.validation === 'clear' ? 'CL' : 'AL', text: 'Validation' });
                    }
                }
                
                checks.push({
                    isNestedCard: true,
                    title: 'Document Verification',
                    result: docResult,
                    items: docObjectives
                });
            }
            
            // 2. Facial Similarity (nested collapsible card)
            if (breakdown.facial_similarity || breakdown.facial_similarity_video) {
                // Prioritize facial_similarity_video if both exist (has more detailed breakdown)
                const faceTask = breakdown.facial_similarity_video || breakdown.facial_similarity;
                const faceData = faceTask.data || {};
                const faceBreakdown = faceTask.breakdown || {};
                const faceResult = faceTask.result || '';
                
                const faceObjectives = [];
                
                // Check for detailed breakdown structure (like Se's check)
                if (Object.keys(faceBreakdown).length > 0) {
                    // Detailed breakdown with categories and sub-checks
                    
                    // Face Comparison (with score if available)
                    if (faceBreakdown.face_comparison) {
                        const faceCompBreakdown = faceBreakdown.face_comparison.breakdown || {};
                        const faceCompResult = faceBreakdown.face_comparison.result || '';
                        
                        // Check for face_match with score
                        if (faceCompBreakdown.face_match) {
                            const score = faceCompBreakdown.face_match.properties?.score;
                            const scoreText = score ? ` (${(score * 100).toFixed(1)}% match)` : '';
                            faceObjectives.push({ 
                                status: faceCompBreakdown.face_match.result === 'clear' ? 'CL' : 'CO', 
                                text: `Face Match${scoreText}` 
                            });
                        } else {
                            faceObjectives.push({ 
                                status: faceCompResult === 'clear' ? 'CL' : 'CO', 
                                text: 'Face Comparison' 
                            });
                        }
                    }
                    
                    // Image Integrity (with sub-checks)
                    if (faceBreakdown.image_integrity) {
                        const imgIntBreakdown = faceBreakdown.image_integrity.breakdown || {};
                        
                        if (imgIntBreakdown.face_detected) {
                            faceObjectives.push({ 
                                status: imgIntBreakdown.face_detected.result === 'clear' ? 'CL' : 'AL', 
                                text: 'Face Detected' 
                            });
                        }
                        if (imgIntBreakdown.source_integrity) {
                            faceObjectives.push({ 
                                status: imgIntBreakdown.source_integrity.result === 'clear' ? 'CL' : 'AL', 
                                text: 'Source Integrity' 
                            });
                        }
                        
                        // If no sub-checks, show overall
                        if (Object.keys(imgIntBreakdown).length === 0) {
                            faceObjectives.push({ 
                                status: faceBreakdown.image_integrity.result === 'clear' ? 'CL' : 'AL', 
                                text: 'Image Integrity' 
                            });
                        }
                    }
                    
                    // Visual Authenticity (with sub-checks and scores)
                    if (faceBreakdown.visual_authenticity) {
                        const visAuthBreakdown = faceBreakdown.visual_authenticity.breakdown || {};
                        
                        if (visAuthBreakdown.liveness_detected) {
                            faceObjectives.push({ 
                                status: visAuthBreakdown.liveness_detected.result === 'clear' ? 'CL' : 'AL', 
                                text: 'Liveness Detected' 
                            });
                        }
                        if (visAuthBreakdown.spoofing_detection) {
                            const spoofScore = visAuthBreakdown.spoofing_detection.properties?.score;
                            const spoofText = spoofScore ? ` (${(spoofScore * 100).toFixed(1)}% confidence)` : '';
                            faceObjectives.push({ 
                                status: visAuthBreakdown.spoofing_detection.result === 'clear' ? 'CL' : 'AL', 
                                text: `Spoofing Detection${spoofText}` 
                            });
                        }
                        
                        // If no sub-checks, show overall
                        if (Object.keys(visAuthBreakdown).length === 0) {
                            faceObjectives.push({ 
                                status: faceBreakdown.visual_authenticity.result === 'clear' ? 'CL' : 'AL', 
                                text: 'Visual Authenticity' 
                            });
                        }
                    }
                } else if (Object.keys(faceData).length > 0) {
                    // Simple data structure (like Benjamin's check)
                    if (faceData.authenticity) {
                        faceObjectives.push({ status: faceData.authenticity === 'clear' ? 'CL' : 'AL', text: 'Authenticity' });
                    }
                    if (faceData.comparison) {
                        faceObjectives.push({ status: faceData.comparison === 'clear' ? 'CL' : 'CO', text: 'Comparison' });
                    }
                    if (faceData.integrity) {
                        faceObjectives.push({ status: faceData.integrity === 'clear' ? 'CL' : 'AL', text: 'Integrity' });
                    }
                }
                
                checks.push({
                    isNestedCard: true,
                    title: 'Facial Similarity',
                    result: faceResult,
                    items: faceObjectives
                });
            }
            
            // 3. NFC (Document) Verification (nested card with detailed breakdown)
            // Only show if NFC was actually completed (not unobtainable)
            if (breakdown.nfc && breakdown.nfc.status !== 'unobtainable') {
                const nfcResult = breakdown.nfc.result || '';
                const nfcStatus = breakdown.nfc.status || '';
                const nfcBreakdown = breakdown.nfc.breakdown || {};
                
                // Get actual data for comparison descriptions
                const nfcData = data.nfc || {};
                const providedData = data.name || {};
                const providedDob = data.dob || '';
                
                const nfcItems = [];
                
                // Chip verification details
                if (nfcBreakdown.chip) {
                    const chipBreakdown = nfcBreakdown.chip.breakdown || {};
                    
                    // Clone detection
                    if (chipBreakdown.clone_detection) {
                        nfcItems.push({
                            status: chipBreakdown.clone_detection.result === 'clear' ? 'CL' : 'AL',
                            text: 'Clone Detection'
                        });
                    }
                    
                    // Chip verification
                    if (chipBreakdown.verification) {
                        nfcItems.push({
                            status: chipBreakdown.verification.result === 'clear' ? 'CL' : 'AL',
                            text: 'Chip Verification'
                        });
                    }
                }
                
                // Data comparison details with actual values
                if (nfcBreakdown.data_comparison) {
                    const compBreakdown = nfcBreakdown.data_comparison.breakdown || {};
                    
                    // DOB comparison
                    if (compBreakdown.dob) {
                        const dobResult = compBreakdown.dob.result || '';
                        const daysDiff = compBreakdown.dob.properties?.days_difference;
                        
                        let dobText = '';
                        if (dobResult === 'clear' && daysDiff === 0) {
                            dobText = `Date of birth: ${nfcData.dob || 'N/A'}. No difference between NFC chip and client entry`;
                        } else if (daysDiff !== undefined && daysDiff !== 0) {
                            dobText = `Date of birth mismatch: ${daysDiff} days difference between NFC chip and client entry`;
                        } else {
                            dobText = 'Date of Birth Match';
                        }
                        
                        nfcItems.push({
                            status: dobResult === 'clear' ? 'CL' : 'CO',
                            text: dobText
                        });
                    }
                    
                    // Name comparison with actual values
                    if (compBreakdown.name) {
                        const nameResult = compBreakdown.name.result || '';
                        const levenshtein = compBreakdown.name.properties?.levenshtein_pct;
                        
                        // Build full name from provided data
                        const providedFullName = [providedData.first, providedData.other, providedData.last]
                            .filter(Boolean).join(' ');
                        const nfcName = nfcData.name || '';
                        
                        let nameText = '';
                        if (nameResult === 'clear') {
                            nameText = `Name: ${nfcName}. Match confirmed`;
                        } else if (levenshtein !== undefined) {
                            nameText = `Name mismatch: Client entered "${providedFullName}", NFC chip reads "${nfcName}" (${levenshtein}% similarity)`;
                        } else {
                            nameText = 'Name Match';
                        }
                        
                        nfcItems.push({
                            status: nameResult === 'clear' ? 'CL' : 'CO',
                            text: nameText
                        });
                    }
                }
                
                checks.push({
                    isNestedCard: true,
                    title: 'NFC (Document) Verification',
                    result: nfcResult,
                    items: nfcItems
                });
            }
            
            // 4. Biometric Verification (Facial Similarity) (nested card)
            // Only show if biometric was actually completed (not unobtainable)
            if (breakdown.biometrics && breakdown.biometrics.status !== 'unobtainable') {
                const bioResult = breakdown.biometrics.result || '';
                const bioStatus = breakdown.biometrics.status || '';
                const bioBreakdown = breakdown.biometrics.breakdown || {};
                
                const bioItems = [];
                
                // Liveness attempts with descriptive text
                if (bioBreakdown.attempts && Array.isArray(bioBreakdown.attempts)) {
                    const totalAttempts = bioBreakdown.attempts.length;
                    const firstAttempt = bioBreakdown.attempts[0];
                    
                    if (totalAttempts === 1 && firstAttempt.passed && firstAttempt.status === 'complete') {
                        // Single successful attempt
                        bioItems.push({
                            status: 'CL',
                            text: 'Live facial video completed on first try'
                        });
                    } else {
                        // Multiple attempts or failed
                        bioBreakdown.attempts.forEach((attempt, index) => {
                            const passed = attempt.passed;
                            const attemptStatus = attempt.status || '';
                            const attemptText = passed 
                                ? `Attempt ${index + 1}: ${attemptStatus} - Passed`
                                : `Attempt ${index + 1}: ${attemptStatus} - Failed`;
                            bioItems.push({
                                status: passed ? 'CL' : 'AL',
                                text: attemptText
                            });
                        });
                    }
                }
                
                checks.push({
                    isNestedCard: true,
                    title: 'Biometric Verification (Facial Similarity)',
                    result: bioResult,
                    items: bioItems
                });
            }
            
            // Fallback for simple data
            if (!breakdown.nfc && !breakdown.biometrics && !breakdown.document && data.verified !== undefined) {
                checks.push({
                    status: data.verified ? 'CL' : 'CO',
                    text: data.verified ? 'Identity verified' : 'Identity verification requires review'
                });
            }
        }
        else if (taskType === 'address') {
            // Address verification - includes footprint data from electronic-id checks or lite screen data
            const data = outcome.data || {};
            const breakdown = outcome.breakdown || {};
            const quality = data.quality !== undefined ? data.quality : 0;
            const sources = data.sources !== undefined ? data.sources : 0;
            
            // Determine status based on quality and sources
            // Quality: 0% = fail, 1-79% = consider, 80%+ = clear
            // Sources: 0 = fail, 1 = consider, 2+ = clear
            let qualityStatus = quality === 0 ? 'AL' : (quality >= 80 ? 'CL' : 'CO');
            let sourcesStatus = sources === 0 ? 'AL' : (sources >= 2 ? 'CL' : 'CO');
            
            // Overall status is the worst of the two
            let overallStatus = 'CL';
            if (qualityStatus === 'AL' || sourcesStatus === 'AL') {
                overallStatus = 'AL';
            } else if (qualityStatus === 'CO' || sourcesStatus === 'CO') {
                overallStatus = 'CO';
            }
            
            // Check for footprint rules/warnings
            const rules = breakdown.rules || [];
            let inlineWarning = '';
            if (rules.length > 0 && rules[0].text) {
                inlineWarning = rules[0].text;
            } else if (quality === 0 && sources === 0) {
                inlineWarning = 'No address verification data available';
            }
            
            // Check if Proof of Address documents exist when address fails/consider
            const poaTask = check?.taskOutcomes?.['documents:poa'];
            const poaDocs = poaTask?.documents || poaTask?.breakdown?.documents || [];
            
            // Show main warning as header check (visible when collapsed)
            if (inlineWarning) {
                checks.push({
                    status: overallStatus === 'AL' ? 'AL' : 'CO',
                    text: inlineWarning
                });
            }
            
            // Show PoA review prompt as header check (visible when collapsed)
            if (poaDocs.length > 0 && (outcome.result === 'consider' || outcome.result === 'fail')) {
                checks.push({
                    status: 'CO',
                    text: `Review ${poaDocs.length} uploaded Proof of Address document${poaDocs.length > 1 ? 's' : ''} to verify address`
                });
            }
            
            // Address verification summary
            checks.push({
                status: qualityStatus,
                text: `Verification Quality: ${quality}%`,
                indented: true
            });
            
            checks.push({
                status: sourcesStatus,
                text: `Address Sources: ${sources}`,
                indented: true
            });
            
            // Add footprint details if available (from electronic-id checks)
            if (breakdown.data_count) {
                const score = breakdown.data_count.properties?.score || 0;
                const result = breakdown.data_count.result || '';
                // Score: 0 = fail, 1-79 = consider, 80+ = clear
                const scoreStatus = score === 0 ? 'AL' : (score >= 80 ? 'CL' : 'CO');
                checks.push({
                    status: scoreStatus,
                    text: `Data Count Score: ${score}`,
                    indented: true
                });
            }
            
            if (breakdown.data_quality) {
                const score = breakdown.data_quality.properties?.score || 0;
                const result = breakdown.data_quality.result || '';
                // Score: 0 = fail, 1-79 = consider, 80+ = clear
                const scoreStatus = score === 0 ? 'AL' : (score >= 80 ? 'CL' : 'CO');
                checks.push({
                    status: scoreStatus,
                    text: `Data Quality Score: ${score}`,
                    indented: true
                });
            }
        }
        else if (taskType === 'screening') {
            // Combined Screening (PEP + Sanctions + Adverse Media)
            const breakdown = outcome.breakdown || {};
            const totalHits = breakdown.total_hits || 0;
            const hits = breakdown.hits || [];
            
            // Count dismissed hits
            const pepDismissals = check.pepDismissals || [];
            const dismissedCount = hits.filter(hit => pepDismissals.some(d => d.hitId === hit.id)).length;
            const outstandingCount = totalHits - dismissedCount;
            
            checks.push({
                status: totalHits === 0 ? 'CL' : 'CO', // Always CONSIDER if hits exist, regardless of dismissals
                text: `${totalHits} match${totalHits !== 1 ? 'es' : ''} found`,
                dismissedCount: dismissedCount,
                outstandingCount: outstandingCount
            });
            
            // Show detailed hit information using the same format as PEP updates
            if (hits.length > 0) {
                hits.forEach(hit => {
                    const name = hit.name || 'Unknown';
                    const dob = hit.dob?.main || hit.dob;
                    const flagTypes = hit.flag_types || [];
                    const positions = hit.political_positions || [];
                    const countries = hit.countries || [];
                    const aka = hit.aka || [];
                    const score = hit.score || 0;
                    
                    // Determine primary hit type
                    let hitType = '';
                    let hitIcon = '';
                    
                    // Check flag types if available (screening:lite format)
                    if (flagTypes.length > 0) {
                        if (flagTypes.some(f => f.includes('pep'))) {
                            hitType = 'PEP';
                            hitIcon = '&#xD83D;&#xDC64;';
                        }
                        if (flagTypes.some(f => f.includes('sanction'))) {
                            hitType = hitType ? `${hitType} + Sanctions` : 'Sanctions';
                            hitIcon = '&#xD83D;&#xDEAB;';
                        }
                        if (flagTypes.some(f => f.includes('adverse-media'))) {
                            hitType = hitType ? `${hitType} + Adverse Media` : 'Adverse Media';
                            hitIcon = '&#xD83D;&#xDCF0;';
                        }
                    } else {
                        // Default to PEP if no flag types (simple peps format)
                        hitType = 'PEP';
                        hitIcon = '&#xD83D;&#xDC64;';
                    }
                    
                    // Check if this hit has been dismissed
                    const pepDismissals = check.pepDismissals || [];
                    const dismissal = pepDismissals.find(d => d.hitId === hit.id);
                    
                    // Create a "hit card" structure similar to PEP updates
                    checks.push({
                        isHitCard: true,
                        hitData: {
                            name,
                            dob,
                            hitType,
                            hitIcon,
                            score,
                            flagTypes,
                            positions,
                            countries,
                            aka,
                            media: hit.media || [],
                            associates: hit.associates || [],
                            fields: hit.fields || [],
                            match_types: hit.match_types || [],
                            dismissal: dismissal // Add dismissal info if exists
                        }
                    });
                });
            }
        }
        else if (taskType === 'peps') {
            // PEP Screening (Lite Screen or standalone)
            const breakdown = outcome.breakdown || {};
            const totalHits = breakdown.total_hits || 0;
            const hits = breakdown.hits || [];
            
            checks.push({
                status: totalHits === 0 ? 'CL' : 'CO',
                text: `${totalHits} PEP match${totalHits !== 1 ? 'es' : ''} found`
            });
            
            // Show individual hits if any
            if (hits.length > 0) {
                hits.forEach(hit => {
                    const name = hit.name || 'Unknown';
                    const positions = hit.political_positions || [];
                    const countries = hit.countries || [];
                    
                    let hitText = `${name}`;
                    if (positions.length > 0) hitText += ` | ${positions.slice(0, 2).join(', ')}`;
                    if (countries.length > 0) hitText += ` [${countries.slice(0, 3).join(', ')}]`;
                    
                    checks.push({
                        status: 'CO',
                        text: hitText,
                        indented: true
                    });
                });
            }
        }
        else if (taskType === 'footprint') {
            // Digital Footprint (Lite Screen)
            const breakdown = outcome.breakdown || {};
            
            // Data count
            if (breakdown.data_count) {
                const score = breakdown.data_count.properties?.score || 0;
                const result = breakdown.data_count.result || '';
                checks.push({
                    status: result === 'clear' ? 'CL' : 'CO',
                    text: `Data Count Score: ${score}`
                });
            }
            
            // Data quality
            if (breakdown.data_quality) {
                const score = breakdown.data_quality.properties?.score || 0;
                const result = breakdown.data_quality.result || '';
                checks.push({
                    status: result === 'clear' ? 'CL' : 'CO',
                    text: `Data Quality Score: ${score}`
                });
            }
            
            // Service name
            if (breakdown.service_name) {
                checks.push({
                    status: 'CN',
                    text: `Service: ${breakdown.service_name}`
                });
            }
            
            // Rules
            if (breakdown.rules && Array.isArray(breakdown.rules) && breakdown.rules.length > 0) {
                breakdown.rules.forEach(rule => {
                    if (rule.text) {
                        checks.push({
                            status: 'CO',
                            text: rule.text,
                            indented: true
                        });
                    }
                });
            }
        }
        else if (taskType === 'identity:lite') {
            // IDV document verification - Show detailed breakdown with nested items when needed
            const breakdown = outcome.breakdown?.document?.breakdown || {};
            
            // Helper function to process category and show nested items when needed (same as electronic-id)
            const processCategory = (category, categoryName) => {
                if (!category) return;
                
                const catBreakdown = category.breakdown || {};
                const catResult = category.result || '';
                
                // If category has nested breakdown
                if (Object.keys(catBreakdown).length > 0) {
                    // If parent category is consider/fail, show parent + ALL nested items indented
                    if (catResult !== 'clear') {
                        // Add parent category header
                        checks.push({
                            status: catResult === 'fail' ? 'AL' : 'CO',
                            text: categoryName,
                            isParent: true
                        });
                        
                        // Add all nested items indented
                        Object.entries(catBreakdown).forEach(([key, subCheck]) => {
                            const subResult = subCheck.result || '';
                            const formattedKey = key.replace(/_/g, ' ')
                                .split(' ')
                                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                                .join(' ');
                            checks.push({
                                status: subResult === 'clear' ? 'CL' : (subResult === 'fail' ? 'AL' : 'CO'),
                                text: formattedKey,
                                isChildItem: true  // Visual indentation in header checks
                            });
                        });
                    } else {
                        // Parent is clear - just show the category name
                        checks.push({
                            status: 'CL',
                            text: categoryName
                        });
                    }
                } else {
                    // No nested breakdown, show the category itself
                    checks.push({
                        status: catResult === 'clear' ? 'CL' : (catResult === 'fail' ? 'AL' : 'CO'),
                        text: categoryName
                    });
                }
            };
            
            // Process all document categories (same order as electronic-id)
            processCategory(breakdown.visual_authenticity, 'Visual Authenticity');
            processCategory(breakdown.image_integrity, 'Image Integrity');
            processCategory(breakdown.data_validation, 'Data Validation');
            processCategory(breakdown.data_consistency, 'Data Consistency');
            processCategory(breakdown.data_comparison, 'Data Comparison');
            processCategory(breakdown.compromised_document, 'Compromised Check');
            processCategory(breakdown.age_validation, 'Age Validation');
            processCategory(breakdown.police_record, 'Police Record');
        }
        else if (taskType === 'company:summary') {
            // Company Summary - Show people count in header, profile cards in details
            const breakdown = outcome.breakdown || {};
            const people = breakdown.people || [];
            const peopleCount = people.length;
            
            // Header check: people count
            const peopleStatus = peopleCount === 0 ? 'AL' : 'CL';
            const peopleText = peopleCount === 0 ? '0 people found' : `${peopleCount} ${peopleCount === 1 ? 'person' : 'people'} found`;
            checks.push({
                status: peopleStatus,
                text: peopleText
            });
            
            // Officers/People as profile cards (indented - show in details only)
            if (peopleCount > 0) {
                people.forEach(person => {
                    checks.push({
                        isPersonCard: true,
                        personData: person,
                        indented: true  // Mark as detail-only
                        // NO status or text field - only isPersonCard and personData
                    });
                });
            }
        }
        else if (taskType === 'company:ubo') {
            // Ultimate Beneficial Owners
            const breakdown = outcome.breakdown || {};
            
            // Show unobtainable message if applicable (header check)
            if (breakdown.uboUnavailable && outcome.status === 'unobtainable') {
                checks.push({
                    status: 'CO',
                    text: 'UBO information unobtainable'
                });
            }
            
            // Count all people found
            const pscsCount = breakdown.pscs?.length || 0;
            const beneficialOwnersCount = breakdown.beneficialOwners?.length || 0;
            const totalPeopleCount = pscsCount + beneficialOwnersCount;
            
            // Show people count in header
            if (totalPeopleCount > 0) {
                checks.push({
                    status: 'CL',
                    text: `${totalPeopleCount} ${totalPeopleCount === 1 ? 'person' : 'people'} found`
                });
            } else {
                checks.push({
                    status: 'AL',
                    text: '0 people found'
                });
            }
            
            // PSCs (Persons with Significant Control) as profile cards (indented - details only)
            if (breakdown.pscs && Array.isArray(breakdown.pscs) && breakdown.pscs.length > 0) {
                breakdown.pscs.forEach(psc => {
                    const person = psc.person || {};
                    // Merge PSC-level data with person data
                    const personWithControls = {
                        ...person,
                        natureOfControlTypes: psc.natureOfControlTypes,
                        natureOfControlStartDate: psc.natureOfControlStartDate
                    };
                    
                    checks.push({
                        isPersonCard: true,
                        personData: personWithControls,
                        indented: true  // Mark as detail-only
                        // NO status or text field
                    });
                });
            }
            
            // Beneficial Owners as profile cards (indented - details only)
            if (breakdown.beneficialOwners && Array.isArray(breakdown.beneficialOwners) && breakdown.beneficialOwners.length > 0) {
                breakdown.beneficialOwners.forEach(owner => {
                    checks.push({
                        isPersonCard: true,
                        personData: owner,
                        indented: true  // Mark as detail-only
                        // NO status or text field
                    });
                });
            }
            
            // Relationships (ownership structure)
            if (breakdown.relationships && Array.isArray(breakdown.relationships) && breakdown.relationships.length > 0) {
                checks.push({
                    status: 'CN',
                    text: 'Ownership Relationships',
                    isSectionHeader: true
                });
                
                breakdown.relationships.forEach(rel => {
                    const relText = `${rel.source || 'Unknown'} &#x2192; ${rel.target || 'Unknown'} (${rel.type || 'relationship'})`;
                    checks.push({
                        status: 'CN',
                        text: relText,
                        indented: true
                    });
                });
            }
        }
        else if (taskType === 'company:beneficial-check') {
            // PSC Extract document
            const breakdown = outcome.breakdown || {};
            
            if (breakdown.documents && Array.isArray(breakdown.documents) && breakdown.documents.length > 0) {
                checks.push({
                    status: 'CL',
                    text: `PSC Extract document obtained`
                });
            } else if (outcome.status === 'unobtainable') {
                checks.push({
                    status: 'CO',
                    text: 'PSC Extract unobtainable - manual review required'
                });
            }
        }
        else if (taskType === 'company:shareholders') {
            // Shareholders information
            const breakdown = outcome.breakdown || {};
            
            if (breakdown.documents && Array.isArray(breakdown.documents) && breakdown.documents.length > 0) {
                checks.push({
                    status: 'CL',
                    text: `Shareholder register obtained (${breakdown.documents.length} document${breakdown.documents.length !== 1 ? 's' : ''})`
                });
            }
            
            // If we have shareholder data in breakdown
            if (breakdown.shareholders && Array.isArray(breakdown.shareholders) && breakdown.shareholders.length > 0) {
                checks.push({
                    status: 'CN',
                    text: `${breakdown.shareholders.length} Shareholder${breakdown.shareholders.length !== 1 ? 's' : ''}`,
                    isSectionHeader: true
                });
                
                breakdown.shareholders.forEach(shareholder => {
                    const name = shareholder.name || 'Unknown';
                    const shares = shareholder.shares || '';
                    const percentage = shareholder.percentage || '';
                    
                    let shareText = name;
                    if (shares) shareText += ` - ${shares} shares`;
                    if (percentage) shareText += ` (${percentage}%)`;
                    
                    checks.push({
                        status: 'CL',
                        text: shareText,
                        indented: true
                    });
                });
            }
        }
        
        return checks;
    }
    
    // ===================================================================
    // ACTIONS
    // ===================================================================
    
    viewPDF(s3Key) {
        console.log('&#xD83D;&#xDCC4; Viewing PDF:', s3Key);
        this.sendMessage('view-pdf', { s3Key });
    }
    
    toggleMonitoring(currentlyEnabled) {
        console.log('&#xD83D;&#xDD04; Toggling monitoring:', !currentlyEnabled);
        
        const check = this.currentCheck;
        this.sendMessage('monitoring-patch', {
            id: check.transactionId || check.checkId,
            resourceType: check.transactionId ? 'transaction' : 'check',
            enabled: !currentlyEnabled
        });
    }
    
    abortCheck() {
        if (!confirm('Are you sure you want to cancel this check? This action cannot be undone.')) {
            return;
        }
        
        console.log('&#xD83D;&#xDEAB; Aborting check');
        
        const check = this.currentCheck;
        this.sendMessage('cancel-check', {
            id: check.transactionId || check.checkId,
            resourceType: check.transactionId ? 'transaction' : 'check'
        });
    }
    
    // ===================================================================
    // MOCK DATA (for testing)
    // ===================================================================
    
    loadMockData() {
        console.log('&#xD83C;&#xDFAD; Loading mock data...');
        
        const mockChecks = this.generateMockData();
        this.loadChecks(mockChecks);
    }
    
    generateMockData() {
        // Real KYB check data for THURSTAN HOSKIN SOLICITORS LLP
        return [
            // Mock Check: Jacob Robert Archer Moran - Enhanced ID Check
            {
                  "taskOutcomes": {
                    "sof:v1": {
                      "breakdown": {
                        "property": {
                          "address": {
                            "postcode": "TR15 1JZ",
                            "country": "GBR",
                            "flat_number": "Flat 1",
                            "street": "Green Lane",
                            "building_number": "21",
                            "town": "Redruth"
                          },
                          "new_build": false,
                          "price": 2000000,
                          "stamp_duty": 10000
                        },
                        "funds": [
                          {
                            "data": {
                              "amount": 2000000,
                              "location": "GBR",
                              "people": [
                                {
                                  "actor": true,
                                  "name": "Jacob Robert Archer-Moran",
                                  "incomes": [
                                    {
                                      "reference": "payslip",
                                      "source": "salary",
                                      "description": "",
                                      "annual_total": 5000000,
                                      "frequency": "monthly"
                                    }
                                  ],
                                  "employment_status": "employed",
                                  "phone": "+447506430094"
                                }
                              ]
                            },
                            "metadata": {
                              "created_at": 1762991874796
                            },
                            "type": "fund:savings"
                          },
                          {
                            "data": {
                              "amount": 10000,
                              "description": "Savings",
                              "location": "GBR"
                            },
                            "metadata": {
                              "created_at": 1762991874961
                            },
                            "type": "fund:cryptocurrency"
                          }
                        ]
                      },
                      "data": {},
                      "result": "clear",
                      "documents": [],
                      "id": "d4ahyc123amg030yrxwg",
                      "status": "closed",
                      "createdAt": "2025-11-12T23:58:40.825Z"
                    },
                    "documents:savings": {
                      "breakdown": {
                        "documents": [
                          {
                            "id": "d4ahygj23amg030yry40",
                            "type": "savings"
                          }
                        ]
                      },
                      "data": {},
                      "result": "clear",
                      "documents": [
                        "d4ahygj23amg030yry40"
                      ],
                      "id": "d4ahyha23amg030yry5g",
                      "status": "closed",
                      "createdAt": "2025-11-12T23:59:01.128Z"
                    },
                    "documents:poa": {
                      "breakdown": {
                        "documents": [
                          {
                            "id": "d4ahwsk23amg030yrxmg",
                            "type": "poa"
                          },
                          {
                            "id": "d4ahwsk23amg030yrxn0",
                            "type": "poa"
                          }
                        ]
                      },
                      "data": {},
                      "result": "clear",
                      "documents": [
                        "d4ahwsk23amg030yrxmg",
                        "d4ahwsk23amg030yrxn0"
                      ],
                      "id": "d4ahyc123amg030yrxrg",
                      "status": "closed",
                      "createdAt": "2025-11-12T23:58:39.994Z"
                    },
                    "peps": {
                      "breakdown": {
                        "total_hits": 2,
                        "hits": [
                          {
                            "name": "Jake Moran",
                            "assets": [],
                            "dob": {
                              "main": "",
                              "other": []
                            },
                            "score": 0.1,
                            "flag_types": [
                              "adverse-media",
                              "adverse-media-violent-crime"
                            ],
                            "source_notes": {
                              "complyadvantage-adverse-media": {
                                "aml_types": [
                                  "adverse-media",
                                  "adverse-media-violent-crime"
                                ],
                                "country_codes": [
                                  "US"
                                ],
                                "name": "ComplyAdvantage Adverse Media"
                              }
                            },
                            "institutions": [],
                            "spouses": [],
                            "political_positions": [],
                            "countries": [
                              "United States"
                            ],
                            "aka": [
                              "Jake Moran"
                            ],
                            "id": "CPPFOJFI8OCU4PE",
                            "match_types": [
                              "equivalent_name",
                              "name_variations_removal"
                            ],
                            "roles": [],
                            "fields": [
                              {
                                "name": "Country",
                                "source": "complyadvantage-adverse-media",
                                "value": "United States"
                              },
                              {
                                "name": "Original Country Text",
                                "source": "complyadvantage-adverse-media",
                                "value": "United States"
                              },
                              {
                                "name": "Countries",
                                "source": "",
                                "value": "United States"
                              }
                            ],
                            "media": [
                              {
                                "date": "2014-05-21T00:00:00Z",
                                "snippet": "But after suffering a gut-wrenching 29-27, 20-25, 29-27 setback to the Redwings, the RedHawks rebounded to take down St. Patrick (25-19, 25-22) in another conference clash. Spearheading Marist's winning effort was Jake Moran, who registered five kills and six digs. Tom Inzinga equaled Moran's kill total, while Nick O'Gorman chipped in four kills and a service ace.",
                                "title": "Community sports news - Southwest Community Publishing",
                                "url": "https://www.southwestregionalpublishing.com/2014/05/21/community-sports-news-05-21-14-2/"
                              },
                              {
                                "date": "2016-05-21T00:00:00Z",
                                "snippet": "The best challenge to the Patriot stronghold, as evidenced this weekend, is O'Gorman, which took four of six heads-up championship matches against Lincoln. Sam Heckman (Flight 3), Jake Moran (Flight 4) and Michael Yousef (Flight 6) all racked up singles titles, while Flight 2 runner-up Wil McDowell and Heckman took home the Flight 2 doubles crown. \"They performed like I thought they would, and also expected,\" said Coach Don Barnes.",
                                "title": "Lincoln caps third straight tennis title",
                                "url": "https://www.argusleader.com/story/sports/high-school-sports/2016/05/21/midst-dynasty---lincoln-caps-third-straight-title/84666134/"
                              }
                            ],
                            "associates": []
                          },
                          {
                            "name": "Jacob Moran",
                            "assets": [],
                            "dob": {
                              "main": "",
                              "other": []
                            },
                            "score": 0.1,
                            "flag_types": [
                              "adverse-media",
                              "adverse-media-general",
                              "adverse-media-violent-crime"
                            ],
                            "source_notes": {
                              "complyadvantage-adverse-media": {
                                "aml_types": [
                                  "adverse-media",
                                  "adverse-media-general",
                                  "adverse-media-violent-crime"
                                ],
                                "country_codes": [
                                  "CA",
                                  "US"
                                ],
                                "name": "ComplyAdvantage Adverse Media"
                              }
                            },
                            "institutions": [],
                            "spouses": [],
                            "political_positions": [],
                            "countries": [
                              "Canada",
                              "United States"
                            ],
                            "aka": [
                              "Jacob Moran",
                              "Jacob Benning Moran"
                            ],
                            "id": "5F0CGJUQGD3KXR6",
                            "match_types": [
                              "aka_exact",
                              "name_variations_removal"
                            ],
                            "roles": [],
                            "fields": [
                              {
                                "name": "Country",
                                "source": "complyadvantage-adverse-media",
                                "value": "Canada"
                              },
                              {
                                "name": "Original Country Text",
                                "source": "complyadvantage-adverse-media",
                                "value": "Canada, United States"
                              },
                              {
                                "name": "Country",
                                "source": "complyadvantage-adverse-media",
                                "value": "United States"
                              },
                              {
                                "name": "Countries",
                                "source": "",
                                "value": "Canada, United States"
                              }
                            ],
                            "media": [
                              {
                                "date": "0001-01-01T00:00:00Z",
                                "snippet": "GPD is in direct communication with the Michigan State Police and are working with them on the case following his capture, the agency said.<\\/p>\\n Shortly after GPD announced that Jacob Moran was in custody, the Johnson County Coroner\\u2019s Office formally identified Shaun Moran as the man who was killed in the shooting. The office ruled his death as homicide caused by a single gunshot wound.<\\/p>\\n",
                                "title": "(no title)",
                                "url": "https://dailyjournal.net/wp-json/wp/v2/posts/1816390"
                              },
                              {
                                "date": "2021-03-01T00:00:00Z",
                                "snippet": "They detained Moran and learned he had urinated on a tire of the car. \"Moran was heavily intoxicated on marijuana. He was arrested for prowling, public urination and public intoxication,\" police said.",
                                "title": "530 Crime Watch: Man tried to rob bank across street from police station",
                                "url": "https://www.usatoday.com/story/news/local/2021/03/01/530-crime-watch-arrest-jail-redding-police-shasta-sheriff/6870286002/?gnt-cfr=1"
                              },
                              {
                                "date": "2023-08-29T00:00:00Z",
                                "snippet": "Court documents show that Jacob Moran had allegedly assaulted his father twice in the hours before the shooting. Jacob Moran was charged Tuesday with residential entry, a Level 6 felony, and two counts of domestic battery both as a Level 6 felony and a misdemeanor, for the incidents. Charges for the shooting have not yet been filed.",
                                "title": "Greenwood domestic dispute ends in fatal shooting - Daily Journal",
                                "url": "https://dailyjournal.net/2023/08/29/greenwood-domestic-dispute-ends-in-fatal-shooting/"
                              },
                              {
                                "date": "2024-11-15T00:00:00Z",
                                "snippet": "Jacob Moran had been staying at his father's home but had reportedly been causing issues and been asked to leave the home. After being asked to leave the first time, Jacob Moran allegedly assaulted his father, leading to police being called. Later that day, he returned and again allegedly assaulted Shaun Moran, according to court documents.",
                                "title": "Greenwood man convicted of murder of father following domestic dispute - Daily Journal",
                                "url": "https://dailyjournal.net/2024/11/15/greenwood-man-convicted-of-murder-of-father-following-domestic-dispute/"
                              },
                              {
                                "date": "2023-09-07T00:00:00Z",
                                "snippet": "The gun's serial number was a match to the gun box that was found in the garage, court documents show. Jacob Moran was then arrested and taken to a Sturgis, Michigan jail on a charge of possession of an unregistered handgun. The BMW was impounded, court documents say.",
                                "title": "Greenwood man, 22, charged with his father's murder - Daily Journal",
                                "url": "https://dailyjournal.net/2023/09/07/greenwood-man-22-charged-with-his-fathers-murder/"
                              },
                              {
                                "date": "0001-01-01T00:00:00Z",
                                "snippet": "As deputies attempted to place Moran into custody for his warrant, Moran began to physically resist deputies. While resisting, Moran twice attempted to unholster a deputy's service firearm. After a brief struggle, Moran was arrested and then booked into the Humboldt County Correctional Facility on fresh charges of attempting to remove a peace officer's firearm (PC 148(d)) and resisting a peace officer (PC 148(a)(1)), in addition to his warrant charges of assault (PC 240) and battery (PC 242).",
                                "title": "News Flash &#x2022; County of Humboldt &#x2022; CivicEngage",
                                "url": "https://humboldtgov.org/CivicAlerts.aspx?AID=4279"
                              },
                              {
                                "date": "2021-03-26T00:00:00Z",
                                "snippet": "They immediately detained Moran and learned he urinated on a tire of the same car. Moran was \"heavily intoxicated on marijuana,\" and was ultimately arrested for public intoxication, public urination, and prowling.",
                                "title": "Officers arrest prowler looking inside, and urinating on, a vehicle in Redding on Friday",
                                "url": "https://krcrtv.com/news/local/bicycle-officers-catch-prowler-looking-inside-cars-in-redding-on-friday"
                              },
                              {
                                "date": "2015-04-01T00:00:00Z",
                                "snippet": "Moran then emerged, ran toward the plaintiff, and punched him. The officers arrested Moran. The plaintiff commenced this action against, among others, the defendant City of New York, alleging that the officers were negligent in failing to protect the plaintiff.",
                                "title": "PHILIP v. MORAN | 127 A.D.3d 717 (2015) | 20150401440 | Leagle.com",
                                "url": "https://www.leagle.com/decision/innyco20150401440"
                              },
                              {
                                "date": "2023-08-29T00:00:00Z",
                                "snippet": "When they arrived they found, Shaun Moran dead of an apparent gunshot wound in the home's garage, police say. Police say Jacob Moran is suspect in the shooting. It was reported that he was angry with Shaun Moran about being told to move out of the home, according to the news release.",
                                "title": "UPDATE: Suspect in custody after deadly Greenwood shooting - Daily Journal",
                                "url": "https://dailyjournal.net/2023/08/29/update-suspect-in-custody-after-deadly-greenwood-shooting/"
                              },
                              {
                                "date": "2021-10-13T00:00:00Z",
                                "snippet": "16 p.m., Humboldt County Sheriff's deputies on patrol in the 2400 block of Myrtle Avenue observed a suspicious male exhibiting behavior consistent with attempting a car burglary. Deputies contacted the man, 20-year-old Jacob Benning Moran, and learned that Moran had an outstanding misdemeanor warrant for his arrest. As deputies attempted to place Moran into custody for his warrant, Moran began to physically resist deputies.",
                                "title": "Warrant suspect tries to grab deputy's gun during arrest in Myrtletown, HCSO says",
                                "url": "https://krcrtv.com/north-coast-news/eureka-local-news/warrant-suspect-tries-to-grab-deputys-gun-during-arrest-in-myrtletown-hcso-says"
                              }
                            ],
                            "associates": []
                          }
                        ]
                      },
                      "data": {
                        "dob": "2001-01-11T00:00:00.000Z",
                        "name": {
                          "first": "Jacob",
                          "last": "Moran",
                          "other": "Robert"
                        },
                        "address": {
                          "postcode": "TR15 2ND",
                          "country": "GBR",
                          "street": "Southgate Street",
                          "building_number": "94",
                          "town": "Redruth"
                        }
                      },
                      "result": "consider",
                      "documents": [
                        "d4ahz1w23amg030yryqg"
                      ],
                      "id": "d4ahytv23amg030yrym0",
                      "status": "closed",
                      "createdAt": "2025-11-12T23:59:39.009Z"
                    },
                    "nfc": {
                      "result": "clear",
                      "status": "complete",
                      "data": {
                        "chip": {
                          "clone_detection": "clear",
                          "verification": "clear"
                        },
                        "comparison": {
                          "dob": 0,
                          "name": 100
                        }
                      }
                    },
                    "bank:summary": {
                      "breakdown": {
                        "summary": {
                          "by_ccy": {
                            "GBP": {
                              "top_in": [
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-08T00:00:00Z",
                                  "description": "JACOB ARCHER-MORANGWN25",
                                  "amount": 2400,
                                  "id": "ee587010c1a76619f7888e7448df3dac",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-02T00:00:00Z",
                                  "description": "JACOB ARCHER-MORANGWD25",
                                  "amount": 2300,
                                  "id": "d5fdf791a4294d42275adabc74e82413",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-24T00:00:00Z",
                                  "description": "THUR HOSK SO LLP W/E 24/10 SCREWFIX",
                                  "amount": 2272.48,
                                  "id": "9ff7a8f1b4bb4337e257c78ad2629d25",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-06T00:00:00Z",
                                  "description": "THUR HOSK SO LLP work w/e 6.9.25",
                                  "amount": 800,
                                  "id": "4eb4becb238395fa3a60bff26b2e4797",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-03T00:00:00Z",
                                  "description": "THUR HOSK SO LLP work w/e 3.10.25",
                                  "amount": 660,
                                  "id": "65bea463c180e32c536ebf770ad4f6db",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-07T00:00:00Z",
                                  "description": "Arc-McDo B Greece",
                                  "amount": 500,
                                  "id": "908b356faa560c1910ab62699105519e",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-11-07T00:00:00Z",
                                  "description": "THUR HOSK SO LLP work w/e 7.11.25",
                                  "amount": 440,
                                  "id": "00f9c71275693005d466d231746d1a4b",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-08-30T00:00:00Z",
                                  "description": "STEWART S Holidayxx",
                                  "amount": 245,
                                  "id": "1abd212b42e55440112ca9b8e2b87d9f",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-12T00:00:00Z",
                                  "description": "THUR HOSK SO LLP work w/e 12.9.25",
                                  "amount": 220,
                                  "id": "2eb349e09df20e7e811525c18130a684",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-28T00:00:00Z",
                                  "description": "STEWART S Holidayxx",
                                  "amount": 200,
                                  "id": "d1c97b4c29623482d6ff920ded9ffddc",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-31T00:00:00Z",
                                  "description": "STEWART S Holidayxx",
                                  "amount": 150,
                                  "id": "db76f59f7ac5395ab94ec1a7d5648ee2",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-01T00:00:00Z",
                                  "description": "404434 21857479 INTERNET TRANSFER",
                                  "amount": 130,
                                  "id": "6260e8341669381eaa8163ab03e303e1",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-11-03T00:00:00Z",
                                  "description": "REVERSAL OF 03-11 ADMIRAL INSURANCE",
                                  "amount": 90.18,
                                  "id": "41f008d187aacafb9284eb4c05aa1229",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-18T00:00:00Z",
                                  "description": "GREAT WESTERN TRAI",
                                  "amount": 75.25,
                                  "id": "443f1383ff63083d556fd8bdebaba1dd",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-11-03T00:00:00Z",
                                  "description": "CAR STEWART S",
                                  "amount": 70,
                                  "id": "9738cf4da5ca96b561a70e21a6b8e666",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-01T00:00:00Z",
                                  "description": "CAR STEWART S",
                                  "amount": 70,
                                  "id": "fabe29bf4ded2b8b45199b2de974cacb",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-01T00:00:00Z",
                                  "description": "CAR STEWART S",
                                  "amount": 70,
                                  "id": "ea13d2a5a3d225c323b8193b4a5d1dd8",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-28T00:00:00Z",
                                  "description": "404434 21857479 INTERNET TRANSFER",
                                  "amount": 50,
                                  "id": "e8dc9f623531137194dad9a1eda4b000",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-11-09T00:00:00Z",
                                  "description": "Benjamin Meehan Jacob Robert Arche",
                                  "amount": 50,
                                  "id": "93f2af753c290441057d96c9360d07d1",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-02T00:00:00Z",
                                  "description": "THUR HOSK SO LLP CPC Expenses",
                                  "amount": 29.52,
                                  "id": "2084d3432b19833661dd626133b0c011",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "CREDIT",
                                  "classification": null,
                                  "type": "CREDIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                }
                              ],
                              "top_out": [
                                {
                                  "merchant_name": "Tesco Bank",
                                  "timestamp": "2025-10-02T00:00:00Z",
                                  "description": "TESCO BANK 518652******0936",
                                  "amount": -2034.26,
                                  "id": "313deb3db30a087d274b7429bc9637b9",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "DEBIT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "Tesco Bank",
                                  "timestamp": "2025-09-08T00:00:00Z",
                                  "description": "TESCO BANK 518652******0936",
                                  "amount": -1500,
                                  "id": "f64c8549d4927508cbee937952190e20",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "DEBIT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "Tesco Bank",
                                  "timestamp": "2025-09-07T00:00:00Z",
                                  "description": "TESCO BANK 518652******0936",
                                  "amount": -1065.68,
                                  "id": "0ea56de940d75d4b26c76aeee4ba8ddc",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "Tesco Bank",
                                  "timestamp": "2025-10-27T00:00:00Z",
                                  "description": "TESCO BANK 518652******0936",
                                  "amount": -1000,
                                  "id": "282a0116410532bb12df1fce68ff2ca2",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-27T00:00:00Z",
                                  "description": "B ARCHER Rent & Owings x4",
                                  "amount": -600,
                                  "id": "c84f0526ba6a0e5fbfb96fb23e3ae47f",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "Tesco Bank",
                                  "timestamp": "2025-09-08T00:00:00Z",
                                  "description": "TESCO BANK 518652******0936",
                                  "amount": -550.67,
                                  "id": "14b11a87620190e2b202574bdfb2d2e4",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "DEBIT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-03T00:00:00Z",
                                  "description": "B ARCHER Rent & Owings x2",
                                  "amount": -300,
                                  "id": "fc339ff805ae07fb3bc7355dce8f7050",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-08T00:00:00Z",
                                  "description": "B ARCHER Owings finl",
                                  "amount": -200,
                                  "id": "4f1d2724e46e78ebd57b6ba524790134",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "Tesco Bank",
                                  "timestamp": "2025-08-30T00:00:00Z",
                                  "description": "TESCO BANK 518652******0936",
                                  "amount": -200,
                                  "id": "7792426ac76f46c4c60e6aa0d15f15a2",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "DEBIT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-25T00:00:00Z",
                                  "description": "Klarna Financial SYA777777777713C9YB",
                                  "amount": -199.56,
                                  "id": "2e6ee436a7394f2406fdebb7664f0dc1",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "DEBIT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-03T00:00:00Z",
                                  "description": "HMRC GOV.UK SA GLASGOW",
                                  "amount": -197.6,
                                  "id": "85edd8e1479758f6319dbaddf1c7ea07",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "PURCHASE",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "Tesco Bank",
                                  "timestamp": "2025-10-27T00:00:00Z",
                                  "description": "TESCO BANK 518652******0936",
                                  "amount": -160.31,
                                  "id": "3c8640af1c234df97be59a19b6af559b",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-11-10T00:00:00Z",
                                  "description": "B ARCHER Rent & Owings",
                                  "amount": -150,
                                  "id": "25f25b5af9c64b5492b4cf320a16bf08",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-27T00:00:00Z",
                                  "description": "HLTN PREMIUM",
                                  "amount": -150,
                                  "id": "4e74dc5b71f6cab998e729cb943a5805",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "DIRECT_DEBIT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-27T00:00:00Z",
                                  "description": "Jacob TSB work return iou",
                                  "amount": -150,
                                  "id": "6cc540e761172036d41dca37fce01d38",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-01T00:00:00Z",
                                  "description": "404434 71857460 INTERNET TRANSFER",
                                  "amount": -130,
                                  "id": "104b2be93860d304d1bc5e53291b36f7",
                                  "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                  "currency": "GBP",
                                  "category": "DEBIT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-28T00:00:00Z",
                                  "description": "Se Iou",
                                  "amount": -110,
                                  "id": "2789d8f6f89e6d2f4dec2a99dd406980",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-11-10T00:00:00Z",
                                  "description": "Benjamin Meehan Meal",
                                  "amount": -110,
                                  "id": "6ef70a84cfafbf2816038d69e705d281",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-10-27T00:00:00Z",
                                  "description": "Se Iou",
                                  "amount": -100,
                                  "id": "8aaca016c37aae8ae9737b19a065d93a",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                },
                                {
                                  "merchant_name": "",
                                  "timestamp": "2025-09-08T00:00:00Z",
                                  "description": "Se Iou",
                                  "amount": -100,
                                  "id": "3a6fc65196ab7f60ff8cca5d9a1d6d73",
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "currency": "GBP",
                                  "category": "BILL_PAYMENT",
                                  "classification": null,
                                  "type": "DEBIT",
                                  "counterparty_name": "",
                                  "counterparty_iban": ""
                                }
                              ]
                            }
                          }
                        },
                        "accounts": {
                          "14adec06e254acfbdaf13a29f2eb2cab": {
                            "number": {
                              "iban": "GB02MIDL40115650730920",
                              "number": "50730920",
                              "sort_code": "40-11-56",
                              "swift_bic": ""
                            },
                            "name": "ON BNS SAVER",
                            "provider": {
                              "id": "ob-hsbc",
                              "name": "HSBC"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 0.01,
                              "current": 0.01,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "Mr Jacob Robert Archer-Moran",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": 1762991927038,
                              "encryption": null,
                              "tl": {
                                "account_id": "14adec06e254acfbdaf13a29f2eb2cab",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "3050f0d0-6300-429c-9007-013966952bea"
                              },
                              "updated_at": 1762991924193
                            },
                            "type": "SAVINGS"
                          },
                          "8c5bdd03ccbab455eb41c681ea67a519": {
                            "number": {
                              "iban": "GB50MIDL40115690731110",
                              "number": "90731110",
                              "sort_code": "40-11-56",
                              "swift_bic": ""
                            },
                            "name": "FLEX SAVER",
                            "provider": {
                              "id": "ob-hsbc",
                              "name": "HSBC"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 0.15,
                              "current": 0.15,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "Mr Jacob Robert Archer-Moran",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": 1762991926840,
                              "encryption": null,
                              "tl": {
                                "account_id": "8c5bdd03ccbab455eb41c681ea67a519",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "9218b153-243d-428d-a2f0-abc69503e70e"
                              },
                              "updated_at": 1762991924193
                            },
                            "type": "SAVINGS"
                          },
                          "4c82630f5b8bccce242ff3fbb4740b8d": {
                            "number": {
                              "iban": "GB63MIDL40443471857460",
                              "number": "71857460",
                              "sort_code": "40-44-34",
                              "swift_bic": ""
                            },
                            "name": "BANK A/C",
                            "provider": {
                              "id": "ob-hsbc",
                              "name": "HSBC"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 67.53,
                              "current": 67.53,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "Mr Jacob Robert Archer-Moran",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": 1762991926654,
                              "encryption": null,
                              "tl": {
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "f952cd5d-e77d-47b5-bea9-5c462eef9c57"
                              },
                              "updated_at": 1762991924193
                            },
                            "type": "TRANSACTION"
                          },
                          "071fc97cd0cf36290a519783bb8f1114": {
                            "number": {
                              "iban": "GB13MIDL40443421857479",
                              "number": "21857479",
                              "sort_code": "40-44-34",
                              "swift_bic": ""
                            },
                            "name": "FLEX SAVER",
                            "provider": {
                              "id": "ob-hsbc",
                              "name": "HSBC"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 50.3,
                              "current": 50.3,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "Mr Jacob Robert Archer-Moran",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": 1762991926938,
                              "encryption": null,
                              "tl": {
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "0b9d546d-7a51-4392-b638-0be9ebffbd4a"
                              },
                              "updated_at": 1762991924193
                            },
                            "type": "SAVINGS"
                          },
                          "cb6440fd6af1f4329588bf7c2bce69da": {
                            "number": {
                              "iban": "GB54MIDL40115670868833",
                              "number": "70868833",
                              "sort_code": "40-11-56",
                              "swift_bic": ""
                            },
                            "name": "FLEX SAVER",
                            "provider": {
                              "id": "ob-hsbc",
                              "name": "HSBC"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 0.19,
                              "current": 0.19,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "Mr Jacob Robert Archer-Moran",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": 1762991926753,
                              "encryption": null,
                              "tl": {
                                "account_id": "cb6440fd6af1f4329588bf7c2bce69da",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "364a617e-b5f9-49e5-ae3d-af0d41b896b5"
                              },
                              "updated_at": 1762991924193
                            },
                            "type": "SAVINGS"
                          }
                        }
                      },
                      "data": {},
                      "result": "clear",
                      "documents": [],
                      "id": "d4ahyf923amg030yry1g",
                      "status": "closed",
                      "createdAt": "2025-11-12T23:58:53.059Z"
                    },
                    "bank:statement": {
                      "breakdown": {
                        "accounts": {
                          "14adec06e254acfbdaf13a29f2eb2cab": {
                            "info": {
                              "number": {
                                "iban": "GB02MIDL40115650730920",
                                "number": "50730920",
                                "sort_code": "40-11-56",
                                "swift_bic": ""
                              },
                              "name": "ON BNS SAVER",
                              "provider": {
                                "id": "ob-hsbc",
                                "name": "HSBC"
                              },
                              "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "balance": {
                                "available": 0.01,
                                "current": 0.01,
                                "overdraft": 0
                              },
                              "info": [
                                {
                                  "full_name": "Mr Jacob Robert Archer-Moran",
                                  "phones": null,
                                  "date_of_birth": "",
                                  "emails": null,
                                  "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                  "addresses": null
                                }
                              ],
                              "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "currency": "GBP",
                              "metadata": {
                                "created_at": 1762991927038,
                                "tl": {
                                  "account_id": "14adec06e254acfbdaf13a29f2eb2cab",
                                  "debug_id": "",
                                  "download_status": "complete",
                                  "task_id": "3050f0d0-6300-429c-9007-013966952bea"
                                },
                                "updated_at": 1762991924193
                              },
                              "type": "SAVINGS"
                            }
                          },
                          "8c5bdd03ccbab455eb41c681ea67a519": {
                            "info": {
                              "number": {
                                "iban": "GB50MIDL40115690731110",
                                "number": "90731110",
                                "sort_code": "40-11-56",
                                "swift_bic": ""
                              },
                              "name": "FLEX SAVER",
                              "provider": {
                                "id": "ob-hsbc",
                                "name": "HSBC"
                              },
                              "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "balance": {
                                "available": 0.15,
                                "current": 0.15,
                                "overdraft": 0
                              },
                              "info": [
                                {
                                  "full_name": "Mr Jacob Robert Archer-Moran",
                                  "phones": null,
                                  "date_of_birth": "",
                                  "emails": null,
                                  "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                  "addresses": null
                                }
                              ],
                              "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "currency": "GBP",
                              "metadata": {
                                "created_at": 1762991926840,
                                "tl": {
                                  "account_id": "8c5bdd03ccbab455eb41c681ea67a519",
                                  "debug_id": "",
                                  "download_status": "complete",
                                  "task_id": "9218b153-243d-428d-a2f0-abc69503e70e"
                                },
                                "updated_at": 1762991924193
                              },
                              "type": "SAVINGS"
                            }
                          },
                          "4c82630f5b8bccce242ff3fbb4740b8d": {
                            "info": {
                              "number": {
                                "iban": "GB63MIDL40443471857460",
                                "number": "71857460",
                                "sort_code": "40-44-34",
                                "swift_bic": ""
                              },
                              "name": "BANK A/C",
                              "provider": {
                                "id": "ob-hsbc",
                                "name": "HSBC"
                              },
                              "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "balance": {
                                "available": 67.53,
                                "current": 67.53,
                                "overdraft": 0
                              },
                              "info": [
                                {
                                  "full_name": "Mr Jacob Robert Archer-Moran",
                                  "phones": null,
                                  "date_of_birth": "",
                                  "emails": null,
                                  "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                  "addresses": null
                                }
                              ],
                              "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "currency": "GBP",
                              "metadata": {
                                "created_at": 1762991926654,
                                "tl": {
                                  "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                  "debug_id": "",
                                  "download_status": "complete",
                                  "task_id": "f952cd5d-e77d-47b5-bea9-5c462eef9c57"
                                },
                                "updated_at": 1762991924193
                              },
                              "type": "TRANSACTION"
                            },
                            "statement": [
                              {
                                "merchant_name": "McDonald's",
                                "timestamp": "2025-11-12T00:00:00Z",
                                "description": "McDonalds 8261015 Redruth",
                                "amount": -10.65,
                                "id": "8b2bca4a6ec945e2e8b2b0754cb2efa9",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Lucky House",
                                "timestamp": "2025-11-12T00:00:00Z",
                                "description": "LUCKY HOUSE REDRUTH",
                                "amount": -7.3,
                                "id": "200d67ed04f7ac5659647720fd6b0c3a",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon Prime Video",
                                "timestamp": "2025-11-11T00:00:00Z",
                                "description": "HLTN07 PRIME VIDEO",
                                "amount": -5,
                                "id": "5e16cad674a74e7d60dba1175e891c80",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Nhs Prescription Prepayment Certificates",
                                "timestamp": "2025-11-11T00:00:00Z",
                                "description": "NHSBSA PPC 2",
                                "amount": -11.45,
                                "id": "2c1282c5c397f736b64c063ca8f769f3",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Just Eat",
                                "timestamp": "2025-11-10T00:00:00Z",
                                "description": "Just Eat.Co.UK LtdLondon",
                                "amount": -43.9,
                                "id": "24843fe405941a003634edd5f6acb619",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-10T00:00:00Z",
                                "description": "B ARCHER Rent & Owings",
                                "amount": -150,
                                "id": "25f25b5af9c64b5492b4cf320a16bf08",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-10T00:00:00Z",
                                "description": "Benjamin Meehan Meal",
                                "amount": -110,
                                "id": "6ef70a84cfafbf2816038d69e705d281",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-10T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "6f3e160909652a408c0e5107574b9d41",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-11-10T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "f589e28f373ea8888e49eb3748653d07",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-11-10T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "b8d37aa705d1f6f60c7fe0abb4aaebd2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-09T00:00:00Z",
                                "description": "Benjamin Meehan RETURN REJECT",
                                "amount": -50,
                                "id": "a5f754c5e3a4f51bcad8a2a157b2bf2d",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-09T00:00:00Z",
                                "description": "Benjamin Meehan Jacob Robert Arche",
                                "amount": 50,
                                "id": "93f2af753c290441057d96c9360d07d1",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-07T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 7.11.25",
                                "amount": 440,
                                "id": "00f9c71275693005d466d231746d1a4b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Google",
                                "timestamp": "2025-11-06T00:00:00Z",
                                "description": "GOOGLE *Google Plag.co/helppay#",
                                "amount": -29.97,
                                "id": "0fa775e9fa58f8a57b2281d856f4677d",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-05T00:00:00Z",
                                "description": "HLTN03 VOIPSTUDIO.",
                                "amount": -18,
                                "id": "57efabbf4332c55d74b2145b3ed89a52",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon Prime Video",
                                "timestamp": "2025-11-05T00:00:00Z",
                                "description": "HLTN05 PRIME VIDE",
                                "amount": -5,
                                "id": "05b28649733c15d4d1d0d2e9af83ad56",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon Prime Video",
                                "timestamp": "2025-11-05T00:00:00Z",
                                "description": "HLTN04 PRIME VIDEO",
                                "amount": -4,
                                "id": "74e37a254758995c00bce013d15264e6",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Transport for London",
                                "timestamp": "2025-11-05T00:00:00Z",
                                "description": "HLTN06 TFL TRAVEL",
                                "amount": -3.1,
                                "id": "88cff579b837c22234f7e3613bf5c321",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Google",
                                "timestamp": "2025-11-04T00:00:00Z",
                                "description": "GOOGLE *Google Plag.co/helppay#",
                                "amount": -12.99,
                                "id": "5f375a74644bd908e00fd03834d1e579",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Vape Club",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "VAPE CLUB LTD WATFORD",
                                "amount": -39.97,
                                "id": "5ff7571700be937346932392ded4e84b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "b4e6e3e698d83bd34493d70b864ef210",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "CAR STEWART S",
                                "amount": 70,
                                "id": "9738cf4da5ca96b561a70e21a6b8e666",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "77bda169d7f18df9e0350118929e55c1",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "c4e8a8624a787db81490123872b4c090",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Driver And Vehicle Licensing Agency",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "DVLA-WF60YWP",
                                "amount": -18.81,
                                "id": "0375fd775ea648bae3eea8ec7de8b713",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Driver And Vehicle Licensing Agency",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "DVLA-OE62WGD",
                                "amount": -29.31,
                                "id": "8b815c0f80804a7933ef4966d278015f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "REVERSAL OF 03-11 ADMIRAL INSURANCE",
                                "amount": 90.18,
                                "id": "41f008d187aacafb9284eb4c05aa1229",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Admiral",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "ADMIRAL INSURANCE",
                                "amount": -90.18,
                                "id": "4c188f7806f94d3181ee32fc0e341764",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-03T00:00:00Z",
                                "description": "PROSPECT UNION",
                                "amount": -11.25,
                                "id": "5ecbcc1af74c6fb0b4f46f84010380c0",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-31T00:00:00Z",
                                "description": "STEWART S Holidayxx",
                                "amount": 150,
                                "id": "db76f59f7ac5395ab94ec1a7d5648ee2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Trainline",
                                "timestamp": "2025-10-31T00:00:00Z",
                                "description": "HLTN02 TRAINLINE",
                                "amount": -14.2,
                                "id": "be44b1efe0dfa1282da88d4d90446f0f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-30T00:00:00Z",
                                "description": "Non-Sterling Transaction Fee",
                                "amount": -0.24,
                                "id": "0fed04a35afb73104eb934f0b51a734c",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-30T00:00:00Z",
                                "description": "INT'L 0066211166 DUOFAX.COM PRAHA 4 EUR 10.00 @ 1.1376 Visa Rate",
                                "amount": -8.79,
                                "id": "1e9ddbd0ab75bae40bd07f0c33934013",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Trainline",
                                "timestamp": "2025-10-30T00:00:00Z",
                                "description": "TRAINLINE WWW.THETRAINL",
                                "amount": -10,
                                "id": "69fceaa63ab5cf18b7104dc18aa37cbe",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Trainline",
                                "timestamp": "2025-10-29T00:00:00Z",
                                "description": "HLTN01 TRAINLINE",
                                "amount": -10,
                                "id": "195adc7b7f10efe1bfda62c24dbd0a07",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-28T00:00:00Z",
                                "description": "Se Iou",
                                "amount": -110,
                                "id": "2789d8f6f89e6d2f4dec2a99dd406980",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-28T00:00:00Z",
                                "description": "404434 21857479 INTERNET TRANSFER",
                                "amount": 50,
                                "id": "e8dc9f623531137194dad9a1eda4b000",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "Jacob TSB work return iou",
                                "amount": -150,
                                "id": "6cc540e761172036d41dca37fce01d38",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -160.31,
                                "id": "3c8640af1c234df97be59a19b6af559b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -1000,
                                "id": "282a0116410532bb12df1fce68ff2ca2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "B ARCHER Rent & Owings x4",
                                "amount": -600,
                                "id": "c84f0526ba6a0e5fbfb96fb23e3ae47f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "Se Iou",
                                "amount": -100,
                                "id": "8aaca016c37aae8ae9737b19a065d93a",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "The Cock Tavern",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "The Cock Tavern London",
                                "amount": -10,
                                "id": "7df7f2e338caa7671e1ae19794a33cdf",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "e5eb85608f0211749d34f470bac543e2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "14315818ab265b9e865341971ca3cf7e",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "f0f4a7e4a0b6e57308ecd882243d9d6f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "HLTN PREMIUM",
                                "amount": -150,
                                "id": "4e74dc5b71f6cab998e729cb943a5805",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-24T00:00:00Z",
                                "description": "THUR HOSK SO LLP W/E 24/10 SCREWFIX",
                                "amount": 2272.48,
                                "id": "9ff7a8f1b4bb4337e257c78ad2629d25",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-22T00:00:00Z",
                                "description": "LEE CAJ CAROLINE is fab",
                                "amount": 20,
                                "id": "3a05881505230f565f56c9770184af71",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Google Moon",
                                "timestamp": "2025-10-22T00:00:00Z",
                                "description": "HLTN48 GOOGLE GOOG",
                                "amount": -25,
                                "id": "e43c2d9863475454a2b188d11b304331",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Just Eat",
                                "timestamp": "2025-10-20T00:00:00Z",
                                "description": "Just Eat.Co.UK LtdLondon",
                                "amount": -22.47,
                                "id": "d09c63041f2cb6c6d38f8ff828617356",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-20T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "3fa9b21c0eb1d3c8b5c0603c6440bc7b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-10-20T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "15698d426b434690ca629a80c68bbc9a",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-10-20T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "473567e154be184192a74a2fd31e8171",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-17T00:00:00Z",
                                "description": "ICO",
                                "amount": -47,
                                "id": "efc07b773f209dd7258ffbedf7735585",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon",
                                "timestamp": "2025-10-17T00:00:00Z",
                                "description": "HLTN47 AMAZON.CO.U",
                                "amount": -7,
                                "id": "816c182fd4846287a6555db48f99500a",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon",
                                "timestamp": "2025-10-15T00:00:00Z",
                                "description": "HLTN45 AMAZON.CO.U",
                                "amount": -14,
                                "id": "1574fbd61b751b043d1a70f4eacc534f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon Prime Video",
                                "timestamp": "2025-10-15T00:00:00Z",
                                "description": "HLTN46 PRIME VIDE",
                                "amount": -4,
                                "id": "a1655eeb312498a610245c1cc2c2b12c",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon",
                                "timestamp": "2025-10-14T00:00:00Z",
                                "description": "HLTN44 AMAZON.CO.U",
                                "amount": -4,
                                "id": "787afb76f56828da3d4df278d4ab4256",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Just Eat",
                                "timestamp": "2025-10-13T00:00:00Z",
                                "description": "Just Eat.Co.UK LtdLondon",
                                "amount": -25.96,
                                "id": "480b4c4823d8d7e8da089e9e95878bda",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Vape Club",
                                "timestamp": "2025-10-13T00:00:00Z",
                                "description": "VAPE CLUB LTD WATFORD",
                                "amount": -49.97,
                                "id": "6e4bfc8286eb54cbf5cf1d7030175d54",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-13T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "000fdb8c5d670d5a1cfc9298e6a9aa08",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-10-13T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "c104d08004a929187f8611aa62d6141b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-10-13T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "6d8e97047838357c619ae9de7b76e52e",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Just Eat",
                                "timestamp": "2025-10-08T00:00:00Z",
                                "description": "Just Eat.Co.UK LtdLondon",
                                "amount": -15.75,
                                "id": "b5a5ae621bbe8bac674b027f047bac97",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-06T00:00:00Z",
                                "description": "Non-Sterling Transaction Fee",
                                "amount": -0.24,
                                "id": "61ac548a6c55b987e741d3c70b7bf82e",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-06T00:00:00Z",
                                "description": "INT'L 0066184243 DUOFAX.COM PRAHA 4 EUR 10.00 @ 1.1454 Visa Rate",
                                "amount": -8.73,
                                "id": "e1affbffd520a240dfcfe1636eb7edf5",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Vape Club",
                                "timestamp": "2025-10-06T00:00:00Z",
                                "description": "VAPE CLUB LTD WATFORD",
                                "amount": -47.98,
                                "id": "3e7088d0021f50795f1bb6636abd1f2f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Just Eat",
                                "timestamp": "2025-10-06T00:00:00Z",
                                "description": "Just Eat.Co.UK LtdLondon",
                                "amount": -25.96,
                                "id": "7354365839e01f9ae93d96ed75ddf5ee",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Google",
                                "timestamp": "2025-10-06T00:00:00Z",
                                "description": "GOOGLE *Google Plag.co/helppay#",
                                "amount": -12.99,
                                "id": "92d3324c249c1da1648506bf22a36a2f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-06T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "fea61beecc5bc5a72a5bdb0976c7bb25",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-10-06T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "9e462d0d506872cbc794e034eb96a8bd",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-10-06T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "0309bc1935d09be5822855cf322f70cc",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon Prime Video",
                                "timestamp": "2025-10-06T00:00:00Z",
                                "description": "HLTN43 PRIME VIDE",
                                "amount": -5,
                                "id": "c4dfdfe558fe18e7863df736090484b0",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "B ARCHER Rent & Owings x2",
                                "amount": -300,
                                "id": "fc339ff805ae07fb3bc7355dce8f7050",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 3.10.25",
                                "amount": 660,
                                "id": "65bea463c180e32c536ebf770ad4f6db",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "HMRC GOV.UK SA GLASGOW",
                                "amount": -197.6,
                                "id": "85edd8e1479758f6319dbaddf1c7ea07",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "HLTN42 VOIPSTUDIO.",
                                "amount": -18,
                                "id": "689739b38b650b11fe07cffa4ae44318",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Paypal",
                                "timestamp": "2025-10-02T00:00:00Z",
                                "description": "PAYPAL *UBERTRIP 35314369001",
                                "amount": -1.5,
                                "id": "978597377aad280b5e524a94a4e97d28",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-10-02T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -2034.26,
                                "id": "313deb3db30a087d274b7429bc9637b9",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-02T00:00:00Z",
                                "description": "JACOB ARCHER-MORANGWD25",
                                "amount": 2300,
                                "id": "d5fdf791a4294d42275adabc74e82413",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Experian",
                                "timestamp": "2025-10-02T00:00:00Z",
                                "description": "HLTN41 EXPERIAN LT",
                                "amount": -15,
                                "id": "d44b2966f183387818cb0915d7782198",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Apple",
                                "timestamp": "2025-10-01T00:00:00Z",
                                "description": "PAYPAL *APPLE.COM/35314369001",
                                "amount": -0.99,
                                "id": "f5c08a758d1d481bcf1f07d088161874",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-01T00:00:00Z",
                                "description": "CAR STEWART S",
                                "amount": 70,
                                "id": "ea13d2a5a3d225c323b8193b4a5d1dd8",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Driver And Vehicle Licensing Agency",
                                "timestamp": "2025-10-01T00:00:00Z",
                                "description": "DVLA-WF60YWP",
                                "amount": -18.81,
                                "id": "f918f881fb7eee736b8db824fb0f42bf",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Driver And Vehicle Licensing Agency",
                                "timestamp": "2025-10-01T00:00:00Z",
                                "description": "DVLA-OE62WGD",
                                "amount": -29.31,
                                "id": "43580b657664533030bf8af3bfd6ad8e",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Admiral",
                                "timestamp": "2025-10-01T00:00:00Z",
                                "description": "ADMIRAL INSURANCE",
                                "amount": -90.18,
                                "id": "db20112ffe29f638cf31e056b0678467",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-01T00:00:00Z",
                                "description": "PROSPECT UNION",
                                "amount": -11.25,
                                "id": "148fff3918e5d81fda9aa0a6a6d32dbf",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Just Eat",
                                "timestamp": "2025-09-30T00:00:00Z",
                                "description": "Just Eat.Co.UK LtdLondon",
                                "amount": -25.57,
                                "id": "748ebfbf7f8d39bed8c5eaf4e11a6eff",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Omaze Uk",
                                "timestamp": "2025-09-29T00:00:00Z",
                                "description": "SP OMAZE UK ALTRINCHAM",
                                "amount": -15,
                                "id": "35411103828cce4fb150e3706921a73c",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Just Eat",
                                "timestamp": "2025-09-29T00:00:00Z",
                                "description": "Just Eat.Co.UK LtdLondon",
                                "amount": -38.38,
                                "id": "66c9b09401a82e6a93c16a4686eb972f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-29T00:00:00Z",
                                "description": "Just Eat.Co.UK LtdLondon",
                                "amount": 7,
                                "id": "ec03370db9358e8140d4705606e97f61",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-29T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "e3d73daf8064029bd77095eb288626df",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-29T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "725d9bb576d08331bc049efeb5175250",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-29T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "58410776ed94bee425e6802e9d8bfb08",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-28T00:00:00Z",
                                "description": "STEWART S Holidayxx",
                                "amount": 200,
                                "id": "d1c97b4c29623482d6ff920ded9ffddc",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Deliveroo",
                                "timestamp": "2025-09-25T00:00:00Z",
                                "description": "DELIVEROO LONDON",
                                "amount": -12.08,
                                "id": "db00abb4cb860f45ae492c01ef9e2678",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Vape Club",
                                "timestamp": "2025-09-25T00:00:00Z",
                                "description": "VAPE CLUB LTD WATFORD",
                                "amount": -28.99,
                                "id": "f51ae34cf58f79774ef91ff72fd2a4f4",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-25T00:00:00Z",
                                "description": "Klarna Financial SYA777777777713C9YB",
                                "amount": -199.56,
                                "id": "2e6ee436a7394f2406fdebb7664f0dc1",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Deliveroo",
                                "timestamp": "2025-09-24T00:00:00Z",
                                "description": "DELIVEROO LONDON",
                                "amount": -17.54,
                                "id": "63016b02bf97950287954693ee4e39c5",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Co-op",
                                "timestamp": "2025-09-24T00:00:00Z",
                                "description": "CO-OP GROUP FOOD LONDON",
                                "amount": -1.95,
                                "id": "42a9f5445f421a3152bbd97cf66bc2f3",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Klarna",
                                "timestamp": "2025-09-24T00:00:00Z",
                                "description": "KLARNA",
                                "amount": -19.96,
                                "id": "e85d67c773a0a59136dad03d27b89f8c",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-22T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "3e30d63678a3853fa0c6c72ea04cd3cc",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-22T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "de57508d74169eda397e6758d2709f0c",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-22T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "f0cb165438e9f457043b6291208f8142",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-19T00:00:00Z",
                                "description": "Non-Sterling Transaction Fee",
                                "amount": -0.04,
                                "id": "a49711695aee358ffcd41a31223ae9d8",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-19T00:00:00Z",
                                "description": "INT'L 0048286545 2CO.COM&#xA6;MALWAREBYTAMSTERDAM EUR 1.90 @ 1.1515 Visa Rate",
                                "amount": -1.65,
                                "id": "793a721d100c4c9d39da959262398a9e",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-18T00:00:00Z",
                                "description": "GREAT WESTERN TRAI",
                                "amount": 75.25,
                                "id": "443f1383ff63083d556fd8bdebaba1dd",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-16T00:00:00Z",
                                "description": "HLTN40 VOIPSTUDIO.",
                                "amount": -18,
                                "id": "66794a0e3d6f8d55d6bb0bd2476c8667",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Deliveroo",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "DELIVEROO LONDON",
                                "amount": -14.4,
                                "id": "9881ca248ed50b787bb58df2f5b3c777",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Deliveroo",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "DELIVEROO LONDON",
                                "amount": -20.98,
                                "id": "fd6d855773564077849e35ffb31b0d5c",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "BIG PENNY SOCIAL LONDON",
                                "amount": -30.58,
                                "id": "e3fa3c1e6b036b1f400eacf7135c0a91",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Vape Club",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "VAPE CLUB LTD WATFORD",
                                "amount": -46.97,
                                "id": "0aa200fd9617c25aa5984a9395e1ffe8",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "5f930488e74ed312a8480764c4981aa4",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "6517ef405e4e6df7ad3a02ca3303ff02",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "18cc7f418b45382939ab155c3342a88b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-12T00:00:00Z",
                                "description": "Jacob Barclays holiday",
                                "amount": -15,
                                "id": "4ff304ac4c5d83b264e2077ee5742cfd",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-12T00:00:00Z",
                                "description": "Jacob Barclays holiday",
                                "amount": -10,
                                "id": "2f48a0db6c06f72b2f2453e033c45d59",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-12T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 12.9.25",
                                "amount": 220,
                                "id": "2eb349e09df20e7e811525c18130a684",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Deliveroo",
                                "timestamp": "2025-09-11T00:00:00Z",
                                "description": "DELIVEROO LONDON",
                                "amount": -18.68,
                                "id": "e6c038ae8032d7c918c6816cf8f24a59",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -550.67,
                                "id": "14b11a87620190e2b202574bdfb2d2e4",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "Se Iou",
                                "amount": -100,
                                "id": "3a6fc65196ab7f60ff8cca5d9a1d6d73",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -1500,
                                "id": "f64c8549d4927508cbee937952190e20",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "B ARCHER Owings finl",
                                "amount": -200,
                                "id": "4f1d2724e46e78ebd57b6ba524790134",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "JACOB ARCHER-MORANGWN25",
                                "amount": 2400,
                                "id": "ee587010c1a76619f7888e7448df3dac",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "d75cef9e6315bb83253b19168862250f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "ae6eed564313fee88ec7c7c5438918ab",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "542682a6285d84feca8f41b770f3e51d",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-09-07T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -1065.68,
                                "id": "0ea56de940d75d4b26c76aeee4ba8ddc",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-07T00:00:00Z",
                                "description": "Arc-McDo B Greece",
                                "amount": 500,
                                "id": "908b356faa560c1910ab62699105519e",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-06T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 6.9.25",
                                "amount": 800,
                                "id": "4eb4becb238395fa3a60bff26b2e4797",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-04T00:00:00Z",
                                "description": "Non-Sterling Transaction Fee",
                                "amount": -0.23,
                                "id": "ea0be3b2bdf96aae306c31f03a7dce57",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-04T00:00:00Z",
                                "description": "INT'L 0037058365 DUOFAX.COM PRAHA 4 EUR 10.00 @ 1.1481 Visa Rate",
                                "amount": -8.71,
                                "id": "652937aac30a98c6022e1a134f3fcb60",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Google",
                                "timestamp": "2025-09-04T00:00:00Z",
                                "description": "GOOGLE *Google Plag.co/helppay#",
                                "amount": -12.99,
                                "id": "278277a7b541c44bc889fb469bb9dfad",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon Prime Video",
                                "timestamp": "2025-09-04T00:00:00Z",
                                "description": "HLTN39 PRIME VIDE",
                                "amount": -5,
                                "id": "99cf0d9025219e9db05846853a886e41",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco",
                                "timestamp": "2025-09-03T00:00:00Z",
                                "description": "HLTN38 TESCO STORE",
                                "amount": -3.3,
                                "id": "0d09b7e15204724f016ad93b16d0b610",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-02T00:00:00Z",
                                "description": "THUR HOSK SO LLP CPC Expenses",
                                "amount": 29.52,
                                "id": "2084d3432b19833661dd626133b0c011",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Apple",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "PAYPAL *APPLE.COM/35314369001",
                                "amount": -0.99,
                                "id": "77de55dd13ff2d0e4d5b567d0c3d64c4",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Paypal",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "PAYPAL *UBERTRIP 35314369001",
                                "amount": -4.99,
                                "id": "ea9f9e6c2df2b1ba21ee791671120703",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "404434 21857479 INTERNET TRANSFER",
                                "amount": 130,
                                "id": "6260e8341669381eaa8163ab03e303e1",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "CAR STEWART S",
                                "amount": 70,
                                "id": "fabe29bf4ded2b8b45199b2de974cacb",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "24003b987c8d8caf48030c00403c100f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "f80b053a0dec8f9fcc2f804ff9dec59b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "b4df868d5c5422886bea471a5174e409",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Driver And Vehicle Licensing Agency",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "DVLA-WF60YWP",
                                "amount": -18.81,
                                "id": "db806b00827eff941557b092e65eb54e",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Driver And Vehicle Licensing Agency",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "DVLA-OE62WGD",
                                "amount": -29.31,
                                "id": "95d09ab23421509f6c09ad72aac77364",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Admiral",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "ADMIRAL INSURANCE",
                                "amount": -90.18,
                                "id": "5aaed144c1a4ae4e6d79906103c4e3e9",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "PROSPECT UNION",
                                "amount": -11.25,
                                "id": "3742b35a64f665ca2dafbf728f778757",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-08-30T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -200,
                                "id": "7792426ac76f46c4c60e6aa0d15f15a2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-30T00:00:00Z",
                                "description": "STEWART S Holidayxx",
                                "amount": 245,
                                "id": "1abd212b42e55440112ca9b8e2b87d9f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-26T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "27604ce52ddf620af046a390ebee4221",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-08-26T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "0455665fdc4e6f857f8aa209093f6b1c",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-08-26T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "ed9a9f36174e9d87770cbef4723ae752",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Klarna",
                                "timestamp": "2025-08-26T00:00:00Z",
                                "description": "KLARNA",
                                "amount": -19.96,
                                "id": "b19e2c02f668f78678effca245c1f9e2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-23T00:00:00Z",
                                "description": "Se Iou",
                                "amount": -50,
                                "id": "02747dcd4efaac2d613cd130ade34a7c",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Booking.com",
                                "timestamp": "2025-08-21T00:00:00Z",
                                "description": "HLTN37 BOOKING.COM",
                                "amount": -46.9,
                                "id": "a237465f6e362d37cdc703b64a22a153",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Wix",
                                "timestamp": "2025-08-19T00:00:00Z",
                                "description": "WIX.COM LONDON",
                                "amount": -27.6,
                                "id": "a3e6fe9e6de03e974c4008c18a27161c",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-18T00:00:00Z",
                                "description": "ME GROUP INTERNATIME Group Refund",
                                "amount": 7,
                                "id": "724af9b44b895a3513293f8b501e94bf",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-18T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "36f55f318292670ffe01e57043bd6f5b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-08-18T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "6d29b0e8f86cf4e577a73692c6702b67",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-08-18T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "11d40f95b89886b124b16f1fb2d55d78",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Amazon Prime Video",
                                "timestamp": "2025-08-15T00:00:00Z",
                                "description": "HLTN36 PRIME VIDE",
                                "amount": -4,
                                "id": "981f25ee4c213239859270fd6b1ad6c7",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-11T00:00:00Z",
                                "description": "LISA Arc-McDo B",
                                "amount": 20,
                                "id": "5343cd69b6e062310b6c47f3191c255d",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-08-11T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "3ad70ec958f634869ebd7364f9ac747a",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Moneybox",
                                "timestamp": "2025-08-11T00:00:00Z",
                                "description": "MONEYBOX",
                                "amount": -30,
                                "id": "fdc93358e0c4f27e4191ac62f83ebf65",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Nhs Prescription Prepayment Certificates",
                                "timestamp": "2025-08-11T00:00:00Z",
                                "description": "NHSBSA PPC 2",
                                "amount": -11.45,
                                "id": "3b8c304a7d6d3f2c5eaaacc4fea7b182",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DIRECT_DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "WM Morrisons",
                                "timestamp": "2025-08-11T00:00:00Z",
                                "description": "WM MORRISONS STOREFAKENHAM",
                                "amount": -51.5,
                                "id": "4dd658bb513f80a1f873c6268248b798",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              }
                            ]
                          },
                          "071fc97cd0cf36290a519783bb8f1114": {
                            "info": {
                              "number": {
                                "iban": "GB13MIDL40443421857479",
                                "number": "21857479",
                                "sort_code": "40-44-34",
                                "swift_bic": ""
                              },
                              "name": "FLEX SAVER",
                              "provider": {
                                "id": "ob-hsbc",
                                "name": "HSBC"
                              },
                              "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "balance": {
                                "available": 50.3,
                                "current": 50.3,
                                "overdraft": 0
                              },
                              "info": [
                                {
                                  "full_name": "Mr Jacob Robert Archer-Moran",
                                  "phones": null,
                                  "date_of_birth": "",
                                  "emails": null,
                                  "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                  "addresses": null
                                }
                              ],
                              "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "currency": "GBP",
                              "metadata": {
                                "created_at": 1762991926938,
                                "tl": {
                                  "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                  "debug_id": "",
                                  "download_status": "complete",
                                  "task_id": "0b9d546d-7a51-4392-b638-0be9ebffbd4a"
                                },
                                "updated_at": 1762991924193
                              },
                              "type": "SAVINGS"
                            },
                            "statement": [
                              {
                                "merchant_name": "",
                                "timestamp": "2025-11-06T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "05a65b1d49babb4d449db63687f32262",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-30T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "30f053128f38de8ef7e0262302cffc8b",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-28T00:00:00Z",
                                "description": "404434 71857460 INTERNET TRANSFER",
                                "amount": -50,
                                "id": "0e25dc2e339a922ea4d407d861cf0465",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-23T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "8b60e9df59164c3719eb8ba2a3737066",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-20T00:00:00Z",
                                "description": "GROSS INTEREST TO 19OCT2025",
                                "amount": 0.05,
                                "id": "dc8ccae8b5d94ff4a6f84b741f21c4f0",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "INTEREST",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-16T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "9c2d073f614ff5cf9c5c4c89f98c5548",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-09T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "0fd34b36a11b2a5beaed5d0bdfb71e2a",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-02T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "2f161e27a5d0124a855fb5958ba8d4ca",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-25T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "d78230be74370f682fa0ef2a3427fa9e",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-20T00:00:00Z",
                                "description": "GROSS INTEREST TO 19SEP2025",
                                "amount": 0.06,
                                "id": "e293c607abb4a95228cf43e765873533",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "INTEREST",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-18T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "5a7ab01dbe8e3f6f16da8623e1180077",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-11T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "7e155bf256e41c799e87179c9e435440",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-04T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "b4e3c8cbc22858e1f742715fcf60d9ce",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "404434 71857460 INTERNET TRANSFER",
                                "amount": -130,
                                "id": "104b2be93860d304d1bc5e53291b36f7",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-28T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "7073d71d64314581f68658976cb5b8bd",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-21T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "3cb960a06eed48da5a7b09ab486254d8",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-20T00:00:00Z",
                                "description": "GROSS INTEREST TO 19AUG2025",
                                "amount": 0.1,
                                "id": "2e171add99d24c5785fc3f538ceefc46",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "INTEREST",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-14T00:00:00Z",
                                "description": "GRANDAD Arc-McDo B",
                                "amount": 10,
                                "id": "7516e2bdd553795219da981866e5510b",
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              }
                            ]
                          },
                          "cb6440fd6af1f4329588bf7c2bce69da": {
                            "info": {
                              "number": {
                                "iban": "GB54MIDL40115670868833",
                                "number": "70868833",
                                "sort_code": "40-11-56",
                                "swift_bic": ""
                              },
                              "name": "FLEX SAVER",
                              "provider": {
                                "id": "ob-hsbc",
                                "name": "HSBC"
                              },
                              "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "balance": {
                                "available": 0.19,
                                "current": 0.19,
                                "overdraft": 0
                              },
                              "info": [
                                {
                                  "full_name": "Mr Jacob Robert Archer-Moran",
                                  "phones": null,
                                  "date_of_birth": "",
                                  "emails": null,
                                  "update_timestamp": "2025-11-12T23:58:39.1736979Z",
                                  "addresses": null
                                }
                              ],
                              "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                              "currency": "GBP",
                              "metadata": {
                                "created_at": 1762991926753,
                                "tl": {
                                  "account_id": "cb6440fd6af1f4329588bf7c2bce69da",
                                  "debug_id": "",
                                  "download_status": "complete",
                                  "task_id": "364a617e-b5f9-49e5-ae3d-af0d41b896b5"
                                },
                                "updated_at": 1762991924193
                              },
                              "type": "SAVINGS"
                            }
                          }
                        },
                        "analysis": {
                          "id": "4151814894",
                          "repeating_transactions": [
                            {
                              "sort_score": 600,
                              "items": [
                                "25f25b5af9c64b5492b4cf320a16bf08",
                                "c84f0526ba6a0e5fbfb96fb23e3ae47f",
                                "fc339ff805ae07fb3bc7355dce8f7050"
                              ]
                            },
                            {
                              "sort_score": 245,
                              "items": [
                                "1abd212b42e55440112ca9b8e2b87d9f",
                                "d1c97b4c29623482d6ff920ded9ffddc",
                                "db76f59f7ac5395ab94ec1a7d5648ee2"
                              ]
                            },
                            {
                              "sort_score": 130,
                              "items": [
                                "0e25dc2e339a922ea4d407d861cf0465",
                                "104b2be93860d304d1bc5e53291b36f7"
                              ]
                            },
                            {
                              "sort_score": 130,
                              "items": [
                                "6260e8341669381eaa8163ab03e303e1",
                                "e8dc9f623531137194dad9a1eda4b000"
                              ]
                            },
                            {
                              "sort_score": 110,
                              "items": [
                                "02747dcd4efaac2d613cd130ade34a7c",
                                "2789d8f6f89e6d2f4dec2a99dd406980",
                                "3a6fc65196ab7f60ff8cca5d9a1d6d73",
                                "8aaca016c37aae8ae9737b19a065d93a"
                              ]
                            },
                            {
                              "sort_score": 90.18,
                              "items": [
                                "4c188f7806f94d3181ee32fc0e341764",
                                "5aaed144c1a4ae4e6d79906103c4e3e9",
                                "db20112ffe29f638cf31e056b0678467"
                              ]
                            },
                            {
                              "sort_score": 70,
                              "items": [
                                "9738cf4da5ca96b561a70e21a6b8e666",
                                "ea13d2a5a3d225c323b8193b4a5d1dd8",
                                "fabe29bf4ded2b8b45199b2de974cacb"
                              ]
                            },
                            {
                              "sort_score": 49.97,
                              "items": [
                                "0aa200fd9617c25aa5984a9395e1ffe8",
                                "3e7088d0021f50795f1bb6636abd1f2f",
                                "5ff7571700be937346932392ded4e84b",
                                "6e4bfc8286eb54cbf5cf1d7030175d54",
                                "f51ae34cf58f79774ef91ff72fd2a4f4"
                              ]
                            },
                            {
                              "sort_score": 43.9,
                              "items": [
                                "24843fe405941a003634edd5f6acb619",
                                "480b4c4823d8d7e8da089e9e95878bda",
                                "66c9b09401a82e6a93c16a4686eb972f",
                                "7354365839e01f9ae93d96ed75ddf5ee",
                                "748ebfbf7f8d39bed8c5eaf4e11a6eff",
                                "b5a5ae621bbe8bac674b027f047bac97",
                                "d09c63041f2cb6c6d38f8ff828617356"
                              ]
                            },
                            {
                              "sort_score": 2400,
                              "items": [
                                "d5fdf791a4294d42275adabc74e82413",
                                "ee587010c1a76619f7888e7448df3dac"
                              ]
                            },
                            {
                              "sort_score": 2034.26,
                              "items": [
                                "0ea56de940d75d4b26c76aeee4ba8ddc",
                                "14b11a87620190e2b202574bdfb2d2e4",
                                "282a0116410532bb12df1fce68ff2ca2",
                                "313deb3db30a087d274b7429bc9637b9",
                                "3c8640af1c234df97be59a19b6af559b",
                                "7792426ac76f46c4c60e6aa0d15f15a2",
                                "f64c8549d4927508cbee937952190e20"
                              ]
                            },
                            {
                              "sort_score": 800,
                              "items": [
                                "00f9c71275693005d466d231746d1a4b",
                                "2eb349e09df20e7e811525c18130a684",
                                "4eb4becb238395fa3a60bff26b2e4797",
                                "65bea463c180e32c536ebf770ad4f6db"
                              ]
                            },
                            {
                              "sort_score": 30,
                              "items": [
                                "0309bc1935d09be5822855cf322f70cc",
                                "0455665fdc4e6f857f8aa209093f6b1c",
                                "11d40f95b89886b124b16f1fb2d55d78",
                                "14315818ab265b9e865341971ca3cf7e",
                                "15698d426b434690ca629a80c68bbc9a",
                                "18cc7f418b45382939ab155c3342a88b",
                                "3ad70ec958f634869ebd7364f9ac747a",
                                "473567e154be184192a74a2fd31e8171",
                                "542682a6285d84feca8f41b770f3e51d",
                                "58410776ed94bee425e6802e9d8bfb08",
                                "6517ef405e4e6df7ad3a02ca3303ff02",
                                "6d29b0e8f86cf4e577a73692c6702b67",
                                "6d8e97047838357c619ae9de7b76e52e",
                                "725d9bb576d08331bc049efeb5175250",
                                "77bda169d7f18df9e0350118929e55c1",
                                "9e462d0d506872cbc794e034eb96a8bd",
                                "ae6eed564313fee88ec7c7c5438918ab",
                                "b4df868d5c5422886bea471a5174e409",
                                "b8d37aa705d1f6f60c7fe0abb4aaebd2",
                                "c104d08004a929187f8611aa62d6141b",
                                "c4e8a8624a787db81490123872b4c090",
                                "de57508d74169eda397e6758d2709f0c",
                                "ed9a9f36174e9d87770cbef4723ae752",
                                "f0cb165438e9f457043b6291208f8142",
                                "f0f4a7e4a0b6e57308ecd882243d9d6f",
                                "f589e28f373ea8888e49eb3748653d07",
                                "f80b053a0dec8f9fcc2f804ff9dec59b",
                                "fdc93358e0c4f27e4191ac62f83ebf65"
                              ]
                            },
                            {
                              "sort_score": 29.97,
                              "items": [
                                "0fa775e9fa58f8a57b2281d856f4677d",
                                "278277a7b541c44bc889fb469bb9dfad",
                                "5f375a74644bd908e00fd03834d1e579",
                                "92d3324c249c1da1648506bf22a36a2f"
                              ]
                            },
                            {
                              "sort_score": 29.31,
                              "items": [
                                "0375fd775ea648bae3eea8ec7de8b713",
                                "43580b657664533030bf8af3bfd6ad8e",
                                "8b815c0f80804a7933ef4966d278015f",
                                "95d09ab23421509f6c09ad72aac77364",
                                "db806b00827eff941557b092e65eb54e",
                                "f918f881fb7eee736b8db824fb0f42bf"
                              ]
                            },
                            {
                              "sort_score": 20.98,
                              "items": [
                                "63016b02bf97950287954693ee4e39c5",
                                "9881ca248ed50b787bb58df2f5b3c777",
                                "db00abb4cb860f45ae492c01ef9e2678",
                                "e6c038ae8032d7c918c6816cf8f24a59",
                                "fd6d855773564077849e35ffb31b0d5c"
                              ]
                            },
                            {
                              "sort_score": 20,
                              "items": [
                                "000fdb8c5d670d5a1cfc9298e6a9aa08",
                                "24003b987c8d8caf48030c00403c100f",
                                "27604ce52ddf620af046a390ebee4221",
                                "36f55f318292670ffe01e57043bd6f5b",
                                "3e30d63678a3853fa0c6c72ea04cd3cc",
                                "3fa9b21c0eb1d3c8b5c0603c6440bc7b",
                                "5343cd69b6e062310b6c47f3191c255d",
                                "5f930488e74ed312a8480764c4981aa4",
                                "6f3e160909652a408c0e5107574b9d41",
                                "b4e6e3e698d83bd34493d70b864ef210",
                                "d75cef9e6315bb83253b19168862250f",
                                "e3d73daf8064029bd77095eb288626df",
                                "e5eb85608f0211749d34f470bac543e2",
                                "fea61beecc5bc5a72a5bdb0976c7bb25"
                              ]
                            },
                            {
                              "sort_score": 19.96,
                              "items": [
                                "b19e2c02f668f78678effca245c1f9e2",
                                "e85d67c773a0a59136dad03d27b89f8c"
                              ]
                            },
                            {
                              "sort_score": 18,
                              "items": [
                                "57efabbf4332c55d74b2145b3ed89a52",
                                "66794a0e3d6f8d55d6bb0bd2476c8667",
                                "689739b38b650b11fe07cffa4ae44318"
                              ]
                            },
                            {
                              "sort_score": 15,
                              "items": [
                                "2f48a0db6c06f72b2f2453e033c45d59",
                                "4ff304ac4c5d83b264e2077ee5742cfd"
                              ]
                            },
                            {
                              "sort_score": 14.2,
                              "items": [
                                "195adc7b7f10efe1bfda62c24dbd0a07",
                                "be44b1efe0dfa1282da88d4d90446f0f"
                              ]
                            },
                            {
                              "sort_score": 14,
                              "items": [
                                "1574fbd61b751b043d1a70f4eacc534f",
                                "787afb76f56828da3d4df278d4ab4256",
                                "816c182fd4846287a6555db48f99500a"
                              ]
                            },
                            {
                              "sort_score": 11.45,
                              "items": [
                                "2c1282c5c397f736b64c063ca8f769f3",
                                "3b8c304a7d6d3f2c5eaaacc4fea7b182"
                              ]
                            },
                            {
                              "sort_score": 11.25,
                              "items": [
                                "148fff3918e5d81fda9aa0a6a6d32dbf",
                                "3742b35a64f665ca2dafbf728f778757",
                                "5ecbcc1af74c6fb0b4f46f84010380c0"
                              ]
                            },
                            {
                              "sort_score": 10,
                              "items": [
                                "05a65b1d49babb4d449db63687f32262",
                                "0fd34b36a11b2a5beaed5d0bdfb71e2a",
                                "2f161e27a5d0124a855fb5958ba8d4ca",
                                "30f053128f38de8ef7e0262302cffc8b",
                                "3cb960a06eed48da5a7b09ab486254d8",
                                "5a7ab01dbe8e3f6f16da8623e1180077",
                                "7073d71d64314581f68658976cb5b8bd",
                                "7516e2bdd553795219da981866e5510b",
                                "7e155bf256e41c799e87179c9e435440",
                                "8b60e9df59164c3719eb8ba2a3737066",
                                "9c2d073f614ff5cf9c5c4c89f98c5548",
                                "b4e3c8cbc22858e1f742715fcf60d9ce",
                                "d78230be74370f682fa0ef2a3427fa9e"
                              ]
                            },
                            {
                              "sort_score": 8.79,
                              "items": [
                                "1e9ddbd0ab75bae40bd07f0c33934013",
                                "652937aac30a98c6022e1a134f3fcb60",
                                "e1affbffd520a240dfcfe1636eb7edf5"
                              ]
                            },
                            {
                              "sort_score": 5,
                              "items": [
                                "05b28649733c15d4d1d0d2e9af83ad56",
                                "981f25ee4c213239859270fd6b1ad6c7",
                                "99cf0d9025219e9db05846853a886e41",
                                "a1655eeb312498a610245c1cc2c2b12c",
                                "c4dfdfe558fe18e7863df736090484b0"
                              ]
                            },
                            {
                              "sort_score": 5,
                              "items": [
                                "5e16cad674a74e7d60dba1175e891c80",
                                "74e37a254758995c00bce013d15264e6"
                              ]
                            },
                            {
                              "sort_score": 4.99,
                              "items": [
                                "978597377aad280b5e524a94a4e97d28",
                                "ea9f9e6c2df2b1ba21ee791671120703"
                              ]
                            },
                            {
                              "sort_score": 0.99,
                              "items": [
                                "77de55dd13ff2d0e4d5b567d0c3d64c4",
                                "f5c08a758d1d481bcf1f07d088161874"
                              ]
                            },
                            {
                              "sort_score": 0.24,
                              "items": [
                                "0fed04a35afb73104eb934f0b51a734c",
                                "61ac548a6c55b987e741d3c70b7bf82e",
                                "a49711695aee358ffcd41a31223ae9d8",
                                "ea0be3b2bdf96aae306c31f03a7dce57"
                              ]
                            },
                            {
                              "sort_score": 0.1,
                              "items": [
                                "2e171add99d24c5785fc3f538ceefc46",
                                "dc8ccae8b5d94ff4a6f84b741f21c4f0",
                                "e293c607abb4a95228cf43e765873533"
                              ]
                            }
                          ],
                          "large_one_off_transactions": [
                            "4f1d2724e46e78ebd57b6ba524790134",
                            "2e6ee436a7394f2406fdebb7664f0dc1",
                            "85edd8e1479758f6319dbaddf1c7ea07",
                            "4e74dc5b71f6cab998e729cb943a5805",
                            "6cc540e761172036d41dca37fce01d38",
                            "6ef70a84cfafbf2816038d69e705d281",
                            "4dd658bb513f80a1f873c6268248b798",
                            "a5f754c5e3a4f51bcad8a2a157b2bf2d",
                            "efc07b773f209dd7258ffbedf7735585",
                            "a237465f6e362d37cdc703b64a22a153",
                            "9ff7a8f1b4bb4337e257c78ad2629d25",
                            "908b356faa560c1910ab62699105519e",
                            "41f008d187aacafb9284eb4c05aa1229",
                            "443f1383ff63083d556fd8bdebaba1dd",
                            "93f2af753c290441057d96c9360d07d1",
                            "2084d3432b19833661dd626133b0c011",
                            "3a05881505230f565f56c9770184af71",
                            "724af9b44b895a3513293f8b501e94bf",
                            "ec03370db9358e8140d4705606e97f61"
                          ],
                          "sof_matches": {}
                        }
                      },
                      "data": {},
                      "result": "clear",
                      "documents": [],
                      "id": "d4ahyhj23amg030yry8g",
                      "status": "closed",
                      "createdAt": "2025-11-12T23:59:02.622Z"
                    },
                    "address": {
                      "result": "fail",
                      "status": "closed",
                      "data": {
                        "quality": 0
                      }
                    },
                    "biometrics": {
                      "result": "clear",
                      "status": "complete",
                      "data": {}
                    },
                    "identity": {
                      "breakdown": {
                        "nfc": {
                          "breakdown": {
                            "chip": {
                              "breakdown": {
                                "clone_detection": {
                                  "result": "clear"
                                },
                                "verification": {
                                  "result": "clear"
                                }
                              },
                              "result": "clear"
                            },
                            "data_comparison": {
                              "breakdown": {
                                "dob": {
                                  "result": "clear",
                                  "properties": {
                                    "days_difference": 0
                                  }
                                },
                                "name": {
                                  "result": "clear",
                                  "properties": {
                                    "levenshtein_pct": 100
                                  }
                                }
                              },
                              "result": "clear"
                            }
                          },
                          "result": "clear",
                          "status": "complete"
                        },
                        "documents": [
                          {
                            "id": "d4ahx6c23amg030yrxng",
                            "type": "passport"
                          },
                          {
                            "id": "d4ahxa523amg030yrxp0",
                            "type": "face-image"
                          },
                          {
                            "id": "d4ahxen23amg030yrxpg",
                            "type": "selfie"
                          }
                        ],
                        "biometrics": {
                          "breakdown": {
                            "attempts": [
                              {
                                "frame_available": false,
                                "passed": true,
                                "status": "complete",
                                "token": {
                                  "created_at": 1762991785704,
                                  "validated_at": 1762991802582,
                                  "value": "9e88701ce7ebab6fa31edc175511469b544876b3647286732cce913e1801vi07"
                                }
                              }
                            ]
                          },
                          "result": "clear",
                          "status": "complete"
                        }
                      },
                      "data": {
                        "nfc": {
                          "date_of_expiry": "22.08.2033",
                          "dob": "11.01.2001",
                          "name": "MORAN, JACOB ROBERT"
                        },
                        "name": {
                          "first": "Jacob",
                          "last": "Moran",
                          "other": "Robert"
                        },
                        "dob": "2001-01-11T00:00:00.000Z"
                      },
                      "result": "clear",
                      "documents": [
                        "d4ahx6c23amg030yrxng",
                        "d4ahxa523amg030yrxp0",
                        "d4ahxen23amg030yrxpg"
                      ],
                      "id": "d4ahytb23amg030yryg0",
                      "status": "closed",
                      "createdAt": "2025-11-12T23:59:37.209Z"
                    },
                    "footprint": {
                      "breakdown": {
                        "data_count": {
                          "properties": {
                            "score": 0
                          },
                          "result": "consider"
                        },
                        "data_quality": {
                          "properties": {
                            "score": 0
                          },
                          "result": "consider"
                        },
                        "service_name": "Authenticateplus",
                        "documents": [
                          {
                            "id": "d4ahysv23amg030yrya0",
                            "type": "poa"
                          },
                          {
                            "id": "d4ahysv23amg030yryag",
                            "type": "poa"
                          }
                        ],
                        "rules": [
                          {
                            "id": "U000",
                            "name": "",
                            "score": 0,
                            "text": "No trace of supplied Address(es), or manual Authentication required by the Applicant"
                          }
                        ]
                      },
                      "data": {
                        "dob": "2001-01-11T00:00:00.000Z",
                        "name": {
                          "first": "Jacob",
                          "last": "Moran",
                          "other": "Robert"
                        },
                        "address": {
                          "postcode": "TR15 2ND",
                          "country": "GBR",
                          "street": "Southgate Street",
                          "building_number": "94",
                          "town": "Redruth"
                        }
                      },
                      "result": "fail",
                      "documents": [
                        "d4ahysv23amg030yrya0",
                        "d4ahysv23amg030yryag"
                      ],
                      "id": "d4ahyt323amg030yryc0",
                      "status": "closed",
                      "createdAt": "2025-11-12T23:59:36.715Z"
                    }
                  },
                  "updatedAt": "2025-11-12T23:59:45.159Z",
                  "consumerPhone": "+447506430094",
                  "pdfReady": true,
                  "checkType": "electronic-id",
                  "completedAt": "2025-11-12T23:59:45.159Z",
                  "initiatedAt": "2025-11-12T23:41:12.646Z",
                  "considerReasons": [
                    "address verification",
                    "digital footprint",
                    "PEP hits"
                  ],
                  "pdfS3Key": "protected/thTrohE",
                  "consumerName": "Jacob Robert Archer-Moran",
                  "tasks": [
                    "report:identity",
                    "report:footprint",
                    "report:peps",
                    "documents:poa",
                    "report:sof-v1",
                    "report:bank-statement",
                    "report:bank-summary"
                  ],
                  "updates": [
                    {
                      "timestamp": "2025-11-12T23:41:12.646Z",
                      "update": "Electronic ID check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                    },
                    {
                      "timestamp": "2025-11-12T23:59:45.159Z",
                      "update": "Transaction completed - awaiting PDF"
                    },
                    {
                      "timestamp": "2025-11-13T00:00:16.009Z",
                      "update": "PDF received and uploaded to S3 - CONSIDER: address verification, digital footprint, PEP hits"
                    },
                    {
                      "timestamp": "2025-11-13T00:33:37.535Z",
                      "update": "2 additional document(s) uploaded by consumer"
                    }
                  ],
                  "status": "closed",
                  "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                  "piiData": {
                    "name": {
                      "first": "Jacob",
                      "last": "Moran",
                      "other": "Robert"
                    },
                    "address": {
                      "postcode": "TR15 2ND",
                      "country": "GBR",
                      "street": "Southgate Street",
                      "building_number": "94",
                      "town": "Redruth"
                    },
                    "dob": "2001-01-11T00:00:00.000Z",
                    "document": {}
                  },
                  "hasMonitoring": false,
                  "thirdfortResponse": {
                    "name": "Purchase of 21 Green Lane",
                    "request": {
                      "actor": {
                        "name": "Jacob Robert Archer-Moran",
                        "phone": "+447506430094"
                      },
                      "tasks": [
                        {
                          "opts": {
                            "nfc": "preferred"
                          },
                          "type": "report:identity"
                        },
                        {
                          "opts": {
                            "consent": false
                          },
                          "type": "report:footprint"
                        },
                        {
                          "opts": {
                            "monitored": false
                          },
                          "type": "report:peps"
                        },
                        {
                          "type": "documents:poa"
                        },
                        {
                          "type": "report:sof-v1"
                        },
                        {
                          "type": "report:bank-statement"
                        },
                        {
                          "type": "report:bank-summary"
                        }
                      ]
                    },
                    "ref": "Val'ID'ate: 50/998",
                    "id": "d4ahp5r23amg030yrx60",
                    "reports": [],
                    "status": "open",
                    "metadata": {
                      "notify": {
                        "type": "http",
                        "data": {
                          "hmac_key": "sHxpp6Xb9DIYeyLab5zKdj1RQ6XJ4LazOhFm3XxrS7U=",
                          "method": "POST",
                          "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                        }
                      },
                      "created_by": "d3t0auq9io6g00ak3kkg",
                      "print": {
                        "team": "Cashiers",
                        "tenant": "Thurstan Hoskin Solicitors LLP",
                        "user": "THS Bot"
                      },
                      "context": {
                        "gid": "d3t2k5a9io6g00ak3km0",
                        "uid": "d3t0auq9io6g00ak3kkg",
                        "team_id": "d3t2k5a9io6g00ak3km0",
                        "tenant_id": "d3t2ifa9io6g00ak3klg"
                      },
                      "ce": {
                        "uri": "/v1/checks/4151797962"
                      },
                      "created_at": "2025-11-12T23:41:11.401Z"
                    },
                    "type": "v2",
                    "opts": {
                      "peps": {
                        "monitored": false
                      }
                    }
                  },
                  "hasAlerts": true,
                  "pdfAddedAt": "2025-11-13T00:00:16.009Z",
                  "smsSent": true,
                  "transactionId": "d4ahp5r23amg030yrx60"
            },
            {
                "taskOutcomes": {
                  "sof:v1": {
                    "breakdown": {
                      "property": {
                        "address": {
                          "postcode": "BT32 5HD",
                          "country": "GBR",
                          "street": "Mill Road",
                          "building_number": "40",
                          "town": "Banbridge"
                        },
                        "new_build": false,
                        "price": 28000000,
                        "stamp_duty": 250000
                      },
                      "funds": [
                        {
                          "data": {
                            "amount": 22000000,
                            "lender": "hsbc",
                            "location": "GBR"
                          },
                          "metadata": {
                            "created_at": 1763045673639
                          },
                          "type": "fund:mortgage"
                        },
                        {
                          "data": {
                            "amount": 2000000,
                            "location": "GBR",
                            "type": "lisa"
                          },
                          "metadata": {
                            "created_at": 1763045673800
                          },
                          "type": "fund:htb"
                        },
                        {
                          "data": {
                            "amount": 1500000,
                            "location": "GBR",
                            "people": [
                              {
                                "actor": true,
                                "name": "Jacob Robert Archer-Moran",
                                "incomes": [
                                  {
                                    "reference": "varies",
                                    "source": "salary",
                                    "description": "",
                                    "annual_total": 3500000,
                                    "frequency": "other"
                                  }
                                ],
                                "employment_status": "independent",
                                "phone": "+447506430094"
                              },
                              {
                                "actor": false,
                                "name": "Se Stewart ",
                                "incomes": [
                                  {
                                    "reference": "ladywell",
                                    "source": "salary",
                                    "description": "",
                                    "annual_total": 2800000,
                                    "frequency": "monthly"
                                  },
                                  {
                                    "reference": "pip",
                                    "source": "other",
                                    "description": "pip",
                                    "annual_total": 975000,
                                    "frequency": "fortnightly"
                                  }
                                ],
                                "employment_status": "employed",
                                "phone": "+447493580033"
                              }
                            ]
                          },
                          "metadata": {
                            "created_at": 1763045673971
                          },
                          "type": "fund:savings"
                        },
                        {
                          "data": {
                            "amount": 1500000,
                            "giftor": {
                              "contactable": true,
                              "name": "Barbara Archer",
                              "phone": "+447581408576",
                              "relationship": "Mum"
                            },
                            "location": "GBR",
                            "repayable": false
                          },
                          "metadata": {
                            "created_at": 1763045674170
                          },
                          "type": "fund:gift"
                        },
                        {
                          "data": {
                            "location": "GBR",
                            "amount": 500000,
                            "date": "2025-11-11T00:00:00.000Z",
                            "status": "complete",
                            "lawyer": "Thurstan hoskin "
                          },
                          "metadata": {
                            "created_at": 1763045674331
                          },
                          "type": "fund:sale:property"
                        },
                        {
                          "data": {
                            "amount": 250000,
                            "description": "Car",
                            "location": "GBR"
                          },
                          "metadata": {
                            "created_at": 1763045674490
                          },
                          "type": "fund:sale:assets"
                        },
                        {
                          "data": {
                            "location": "GBR",
                            "is_owner": false,
                            "amount": 100000,
                            "date": "2025-11-03T00:00:00.000Z",
                            "account_name": "Thurstan hoskin ",
                            "from": "Mary archer"
                          },
                          "metadata": {
                            "created_at": 1763045674658
                          },
                          "type": "fund:inheritance"
                        },
                        {
                          "data": {
                            "location": "GBR",
                            "is_owner": false,
                            "amount": 100000,
                            "account_name": "Thurstan hoskin ",
                            "lawyer": "Thurstan hoskin ",
                            "settlement_date": "2025-11-01T00:00:00.000Z"
                          },
                          "metadata": {
                            "created_at": 1763045674812
                          },
                          "type": "fund:divorce"
                        },
                        {
                          "data": {
                            "amount": 200000,
                            "description": "Savings",
                            "location": "GBR"
                          },
                          "metadata": {
                            "created_at": 1763045674975
                          },
                          "type": "fund:cryptocurrency"
                        },
                        {
                          "data": {
                            "amount": 100000,
                            "description": "Found in street",
                            "location": "GBR"
                          },
                          "metadata": {
                            "created_at": 1763045675143
                          },
                          "type": "fund:other"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [],
                    "id": "d4az3he23amg030ys230",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:57:09.949Z"
                  },
                  "documents:savings": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d4az49h23amg030ys2a0",
                          "type": "savings"
                        },
                        {
                          "id": "d4az49s23amg030ys2ag",
                          "type": "savings"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d4az49h23amg030ys2a0",
                      "d4az49s23amg030ys2ag"
                    ],
                    "id": "d4az4ah23amg030ys2rg",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:58:50.011Z"
                  },
                  "documents:mortgage": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d4az40r23amg030ys290",
                          "type": "mortgage"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d4az40r23amg030ys290"
                    ],
                    "id": "d4az4a923amg030ys2kg",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:58:49.465Z"
                  },
                  "documents:poa": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d4az3g623amg030ys1rg",
                          "type": "poa"
                        },
                        {
                          "id": "d4az3ge23amg030ys1s0",
                          "type": "poa"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d4az3g623amg030ys1rg",
                      "d4az3ge23amg030ys1s0"
                    ],
                    "id": "d4az3h623amg030ys1tg",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:57:08.120Z"
                  },
                  "peps": {
                    "breakdown": {
                      "total_hits": 2,
                      "hits": [
                        {
                          "name": "Jake Moran",
                          "assets": [],
                          "dob": {
                            "main": "",
                            "other": []
                          },
                          "score": 0.1,
                          "flag_types": [
                            "adverse-media",
                            "adverse-media-violent-crime"
                          ],
                          "source_notes": {
                            "complyadvantage-adverse-media": {
                              "aml_types": [
                                "adverse-media",
                                "adverse-media-violent-crime"
                              ],
                              "country_codes": [
                                "US"
                              ],
                              "name": "ComplyAdvantage Adverse Media"
                            }
                          },
                          "institutions": [],
                          "spouses": [],
                          "political_positions": [],
                          "countries": [
                            "United States"
                          ],
                          "aka": [
                            "Jake Moran"
                          ],
                          "id": "CPPFOJFI8OCU4PE",
                          "match_types": [
                            "equivalent_name",
                            "name_variations_removal"
                          ],
                          "roles": [],
                          "fields": [
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "United States"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "United States"
                            },
                            {
                              "name": "Countries",
                              "source": "",
                              "value": "United States"
                            }
                          ],
                          "media": [
                            {
                              "date": "2014-05-21T00:00:00Z",
                              "snippet": "But after suffering a gut-wrenching 29-27, 20-25, 29-27 setback to the Redwings, the RedHawks rebounded to take down St. Patrick (25-19, 25-22) in another conference clash. Spearheading Marist's winning effort was Jake Moran, who registered five kills and six digs. Tom Inzinga equaled Moran's kill total, while Nick O'Gorman chipped in four kills and a service ace.",
                              "title": "Community sports news - Southwest Community Publishing",
                              "url": "https://www.southwestregionalpublishing.com/2014/05/21/community-sports-news-05-21-14-2/"
                            },
                            {
                              "date": "2016-05-21T00:00:00Z",
                              "snippet": "The best challenge to the Patriot stronghold, as evidenced this weekend, is O'Gorman, which took four of six heads-up championship matches against Lincoln. Sam Heckman (Flight 3), Jake Moran (Flight 4) and Michael Yousef (Flight 6) all racked up singles titles, while Flight 2 runner-up Wil McDowell and Heckman took home the Flight 2 doubles crown. \"They performed like I thought they would, and also expected,\" said Coach Don Barnes.",
                              "title": "Lincoln caps third straight tennis title",
                              "url": "https://www.argusleader.com/story/sports/high-school-sports/2016/05/21/midst-dynasty---lincoln-caps-third-straight-title/84666134/"
                            }
                          ],
                          "associates": []
                        },
                        {
                          "name": "Jacob Moran",
                          "assets": [],
                          "dob": {
                            "main": "",
                            "other": []
                          },
                          "score": 0.1,
                          "flag_types": [
                            "adverse-media",
                            "adverse-media-general",
                            "adverse-media-violent-crime"
                          ],
                          "source_notes": {
                            "complyadvantage-adverse-media": {
                              "aml_types": [
                                "adverse-media",
                                "adverse-media-general",
                                "adverse-media-violent-crime"
                              ],
                              "country_codes": [
                                "CA",
                                "US"
                              ],
                              "name": "ComplyAdvantage Adverse Media"
                            }
                          },
                          "institutions": [],
                          "spouses": [],
                          "political_positions": [],
                          "countries": [
                            "Canada",
                            "United States"
                          ],
                          "aka": [
                            "Jacob Benning Moran",
                            "Jacob Moran"
                          ],
                          "id": "5F0CGJUQGD3KXR6",
                          "match_types": [
                            "aka_exact",
                            "name_variations_removal"
                          ],
                          "roles": [],
                          "fields": [
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "Canada"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "Canada, United States"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "United States"
                            },
                            {
                              "name": "Countries",
                              "source": "",
                              "value": "Canada, United States"
                            }
                          ],
                          "media": [
                            {
                              "date": "0001-01-01T00:00:00Z",
                              "snippet": "GPD is in direct communication with the Michigan State Police and are working with them on the case following his capture, the agency said.<\\/p>\\n Shortly after GPD announced that Jacob Moran was in custody, the Johnson County Coroner\\u2019s Office formally identified Shaun Moran as the man who was killed in the shooting. The office ruled his death as homicide caused by a single gunshot wound.<\\/p>\\n",
                              "title": "(no title)",
                              "url": "https://dailyjournal.net/wp-json/wp/v2/posts/1816390"
                            },
                            {
                              "date": "2021-03-01T00:00:00Z",
                              "snippet": "They detained Moran and learned he had urinated on a tire of the car. \"Moran was heavily intoxicated on marijuana. He was arrested for prowling, public urination and public intoxication,\" police said.",
                              "title": "530 Crime Watch: Man tried to rob bank across street from police station",
                              "url": "https://www.usatoday.com/story/news/local/2021/03/01/530-crime-watch-arrest-jail-redding-police-shasta-sheriff/6870286002/?gnt-cfr=1"
                            },
                            {
                              "date": "2023-08-29T00:00:00Z",
                              "snippet": "Court documents show that Jacob Moran had allegedly assaulted his father twice in the hours before the shooting. Jacob Moran was charged Tuesday with residential entry, a Level 6 felony, and two counts of domestic battery both as a Level 6 felony and a misdemeanor, for the incidents. Charges for the shooting have not yet been filed.",
                              "title": "Greenwood domestic dispute ends in fatal shooting - Daily Journal",
                              "url": "https://dailyjournal.net/2023/08/29/greenwood-domestic-dispute-ends-in-fatal-shooting/"
                            },
                            {
                              "date": "2024-11-15T00:00:00Z",
                              "snippet": "Jacob Moran had been staying at his father's home but had reportedly been causing issues and been asked to leave the home. After being asked to leave the first time, Jacob Moran allegedly assaulted his father, leading to police being called. Later that day, he returned and again allegedly assaulted Shaun Moran, according to court documents.",
                              "title": "Greenwood man convicted of murder of father following domestic dispute - Daily Journal",
                              "url": "https://dailyjournal.net/2024/11/15/greenwood-man-convicted-of-murder-of-father-following-domestic-dispute/"
                            },
                            {
                              "date": "2023-09-07T00:00:00Z",
                              "snippet": "The gun's serial number was a match to the gun box that was found in the garage, court documents show. Jacob Moran was then arrested and taken to a Sturgis, Michigan jail on a charge of possession of an unregistered handgun. The BMW was impounded, court documents say.",
                              "title": "Greenwood man, 22, charged with his father's murder - Daily Journal",
                              "url": "https://dailyjournal.net/2023/09/07/greenwood-man-22-charged-with-his-fathers-murder/"
                            },
                            {
                              "date": "0001-01-01T00:00:00Z",
                              "snippet": "As deputies attempted to place Moran into custody for his warrant, Moran began to physically resist deputies. While resisting, Moran twice attempted to unholster a deputy's service firearm. After a brief struggle, Moran was arrested and then booked into the Humboldt County Correctional Facility on fresh charges of attempting to remove a peace officer's firearm (PC 148(d)) and resisting a peace officer (PC 148(a)(1)), in addition to his warrant charges of assault (PC 240) and battery (PC 242).",
                              "title": "News Flash &#x2022; County of Humboldt &#x2022; CivicEngage",
                              "url": "https://humboldtgov.org/CivicAlerts.aspx?AID=4279"
                            },
                            {
                              "date": "2021-03-26T00:00:00Z",
                              "snippet": "They immediately detained Moran and learned he urinated on a tire of the same car. Moran was \"heavily intoxicated on marijuana,\" and was ultimately arrested for public intoxication, public urination, and prowling.",
                              "title": "Officers arrest prowler looking inside, and urinating on, a vehicle in Redding on Friday",
                              "url": "https://krcrtv.com/news/local/bicycle-officers-catch-prowler-looking-inside-cars-in-redding-on-friday"
                            },
                            {
                              "date": "2015-04-01T00:00:00Z",
                              "snippet": "Moran then emerged, ran toward the plaintiff, and punched him. The officers arrested Moran. The plaintiff commenced this action against, among others, the defendant City of New York, alleging that the officers were negligent in failing to protect the plaintiff.",
                              "title": "PHILIP v. MORAN | 127 A.D.3d 717 (2015) | 20150401440 | Leagle.com",
                              "url": "https://www.leagle.com/decision/innyco20150401440"
                            },
                            {
                              "date": "2023-08-29T00:00:00Z",
                              "snippet": "When they arrived they found, Shaun Moran dead of an apparent gunshot wound in the home's garage, police say. Police say Jacob Moran is suspect in the shooting. It was reported that he was angry with Shaun Moran about being told to move out of the home, according to the news release.",
                              "title": "UPDATE: Suspect in custody after deadly Greenwood shooting - Daily Journal",
                              "url": "https://dailyjournal.net/2023/08/29/update-suspect-in-custody-after-deadly-greenwood-shooting/"
                            },
                            {
                              "date": "2021-10-13T00:00:00Z",
                              "snippet": "16 p.m., Humboldt County Sheriff's deputies on patrol in the 2400 block of Myrtle Avenue observed a suspicious male exhibiting behavior consistent with attempting a car burglary. Deputies contacted the man, 20-year-old Jacob Benning Moran, and learned that Moran had an outstanding misdemeanor warrant for his arrest. As deputies attempted to place Moran into custody for his warrant, Moran began to physically resist deputies.",
                              "title": "Warrant suspect tries to grab deputy's gun during arrest in Myrtletown, HCSO says",
                              "url": "https://krcrtv.com/north-coast-news/eureka-local-news/warrant-suspect-tries-to-grab-deputys-gun-during-arrest-in-myrtletown-hcso-says"
                            }
                          ],
                          "associates": []
                        }
                      ]
                    },
                    "data": {
                      "dob": "2001-01-11T00:00:00.000Z",
                      "name": {
                        "first": "Jacob",
                        "last": "Moran",
                        "other": "Robert"
                      },
                      "address": {
                        "postcode": "TR15 2ND",
                        "country": "GBR",
                        "street": "Southgate Street",
                        "building_number": "94",
                        "town": "Redruth"
                      }
                    },
                    "result": "consider",
                    "documents": [
                      "d4az67023amg030ys3dg"
                    ],
                    "id": "d4az4p223amg030ys3b0",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:59:36.723Z"
                  },
                  "nfc": {
                    "result": "clear",
                    "status": "complete",
                    "data": {
                      "chip": {
                        "clone_detection": "clear",
                        "verification": "clear"
                      },
                      "comparison": {
                        "dob": 0,
                        "name": 100
                      }
                    }
                  },
                  "documents:bank-statement": {
                    "breakdown": {
                      "accounts": {
                        "71857460": {
                          "info": {
                            "number": {
                              "iban": "",
                              "number": "71857460",
                              "sort_code": "40-44-34",
                              "swift_bic": ""
                            },
                            "name": "",
                            "provider": {
                              "id": "",
                              "name": "HSBC"
                            },
                            "balance": {
                              "available": 44.29,
                              "current": 44.29,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "Mr Jacob Robert Archer-Moran",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": "2025-11-13T14:57:10.728512Z",
                              "encryption": "",
                              "updated_at": "2025-11-13T14:59:21.316696Z"
                            },
                            "type": ""
                          },
                          "statement": [
                            {
                              "merchant_name": "BOOKING.COM",
                              "timestamp": "2025-08-21T00:00:00Z",
                              "description": "DD HLTN37 BOOKING.COM",
                              "amount": -46.9,
                              "rolling_account_balance": 112.87,
                              "id": "41c33378-07b6-496b-b128-38c4b24e099b",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "Se Iou",
                              "timestamp": "2025-08-23T00:00:00Z",
                              "description": "BP Se Iou",
                              "amount": -50,
                              "rolling_account_balance": 62.87,
                              "id": "304ce228-e101-43dd-a043-7bc423eb646f",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "BP",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "KLARNA",
                              "timestamp": "2025-08-26T00:00:00Z",
                              "description": "DD KLARNA",
                              "amount": -19.96,
                              "id": "9eaae314-f9bb-4137-aaa6-e14e4c330bbd",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-08-26T00:00:00Z",
                              "description": "DD MONEYBOX",
                              "amount": -30,
                              "id": "815ac584-c009-42b7-bdd1-23e93b8cc40f",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-08-26T00:00:00Z",
                              "description": "DD MONEYBOX",
                              "amount": -30,
                              "id": "9a27095f-9fb2-4959-8716-c5f6c2b896b6",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "LISA Arc-McDo B",
                              "timestamp": "2025-08-26T00:00:00Z",
                              "description": "CR LISA Arc-McDo B",
                              "amount": 20,
                              "rolling_account_balance": 2.91,
                              "id": "0d1f001e-c7ed-4096-99cc-af40c5bb53ba",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "STEWART S Holidayxx",
                              "timestamp": "2025-08-30T00:00:00Z",
                              "description": "BP STEWART S Holidayxx",
                              "amount": 245,
                              "id": "a9af73cf-cedb-403c-9af7-46f362671c91",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "BP",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "TESCO BANK",
                              "timestamp": "2025-08-30T00:00:00Z",
                              "description": "OBP TESCO BANK 518652 ****** 0936",
                              "amount": -200,
                              "rolling_account_balance": 47.91,
                              "id": "c1dd88a3-247f-4ba5-91f4-2e61c0f15278",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "OBP",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "PROSPECT UNION",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "DD PROSPECT UNION",
                              "amount": -11.25,
                              "id": "b0a174ba-92f7-4fa2-908d-9b16760d01dd",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "ADMIRAL INSURANCE",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "DD ADMIRAL INSURANCE",
                              "amount": -90.18,
                              "id": "99b1ca77-a7f1-4a97-bad7-7f1a155a30d6",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "DVLA-OE62WGD",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "DD DVLA-OE62WGD",
                              "amount": -29.31,
                              "id": "16f0b91f-4d6c-4d86-8bf2-7ee60139bd65",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "DVLA-WF60YWP",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "DD DVLA-WF60YWP",
                              "amount": -18.81,
                              "id": "82300241-7c41-40e0-9225-6e82cc915003",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "DD MONEYBOX",
                              "amount": -30,
                              "id": "cf235c75-239c-4e8f-9572-4485d61fd495",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "DD MONEYBOX",
                              "amount": -30,
                              "id": "dc3ce488-e5ae-4c64-ab8e-7565a5477175",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "LISA Arc-McDo B",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "CR LISA Arc-McDo B",
                              "amount": 20,
                              "id": "d78e6959-7952-4f3c-927a-e04922a9bef9",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "CAR STEWART S",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "CR CAR STEWART S",
                              "amount": 70,
                              "id": "eada9b3a-b64a-444a-b145-c5d46d4164c7",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "INTERNET TRANSFER",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "TFR 404434 21857479 INTERNET TRANSFER",
                              "amount": 130,
                              "id": "d5791b41-18d8-40ae-9ead-e7fab6298d51",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "TFR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "PAYPAL *UBERTRIP",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "VIS PAYPAL *UBERTRIP 35314369001",
                              "amount": -4.99,
                              "rolling_account_balance": 53.37,
                              "id": "0c51747e-b92f-43d8-bd18-579b9753544f",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-09-22T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "22e95bf5-fd83-40aa-aca2-d71931972fc9",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-09-22T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "a240e396-b287-4872-b6e8-ddeef664ea18",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "LISA Arc-McDo B",
                              "timestamp": "2025-09-22T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "rolling_account_balance": 334.27,
                              "id": "7f2616ce-054d-4a3f-87f5-9e8e1c73c98e",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "KLARNA",
                              "timestamp": "2025-09-24T00:00:00Z",
                              "description": "KLARNA",
                              "amount": -19.96,
                              "id": "29c56ee0-fa74-4256-a697-978edaf03224",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "CO-OP GROUP FOOD LONDON",
                              "timestamp": "2025-09-24T00:00:00Z",
                              "description": "CO-OP GROUP FOOD LONDON",
                              "amount": -1.95,
                              "id": "a7527947-b9fa-4b94-a899-aa34dbb7bc4b",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": ")))",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "DELIVEROO LONDON",
                              "timestamp": "2025-09-24T00:00:00Z",
                              "description": "DELIVEROO LONDON",
                              "amount": -17.54,
                              "rolling_account_balance": 294.82,
                              "id": "1f8faa7f-7ae5-4ced-ac43-66cfac9581a9",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "Klarna Financial S",
                              "timestamp": "2025-09-25T00:00:00Z",
                              "description": "Klarna Financial S YA777777777713C9YB",
                              "amount": -199.56,
                              "id": "5f581817-f85b-44d6-95ac-f23c1c131e93",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "OBP",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "VAPE CLUB LTD WATFORD",
                              "timestamp": "2025-09-25T00:00:00Z",
                              "description": "VAPE CLUB LTD WATFORD",
                              "amount": -28.99,
                              "id": "56161b6a-9ac6-4fa7-8b28-521d1855caaf",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "DELIVEROO LONDON",
                              "timestamp": "2025-09-25T00:00:00Z",
                              "description": "DELIVEROO LONDON",
                              "amount": -12.08,
                              "rolling_account_balance": 54.19,
                              "id": "bffcb516-5079-4264-a5f0-1b4a0e65fc2a",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "STEWART S",
                              "timestamp": "2025-09-28T00:00:00Z",
                              "description": "STEWART S Holidayxx",
                              "amount": 200,
                              "rolling_account_balance": 254.19,
                              "id": "9a7c7c95-83c1-4fa7-9ad0-4f446562db9c",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "BP",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "22d44a80-9dce-4d1e-b21f-7c3843f421d2",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "43ca2e55-d2e0-4b65-8c19-1a2fbb2e158f",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "LISA Arc-McDo B",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "8bf294d2-0b5e-416d-8381-2c3f1502226c",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "Just Eat.Co. UK Ltd London",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "Just Eat.Co. UK Ltd London",
                              "amount": 7,
                              "id": "d9912d42-43db-4f1d-ac57-0279ac2df945",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "Just Eat.Co.UK Ltd London",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "Just Eat.Co.UK Ltd London",
                              "amount": -38.38,
                              "id": "86408118-caab-4edb-aadd-2ccf26695412",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "SP OMAZE UK ALTRINCHAM",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "SP OMAZE UK ALTRINCHAM",
                              "amount": -15,
                              "rolling_account_balance": 167.81,
                              "id": "669ac886-e612-4a11-8d54-4e5baf2fb2aa",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "Just Eat.Co. UK Ltd London",
                              "timestamp": "2025-09-30T00:00:00Z",
                              "description": "Just Eat.Co. UK Ltd London",
                              "amount": -25.57,
                              "rolling_account_balance": 142.24,
                              "id": "947a1861-f43c-460e-b233-2ecdb4404f2a",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "PROSPECT UNION",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "PROSPECT UNION",
                              "amount": -11.25,
                              "id": "6367f1e6-21f3-4382-8f8e-14350caee2c0",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "ADMIRAL INSURANCE",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "ADMIRAL INSURANCE",
                              "amount": -90.18,
                              "id": "acc51f3d-ad5d-4659-98a9-468071c8342b",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "DVLA-OE62WGD",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "DVLA-OE62WGD",
                              "amount": -29.31,
                              "id": "9e02560a-a7b5-4ffe-8ee4-320c634a1219",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "DVLA-WF60YWP",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "DVLA-WF60YWP",
                              "amount": -18.81,
                              "id": "0718ce8d-96bb-4398-845d-7ac5870634a1",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "CAR STEWART S",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "CAR STEWART S",
                              "amount": 70,
                              "id": "b78dd0fc-9eea-4bc7-b9ce-dec5a1d3ed94",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "PAYPAL *APPLE.COM/",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "PAYPAL *APPLE.COM/ 35314369001",
                              "amount": -0.99,
                              "rolling_account_balance": 61.7,
                              "id": "f0f671b7-23c9-432b-a6a4-0fec00ee80b9",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "HLTN41 EXPERIAN LT",
                              "timestamp": "2025-10-02T00:00:00Z",
                              "description": "HLTN41 EXPERIAN LT",
                              "amount": -15,
                              "id": "1ca847ac-e821-4e0a-b2a7-e1510ecb0422",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "JACOB ARCHER-MORAN",
                              "timestamp": "2025-10-02T00:00:00Z",
                              "description": "JACOB ARCHER-MORAN GWD25",
                              "amount": 2300,
                              "id": "91ac1d0d-9346-4863-9955-ae12f0cc8e30",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "TESCO BANK",
                              "timestamp": "2025-10-02T00:00:00Z",
                              "description": "TESCO BANK 518652 ****** 0936",
                              "amount": -2034.26,
                              "id": "22f1ebc5-5b2a-4b07-9353-b8b278722685",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "OBP",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "PAYPAL *UBERTRIP",
                              "timestamp": "2025-10-02T00:00:00Z",
                              "description": "PAYPAL *UBERTRIP 35314369001",
                              "amount": -1.5,
                              "rolling_account_balance": 310.94,
                              "id": "54084884-6134-4926-ae38-dafb256f4d5d",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "HLTN42 VOIPSTUDIO.",
                              "timestamp": "2025-10-03T00:00:00Z",
                              "description": "HLTN42 VOIPSTUDIO.",
                              "amount": -18,
                              "id": "c97eb1ef-8980-4b76-bf2b-ed1d368449b7",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "HMRC GOV.UK SA GLASGOW",
                              "timestamp": "2025-10-03T00:00:00Z",
                              "description": "HMRC GOV.UK SA GLASGOW",
                              "amount": -197.6,
                              "id": "8821fc1b-a83d-476d-b803-9b2653820437",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "THUR HOSK SO LLP",
                              "timestamp": "2025-10-03T00:00:00Z",
                              "description": "THUR HOSK SO LLP work w/e 3.10.25",
                              "amount": 660,
                              "id": "745a293f-61df-43be-89b6-a5e90ea6b405",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "B ARCHER",
                              "timestamp": "2025-10-03T00:00:00Z",
                              "description": "B ARCHER Rent & Owings x2",
                              "amount": -300,
                              "rolling_account_balance": 455.34,
                              "id": "e1f2a89b-127f-46c0-93b6-cad2b9871103",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "BP",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "HLTN43 PRIME VIDE",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "HLTN43 PRIME VIDE",
                              "amount": -5,
                              "id": "96ea35b3-8cd5-4941-8bc4-0996d81881e5",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "49f6d20c-1616-47a0-8147-dd157f079f63",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "1a59c3a1-5a17-434e-ad82-35810a481741",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "LISA Arc-McDo B",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "3451f11e-1861-46f0-9ea0-6ebb9eeb83cd",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "GOOGLE *Google Pla",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "GOOGLE *Google Pla g.co/helppay#",
                              "amount": -12.99,
                              "id": "a62a7b9f-fad1-4479-b158-fccba58857f8",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "Just Eat. Co. UK Ltd London",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "Just Eat. Co. UK Ltd London",
                              "amount": -25.96,
                              "id": "9cc60826-4dff-4143-afc3-9a2b94e1dd18",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "VAPE CLUB LTD WATFORD",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "VAPE CLUB LTD WATFORD",
                              "amount": -47.98,
                              "id": "2bce8f48-54d2-480e-a143-ddba17a3052c",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "DUOFAX.COM PRAHA 4",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "INT'L 0066184243 DUOFAX.COM PRAHA 4 EUR 10.00 @ 1.1454 Visa Rate",
                              "amount": -8.73,
                              "id": "a2714dba-c8ba-4537-a077-f47c01abd958",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "Non-Sterling Transaction Fee",
                              "amount": -0.24,
                              "rolling_account_balance": 314.44,
                              "id": "9ded8527-5f28-4c96-8a3d-bf6903e5fb31",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DR",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "Just Eat.Co. UK Ltd London",
                              "timestamp": "2025-10-08T00:00:00Z",
                              "description": "Just Eat.Co. UK Ltd London",
                              "amount": -15.75,
                              "rolling_account_balance": 298.69,
                              "id": "80b127b2-cc31-4cc2-b21a-186c2fd73abd",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "87b890fb-b106-4a2c-b3e6-fa331048e66c",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "106bfabe-3459-4798-95ec-927884e6083a",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "LISA Arc-McDo B",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "bb7b1ae3-fe59-4173-af9d-54f991f21a27",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "VAPE CLUB LTD WATFORD",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "VAPE CLUB LTD WATFORD",
                              "amount": -49.97,
                              "id": "4b8f66f3-1b70-43b5-8db2-1ad3159b75d0",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "Just Eat.Co.UK Ltd London",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "Just Eat.Co.UK Ltd London",
                              "amount": -25.96,
                              "rolling_account_balance": 182.76,
                              "id": "6ae01562-f0a4-4b91-8729-6245b2e477aa",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "HLTN44 AMAZON.CO.U",
                              "timestamp": "2025-10-14T00:00:00Z",
                              "description": "HLTN44 AMAZON.CO.U",
                              "amount": -4,
                              "rolling_account_balance": 178.76,
                              "id": "95c6031a-e83f-472b-b6c8-4bfd2eea0523",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "HLTN46 PRIME VIDE",
                              "timestamp": "2025-10-15T00:00:00Z",
                              "description": "HLTN46 PRIME VIDE",
                              "amount": -4,
                              "id": "6dc62e08-3aa3-40d8-9106-f00301f12f77",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "HLTN45 AMAZON.CO.U",
                              "timestamp": "2025-10-15T00:00:00Z",
                              "description": "HLTN45 AMAZON.CO.U",
                              "amount": -14,
                              "rolling_account_balance": 160.76,
                              "id": "c80106c2-8996-4a87-b202-ba0a297e6c1e",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "HLTN47 AMAZON.CO.U",
                              "timestamp": "2025-10-17T00:00:00Z",
                              "description": "HLTN47 AMAZON.CO.U",
                              "amount": -7,
                              "id": "bab3bae3-0bbf-45d5-ace6-5e22c10a7863",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "ICO",
                              "timestamp": "2025-10-17T00:00:00Z",
                              "description": "ICO",
                              "amount": -47,
                              "rolling_account_balance": 106.76,
                              "id": "d9f511d7-fc32-4fa4-9dbb-977cbda4eb53",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-10-20T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "c201084b-317e-4565-aeb0-c9ffa4a9e7a2",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "MONEYBOX",
                              "timestamp": "2025-10-20T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "a6cb7389-9800-4b23-9487-dbfe6d0d9a1f",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "DD",
                              "classification": null,
                              "type": "DEBIT"
                            },
                            {
                              "merchant_name": "LISA Arc-McDo B",
                              "timestamp": "2025-10-20T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "654ade3c-e5ba-4ab5-881b-dd92b72a236f",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "CR",
                              "classification": null,
                              "type": "CREDIT"
                            },
                            {
                              "merchant_name": "Just Eat.Co.UK Ltd London",
                              "timestamp": "2025-10-20T00:00:00Z",
                              "description": "Just Eat.Co.UK Ltd London",
                              "amount": -22.47,
                              "rolling_account_balance": 44.29,
                              "id": "e4704ef1-45ab-4011-a0c4-593c3ba7b8a0",
                              "account_id": "71857460",
                              "currency": "GBP",
                              "category": "VIS",
                              "classification": null,
                              "type": "DEBIT"
                            }
                          ]
                        }
                      },
                      "documents": [
                        {
                          "id": "d4az35c23amg030ys1qg",
                          "type": "bank-statement"
                        },
                        {
                          "id": "d4az35m23amg030ys1r0",
                          "type": "bank-statement"
                        }
                      ],
                      "analysis": {
                        "id": "4151814987",
                        "repeating_transactions": [
                          {
                            "sort_score": 20,
                            "items": [
                              "3451f11e-1861-46f0-9ea0-6ebb9eeb83cd",
                              "654ade3c-e5ba-4ab5-881b-dd92b72a236f",
                              "7f2616ce-054d-4a3f-87f5-9e8e1c73c98e",
                              "8bf294d2-0b5e-416d-8381-2c3f1502226c",
                              "bb7b1ae3-fe59-4173-af9d-54f991f21a27"
                            ]
                          },
                          {
                            "sort_score": 17.54,
                            "items": [
                              "1f8faa7f-7ae5-4ced-ac43-66cfac9581a9",
                              "bffcb516-5079-4264-a5f0-1b4a0e65fc2a"
                            ]
                          },
                          {
                            "sort_score": 14,
                            "items": [
                              "95c6031a-e83f-472b-b6c8-4bfd2eea0523",
                              "bab3bae3-0bbf-45d5-ace6-5e22c10a7863",
                              "c80106c2-8996-4a87-b202-ba0a297e6c1e"
                            ]
                          },
                          {
                            "sort_score": 5,
                            "items": [
                              "6dc62e08-3aa3-40d8-9106-f00301f12f77",
                              "96ea35b3-8cd5-4941-8bc4-0996d81881e5"
                            ]
                          },
                          {
                            "sort_score": 49.97,
                            "items": [
                              "2bce8f48-54d2-480e-a143-ddba17a3052c",
                              "4b8f66f3-1b70-43b5-8db2-1ad3159b75d0",
                              "56161b6a-9ac6-4fa7-8b28-521d1855caaf"
                            ]
                          },
                          {
                            "sort_score": 38.38,
                            "items": [
                              "6ae01562-f0a4-4b91-8729-6245b2e477aa",
                              "80b127b2-cc31-4cc2-b21a-186c2fd73abd",
                              "86408118-caab-4edb-aadd-2ccf26695412",
                              "947a1861-f43c-460e-b233-2ecdb4404f2a",
                              "9cc60826-4dff-4143-afc3-9a2b94e1dd18",
                              "e4704ef1-45ab-4011-a0c4-593c3ba7b8a0"
                            ]
                          },
                          {
                            "sort_score": 30,
                            "items": [
                              "106bfabe-3459-4798-95ec-927884e6083a",
                              "1a59c3a1-5a17-434e-ad82-35810a481741",
                              "22d44a80-9dce-4d1e-b21f-7c3843f421d2",
                              "22e95bf5-fd83-40aa-aca2-d71931972fc9",
                              "43ca2e55-d2e0-4b65-8c19-1a2fbb2e158f",
                              "49f6d20c-1616-47a0-8147-dd157f079f63",
                              "87b890fb-b106-4a2c-b3e6-fa331048e66c",
                              "a240e396-b287-4872-b6e8-ddeef664ea18",
                              "a6cb7389-9800-4b23-9487-dbfe6d0d9a1f",
                              "c201084b-317e-4565-aeb0-c9ffa4a9e7a2"
                            ]
                          },
                          {
                            "sort_score": 30,
                            "items": [
                              "815ac584-c009-42b7-bdd1-23e93b8cc40f",
                              "9a27095f-9fb2-4959-8716-c5f6c2b896b6",
                              "cf235c75-239c-4e8f-9572-4485d61fd495",
                              "dc3ce488-e5ae-4c64-ab8e-7565a5477175"
                            ]
                          },
                          {
                            "sort_score": 29.31,
                            "items": [
                              "0718ce8d-96bb-4398-845d-7ac5870634a1",
                              "9e02560a-a7b5-4ffe-8ee4-320c634a1219"
                            ]
                          },
                          {
                            "sort_score": 29.31,
                            "items": [
                              "16f0b91f-4d6c-4d86-8bf2-7ee60139bd65",
                              "82300241-7c41-40e0-9225-6e82cc915003"
                            ]
                          },
                          {
                            "sort_score": 20,
                            "items": [
                              "0d1f001e-c7ed-4096-99cc-af40c5bb53ba",
                              "d78e6959-7952-4f3c-927a-e04922a9bef9"
                            ]
                          }
                        ],
                        "large_one_off_transactions": [
                          "22f1ebc5-5b2a-4b07-9353-b8b278722685",
                          "e1f2a89b-127f-46c0-93b6-cad2b9871103",
                          "c1dd88a3-247f-4ba5-91f4-2e61c0f15278",
                          "5f581817-f85b-44d6-95ac-f23c1c131e93",
                          "8821fc1b-a83d-476d-b803-9b2653820437",
                          "99b1ca77-a7f1-4a97-bad7-7f1a155a30d6",
                          "acc51f3d-ad5d-4659-98a9-468071c8342b",
                          "304ce228-e101-43dd-a043-7bc423eb646f",
                          "d9f511d7-fc32-4fa4-9dbb-977cbda4eb53",
                          "41c33378-07b6-496b-b128-38c4b24e099b",
                          "91ac1d0d-9346-4863-9955-ae12f0cc8e30",
                          "745a293f-61df-43be-89b6-a5e90ea6b405",
                          "a9af73cf-cedb-403c-9af7-46f362671c91",
                          "9a7c7c95-83c1-4fa7-9ad0-4f446562db9c",
                          "d5791b41-18d8-40ae-9ead-e7fab6298d51",
                          "b78dd0fc-9eea-4bc7-b9ce-dec5a1d3ed94",
                          "eada9b3a-b64a-444a-b145-c5d46d4164c7",
                          "d9912d42-43db-4f1d-ac57-0279ac2df945"
                        ],
                        "sof_matches": {
                          "gift": [
                            "91ac1d0d-9346-4863-9955-ae12f0cc8e30"
                          ]
                        }
                      }
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d4az35c23amg030ys1qg",
                      "d4az35m23amg030ys1r0"
                    ],
                    "id": "d4az4kt23amg030ys2yg",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:59:27.288Z"
                  },
                  "bank:summary": {
                    "breakdown": {},
                    "data": {},
                    "result": "unknown",
                    "documents": [],
                    "id": "d4az2ds23amg030ys1p0",
                    "status": "rejected",
                    "createdAt": "2025-11-13T14:54:47.615Z"
                  },
                  "bank:statement": {
                    "breakdown": {},
                    "data": {},
                    "result": "unknown",
                    "documents": [],
                    "id": "d4az2ds23amg030ys1ng",
                    "status": "rejected",
                    "createdAt": "2025-11-13T14:54:47.508Z"
                  },
                  "address": {
                    "result": "fail",
                    "status": "closed",
                    "data": {
                      "quality": 0
                    }
                  },
                  "documents:inheritance": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d4az3xf23amg030ys28g",
                          "type": "inheritance"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d4az3xf23amg030ys28g"
                    ],
                    "id": "d4az4a923amg030ys2gg",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:58:49.156Z"
                  },
                  "documents:sale-assets": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d4az44r23amg030ys29g",
                          "type": "sale-assets"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d4az44r23amg030ys29g"
                    ],
                    "id": "d4az4a923amg030ys2p0",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:58:49.783Z"
                  },
                  "biometrics": {
                    "result": "clear",
                    "status": "complete",
                    "data": {}
                  },
                  "identity": {
                    "breakdown": {
                      "nfc": {
                        "breakdown": {
                          "chip": {
                            "breakdown": {
                              "clone_detection": {
                                "result": "clear"
                              },
                              "verification": {
                                "result": "clear"
                              }
                            },
                            "result": "clear"
                          },
                          "data_comparison": {
                            "breakdown": {
                              "dob": {
                                "result": "clear",
                                "properties": {
                                  "days_difference": 0
                                }
                              },
                              "name": {
                                "result": "clear",
                                "properties": {
                                  "levenshtein_pct": 100
                                }
                              }
                            },
                            "result": "clear"
                          }
                        },
                        "result": "clear",
                        "status": "complete"
                      },
                      "documents": [
                        {
                          "id": "d4ax9en23amg030ys0z0",
                          "type": "passport"
                        },
                        {
                          "id": "d4ax9kp23amg030ys0zg",
                          "type": "face-image"
                        },
                        {
                          "id": "d4ax9qp23amg030ys100",
                          "type": "selfie"
                        }
                      ],
                      "biometrics": {
                        "breakdown": {
                          "attempts": [
                            {
                              "frame_available": false,
                              "passed": true,
                              "status": "complete",
                              "token": {
                                "created_at": 1763038415204,
                                "validated_at": 1763038429973,
                                "value": "5cb794e707a37bfec1da6d0809c473a8234cd2efc58928507126e77c1801vi07"
                              }
                            }
                          ]
                        },
                        "result": "clear",
                        "status": "complete"
                      }
                    },
                    "data": {
                      "nfc": {
                        "date_of_expiry": "22.08.2033",
                        "dob": "11.01.2001",
                        "name": "MORAN, JACOB ROBERT"
                      },
                      "name": {
                        "first": "Jacob",
                        "last": "Moran",
                        "other": "Robert"
                      },
                      "dob": "2001-01-11T00:00:00.000Z"
                    },
                    "result": "clear",
                    "documents": [
                      "d4ax9en23amg030ys0z0",
                      "d4ax9kp23amg030ys0zg",
                      "d4ax9qp23amg030ys100"
                    ],
                    "id": "d4az4na23amg030ys370",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:59:33.864Z"
                  },
                  "documents:divorce": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d4az3sz23amg030ys280",
                          "type": "divorce"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d4az3sz23amg030ys280"
                    ],
                    "id": "d4az4a123amg030ys2e0",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:58:48.838Z"
                  },
                  "footprint": {
                    "breakdown": {
                      "data_count": {
                        "properties": {
                          "score": 0
                        },
                        "result": "consider"
                      },
                      "data_quality": {
                        "properties": {
                          "score": 0
                        },
                        "result": "consider"
                      },
                      "service_name": "Authenticateplus",
                      "documents": [
                        {
                          "id": "d4az4mt23amg030ys310",
                          "type": "poa"
                        },
                        {
                          "id": "d4az4mt23amg030ys31g",
                          "type": "poa"
                        }
                      ],
                      "rules": [
                        {
                          "id": "U000",
                          "name": "",
                          "score": 0,
                          "text": "No trace of supplied Address(es), or manual Authentication required by the Applicant"
                        }
                      ]
                    },
                    "data": {
                      "dob": "2001-01-11T00:00:00.000Z",
                      "name": {
                        "first": "Jacob",
                        "last": "Moran",
                        "other": "Robert"
                      },
                      "address": {
                        "postcode": "TR15 2ND",
                        "country": "GBR",
                        "street": "Southgate Street",
                        "building_number": "94",
                        "town": "Redruth"
                      }
                    },
                    "result": "fail",
                    "documents": [
                      "d4az4mt23amg030ys310",
                      "d4az4mt23amg030ys31g"
                    ],
                    "id": "d4az4na23amg030ys330",
                    "status": "closed",
                    "createdAt": "2025-11-13T14:59:33.389Z"
                  }
                },
                "updatedAt": "2025-11-13T14:59:43.509Z",
                "consumerPhone": "+447506430094",
                "pdfReady": true,
                "checkType": "electronic-id",
                "completedAt": "2025-11-13T14:59:43.509Z",
                "initiatedAt": "2025-11-13T12:46:39.453Z",
                "considerReasons": [
                  "address verification",
                  "digital footprint",
                  "PEP hits"
                ],
                "pdfS3Key": "protected/6bEktxs",
                "consumerName": "Jacob Robert Archer-Moran",
                "tasks": [
                  "report:identity",
                  "report:footprint",
                  "report:peps",
                  "documents:poa",
                  "report:sof-v1",
                  "report:bank-statement",
                  "report:bank-summary"
                ],
                "updates": [
                  {
                    "timestamp": "2025-11-13T12:46:39.454Z",
                    "update": "Electronic ID check initiated by elizabeth.farrington@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-13T14:59:43.509Z",
                    "update": "Transaction completed - awaiting PDF"
                  },
                  {
                    "timestamp": "2025-11-13T15:03:04.760Z",
                    "update": "PEPs & Sanctions task completed/updated"
                  },
                  {
                    "timestamp": "2025-11-13T15:04:49.990Z",
                    "update": "PDF received and uploaded to S3 - CONSIDER: address verification, digital footprint, PEP hits"
                  }
                ],
                "status": "closed",
                "initiatedBy": "elizabeth.farrington@thurstanhoskin.co.uk",
                "piiData": {
                  "name": {
                    "first": "Jacob",
                    "last": "Moran",
                    "other": "Robert"
                  },
                  "address": {
                    "postcode": "TR15 2ND",
                    "country": "GBR",
                    "street": "Southgate Street",
                    "building_number": "94",
                    "town": "Redruth"
                  },
                  "dob": "2001-01-11T00:00:00.000Z",
                  "document": {}
                },
                "hasMonitoring": true,
                "thirdfortResponse": {
                  "name": "Purchase of 21 Green Lane",
                  "request": {
                    "actor": {
                      "name": "Jacob Robert Archer-Moran",
                      "phone": "+447506430094"
                    },
                    "tasks": [
                      {
                        "opts": {
                          "nfc": "preferred"
                        },
                        "type": "report:identity"
                      },
                      {
                        "opts": {
                          "consent": false
                        },
                        "type": "report:footprint"
                      },
                      {
                        "opts": {
                          "monitored": true
                        },
                        "type": "report:peps"
                      },
                      {
                        "type": "documents:poa"
                      },
                      {
                        "type": "report:sof-v1"
                      },
                      {
                        "type": "report:bank-statement"
                      },
                      {
                        "type": "report:bank-summary"
                      }
                    ]
                  },
                  "ref": "Val'ID'ate: 50/998",
                  "id": "d4ax6b923amg030ys0y0",
                  "reports": [],
                  "status": "open",
                  "metadata": {
                    "notify": {
                      "type": "http",
                      "data": {
                        "hmac_key": "sHxpp6Xb9DIYeyLab5zKdj1RQ6XJ4LazOhFm3XxrS7U=",
                        "method": "POST",
                        "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                      }
                    },
                    "created_by": "d3t0auq9io6g00ak3kkg",
                    "print": {
                      "team": "Cashiers",
                      "tenant": "Thurstan Hoskin Solicitors LLP",
                      "user": "THS Bot"
                    },
                    "context": {
                      "gid": "d3t2k5a9io6g00ak3km0",
                      "uid": "d3t0auq9io6g00ak3kkg",
                      "team_id": "d3t2k5a9io6g00ak3km0",
                      "tenant_id": "d3t2ifa9io6g00ak3klg"
                    },
                    "ce": {
                      "uri": "/v1/checks/4151797978"
                    },
                    "created_at": "2025-11-13T12:46:37.017Z"
                  },
                  "type": "v2",
                  "opts": {
                    "peps": {
                      "monitored": true
                    }
                  }
                },
                "hasAlerts": true,
                "pdfAddedAt": "2025-11-13T15:04:49.990Z",
                "smsSent": true,
                "transactionId": "d4ax6b923amg030ys0y0"
            },            
            // Mock Check 0: Jacob Robert Archer-Moran - Lite Screen in PROGRESS
            {
                "taskOutcomes": {
                  "address": {
                    "result": "fail",
                    "status": "closed",
                    "data": {
                      "quality": 0
                    }
                  },
                  "peps": {
                    "breakdown": {
                      "total_hits": 2,
                      "hits": [
                        {
                          "name": "Jake Moran",
                          "assets": [],
                          "dob": {
                            "main": "",
                            "other": []
                          },
                          "score": 0.1,
                          "flag_types": [
                            "adverse-media",
                            "adverse-media-violent-crime"
                          ],
                          "source_notes": {
                            "complyadvantage-adverse-media": {
                              "aml_types": [
                                "adverse-media",
                                "adverse-media-violent-crime"
                              ],
                              "country_codes": [
                                "US"
                              ],
                              "name": "ComplyAdvantage Adverse Media"
                            }
                          },
                          "institutions": [],
                          "spouses": [],
                          "political_positions": [],
                          "countries": [
                            "United States"
                          ],
                          "aka": [
                            "Jake Moran"
                          ],
                          "id": "CPPFOJFI8OCU4PE",
                          "match_types": [
                            "equivalent_name",
                            "name_variations_removal"
                          ],
                          "roles": [],
                          "fields": [
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "United States"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "United States"
                            },
                            {
                              "name": "Countries",
                              "source": "",
                              "value": "United States"
                            }
                          ],
                          "media": [
                            {
                              "date": "2014-05-21T00:00:00Z",
                              "snippet": "But after suffering a gut-wrenching 29-27, 20-25, 29-27 setback to the Redwings, the RedHawks rebounded to take down St. Patrick (25-19, 25-22) in another conference clash. Spearheading Marist's winning effort was Jake Moran, who registered five kills and six digs. Tom Inzinga equaled Moran's kill total, while Nick O'Gorman chipped in four kills and a service ace.",
                              "title": "Community sports news - Southwest Community Publishing",
                              "url": "https://www.southwestregionalpublishing.com/2014/05/21/community-sports-news-05-21-14-2/"
                            },
                            {
                              "date": "2016-05-21T00:00:00Z",
                              "snippet": "The best challenge to the Patriot stronghold, as evidenced this weekend, is O'Gorman, which took four of six heads-up championship matches against Lincoln. Sam Heckman (Flight 3), Jake Moran (Flight 4) and Michael Yousef (Flight 6) all racked up singles titles, while Flight 2 runner-up Wil McDowell and Heckman took home the Flight 2 doubles crown. \"They performed like I thought they would, and also expected,\" said Coach Don Barnes.",
                              "title": "Lincoln caps third straight tennis title",
                              "url": "https://www.argusleader.com/story/sports/high-school-sports/2016/05/21/midst-dynasty---lincoln-caps-third-straight-title/84666134/"
                            }
                          ],
                          "associates": []
                        },
                        {
                          "name": "Jacob Moran",
                          "assets": [],
                          "dob": {
                            "main": "",
                            "other": []
                          },
                          "score": 0.1,
                          "flag_types": [
                            "adverse-media",
                            "adverse-media-general",
                            "adverse-media-violent-crime"
                          ],
                          "source_notes": {
                            "complyadvantage-adverse-media": {
                              "aml_types": [
                                "adverse-media",
                                "adverse-media-general",
                                "adverse-media-violent-crime"
                              ],
                              "country_codes": [
                                "CA",
                                "US"
                              ],
                              "name": "ComplyAdvantage Adverse Media"
                            }
                          },
                          "institutions": [],
                          "spouses": [],
                          "political_positions": [],
                          "countries": [
                            "Canada",
                            "United States"
                          ],
                          "aka": [
                            "Jacob Moran",
                            "Jacob Benning Moran"
                          ],
                          "id": "5F0CGJUQGD3KXR6",
                          "match_types": [
                            "aka_exact",
                            "name_variations_removal"
                          ],
                          "roles": [],
                          "fields": [
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "Canada"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "Canada, United States"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "United States"
                            },
                            {
                              "name": "Countries",
                              "source": "",
                              "value": "Canada, United States"
                            }
                          ],
                          "media": [
                            {
                              "date": "0001-01-01T00:00:00Z",
                              "snippet": "GPD is in direct communication with the Michigan State Police and are working with them on the case following his capture, the agency said.<\\/p>\\n Shortly after GPD announced that Jacob Moran was in custody, the Johnson County Coroner\\u2019s Office formally identified Shaun Moran as the man who was killed in the shooting. The office ruled his death as homicide caused by a single gunshot wound.<\\/p>\\n",
                              "title": "(no title)",
                              "url": "https://dailyjournal.net/wp-json/wp/v2/posts/1816390"
                            },
                            {
                              "date": "2021-03-01T00:00:00Z",
                              "snippet": "They detained Moran and learned he had urinated on a tire of the car. \"Moran was heavily intoxicated on marijuana. He was arrested for prowling, public urination and public intoxication,\" police said.",
                              "title": "530 Crime Watch: Man tried to rob bank across street from police station",
                              "url": "https://www.usatoday.com/story/news/local/2021/03/01/530-crime-watch-arrest-jail-redding-police-shasta-sheriff/6870286002/?gnt-cfr=1"
                            },
                            {
                              "date": "2023-08-29T00:00:00Z",
                              "snippet": "Court documents show that Jacob Moran had allegedly assaulted his father twice in the hours before the shooting. Jacob Moran was charged Tuesday with residential entry, a Level 6 felony, and two counts of domestic battery both as a Level 6 felony and a misdemeanor, for the incidents. Charges for the shooting have not yet been filed.",
                              "title": "Greenwood domestic dispute ends in fatal shooting - Daily Journal",
                              "url": "https://dailyjournal.net/2023/08/29/greenwood-domestic-dispute-ends-in-fatal-shooting/"
                            },
                            {
                              "date": "2024-11-15T00:00:00Z",
                              "snippet": "Jacob Moran had been staying at his father's home but had reportedly been causing issues and been asked to leave the home. After being asked to leave the first time, Jacob Moran allegedly assaulted his father, leading to police being called. Later that day, he returned and again allegedly assaulted Shaun Moran, according to court documents.",
                              "title": "Greenwood man convicted of murder of father following domestic dispute - Daily Journal",
                              "url": "https://dailyjournal.net/2024/11/15/greenwood-man-convicted-of-murder-of-father-following-domestic-dispute/"
                            },
                            {
                              "date": "2023-09-07T00:00:00Z",
                              "snippet": "The gun's serial number was a match to the gun box that was found in the garage, court documents show. Jacob Moran was then arrested and taken to a Sturgis, Michigan jail on a charge of possession of an unregistered handgun. The BMW was impounded, court documents say.",
                              "title": "Greenwood man, 22, charged with his father's murder - Daily Journal",
                              "url": "https://dailyjournal.net/2023/09/07/greenwood-man-22-charged-with-his-fathers-murder/"
                            },
                            {
                              "date": "0001-01-01T00:00:00Z",
                              "snippet": "As deputies attempted to place Moran into custody for his warrant, Moran began to physically resist deputies. While resisting, Moran twice attempted to unholster a deputy's service firearm. After a brief struggle, Moran was arrested and then booked into the Humboldt County Correctional Facility on fresh charges of attempting to remove a peace officer's firearm (PC 148(d)) and resisting a peace officer (PC 148(a)(1)), in addition to his warrant charges of assault (PC 240) and battery (PC 242).",
                              "title": "News Flash &#x2022; County of Humboldt &#x2022; CivicEngage",
                              "url": "https://humboldtgov.org/CivicAlerts.aspx?AID=4279"
                            },
                            {
                              "date": "2021-03-26T00:00:00Z",
                              "snippet": "They immediately detained Moran and learned he urinated on a tire of the same car. Moran was \"heavily intoxicated on marijuana,\" and was ultimately arrested for public intoxication, public urination, and prowling.",
                              "title": "Officers arrest prowler looking inside, and urinating on, a vehicle in Redding on Friday",
                              "url": "https://krcrtv.com/news/local/bicycle-officers-catch-prowler-looking-inside-cars-in-redding-on-friday"
                            },
                            {
                              "date": "2015-04-01T00:00:00Z",
                              "snippet": "Moran then emerged, ran toward the plaintiff, and punched him. The officers arrested Moran. The plaintiff commenced this action against, among others, the defendant City of New York, alleging that the officers were negligent in failing to protect the plaintiff.",
                              "title": "PHILIP v. MORAN | 127 A.D.3d 717 (2015) | 20150401440 | Leagle.com",
                              "url": "https://www.leagle.com/decision/innyco20150401440"
                            },
                            {
                              "date": "2023-08-29T00:00:00Z",
                              "snippet": "When they arrived they found, Shaun Moran dead of an apparent gunshot wound in the home's garage, police say. Police say Jacob Moran is suspect in the shooting. It was reported that he was angry with Shaun Moran about being told to move out of the home, according to the news release.",
                              "title": "UPDATE: Suspect in custody after deadly Greenwood shooting - Daily Journal",
                              "url": "https://dailyjournal.net/2023/08/29/update-suspect-in-custody-after-deadly-greenwood-shooting/"
                            },
                            {
                              "date": "2021-10-13T00:00:00Z",
                              "snippet": "16 p.m., Humboldt County Sheriff's deputies on patrol in the 2400 block of Myrtle Avenue observed a suspicious male exhibiting behavior consistent with attempting a car burglary. Deputies contacted the man, 20-year-old Jacob Benning Moran, and learned that Moran had an outstanding misdemeanor warrant for his arrest. As deputies attempted to place Moran into custody for his warrant, Moran began to physically resist deputies.",
                              "title": "Warrant suspect tries to grab deputy's gun during arrest in Myrtletown, HCSO says",
                              "url": "https://krcrtv.com/north-coast-news/eureka-local-news/warrant-suspect-tries-to-grab-deputys-gun-during-arrest-in-myrtletown-hcso-says"
                            }
                          ],
                          "associates": []
                        }
                      ]
                    },
                    "data": {
                      "dob": "2001-01-11T00:00:00.000Z",
                      "name": {
                        "first": "Jacob",
                        "last": "Moran",
                        "other": "Robert"
                      },
                      "address": {
                        "postcode": "TR15 2ND",
                        "country": "GBR",
                        "street": "Southgate Street",
                        "building_number": "94",
                        "town": "Redruth"
                      }
                    },
                    "result": "consider",
                    "documents": [
                      "d4911ad23amg0305ahm0"
                    ],
                    "id": "d49119n23amg0305ahhg",
                    "status": "closed",
                    "createdAt": "2025-11-10T16:19:50.418Z"
                  },
                  "footprint": {
                    "breakdown": {
                      "data_count": {
                        "properties": {
                          "score": 0
                        },
                        "result": "consider"
                      },
                      "data_quality": {
                        "properties": {
                          "score": 0
                        },
                        "result": "consider"
                      },
                      "rules": [
                        {
                          "id": "U000",
                          "name": "",
                          "score": 0,
                          "text": "No trace of supplied Address(es), or manual Authentication required by the Applicant"
                        }
                      ],
                      "service_name": "Authenticateplus"
                    },
                    "data": {
                      "address": {
                        "postcode": "TR15 2ND",
                        "country": "GBR",
                        "street": "Southgate Street",
                        "building_number": "94",
                        "town": "Redruth"
                      },
                      "dob": "2001-01-11T00:00:00.000Z",
                      "name": {
                        "first": "Jacob",
                        "last": "Moran",
                        "other": "Robert"
                      }
                    },
                    "result": "fail",
                    "documents": [],
                    "id": "d49119523amg0305ahfg",
                    "status": "closed",
                    "createdAt": "2025-11-10T16:19:48.086Z"
                  }
                },
                "updatedAt": "2025-11-10T16:19:52.927Z",
                "pdfReady": true,
                "checkType": "lite-screen",
                "completedAt": "2025-11-10T16:19:52.927Z",
                "pepDismissals": [
                  {
                    "timestamp": "2025-11-10T16:21:10.564Z",
                    "reportId": "d49119n23amg0305ahhg",
                    "_id": "8bavqfs",
                    "reason": "different middle name to our client",
                    "hitName": "Jacob Moran",
                    "reportType": "peps",
                    "hitId": "5F0CGJUQGD3KXR6",
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-10T16:21:10.564Z",
                    "reportId": "d49119n23amg0305ahhg",
                    "_id": "sNkrev8",
                    "reason": "different surname to out client",
                    "hitName": "Jake Moran",
                    "reportType": "peps",
                    "hitId": "CPPFOJFI8OCU4PE",
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  }
                ],
                "initiatedAt": "2025-11-10T16:19:47.409Z",
                "considerReasons": [
                  "address verification",
                  "digital footprint",
                  "PEP hits"
                ],
                "pdfS3Key": "protected/6FtVY0d",
                "consumerName": "Jacob Moran",
                "tasks": [
                  "report:footprint",
                  "report:peps"
                ],
                "updates": [
                  {
                    "timestamp": "2025-11-10T16:19:47.409Z",
                    "update": "Lite Screen check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-10T16:19:52.927Z",
                    "update": "Transaction completed - awaiting PDF"
                  },
                  {
                    "timestamp": "2025-11-10T16:19:59.972Z",
                    "update": "PDF received and uploaded to S3 - CONSIDER: address verification, digital footprint, PEP hits"
                  },
                  {
                    "timestamp": "2025-11-10T16:21:19.051Z",
                    "update": "PEPs & Sanctions task completed"
                  }
                ],
                "status": "closed",
                "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                "piiData": {
                  "name": {
                    "first": "Jacob",
                    "last": "Moran",
                    "other": "Robert"
                  },
                  "address": {
                    "postcode": "TR15 2ND",
                    "country": "GBR",
                    "street": "Southgate Street",
                    "building_number": "94",
                    "town": "Redruth"
                  },
                  "dob": "2001-01-11T00:00:00.000Z",
                  "document": {}
                },
                "hasMonitoring": true,
                "thirdfortResponse": {
                  "name": "Jacob Moran - Lite Screening",
                  "request": {
                    "tasks": [
                      {
                        "opts": {
                          "consent": false
                        },
                        "type": "report:footprint"
                      },
                      {
                        "opts": {
                          "monitored": true
                        },
                        "type": "report:peps"
                      }
                    ]
                  },
                  "ref": "Val'ID'ate: 50/999",
                  "id": "d49118n23amg0305ahe0",
                  "reports": [],
                  "status": "open",
                  "metadata": {
                    "notify": {
                      "type": "http",
                      "data": {
                        "hmac_key": "GgUi5IyCFm4TOsMy3Q4cvq6bnQEBJq/0uRqECCRoz+4=",
                        "method": "POST",
                        "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                      }
                    },
                    "created_by": "d3t0auq9io6g00ak3kkg",
                    "print": {
                      "team": "Cashiers",
                      "tenant": "Thurstan Hoskin Solicitors LLP",
                      "user": "THS Bot"
                    },
                    "context": {
                      "gid": "d3t2k5a9io6g00ak3km0",
                      "uid": "d3t0auq9io6g00ak3kkg",
                      "team_id": "d3t2k5a9io6g00ak3km0",
                      "tenant_id": "d3t2ifa9io6g00ak3klg"
                    },
                    "ce": {
                      "uri": "/v1/checks/4151797899"
                    },
                    "created_at": "2025-11-10T16:19:45.948Z"
                  },
                  "type": "v2",
                  "opts": {
                    "peps": {
                      "monitored": true
                    }
                  }
                },
                "expectations": {
                  "name": {
                    "data": {
                      "first": "Jacob",
                      "last": "Moran",
                      "other": "Robert"
                    }
                  },
                  "dob": {
                    "data": "2001-01-11T00:00:00.000Z"
                  },
                  "address": {
                    "data": {
                      "postcode": "TR15 2ND",
                      "country": "GBR",
                      "building_name": "",
                      "flat_number": "",
                      "street": "Southgate Street",
                      "building_number": "94",
                      "sub_street": "",
                      "town": "Redruth"
                    }
                  }
                },
                "hasAlerts": true,
                "pdfAddedAt": "2025-11-10T16:19:59.972Z",
                "transactionId": "d49118n23amg0305ahe0"
            },
            // Mock Check 1: THURSTAN HOSKIN SOLICITORS LLP - KYB Check
            {
                checkId: 'd45v1gy23amg0306599g',
                checkType: 'kyb',
                status: 'closed',
                companyName: 'THURSTAN HOSKIN SOLICITORS LLP',
                initiatedBy: 'jacob.archer-moran@thurstanhoskin.co.uk',
                initiatedAt: '2025-11-05T20:17:10.220Z',
                updatedAt: '2025-11-05T21:15:23.171Z',
                completedAt: '2025-11-05T20:17:29.568Z',
                pdfReady: true,
                pdfS3Key: 'protected/V0QcMFD',
                pdfAddedAt: '2025-11-05T20:21:46.714Z',
                hasMonitoring: true,
                hasAlerts: false,
                companyData: {
                    jurisdiction: 'UK',
                    number: 'OC421980',
                    name: 'THURSTAN HOSKIN SOLICITORS LLP',
                    numbers: ['OC421980'],
                    id: '223822293'
                },
                thirdfortResponse: {
                    request: {
                        data: {
                            jurisdiction: 'UK',
                            number: 'OC421980',
                            name: 'THURSTAN HOSKIN SOLICITORS LLP',
                            numbers: ['OC421980'],
                            id: '223822293'
                        },
                        reports: [
                            { type: 'company:summary' },
                            { type: 'company:sanctions', opts: { monitored: true } },
                            { type: 'company:ubo' },
                            { type: 'company:beneficial-check' },
                            { type: 'company:shareholders' }
                        ]
                    },
                    ref: '21 Green Lane',
                    id: 'd45v1gy23amg0306599g',
                    reports: [],
                    status: 'open',
                    type: 'company'
                },
                tasks: [],
                taskOutcomes: {
                    'company:beneficial-check': {
                        breakdown: {},
                        result: 'consider',
                        documents: [],
                        id: 'd45v1ke23amg030659dg',
                        status: 'unobtainable',
                        createdAt: '2025-11-05T20:17:17.370Z'
                    },
                    'company:summary': {
                        breakdown: {
                            people: [
                                {
                                    name: 'Barbara Archer',
                                    start_date: '2018-04-12',
                                    dob: '1974-07',
                                    position: 'Designated LLP Member',
                                    ownershipPercentage: 45,
                                    votingPercentageHigh: 45,
                                    natureOfControlTypes: ['ownership-of-shares-75-to-100-percent', 'voting-rights-75-to-100-percent']
                                },
                                {
                                    name: 'Stephen John Duncan Morrison',
                                    start_date: '2018-04-12',
                                    dob: '1972-07',
                                    position: 'Designated LLP Member',
                                    ownershipPercentage: 55,
                                    votingPercentageHigh: 55,
                                    natureOfControlTypes: ['ownership-of-shares-75-to-100-percent', 'voting-rights-75-to-100-percent', 'right-to-appoint-and-remove-directors']
                                }
                            ],
                            registration_number: 'OC421980',
                            status: 'active',
                            date_of_incorporation: '2018-04-12'
                        },
                        result: 'clear',
                        documents: [],
                        id: 'd45v1m623amg030659hg',
                        status: 'closed',
                        createdAt: '2025-11-05T20:17:20.796Z'
                    },
                    'company:shareholders': {
                        breakdown: {
                            documents: [
                                {
                                    id: '49621b12-655b-4fee-8715-3daefb7f9ca8',
                                    type: 'shareholders',
                                    provider: 'documents-api'
                                }
                            ]
                        },
                        result: 'clear',
                        documents: ['49621b12-655b-4fee-8715-3daefb7f9ca8'],
                        id: 'd45v1my23amg030659m0',
                        status: 'closed',
                        createdAt: '2025-11-05T20:17:23.522Z'
                    },
                    'company:sanctions': {
                        breakdown: {
                            total_hits: 0,
                            hits: []
                        },
                        result: 'clear',
                        documents: ['d45v3ed23amg030659pg'],
                        id: 'd45v1jy23amg030659b0',
                        status: 'closed',
                        createdAt: '2025-11-05T20:17:15.660Z'
                    },
                    'company:ubo': {
                        breakdown: {
                            uboUnavailable: true,
                            pscs: [
                                {
                                    natureOfControlStartDate: '2018-04-12',
                                    natureOfControlTypes: ['ownership-of-shares-75-to-100-percent', 'voting-rights-75-to-100-percent'],
                                    person: {
                                        name: 'Barbara Archer',
                                        birthDate: '1974-07',
                                        nationality: 'British',
                                        ownershipPercentage: 45,
                                        votingPercentageHigh: 45
                                    }
                                },
                                {
                                    natureOfControlStartDate: '2018-04-12',
                                    natureOfControlTypes: ['ownership-of-shares-75-to-100-percent', 'voting-rights-75-to-100-percent', 'right-to-appoint-and-remove-directors'],
                                    person: {
                                        name: 'Stephen John Duncan Morrison',
                                        birthDate: '1972-07',
                                        nationality: 'British',
                                        ownershipPercentage: 55,
                                        votingPercentageHigh: 55
                                    }
                                }
                            ]
                        },
                        result: 'consider',
                        documents: [],
                        id: 'd45v1kp23amg030659fg',
                        status: 'unobtainable',
                        createdAt: '2025-11-05T20:17:18.266Z'
                    }
                },
                updates: [
                    { timestamp: '2025-11-05T20:17:10.220Z', update: 'KYB check initiated by jacob.archer-moran@thurstanhoskin.co.uk' },
                    { timestamp: '2025-11-05T20:17:29.568Z', update: 'Check completed - awaiting PDF' },
                    { timestamp: '2025-11-05T20:21:46.714Z', update: 'PDF received and uploaded to S3 - CLEAR' },
                    { timestamp: '2025-11-05T21:15:23.171Z', update: 'Refreshed from Thirdfort API - Status: closed' }
                ]
            },
            // Mock Check 2: Benjamin David Jasper Meehan - Electronic ID with CONSIDER
            {
                "taskOutcomes": {
                  "document": {
                    "result": "clear",
                    "status": "complete",
                    "data": {
                      "consistency": "clear",
                      "compromised": "clear",
                      "authenticity": "clear",
                      "integrity": "clear",
                      "validation": "clear"
                    }
                  },
                  "facial_similarity": {
                    "result": "clear",
                    "status": "complete",
                    "data": {
                      "authenticity": "clear",
                      "comparison": "clear",
                      "integrity": "clear"
                    }
                  },
                  "peps": {
                    "breakdown": {
                      "total_hits": 0,
                      "hits": []
                    },
                    "data": {
                      "dob": "2003-02-22T00:00:00.000Z",
                      "name": {
                        "first": "Benjamin",
                        "last": "Meehan",
                        "other": "David Jasepr"
                      },
                      "address": {
                        "postcode": "TR15 3SW",
                        "country": "GBR",
                        "street": "Woolf Place",
                        "building_number": "1",
                        "town": "Redruth"
                      }
                    },
                    "result": "clear",
                    "documents": [
                      "d4704s323amg030w7vdg"
                    ],
                    "id": "d4704e123amg030w7vbg",
                    "status": "closed",
                    "createdAt": "2025-11-07T14:29:12.823Z"
                  },
                  "nfc": {
                    "result": "consider",
                    "status": "unobtainable",
                    "data": {
                      "chip": {},
                      "comparison": {}
                    }
                  },
                  "documents:poo": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d46gtah23amg030rwa50",
                          "type": "poo"
                        },
                        {
                          "id": "d46gtb123amg030rwa5g",
                          "type": "poo"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d46gtah23amg030rwa50",
                      "d46gtb123amg030rwa5g"
                    ],
                    "id": "d46gvdn23amg030rwa70",
                    "status": "closed",
                    "createdAt": "2025-11-06T21:05:58.876Z"
                  },
                  "address": {
                    "result": "fail",
                    "status": "closed",
                    "data": {
                      "quality": 0
                    }
                  },
                  "biometrics": {
                    "result": "consider",
                    "status": "unobtainable",
                    "data": {}
                  },
                  "identity": {
                    "result": "consider",
                    "status": "closed",
                    "data": {}
                  },
                  "documents:selfie": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d4704d923amg030w7v7g",
                          "type": "selfie"
                        }
                      ]
                    },
                    "data": {},
                    "result": "unknown",
                    "documents": [
                      "d4704d923amg030w7v7g"
                    ],
                    "id": "d4704d923amg030w7v6g",
                    "status": "complete",
                    "createdAt": "2025-11-07T14:29:09.617Z"
                  },
                  "footprint": {
                    "breakdown": {
                      "data_count": {
                        "properties": {
                          "score": 0
                        },
                        "result": "consider"
                      },
                      "data_quality": {
                        "properties": {
                          "score": 0
                        },
                        "result": "consider"
                      },
                      "service_name": "Authenticateplus",
                      "documents": [
                        {
                          "id": "d47049923amg030w7tzg",
                          "type": "poa"
                        }
                      ],
                      "rules": [
                        {
                          "id": "U000",
                          "name": "",
                          "score": 0,
                          "text": "No trace of supplied Address(es), or manual Authentication required by the Applicant"
                        }
                      ]
                    },
                    "data": {
                      "dob": "2003-02-22T00:00:00.000Z",
                      "name": {
                        "first": "Benjamin",
                        "last": "Meehan",
                        "other": "David Jasepr"
                      },
                      "address": {
                        "postcode": "TR15 3SW",
                        "country": "GBR",
                        "street": "Woolf Place",
                        "building_number": "1",
                        "town": "Redruth"
                      }
                    },
                    "result": "fail",
                    "documents": [
                      "d47049923amg030w7tzg"
                    ],
                    "id": "d47049s23amg030w7v10",
                    "status": "closed",
                    "createdAt": "2025-11-07T14:28:55.660Z"
                  }
                },
                "updatedAt": "2025-11-07T14:29:17.960Z",
                "considerAnnotations": [
                  {
                    "timestamp": "2025-11-09T13:27:20.862Z",
                    "_id": "79kieI9",
                    "newStatus": "consider",
                    "reason": "Requested further ID from client as failed address task and didnt upload any PoA",
                    "originalStatus": "consider",
                    "taskType": "address",
                    "objectivePath": "address.data_count",
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-09T13:27:20.862Z",
                    "_id": "ykBZIn0",
                    "newStatus": "consider",
                    "reason": "Requested further ID from client as failed address task and didnt upload any PoA",
                    "originalStatus": "consider",
                    "taskType": "address",
                    "objectivePath": "address.data_quality",
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-09T13:27:20.862Z",
                    "_id": "NqKHVUI",
                    "newStatus": "consider",
                    "reason": "Requested further ID from client as failed address task and didnt upload any PoA",
                    "originalStatus": "fail",
                    "taskType": "documents:poa",
                    "objectivePath": "documents:poa",
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-09T13:27:20.862Z",
                    "_id": "Vb0qqvj",
                    "newStatus": "clear",
                    "reason": "Original ID Completed and passed instead of Enhanced ID",
                    "originalStatus": "consider",
                    "taskType": "identity",
                    "objectivePath": "identity.nfc",
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-09T13:27:20.862Z",
                    "_id": "NGoX9bN",
                    "newStatus": "clear",
                    "reason": "Original ID Completed and passed instead of Enhanced ID",
                    "originalStatus": "consider",
                    "taskType": "identity",
                    "objectivePath": "identity.biometrics",
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  }
                ],
                "consumerPhone": "+447754241686",
                "pdfReady": true,
                "checkType": "electronic-id",
                "completedAt": "2025-11-07T14:29:17.960Z",
                "initiatedAt": "2025-11-06T16:42:43.686Z",
                "considerReasons": [
                  "address verification",
                  "digital footprint"
                ],
                "pdfS3Key": "protected/l0lXRcU",
                "consumerName": "Benjamin David Jasper Meehan",
                "tasks": [
                  "report:identity",
                  "report:footprint",
                  "report:peps",
                  "documents:poa",
                  "documents:poo"
                ],
                "updates": [
                  {
                    "timestamp": "2025-11-06T16:42:43.686Z",
                    "update": "Electronic ID check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-07T14:29:17.960Z",
                    "update": "Transaction completed - awaiting PDF"
                  },
                  {
                    "timestamp": "2025-11-07T14:29:59.000Z",
                    "update": "PEPs & Sanctions task completed"
                  },
                  {
                    "timestamp": "2025-11-07T14:31:21.496Z",
                    "update": "PDF received and uploaded to S3 - CONSIDER: address verification, digital footprint, document integrity"
                  },
                  {
                    "timestamp": "2025-11-07T14:33:08.542Z",
                    "update": "PDF received and uploaded to S3 - CONSIDER: address verification, digital footprint"
                  }
                ],
                "status": "closed",
                "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                "piiData": {
                  "name": {
                    "first": "Benjamin",
                    "last": "Meehan",
                    "other": "David Jasepr"
                  },
                  "address": {
                    "postcode": "TR15 3SW",
                    "country": "GBR",
                    "street": "Woolf Place",
                    "building_number": "1",
                    "town": "Redruth"
                  },
                  "dob": "2003-02-22T00:00:00.000Z",
                  "document": {
                    "number": "999999999"
                  }
                },
                "hasMonitoring": true,
                "thirdfortResponse": {
                  "name": "Sale of 21 Green Lane",
                  "request": {
                    "actor": {
                      "name": "Benjamin David Jasper Meehan",
                      "phone": "+447754241686"
                    },
                    "tasks": [
                      {
                        "opts": {
                          "nfc": "preferred"
                        },
                        "type": "report:identity"
                      },
                      {
                        "opts": {
                          "consent": false
                        },
                        "type": "report:footprint"
                      },
                      {
                        "opts": {
                          "monitored": true
                        },
                        "type": "report:peps"
                      },
                      {
                        "type": "documents:poa"
                      },
                      {
                        "type": "documents:poo"
                      }
                    ]
                  },
                  "ref": "21 Green Lane",
                  "id": "d46d00g23amg030rw7s0",
                  "reports": [],
                  "status": "open",
                  "metadata": {
                    "notify": {
                      "type": "http",
                      "data": {
                        "hmac_key": "XZ9PtCPxkpoVkiKRx0KPOIz/tVztJB7bYtE1pBRbvhs=",
                        "method": "POST",
                        "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                      }
                    },
                    "created_by": "d3t0auq9io6g00ak3kkg",
                    "print": {
                      "team": "Cashiers",
                      "tenant": "Thurstan Hoskin Solicitors LLP",
                      "user": "THS Bot"
                    },
                    "context": {
                      "gid": "d3t2k5a9io6g00ak3km0",
                      "uid": "d3t0auq9io6g00ak3kkg",
                      "team_id": "d3t2k5a9io6g00ak3km0",
                      "tenant_id": "d3t2ifa9io6g00ak3klg"
                    },
                    "ce": {
                      "uri": "/v1/checks/4151797878"
                    },
                    "created_at": "2025-11-06T16:42:42.371Z"
                  },
                  "type": "v2",
                  "opts": {
                    "peps": {
                      "monitored": true
                    }
                  }
                },
                "hasAlerts": true,
                "pdfAddedAt": "2025-11-07T14:33:08.542Z",
                "smsSent": true,
                "transactionId": "d46d00g23amg030rw7s0"
            },
            // Mock Check 3: Jacob Robert Moran - Electronic ID with CONSIDER (NFC name mismatch)
            {
                "taskOutcomes": {
                    "documents:poa": {
                        "breakdown": {
                            "documents": [
                                {
                                    "id": "d472tyb23amg030w7vpg",
                                    "type": "poa"
                                },
                                {
                                    "id": "d472tyk23amg030w7vq0",
                                    "type": "poa"
                                }
                            ]
                        },
                        "data": {},
                        "result": "clear",
                        "documents": [
                            "d472tyb23amg030w7vpg",
                            "d472tyk23amg030w7vq0"
                        ],
                        "id": "d472vm623amg030w7w90",
                        "status": "closed",
                        "createdAt": "2025-11-07T17:35:12.907Z"
                    },
                    "peps": {
                        "breakdown": {
                            "total_hits": 0,
                            "hits": []
                        },
                        "data": {
                            "dob": "2001-01-11T00:00:00.000Z",
                            "name": {
                                "first": "Jacob",
                                "last": "Archer-Moran",
                                "other": "Robert"
                            },
                            "address": {
                                "postcode": "TR15 2ND",
                                "country": "GBR",
                                "street": "Southgate Street",
                                "building_number": "94",
                                "town": "Redruth"
                            }
                        },
                        "result": "clear",
                        "documents": [
                            "d472we123amg030w7ww0"
                        ],
                        "id": "d472wd123amg030w7wt0",
                        "status": "closed",
                        "createdAt": "2025-11-07T17:36:52.386Z"
                    },
                    "nfc": {
                        "result": "consider",
                        "status": "complete",
                        "data": {
                            "chip": {
                                "clone_detection": "clear",
                                "verification": "clear"
                            },
                            "comparison": {
                                "dob": 0,
                                "name": 72
                            }
                        }
                    },
                    "address": {
                        "result": "fail",
                        "status": "closed",
                        "data": {
                            "quality": 0
                        }
                    },
                    "biometrics": {
                        "result": "clear",
                        "status": "complete",
                        "data": {}
                    },
                    "identity": {
                        "breakdown": {
                            "nfc": {
                                "breakdown": {
                                    "chip": {
                                        "breakdown": {
                                            "clone_detection": {
                                                "result": "clear"
                                            },
                                            "verification": {
                                                "result": "clear"
                                            }
                                        },
                                        "result": "clear"
                                    },
                                    "data_comparison": {
                                        "breakdown": {
                                            "dob": {
                                                "result": "clear",
                                                "properties": {
                                                    "days_difference": 0
                                                }
                                            },
                                            "name": {
                                                "result": "consider",
                                                "properties": {
                                                    "levenshtein_pct": 72
                                                }
                                            }
                                        },
                                        "result": "consider"
                                    }
                                },
                                "result": "consider",
                                "status": "complete"
                            },
                            "documents": [
                                {
                                    "id": "d472vbd23amg030w7vqg",
                                    "type": "passport"
                                },
                                {
                                    "id": "d472vfn23amg030w7vsg",
                                    "type": "face-image"
                                },
                                {
                                    "id": "d472vky23amg030w7w7g",
                                    "type": "selfie"
                                }
                            ],
                            "biometrics": {
                                "breakdown": {
                                    "attempts": [
                                        {
                                            "frame_available": false,
                                            "passed": true,
                                            "status": "complete",
                                            "token": {
                                                "created_at": 1762536895950,
                                                "validated_at": 1762536911920,
                                                "value": "d7b0d934c8c227d6359d6b794e8dddfbd44a98ffe8fe799283855bdd1801vi07"
                                            }
                                        }
                                    ]
                                },
                                "result": "clear",
                                "status": "complete"
                            }
                        },
                        "data": {
                            "nfc": {
                                "date_of_expiry": "22.08.2033",
                                "dob": "11.01.2001",
                                "name": "MORAN, JACOB ROBERT"
                            },
                            "name": {
                                "first": "Jacob",
                                "last": "Archer-Moran",
                                "other": "Robert"
                            },
                            "dob": "2001-01-11T00:00:00.000Z"
                        },
                        "result": "consider",
                        "documents": [
                            "d472vbd23amg030w7vqg",
                            "d472vfn23amg030w7vsg",
                            "d472vky23amg030w7w7g"
                        ],
                        "id": "d472wc923amg030w7wng",
                        "status": "closed",
                        "createdAt": "2025-11-07T17:36:49.799Z"
                    },
                    "footprint": {
                        "breakdown": {
                            "data_count": {
                                "properties": {
                                    "score": 0
                                },
                                "result": "consider"
                            },
                            "data_quality": {
                                "properties": {
                                    "score": 0
                                },
                                "result": "consider"
                            },
                            "service_name": "Authenticateplus",
                            "documents": [
                                {
                                    "id": "d472wbs23amg030w7wfg",
                                    "type": "poa"
                                },
                                {
                                    "id": "d472wc123amg030w7wg0",
                                    "type": "poa"
                                }
                            ],
                            "rules": [
                                {
                                    "id": "U000",
                                    "name": "",
                                    "score": 0,
                                    "text": "No trace of supplied Address(es), or manual Authentication required by the Applicant"
                                }
                            ]
                        },
                        "data": {
                            "dob": "2001-01-11T00:00:00.000Z",
                            "name": {
                                "first": "Jacob",
                                "last": "Archer-Moran",
                                "other": "Robert"
                            },
                            "address": {
                                "postcode": "TR15 2ND",
                                "country": "GBR",
                                "street": "Southgate Street",
                                "building_number": "94",
                                "town": "Redruth"
                            }
                        },
                        "result": "fail",
                        "documents": [
                            "d472wbs23amg030w7wfg",
                            "d472wc123amg030w7wg0"
                        ],
                        "id": "d472wc923amg030w7whg",
                        "status": "closed",
                        "createdAt": "2025-11-07T17:36:49.214Z"
                    }
                },
                "updatedAt": "2025-11-07T17:36:58.969Z",
                "consumerPhone": "+447506430094",
                "pdfReady": true,
                "checkType": "electronic-id",
                "completedAt": "2025-11-07T17:36:58.969Z",
                "initiatedAt": "2025-11-07T17:23:57.085Z",
                "considerReasons": [
                    "address verification",
                    "digital footprint",
                    "document integrity"
                ],
                "pdfS3Key": "protected/FTAxKJt",
                "consumerName": "Jacob Robert Moran",
                "tasks": [
                    "report:identity",
                    "report:footprint",
                    "report:peps",
                    "documents:poa"
                ],
                "updates": [
                    {
                        "timestamp": "2025-11-07T17:23:57.085Z",
                        "update": "Electronic ID check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                    },
                    {
                        "timestamp": "2025-11-07T17:36:58.969Z",
                        "update": "Transaction completed - awaiting PDF"
                    },
                    {
                        "timestamp": "2025-11-07T17:37:18.427Z",
                        "update": "PDF received and uploaded to S3 - CONSIDER: address verification, digital footprint, document integrity"
                    },
                    {
                        "timestamp": "2025-11-07T17:40:18.288Z",
                        "update": "2 additional document(s) uploaded by consumer"
                    }
                ],
                "status": "closed",
                "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                "piiData": {
                    "name": {
                        "first": "Jacob",
                        "last": "Archer-Moran",
                        "other": "Robert"
                    },
                    "address": {
                        "postcode": "TR15 2ND",
                        "country": "GBR",
                        "street": "Southgate Street",
                        "building_number": "94",
                        "town": "Redruth"
                    },
                    "dob": "2001-01-11T00:00:00.000Z",
                    "document": {}
                },
                "hasMonitoring": true,
                "thirdfortResponse": {
                    "name": "Purchase of 21 Green Lane",
                    "request": {
                        "actor": {
                            "name": "Jacob Robert Moran",
                            "phone": "+447506430094"
                        },
                        "tasks": [
                            {
                                "opts": {
                                    "nfc": "preferred"
                                },
                                "type": "report:identity"
                            },
                            {
                                "opts": {
                                    "consent": false
                                },
                                "type": "report:footprint"
                            },
                            {
                                "opts": {
                                    "monitored": true
                                },
                                "type": "report:peps"
                            },
                            {
                                "type": "documents:poa"
                            }
                        ]
                    },
                    "ref": "Purchase of 21 Green Lane",
                    "id": "d472pb123amg030w7vgg",
                    "reports": [],
                    "status": "open",
                    "metadata": {
                        "notify": {
                            "type": "http",
                            "data": {
                                "hmac_key": "GgUi5IyCFm4TOsMy3Q4cvq6bnQEBJq/0uRqECCRoz+4=",
                                "method": "POST",
                                "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                            }
                        },
                        "created_by": "d3t2m5q9io6g00ak3kmg",
                        "print": {
                            "team": "Cashiers",
                            "tenant": "Thurstan Hoskin Solicitors LLP",
                            "user": "Jacob Archer-Moran"
                        },
                        "context": {
                            "gid": "d3t2k5a9io6g00ak3km0",
                            "uid": "d3t2m5q9io6g00ak3kmg",
                            "team_id": "d3t2k5a9io6g00ak3km0",
                            "tenant_id": "d3t2ifa9io6g00ak3klg"
                        },
                        "ce": {
                            "uri": "/v1/checks/4151797887"
                        },
                        "created_at": "2025-11-07T17:23:55.088Z"
                    },
                    "type": "v2",
                    "opts": {
                        "peps": {
                            "monitored": true
                        }
                    }
                },
                "hasAlerts": true,
                "pdfAddedAt": "2025-11-07T17:37:18.427Z",
                "smsSent": true,
                "transactionId": "d472pb123amg030w7vgg"
            },
            // Mock Check 4: Se Idris Stewart - Electronic ID with SOF and Bank Statements
            {
    "taskOutcomes": {
      "document": {
        "result": "clear",
        "status": "complete",
        "data": {
          "consistency": "clear",
          "compromised": "clear",
          "authenticity": "clear",
          "integrity": "clear",
          "validation": "clear"
        }
      },
      "sof:v1": {
        "breakdown": {
          "property": {
            "address": {
              "building_name": "Chapel Farm House",
              "country": "GBR",
              "postcode": "TR15 1RW",
              "town": "Redruth"
            },
            "new_build": false,
            "price": 20000000,
            "stamp_duty": 150000
          },
          "funds": [
            {
              "data": {
                "amount": 1000000,
                "location": "GBR",
                "type": "lisa"
              },
              "metadata": {
                "created_at": 1762527831116
              },
              "type": "fund:htb"
            },
            {
              "data": {
                "amount": 500000,
                "giftor": {
                  "contactable": true,
                  "name": "Mum",
                  "phone": "+447493580033",
                  "relationship": "Mum"
                },
                "location": "GBR",
                "repayable": false
              },
              "metadata": {
                "created_at": 1762527831327
              },
              "type": "fund:gift"
            },
            {
              "data": {
                "amount": 150000,
                "description": "Clock",
                "location": "GBR"
              },
              "metadata": {
                "created_at": 1762527831542
              },
              "type": "fund:sale:assets"
            },
            {
              "data": {
                "amount": 18000000,
                "lender": "abc",
                "location": "GBR"
              },
              "metadata": {
                "created_at": 1762527831681
              },
              "type": "fund:mortgage"
            },
            {
              "data": {
                "amount": 500000,
                "location": "GBR",
                "people": [
                  {
                    "actor": true,
                    "name": "Se Idris Stewart",
                    "incomes": [
                      {
                        "reference": "payslip",
                        "source": "salary",
                        "description": "",
                        "annual_total": 2700000,
                        "frequency": "monthly"
                      }
                    ],
                    "employment_status": "employed",
                    "phone": "+447493580033"
                  }
                ]
              },
              "metadata": {
                "created_at": 1762527831814
              },
              "type": "fund:savings"
            }
          ]
        },
        "data": {},
        "result": "clear",
        "documents": [],
        "id": "d472vh623amg030w7w2g",
        "status": "closed",
        "createdAt": "2025-11-07T17:35:00.532Z"
      },
      "documents:savings": {
        "breakdown": {
          "documents": [
            {
              "id": "d472wna23amg030w7wz0",
              "type": "savings"
            }
          ]
        },
        "data": {},
        "result": "clear",
        "documents": [
          "d472wna23amg030w7wz0"
        ],
        "id": "d472wpa23amg030w7x6g",
        "status": "closed",
        "createdAt": "2025-11-07T17:37:29.440Z"
      },
      "documents:mortgage": {
        "breakdown": {
          "documents": [
            {
              "id": "d472w9s23amg030w7wf0",
              "type": "mortgage"
            }
          ]
        },
        "data": {},
        "result": "clear",
        "documents": [
          "d472w9s23amg030w7wf0"
        ],
        "id": "d472wp223amg030w7x20",
        "status": "closed",
        "createdAt": "2025-11-07T17:37:28.901Z"
      },
      "documents:poa": {
        "breakdown": {
          "documents": [
            {
              "id": "d470er323amg030w7vg0",
              "type": "poa"
            }
          ]
        },
        "data": {},
        "result": "clear",
        "documents": [
          "d470er323amg030w7vg0"
        ],
        "id": "d472vgy23amg030w7vxg",
        "status": "closed",
        "createdAt": "2025-11-07T17:34:59.453Z"
      },
      "facial_similarity": {
        "result": "clear",
        "status": "complete",
        "data": {
          "authenticity": "clear",
          "comparison": "clear",
          "integrity": "clear"
        }
      },
      "peps": {
        "breakdown": {
          "total_hits": 0,
          "hits": []
        },
        "data": {
          "dob": "2000-01-05T00:00:00.000Z",
          "name": {
            "first": "S&#xE9;",
            "last": "Stewart",
            "other": "Idris"
          },
          "address": {
            "postcode": "TR15 2ND",
            "country": "GBR",
            "street": "Southgate Street",
            "building_number": "94",
            "town": "Redruth"
          }
        },
        "result": "clear",
        "documents": [
          "d472x6c23amg030w7xx0"
        ],
        "id": "d472x5w23amg030w7xs0",
        "status": "closed",
        "createdAt": "2025-11-07T17:38:31.451Z"
      },
      "nfc": {
        "result": "consider",
        "status": "unobtainable",
        "data": {
          "chip": {},
          "comparison": {}
        }
      },
      "documents:bank-statement": {
        "breakdown": {
          "accounts": {
            "40163406": {
              "info": {
                "number": {
                  "iban": "",
                  "number": "40163406",
                  "sort_code": "40-20-55",
                  "swift_bic": ""
                },
                "name": "",
                "provider": {
                  "id": "",
                  "name": "HSBC"
                },
                "balance": {
                  "available": 2.75,
                  "current": 2.75,
                  "overdraft": 0
                },
                "info": [
                  {
                    "full_name": "Mr Se Idris Stewart",
                    "phones": null,
                    "date_of_birth": "",
                    "emails": null,
                    "update_timestamp": "",
                    "addresses": null
                  }
                ],
                "credentials_id": "",
                "currency": "GBP",
                "metadata": {
                  "created_at": "2025-11-07T17:35:01.470172Z",
                  "encryption": "",
                  "updated_at": "2025-11-07T17:36:32.145693Z"
                },
                "type": ""
              },
              "statement": [
                {
                  "merchant_name": "NEST",
                  "timestamp": "2025-07-01T00:00:00Z",
                  "description": "NEST FIRST PAYMENT",
                  "amount": -60,
                  "id": "03c57712-eab4-4574-b022-607336d5b059",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "PROSPECT UNION",
                  "timestamp": "2025-07-01T00:00:00Z",
                  "description": "PROSPECT UNION",
                  "amount": -13.33,
                  "id": "fe049d6e-cc8d-42b2-8e02-9fad81aef643",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "STEWART S *HSM",
                  "timestamp": "2025-07-01T00:00:00Z",
                  "description": "STEWART S *HSM SAVE",
                  "amount": -150,
                  "id": "2ffd97ed-ce60-4fe4-bb86-53ce568a7a02",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R",
                  "timestamp": "2025-07-01T00:00:00Z",
                  "description": "Arch-Mo J R CAR",
                  "amount": -70,
                  "id": "fdc1f9f6-319a-4027-bd94-2c74afdbc070",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arc-McDo B",
                  "timestamp": "2025-07-01T00:00:00Z",
                  "description": "Arc-McDo B VODAFONE",
                  "amount": -15,
                  "id": "f82f3579-3024-44f6-a2f8-af19162b97ee",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "DEX PROPERTY",
                  "timestamp": "2025-07-01T00:00:00Z",
                  "description": "DEX PROPERTY 35 SUTHERLAND RM 1",
                  "amount": -480,
                  "rolling_account_balance": 1073.91,
                  "id": "89137c17-da6f-414b-b221-496551762f06",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Katie Havanna Reen",
                  "timestamp": "2025-07-02T00:00:00Z",
                  "description": "Katie Havanna Reen SPLITWISE-PAYMENT",
                  "amount": -32.73,
                  "rolling_account_balance": 1041.18,
                  "id": "39dd0f39-1cd7-4da0-92b7-dd4ef640b8d1",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "OBP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-08T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "rolling_account_balance": 941.18,
                  "id": "467dcee0-769f-4f84-b710-fae215dbca63",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-09T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -40,
                  "id": "d98c90f8-49e8-4973-8884-d0f9d0cdddf2",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-09T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "id": "9099c841-dec8-4bec-8290-16d2f274bcf3",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-12T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "rolling_account_balance": 936.18,
                  "id": "ff7861ec-d2ff-49bc-ad98-17c256abdddf",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-16T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -60,
                  "rolling_account_balance": 876.18,
                  "id": "942cadee-2578-4cb9-98e3-bc684d9fd184",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-17T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "rolling_account_balance": 826.18,
                  "id": "10963733-05e5-405a-94c5-d7580b390d63",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "NHSBSA",
                  "timestamp": "2025-07-18T00:00:00Z",
                  "description": "NHSBSA PPC 2",
                  "amount": -11.45,
                  "id": "5e7a8546-cca8-46e5-8add-40a412b52ec6",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-18T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "rolling_account_balance": 764.73,
                  "id": "0e16d88a-c79c-44d6-8fcb-c1bb6952724f",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Barbara Archer",
                  "timestamp": "2025-07-19T00:00:00Z",
                  "description": "Barbara Archer Holiday Flights",
                  "amount": -140,
                  "rolling_account_balance": 624.73,
                  "id": "dc55407c-f7e7-4026-b815-53b69d1d1e85",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LEE CAJ",
                  "timestamp": "2025-07-20T00:00:00Z",
                  "description": "LEE CAJ Joy to the lord",
                  "amount": 40,
                  "id": "1444e1f2-3fac-4c78-a8a1-4e0dd3407bc8",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-20T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -240,
                  "id": "c5c8cc39-44dd-4467-ba8b-d115ee536ebd",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-20T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "rolling_account_balance": 374.73,
                  "id": "4f98cc79-7d3b-4201-968f-dba556783460",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-21T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -74.73,
                  "id": "af6a348e-f528-4a58-af07-02fb91e9c9b1",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-21T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "rolling_account_balance": 450,
                  "id": "79865522-6217-4bff-a470-723d0bee6d73",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-23T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -300,
                  "rolling_account_balance": 318,
                  "id": "27d47a64-4632-4973-8838-7b8b5ab85839",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LEE CAJ",
                  "timestamp": "2025-07-23T00:00:00Z",
                  "description": "LEE CAJ Airplane disaster",
                  "amount": 168,
                  "id": "45c7dc04-1865-460f-a857-cfad071e6831",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-24T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -120,
                  "rolling_account_balance": 198,
                  "id": "73171bb4-af3c-46d0-ab1e-f207b2d118e4",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LADYWELL ARIZONA L",
                  "timestamp": "2025-07-25T00:00:00Z",
                  "description": "LADYWELL ARIZONA L SALARY JULY 2025",
                  "amount": 2162.44,
                  "id": "18c9a740-dc6c-4eb9-8a5b-fdffd7a3564c",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-25T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "rolling_account_balance": 2260.44,
                  "id": "ddb0edbd-2d9a-4eb9-8c48-6f9b5646107d",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-28T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "rolling_account_balance": 2160.44,
                  "id": "48b02a93-b68d-4384-9800-7053bc9a48d9",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-07-29T00:00:00Z",
                  "description": "Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "rolling_account_balance": 2060.44,
                  "id": "7faa0e99-67c6-4d34-861d-3bcbddadeb10",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "PROSPECT UNION",
                  "timestamp": "2025-08-01T00:00:00Z",
                  "description": "DD PROSPECT UNION",
                  "amount": -13.33,
                  "id": "78ed938c-c5f4-4737-93df-bf0b8e085d8e",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "NEST",
                  "timestamp": "2025-08-01T00:00:00Z",
                  "description": "DD NEST",
                  "amount": -60,
                  "id": "12404151-42fc-42cf-a102-d698dc9b1ab2",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "STEWART S *HSM SAVE",
                  "timestamp": "2025-08-01T00:00:00Z",
                  "description": "SO STEWART S *HSM SAVE",
                  "amount": -150,
                  "id": "93cd5860-cb98-4be2-be2d-87dddf569c35",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R CAR",
                  "timestamp": "2025-08-01T00:00:00Z",
                  "description": "SO Arch-Mo J R CAR",
                  "amount": -70,
                  "id": "5b0b4661-13bb-42c8-b0af-f6771995eba2",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arc-McDo B VODAFONE",
                  "timestamp": "2025-08-01T00:00:00Z",
                  "description": "SO Arc-McDo B VODAFONE",
                  "amount": -15,
                  "id": "12d8601d-9b0d-4aaa-be25-a2a2c07634d9",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "DEX PROPERTY 35 SUTHERLAND RM 1",
                  "timestamp": "2025-08-01T00:00:00Z",
                  "description": "SO DEX PROPERTY 35 SUTHERLAND RM 1",
                  "amount": -480,
                  "id": "091a1417-6f9d-4301-834a-893776f70189",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-01T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -200,
                  "rolling_account_balance": 1072.11,
                  "id": "d1945c03-afa3-4877-8ba9-4a07398240b2",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-02T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -250,
                  "rolling_account_balance": 822.11,
                  "id": "5d27588c-4266-41be-8eb6-683123082255",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-08T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -200,
                  "rolling_account_balance": 622.11,
                  "id": "5d22cd18-a8e5-4c3d-ae5e-a7521cf60955",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-09T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -400,
                  "rolling_account_balance": 222.11,
                  "id": "8814461c-b7b1-4da5-be9a-ae93066ad667",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Katie Havanna Reen SPLITWISE-PAYMENT",
                  "timestamp": "2025-08-11T00:00:00Z",
                  "description": "OBP Katie Havanna Reen SPLITWISE-PAYMENT",
                  "amount": -15.25,
                  "id": "e1f3f7b8-5b53-4dbd-9ce0-89fcd8e65fbb",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "OBP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-11T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -200,
                  "id": "550bc2cf-0cd6-416b-8a2a-7a72f876fb91",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "402055 40163414 INTERNET TRANSFER",
                  "timestamp": "2025-08-11T00:00:00Z",
                  "description": "TFR 402055 40163414 INTERNET TRANSFER",
                  "amount": 50,
                  "rolling_account_balance": 56.86,
                  "id": "eb8ede2b-24ec-4da9-84ce-989f5a42af1f",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "TFR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-17T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -40,
                  "rolling_account_balance": 16.86,
                  "id": "d25d875c-1c2e-4ce3-b118-031cdc2d0393",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "NHSBSA PPC 2",
                  "timestamp": "2025-08-18T00:00:00Z",
                  "description": "DD NHSBSA PPC 2",
                  "amount": -11.45,
                  "rolling_account_balance": 5.41,
                  "id": "21646963-a1b1-4935-8e8c-134622bc482f",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "402055 40163414 INTERNET TRANSFER",
                  "timestamp": "2025-08-20T00:00:00Z",
                  "description": "TFR 402055 40163414 INTERNET TRANSFER",
                  "amount": 100,
                  "id": "0132d86a-54ef-495f-b58a-3a87e865006f",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "TFR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-20T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "rolling_account_balance": 5.41,
                  "id": "74137577-187f-4463-9783-7c877fcce6d1",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "402055 40163414 INTERNET TRANSFER",
                  "timestamp": "2025-08-22T00:00:00Z",
                  "description": "TFR 402055 40163414 INTERNET TRANSFER",
                  "amount": 100,
                  "id": "fcaba9eb-490f-45e0-8dc3-c6dbec615496",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "TFR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-22T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -80,
                  "id": "7f7a993f-4b9c-4d91-9524-0e2d401d10ac",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-22T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -20,
                  "rolling_account_balance": 5.41,
                  "id": "c78819f5-6e44-47c8-bd77-1575216314ea",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R Iou",
                  "timestamp": "2025-08-23T00:00:00Z",
                  "description": "BP Arch-Mo J R Iou",
                  "amount": 50,
                  "id": "309569df-91e5-4c73-a940-13e4843d534e",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-23T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "rolling_account_balance": 5.41,
                  "id": "ca7caec7-f74f-4273-8cc1-a9a2a25fa912",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LADYWELL ARIZONA L",
                  "timestamp": "2025-08-29T00:00:00Z",
                  "description": "CR LADYWELL ARIZONA L SALARY AUGUST 2025",
                  "amount": 2575.24,
                  "id": "2d466586-2717-4bd0-bc2e-d2bf20993242",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-08-29T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -200,
                  "id": "6ac5bfa3-c855-45e4-8ef1-6bede326feb9",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "CAROLINE LEE",
                  "timestamp": "2025-08-29T00:00:00Z",
                  "description": "BP CAROLINE LEE From Se",
                  "amount": -90,
                  "rolling_account_balance": 2290.65,
                  "id": "3e5fdb0d-1823-4d6e-b451-f677efb5440f",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Jacob",
                  "timestamp": "2025-08-30T00:00:00Z",
                  "description": "BP Jacob Holidayxx",
                  "amount": -245,
                  "rolling_account_balance": 2045.65,
                  "id": "150be101-6bb1-4b6c-909a-c8e9c533708c",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-08-31T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "id": "3633bed0-2cfc-4db5-b1c7-d0757f514364",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-08-31T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -200,
                  "rolling_account_balance": 1745.65,
                  "id": "a156a3a3-fcf1-4c61-98ac-d0171fc784ac",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-08-31T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "id": "855a91b7-8f5c-4866-9bd7-fdc72b4af346",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "PROSPECT UNION",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "DD PROSPECT UNION",
                  "amount": -13.33,
                  "id": "5cc88288-d369-4ebd-88c9-9a2cd75a69d5",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "NEST",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "DD NEST",
                  "amount": -60,
                  "id": "444c1dbe-116b-4aab-839b-189cdb412e6e",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "STEWART S *HSM SAVE",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "SO STEWART S *HSM SAVE",
                  "amount": -150,
                  "id": "3acdac30-7262-4fd6-9e64-210b9ed9da7b",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "SO Arch-Mo J R CAR",
                  "amount": -70,
                  "id": "cadb0d06-2792-40e1-b321-cc7969bfab91",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arc-McDo B",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "SO Arc-McDo B VODAFONE",
                  "amount": -15,
                  "id": "0a92489f-47a6-4384-a38e-da9057fc95db",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "DEX PROPERTY",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "SO DEX PROPERTY 35 SUTHERLAND RM 1",
                  "amount": -480,
                  "rolling_account_balance": 957.32,
                  "id": "dac04f2b-9549-467e-a684-fcd7167741d0",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "PROSPECT UNION",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "DD PROSPECT UNION",
                  "amount": -13.33,
                  "id": "37d6717f-7204-43ec-84bb-b276d2755ef7",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "NEST",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "DD NEST",
                  "amount": -60,
                  "id": "478ec493-655c-48b8-933b-577bb620fa42",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "STEWART S *HSM SAVE",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "SO STEWART S *HSM SAVE",
                  "amount": -150,
                  "id": "db2b6b98-fb73-4827-aafe-e9fff5a83136",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "SO Arch-Mo J R CAR",
                  "amount": -70,
                  "id": "a6effef9-3137-4b3e-8fd5-a97d5c064e00",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arc-McDo B",
                  "timestamp": "2025-09-01T00:00:00Z",
                  "description": "SO Arc-McDo B VODAFONE",
                  "amount": -15,
                  "id": "37a8b581-5045-4d3c-95df-a0c1444e9692",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-04T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -200,
                  "rolling_account_balance": 757.32,
                  "id": "71f05de8-1388-4207-ae5f-2ca8c68fcc3b",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-05T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -200,
                  "rolling_account_balance": 557.32,
                  "id": "8fd28ae6-dc19-4e4b-b892-599bc8cfa5cf",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-07T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -150,
                  "id": "ce9f6978-3b3c-4551-8367-0c93dbd1cc89",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "KATIE HARRISON",
                  "timestamp": "2025-09-07T00:00:00Z",
                  "description": "CR KATIE HARRISON CHASE",
                  "amount": 80,
                  "rolling_account_balance": 487.32,
                  "id": "fe2584da-a62a-4ba6-b342-23fbc6b0f97f",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-07T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -150,
                  "id": "090ecd3a-c3c8-4b23-92b3-49e2ce9614b4",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-08T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "id": "82f70dd8-ed5c-467a-bf5f-ebdb199f68ca",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R",
                  "timestamp": "2025-09-08T00:00:00Z",
                  "description": "BP Arch-Mo J R Iou",
                  "amount": 100,
                  "rolling_account_balance": 537.32,
                  "id": "a45ac5a4-c462-45a0-b71e-db4d284c9110",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-08T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "id": "b6a6c8cb-d72d-4207-880e-3504367e04fa",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-12T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -60,
                  "id": "eba9dd8c-dd8f-4775-af86-cf104abfb659",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Katie Havanna Reen",
                  "timestamp": "2025-09-12T00:00:00Z",
                  "description": "OBP Katie Havanna Reen SPLITWISE-PAYMENT",
                  "amount": -15.25,
                  "id": "3f15166a-574a-4f3a-8747-961e2c79d88b",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "OBP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-12T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -280,
                  "rolling_account_balance": 182.07,
                  "id": "1fe221de-f3ba-48fe-9564-84cf0f2b95d2",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-12T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -60,
                  "id": "fb9432da-6d31-45bb-94ce-ba83e1337c39",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Katie Havanna Reen",
                  "timestamp": "2025-09-12T00:00:00Z",
                  "description": "OBP Katie Havanna Reen SPLITWISE-PAYMENT",
                  "amount": -15.25,
                  "id": "a99af3fb-a2e9-4600-8130-1378110476b3",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "OBP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-14T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -180,
                  "rolling_account_balance": 2.07,
                  "id": "333bdd32-7bf2-4802-83f8-2d568d6ddca2",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "NHSBSA",
                  "timestamp": "2025-09-18T00:00:00Z",
                  "description": "DD NHSBSA PPC 2",
                  "amount": -11.45,
                  "id": "ff155fa3-7558-4d9d-96b6-5a941ca7dabb",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "",
                  "timestamp": "2025-09-18T00:00:00Z",
                  "description": "TFR 402055 40163414 INTERNET TRANSFER",
                  "amount": 200,
                  "id": "b2229847-7132-4733-a342-ba24b776fe16",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "TFR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-18T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -90,
                  "rolling_account_balance": 100.62,
                  "id": "b1811952-4e81-4980-af93-c722de4756fa",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "NHSBSA PPC 2",
                  "timestamp": "2025-09-18T00:00:00Z",
                  "description": "DD NHSBSA PPC 2",
                  "amount": -11.45,
                  "id": "db0e1cec-5c5c-41e7-b61a-95b3cda1a98a",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "",
                  "timestamp": "2025-09-18T00:00:00Z",
                  "description": "TFR 402055 40163414 INTERNET TRANSFER",
                  "amount": 200,
                  "id": "bedb8a6c-956e-435d-b17f-51683b54e795",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "TFR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-20T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "rolling_account_balance": 0.62,
                  "id": "88be2410-9882-452c-bb63-cfdeefd1f7a2",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LEE CAJ",
                  "timestamp": "2025-09-23T00:00:00Z",
                  "description": "CR LEE CAJ favourite parent",
                  "amount": 100,
                  "rolling_account_balance": 100.62,
                  "id": "ab5d57cd-b9cf-4475-99bd-88c08704adc3",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-25T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "rolling_account_balance": 0.62,
                  "id": "50daa6c9-82d6-4dc8-81a3-f68d0b81cc44",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LADYWELL ARIZONA L",
                  "timestamp": "2025-09-26T00:00:00Z",
                  "description": "CR LADYWELL ARIZONA L SALARY SEPTEMBER 2",
                  "amount": 2162.24,
                  "id": "d8ce6a43-3cc1-4549-8b49-49f05ee6ce97",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "CAROLINE LEE",
                  "timestamp": "2025-09-26T00:00:00Z",
                  "description": "BP CAROLINE LEE From Se",
                  "amount": -80,
                  "id": "f4e64bf2-7561-4698-8a40-5c4c16561379",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-26T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -200,
                  "id": "94c1ca78-ebbc-43fd-b325-60cae3035a8d",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "CAROLINE LEE",
                  "timestamp": "2025-09-26T00:00:00Z",
                  "description": "BP CAROLINE LEE From Se",
                  "amount": -110,
                  "rolling_account_balance": 1772.86,
                  "id": "99d70e7d-a03e-429d-9d54-f025681505e2",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LADYWELL ARIZONA L",
                  "timestamp": "2025-09-26T00:00:00Z",
                  "description": "CR LADYWELL ARIZONA L SALARY SEPTEMBER 2",
                  "amount": 2162.24,
                  "id": "07bc1b6b-0abd-4d79-81fa-7e20e1de4bdc",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "CAROLINE LEE",
                  "timestamp": "2025-09-26T00:00:00Z",
                  "description": "BP CAROLINE LEE From Se",
                  "amount": -80,
                  "id": "d5e8c0c1-b6b2-47a8-9711-cfaf68b926e2",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-26T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -200,
                  "id": "1158f471-8ff2-4458-b0b6-21e6ab13f1c3",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Jacob",
                  "timestamp": "2025-09-28T00:00:00Z",
                  "description": "BP Jacob Holidayxx",
                  "amount": -200,
                  "rolling_account_balance": 1572.86,
                  "id": "910911cd-2761-4e9c-b00f-e8bcfc05e260",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-29T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "rolling_account_balance": 1472.86,
                  "id": "0dc3d8bc-f23f-440b-876c-e419abaa4178",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-30T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -400,
                  "id": "ec7d7c5a-1c65-4544-bffb-0a1bff52539c",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "DEX Property Manag",
                  "timestamp": "2025-09-30T00:00:00Z",
                  "description": "BP DEX Property Manag 35 Sutherland RM 1",
                  "amount": -15,
                  "rolling_account_balance": 1057.86,
                  "id": "f55d11b5-39d7-4d6e-a3c2-2bc4d46c7b0a",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart",
                  "timestamp": "2025-09-30T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -400,
                  "id": "67dd0e12-7a71-433f-8a48-955fb47fa4e3",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "PROSPECT UNION",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "DD PROSPECT UNION",
                  "amount": -13.33,
                  "id": "dfb58b00-2eff-4215-912a-f0c78c8dcef0",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "NEST",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "DD NEST",
                  "amount": -60,
                  "id": "f0483bc5-8e4b-45b1-b8f9-b19bce9d4ee9",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "STEWART S *HSM SAVE",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "SO STEWART S *HSM SAVE",
                  "amount": -150,
                  "id": "6b7ff810-98ee-43b4-a0ef-29671e188261",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R CAR",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "SO Arch-Mo J R CAR",
                  "amount": -70,
                  "id": "23a7e4ba-ac19-42a1-ba6b-98118a8397a1",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arc-McDo B VODAFONE",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "SO Arc-McDo B VODAFONE",
                  "amount": -15,
                  "id": "5c210def-7546-4858-a309-ec6a8792360d",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "DEX PROPERTY 35 SUTHERLAND RM 1",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "SO DEX PROPERTY 35 SUTHERLAND RM 1",
                  "amount": -480,
                  "id": "ce0a64e4-6afd-407e-a5a8-b6668b4b5e30",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LEE CAJ Freckle tattoo",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "CR LEE CAJ Freckle tattoo",
                  "amount": 70,
                  "rolling_account_balance": 339.53,
                  "id": "4131d8fd-f7ee-4800-b68e-c27fb2705d23",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "PROSPECT UNION",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "DD PROSPECT UNION",
                  "amount": -13.33,
                  "id": "e5341f24-0a2e-4406-88a7-d16e529689b5",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "NEST",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "DD NEST",
                  "amount": -60,
                  "id": "5b8ff667-131b-4ba0-aed5-291980cb8e16",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "STEWART S *HSM SAVE",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "SO STEWART S *HSM SAVE",
                  "amount": -150,
                  "id": "e284bb67-a3ad-435a-a905-0d4bbca9d4f6",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R CAR",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "SO Arch-Mo J R CAR",
                  "amount": -70,
                  "id": "7448df4b-aa91-47ae-be7b-4b956d921a25",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arc-McDo B VODAFONE",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "SO Arc-McDo B VODAFONE",
                  "amount": -15,
                  "id": "1b03f2ef-0ed0-4cca-9c45-38aba887e891",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "DEX PROPERTY 35 SUTHERLAND RM 1",
                  "timestamp": "2025-10-01T00:00:00Z",
                  "description": "SO DEX PROPERTY 35 SUTHERLAND RM 1",
                  "amount": -480,
                  "id": "3759fb39-56a7-4d12-9a1a-bfe4edd5091b",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "SO",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "DEX Property Manag 35 Sutherland RM 1",
                  "timestamp": "2025-10-02T00:00:00Z",
                  "description": "BP DEX Property Manag 35 Sutherland RM 1",
                  "amount": -15,
                  "rolling_account_balance": 324.53,
                  "id": "f42e248f-2fda-4518-aaf7-6ed07c68212b",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-07T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "rolling_account_balance": 274.53,
                  "id": "59e39591-f2fc-4c00-b8d9-5389f8270196",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-08T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -50,
                  "rolling_account_balance": 224.53,
                  "id": "bebcc2a0-5d15-4387-99eb-bb2e3f6ccb98",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LEE CAJ FRECKLE TATTOO",
                  "timestamp": "2025-10-10T00:00:00Z",
                  "description": "CR LEE CAJ FRECKLE TATTOO",
                  "amount": 10,
                  "rolling_account_balance": 234.53,
                  "id": "a4b23fc4-a5ae-4d70-ab7e-c30133205a6e",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-13T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -60,
                  "rolling_account_balance": 174.53,
                  "id": "54dc95ca-9800-4ad3-a714-4c28f33f37af",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-14T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -70,
                  "rolling_account_balance": 104.53,
                  "id": "fd19c12b-0216-4b6d-a9f0-a0b665aac64c",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Katie Havanna Reen SPLITWISE-PAYMENT",
                  "timestamp": "2025-10-15T00:00:00Z",
                  "description": "OBP Katie Havanna Reen SPLITWISE-PAYMENT",
                  "amount": -20.33,
                  "rolling_account_balance": 84.2,
                  "id": "2b685efc-1760-4766-90c5-4d63aceada7e",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "OBP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-18T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -60,
                  "rolling_account_balance": 24.2,
                  "id": "95931a81-3882-4cb3-9ec5-0ab69cd24280",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "402055 40163414 INTERNET TRANSFER",
                  "timestamp": "2025-10-19T00:00:00Z",
                  "description": "TFR 402055 40163414 INTERNET TRANSFER",
                  "amount": 130,
                  "id": "eb750cf4-4c76-4d98-bd84-0b2ae818d74a",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "TFR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-19T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -130,
                  "id": "1c4fd3f0-5278-4a89-91fa-95d2542afeaa",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "402055 40163414 INTERNET TRANSFER",
                  "timestamp": "2025-10-19T00:00:00Z",
                  "description": "TFR 402055 40163414 INTERNET TRANSFER",
                  "amount": 20,
                  "id": "16a7f942-5ebc-4401-9a6d-867175a74ce4",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "TFR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-19T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -30,
                  "rolling_account_balance": 14.2,
                  "id": "4db514fe-e4e3-42c2-af0d-5d6bc2949101",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "402055 40163414 INTERNET TRANSFER",
                  "timestamp": "2025-10-19T00:00:00Z",
                  "description": "TFR 402055 40163414 INTERNET TRANSFER",
                  "amount": 130,
                  "id": "b2a8cced-3227-462b-9033-f3e8d2c9a83d",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "TFR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-19T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -130,
                  "id": "40139453-6f93-40d0-b3a3-eac2092734b0",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "402055 40163414 INTERNET TRANSFER",
                  "timestamp": "2025-10-19T00:00:00Z",
                  "description": "TFR 402055 40163414 INTERNET TRANSFER",
                  "amount": 20,
                  "id": "b05e63bd-685f-43b0-a7f7-7fa07104f222",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "TFR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "NHSBSA PPC 2",
                  "timestamp": "2025-10-20T00:00:00Z",
                  "description": "DD NHSBSA PPC 2",
                  "amount": -11.45,
                  "id": "c477abc3-feb0-4ccc-b174-51d508b1a90e",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "LEE CAJ Kailab bday",
                  "timestamp": "2025-10-20T00:00:00Z",
                  "description": "CR LEE CAJ Kailab bday",
                  "amount": 150,
                  "rolling_account_balance": 152.75,
                  "id": "80758dde-2044-49c9-ab33-1d7303c44d44",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "NHSBSA PPC 2",
                  "timestamp": "2025-10-20T00:00:00Z",
                  "description": "DD NHSBSA PPC 2",
                  "amount": -11.45,
                  "id": "60a43bf0-43b4-4cf4-9d47-e361d2ca9911",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "DD",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "JACOB ARCHER-MORAN work",
                  "timestamp": "2025-10-22T00:00:00Z",
                  "description": "CR JACOB ARCHER-MORAN work",
                  "amount": 150,
                  "id": "a1f1e471-6ba2-4743-9bfd-ff4403f80c1d",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-22T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -110,
                  "rolling_account_balance": 192.75,
                  "id": "fc2994d5-d240-4c2a-b008-dee999d416a8",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "JACOB ARCHER-MORAN work",
                  "timestamp": "2025-10-22T00:00:00Z",
                  "description": "CR JACOB ARCHER-MORAN work",
                  "amount": 150,
                  "id": "e3999d67-c175-4e01-a8d1-acd910ffe838",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "CR",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-24T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -180,
                  "rolling_account_balance": 12.75,
                  "id": "3c1fa2b5-57f1-4004-83a6-8d46fb2c4c87",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R Iou",
                  "timestamp": "2025-10-27T00:00:00Z",
                  "description": "B Arch-Mo J R Iou",
                  "amount": 100,
                  "id": "075db203-c337-4556-9bb8-cf8154302c15",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "B",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-27T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -100,
                  "rolling_account_balance": 12.75,
                  "id": "9d014384-7b11-46f8-8403-861fe1f85256",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R Iou",
                  "timestamp": "2025-10-27T00:00:00Z",
                  "description": "B Arch-Mo J R Iou",
                  "amount": 100,
                  "id": "17f858bc-f4e6-43e9-aabf-f04b866ed506",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "B",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Arch-Mo J R Iou",
                  "timestamp": "2025-10-28T00:00:00Z",
                  "description": "BP Arch-Mo J R Iou",
                  "amount": 110,
                  "id": "9e7184c1-0dc7-42eb-99d0-13d09ef43241",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-28T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -110,
                  "rolling_account_balance": 12.75,
                  "id": "57ad9380-ce62-44e3-a0e3-eeead29322f6",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                },
                {
                  "merchant_name": "Arch-Mo J R Iou",
                  "timestamp": "2025-10-28T00:00:00Z",
                  "description": "BP Arch-Mo J R Iou",
                  "amount": 110,
                  "id": "537b3bdc-3585-4073-9d14-cb3bd076c738",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "CREDIT"
                },
                {
                  "merchant_name": "Se Stewart Monzo-CLGNP",
                  "timestamp": "2025-10-30T00:00:00Z",
                  "description": "BP Se Stewart Monzo-CLGNP",
                  "amount": -10,
                  "rolling_account_balance": 2.75,
                  "id": "9d21a764-3b6a-4241-bbb5-94346b6d9926",
                  "account_id": "40163406",
                  "currency": "GBP",
                  "category": "BP",
                  "classification": null,
                  "type": "DEBIT"
                }
              ]
            }
          },
          "documents": [
            {
              "id": "d472vf523amg030w7vr0",
              "type": "bank-statement"
            },
            {
              "id": "d472vfd23amg030w7vrg",
              "type": "bank-statement"
            },
            {
              "id": "d472vfn23amg030w7vs0",
              "type": "bank-statement"
            },
            {
              "id": "d472vfx23amg030w7vt0",
              "type": "bank-statement"
            },
            {
              "id": "d472vg623amg030w7vtg",
              "type": "bank-statement"
            },
            {
              "id": "d472vge23amg030w7vv0",
              "type": "bank-statement"
            }
          ],
          "analysis": {
            "id": "4151814620",
            "repeating_transactions": [
              {
                "sort_score": 2575.24,
                "items": [
                  "07bc1b6b-0abd-4d79-81fa-7e20e1de4bdc",
                  "2d466586-2717-4bd0-bc2e-d2bf20993242",
                  "d8ce6a43-3cc1-4549-8b49-49f05ee6ce97"
                ]
              },
              {
                "sort_score": 480,
                "items": [
                  "091a1417-6f9d-4301-834a-893776f70189",
                  "3759fb39-56a7-4d12-9a1a-bfe4edd5091b",
                  "ce0a64e4-6afd-407e-a5a8-b6668b4b5e30",
                  "dac04f2b-9549-467e-a684-fcd7167741d0"
                ]
              },
              {
                "sort_score": 400,
                "items": [
                  "090ecd3a-c3c8-4b23-92b3-49e2ce9614b4",
                  "0dc3d8bc-f23f-440b-876c-e419abaa4178",
                  "1158f471-8ff2-4458-b0b6-21e6ab13f1c3",
                  "1c4fd3f0-5278-4a89-91fa-95d2542afeaa",
                  "1fe221de-f3ba-48fe-9564-84cf0f2b95d2",
                  "333bdd32-7bf2-4802-83f8-2d568d6ddca2",
                  "3633bed0-2cfc-4db5-b1c7-d0757f514364",
                  "3c1fa2b5-57f1-4004-83a6-8d46fb2c4c87",
                  "40139453-6f93-40d0-b3a3-eac2092734b0",
                  "4db514fe-e4e3-42c2-af0d-5d6bc2949101",
                  "50daa6c9-82d6-4dc8-81a3-f68d0b81cc44",
                  "54dc95ca-9800-4ad3-a714-4c28f33f37af",
                  "550bc2cf-0cd6-416b-8a2a-7a72f876fb91",
                  "57ad9380-ce62-44e3-a0e3-eeead29322f6",
                  "59e39591-f2fc-4c00-b8d9-5389f8270196",
                  "5d22cd18-a8e5-4c3d-ae5e-a7521cf60955",
                  "5d27588c-4266-41be-8eb6-683123082255",
                  "67dd0e12-7a71-433f-8a48-955fb47fa4e3",
                  "6ac5bfa3-c855-45e4-8ef1-6bede326feb9",
                  "71f05de8-1388-4207-ae5f-2ca8c68fcc3b",
                  "74137577-187f-4463-9783-7c877fcce6d1",
                  "7f7a993f-4b9c-4d91-9524-0e2d401d10ac",
                  "82f70dd8-ed5c-467a-bf5f-ebdb199f68ca",
                  "855a91b7-8f5c-4866-9bd7-fdc72b4af346",
                  "8814461c-b7b1-4da5-be9a-ae93066ad667",
                  "88be2410-9882-452c-bb63-cfdeefd1f7a2",
                  "8fd28ae6-dc19-4e4b-b892-599bc8cfa5cf",
                  "94c1ca78-ebbc-43fd-b325-60cae3035a8d",
                  "95931a81-3882-4cb3-9ec5-0ab69cd24280",
                  "9d014384-7b11-46f8-8403-861fe1f85256",
                  "9d21a764-3b6a-4241-bbb5-94346b6d9926",
                  "a156a3a3-fcf1-4c61-98ac-d0171fc784ac",
                  "b1811952-4e81-4980-af93-c722de4756fa",
                  "b6a6c8cb-d72d-4207-880e-3504367e04fa",
                  "bebcc2a0-5d15-4387-99eb-bb2e3f6ccb98",
                  "c78819f5-6e44-47c8-bd77-1575216314ea",
                  "ca7caec7-f74f-4273-8cc1-a9a2a25fa912",
                  "ce9f6978-3b3c-4551-8367-0c93dbd1cc89",
                  "d1945c03-afa3-4877-8ba9-4a07398240b2",
                  "d25d875c-1c2e-4ce3-b118-031cdc2d0393",
                  "eba9dd8c-dd8f-4775-af86-cf104abfb659",
                  "ec7d7c5a-1c65-4544-bffb-0a1bff52539c",
                  "fb9432da-6d31-45bb-94ce-ba83e1337c39",
                  "fc2994d5-d240-4c2a-b008-dee999d416a8",
                  "fd19c12b-0216-4b6d-a9f0-a0b665aac64c"
                ]
              },
              {
                "sort_score": 300,
                "items": [
                  "0e16d88a-c79c-44d6-8fcb-c1bb6952724f",
                  "10963733-05e5-405a-94c5-d7580b390d63",
                  "27d47a64-4632-4973-8838-7b8b5ab85839",
                  "467dcee0-769f-4f84-b710-fae215dbca63",
                  "48b02a93-b68d-4384-9800-7053bc9a48d9",
                  "4f98cc79-7d3b-4201-968f-dba556783460",
                  "73171bb4-af3c-46d0-ab1e-f207b2d118e4",
                  "79865522-6217-4bff-a470-723d0bee6d73",
                  "7faa0e99-67c6-4d34-861d-3bcbddadeb10",
                  "9099c841-dec8-4bec-8290-16d2f274bcf3",
                  "942cadee-2578-4cb9-98e3-bc684d9fd184",
                  "af6a348e-f528-4a58-af07-02fb91e9c9b1",
                  "c5c8cc39-44dd-4467-ba8b-d115ee536ebd",
                  "d98c90f8-49e8-4973-8884-d0f9d0cdddf2",
                  "ddb0edbd-2d9a-4eb9-8c48-6f9b5646107d",
                  "ff7861ec-d2ff-49bc-ad98-17c256abdddf"
                ]
              },
              {
                "sort_score": 245,
                "items": [
                  "150be101-6bb1-4b6c-909a-c8e9c533708c",
                  "910911cd-2761-4e9c-b00f-e8bcfc05e260"
                ]
              },
              {
                "sort_score": 200,
                "items": [
                  "0132d86a-54ef-495f-b58a-3a87e865006f",
                  "16a7f942-5ebc-4401-9a6d-867175a74ce4",
                  "b05e63bd-685f-43b0-a7f7-7fa07104f222",
                  "b2229847-7132-4733-a342-ba24b776fe16",
                  "b2a8cced-3227-462b-9033-f3e8d2c9a83d",
                  "bedb8a6c-956e-435d-b17f-51683b54e795",
                  "eb750cf4-4c76-4d98-bd84-0b2ae818d74a",
                  "eb8ede2b-24ec-4da9-84ce-989f5a42af1f",
                  "fcaba9eb-490f-45e0-8dc3-c6dbec615496"
                ]
              },
              {
                "sort_score": 150,
                "items": [
                  "3acdac30-7262-4fd6-9e64-210b9ed9da7b",
                  "6b7ff810-98ee-43b4-a0ef-29671e188261",
                  "93cd5860-cb98-4be2-be2d-87dddf569c35",
                  "db2b6b98-fb73-4827-aafe-e9fff5a83136",
                  "e284bb67-a3ad-435a-a905-0d4bbca9d4f6"
                ]
              },
              {
                "sort_score": 150,
                "items": [
                  "a1f1e471-6ba2-4743-9bfd-ff4403f80c1d",
                  "e3999d67-c175-4e01-a8d1-acd910ffe838"
                ]
              },
              {
                "sort_score": 110,
                "items": [
                  "309569df-91e5-4c73-a940-13e4843d534e",
                  "537b3bdc-3585-4073-9d14-cb3bd076c738",
                  "9e7184c1-0dc7-42eb-99d0-13d09ef43241",
                  "a45ac5a4-c462-45a0-b71e-db4d284c9110"
                ]
              },
              {
                "sort_score": 110,
                "items": [
                  "3e5fdb0d-1823-4d6e-b451-f677efb5440f",
                  "99d70e7d-a03e-429d-9d54-f025681505e2",
                  "d5e8c0c1-b6b2-47a8-9711-cfaf68b926e2",
                  "f4e64bf2-7561-4698-8a40-5c4c16561379"
                ]
              },
              {
                "sort_score": 100,
                "items": [
                  "075db203-c337-4556-9bb8-cf8154302c15",
                  "17f858bc-f4e6-43e9-aabf-f04b866ed506"
                ]
              },
              {
                "sort_score": 70,
                "items": [
                  "23a7e4ba-ac19-42a1-ba6b-98118a8397a1",
                  "5b0b4661-13bb-42c8-b0af-f6771995eba2",
                  "7448df4b-aa91-47ae-be7b-4b956d921a25",
                  "a6effef9-3137-4b3e-8fd5-a97d5c064e00",
                  "cadb0d06-2792-40e1-b321-cc7969bfab91"
                ]
              },
              {
                "sort_score": 70,
                "items": [
                  "4131d8fd-f7ee-4800-b68e-c27fb2705d23",
                  "a4b23fc4-a5ae-4d70-ab7e-c30133205a6e"
                ]
              },
              {
                "sort_score": 60,
                "items": [
                  "12404151-42fc-42cf-a102-d698dc9b1ab2",
                  "444c1dbe-116b-4aab-839b-189cdb412e6e",
                  "478ec493-655c-48b8-933b-577bb620fa42",
                  "5b8ff667-131b-4ba0-aed5-291980cb8e16",
                  "f0483bc5-8e4b-45b1-b8f9-b19bce9d4ee9"
                ]
              },
              {
                "sort_score": 20.33,
                "items": [
                  "2b685efc-1760-4766-90c5-4d63aceada7e",
                  "3f15166a-574a-4f3a-8747-961e2c79d88b",
                  "a99af3fb-a2e9-4600-8130-1378110476b3",
                  "e1f3f7b8-5b53-4dbd-9ce0-89fcd8e65fbb"
                ]
              },
              {
                "sort_score": 15,
                "items": [
                  "0a92489f-47a6-4384-a38e-da9057fc95db",
                  "12d8601d-9b0d-4aaa-be25-a2a2c07634d9",
                  "1b03f2ef-0ed0-4cca-9c45-38aba887e891",
                  "37a8b581-5045-4d3c-95df-a0c1444e9692",
                  "5c210def-7546-4858-a309-ec6a8792360d"
                ]
              },
              {
                "sort_score": 15,
                "items": [
                  "f42e248f-2fda-4518-aaf7-6ed07c68212b",
                  "f55d11b5-39d7-4d6e-a3c2-2bc4d46c7b0a"
                ]
              },
              {
                "sort_score": 13.33,
                "items": [
                  "37d6717f-7204-43ec-84bb-b276d2755ef7",
                  "5cc88288-d369-4ebd-88c9-9a2cd75a69d5",
                  "78ed938c-c5f4-4737-93df-bf0b8e085d8e",
                  "dfb58b00-2eff-4215-912a-f0c78c8dcef0",
                  "e5341f24-0a2e-4406-88a7-d16e529689b5"
                ]
              },
              {
                "sort_score": 11.45,
                "items": [
                  "21646963-a1b1-4935-8e8c-134622bc482f",
                  "60a43bf0-43b4-4cf4-9d47-e361d2ca9911",
                  "c477abc3-feb0-4ccc-b174-51d508b1a90e",
                  "db0e1cec-5c5c-41e7-b61a-95b3cda1a98a",
                  "ff155fa3-7558-4d9d-96b6-5a941ca7dabb"
                ]
              }
            ],
            "large_one_off_transactions": [
              "89137c17-da6f-414b-b221-496551762f06",
              "2ffd97ed-ce60-4fe4-bb86-53ce568a7a02",
              "dc55407c-f7e7-4026-b815-53b69d1d1e85",
              "fdc1f9f6-319a-4027-bd94-2c74afdbc070",
              "03c57712-eab4-4574-b022-607336d5b059",
              "39dd0f39-1cd7-4da0-92b7-dd4ef640b8d1",
              "f82f3579-3024-44f6-a2f8-af19162b97ee",
              "fe049d6e-cc8d-42b2-8e02-9fad81aef643",
              "5e7a8546-cca8-46e5-8add-40a412b52ec6",
              "18c9a740-dc6c-4eb9-8a5b-fdffd7a3564c",
              "45c7dc04-1865-460f-a857-cfad071e6831",
              "80758dde-2044-49c9-ab33-1d7303c44d44",
              "ab5d57cd-b9cf-4475-99bd-88c08704adc3",
              "fe2584da-a62a-4ba6-b342-23fbc6b0f97f",
              "1444e1f2-3fac-4c78-a8a1-4e0dd3407bc8"
            ],
            "sof_matches": {
              "salary_transactions": [
                "07bc1b6b-0abd-4d79-81fa-7e20e1de4bdc",
                "2d466586-2717-4bd0-bc2e-d2bf20993242",
                "d8ce6a43-3cc1-4549-8b49-49f05ee6ce97"
              ]
            }
          }
        },
        "data": {},
        "result": "clear",
        "documents": [
          "d472vf523amg030w7vr0",
          "d472vfd23amg030w7vrg",
          "d472vfn23amg030w7vs0",
          "d472vfx23amg030w7vt0",
          "d472vg623amg030w7vtg",
          "d472vge23amg030w7vv0"
        ],
        "id": "d472wpj23amg030w7xag",
        "status": "closed",
        "createdAt": "2025-11-07T17:37:29.988Z"
      },
      "bank:summary": {
        "breakdown": {},
        "data": {},
        "result": "unknown",
        "documents": [],
        "id": "d472q1c23amg030w7vng",
        "status": "rejected",
        "createdAt": "2025-11-07T17:25:25.193Z"
      },
      "bank:statement": {
        "breakdown": {},
        "data": {},
        "result": "unknown",
        "documents": [],
        "id": "d472q1423amg030w7vmg",
        "status": "rejected",
        "createdAt": "2025-11-07T17:25:24.971Z"
      },
      "address": {
        "result": "fail",
        "status": "closed",
        "data": {
          "quality": 0
        }
      },
      "documents:sale-assets": {
        "breakdown": {
          "documents": [
            {
              "id": "d472wf923amg030w7wxg",
              "type": "sale-assets"
            }
          ]
        },
        "data": {},
        "result": "clear",
        "documents": [
          "d472wf923amg030w7wxg"
        ],
        "id": "d472wpa23amg030w7x5g",
        "status": "closed",
        "createdAt": "2025-11-07T17:37:29.352Z"
      },
      "biometrics": {
        "result": "consider",
        "status": "unobtainable",
        "data": {}
      },
      "identity": {
        "breakdown": {
          "biometrics": {
            "result": "consider",
            "status": "unobtainable"
          },
          "document": {
            "name": "document",
            "breakdown": {
              "compromised_document": {
                "result": "clear"
              },
              "data_consistency": {
                "breakdown": {
                  "first_name": {
                    "properties": {},
                    "result": "clear"
                  },
                  "date_of_expiry": {
                    "properties": {},
                    "result": "clear"
                  },
                  "date_of_birth": {
                    "properties": {},
                    "result": "clear"
                  },
                  "last_name": {
                    "properties": {},
                    "result": "clear"
                  },
                  "nationality": {
                    "properties": {},
                    "result": "clear"
                  },
                  "issuing_country": {
                    "properties": {},
                    "result": "clear"
                  },
                  "document_numbers": {
                    "properties": {},
                    "result": "clear"
                  },
                  "document_type": {
                    "properties": {},
                    "result": "clear"
                  },
                  "gender": {
                    "properties": {},
                    "result": "consider"
                  }
                },
                "result": "consider"
              },
              "data_comparison": {
                "breakdown": {
                  "first_name": {
                    "properties": {},
                    "result": "clear"
                  },
                  "date_of_expiry": {
                    "properties": {},
                    "result": "clear"
                  },
                  "date_of_birth": {
                    "properties": {},
                    "result": "clear"
                  },
                  "last_name": {
                    "properties": {},
                    "result": "clear"
                  },
                  "issuing_country": {
                    "properties": {},
                    "result": "clear"
                  },
                  "document_numbers": {
                    "properties": {},
                    "result": "clear"
                  },
                  "document_type": {
                    "properties": {},
                    "result": "clear"
                  },
                  "gender": {
                    "properties": {},
                    "result": "clear"
                  }
                },
                "result": "clear"
              },
              "data_validation": {
                "breakdown": {
                  "mrz": {
                    "properties": {},
                    "result": "clear"
                  },
                  "date_of_birth": {
                    "properties": {},
                    "result": "clear"
                  },
                  "document_numbers": {
                    "properties": {},
                    "result": "clear"
                  },
                  "expiry_date": {
                    "properties": {},
                    "result": "clear"
                  },
                  "document_expiration": {
                    "properties": {},
                    "result": "clear"
                  },
                  "gender": {
                    "properties": {},
                    "result": "clear"
                  }
                },
                "result": "clear"
              },
              "image_integrity": {
                "breakdown": {
                  "colour_picture": {
                    "properties": {},
                    "result": "clear"
                  },
                  "conclusive_document_quality": {
                    "properties": {},
                    "result": "clear"
                  },
                  "image_quality": {
                    "properties": {},
                    "result": "clear"
                  },
                  "supported_document": {
                    "properties": {},
                    "result": "clear"
                  }
                },
                "result": "clear"
              },
              "visual_authenticity": {
                "breakdown": {
                  "face_detection": {
                    "properties": {},
                    "result": "clear"
                  },
                  "fonts": {
                    "properties": {},
                    "result": "clear"
                  },
                  "picture_face_integrity": {
                    "properties": {},
                    "result": "clear"
                  },
                  "original_document_present": {
                    "properties": {},
                    "result": "clear"
                  },
                  "security_features": {
                    "properties": {},
                    "result": "clear"
                  },
                  "digital_tampering": {
                    "properties": {},
                    "result": "clear"
                  },
                  "template": {
                    "properties": {},
                    "result": "clear"
                  },
                  "other": {
                    "properties": {},
                    "result": "clear"
                  }
                },
                "result": "clear"
              },
              "age_validation": {
                "breakdown": {
                  "minimum_accepted_age": {
                    "properties": {},
                    "result": "clear"
                  }
                },
                "result": "clear"
              },
              "police_record": {
                "result": "clear"
              }
            },
            "result": "clear",
            "documents": [
              {
                "id": "fe4a1818-cdee-4352-bf68-f6984737cfc6"
              },
              {
                "id": "763caf59-603c-4805-89d2-606db4b2b060"
              }
            ],
            "id": "dd84fb2a-22ee-4198-9bb4-cc31181a29dc",
            "properties": {
              "first_name": "S&#xE9;",
              "date_of_expiry": "2031-05-28",
              "issuing_date": "2018-08-16",
              "date_of_birth": "1990-01-01",
              "last_name": "Stewart",
              "issuing_country": "GBR",
              "document_numbers": [
                {
                  "type": "document_number",
                  "value": "999999999"
                }
              ],
              "document_type": "passport"
            },
            "status": "complete",
            "created_at": "2025-11-07T17:38:19Z",
            "href": "/v3.6/reports/dd84fb2a-22ee-4198-9bb4-cc31181a29dc",
            "sub_result": "clear"
          },
          "nfc": {
            "result": "consider",
            "status": "unobtainable"
          },
          "facial_similarity_video": {
            "name": "facial_similarity_video",
            "breakdown": {
              "face_comparison": {
                "breakdown": {
                  "face_match": {
                    "properties": {
                      "document_id": "763caf59-603c-4805-89d2-606db4b2b060",
                      "live_video_id": "20b40a92-2295-403e-af81-dcfb25f3a976",
                      "score": 0.6512
                    },
                    "result": "clear"
                  }
                },
                "result": "clear"
              },
              "image_integrity": {
                "breakdown": {
                  "face_detected": {
                    "properties": {},
                    "result": "clear"
                  },
                  "source_integrity": {
                    "properties": {},
                    "result": "clear"
                  }
                },
                "result": "clear"
              },
              "visual_authenticity": {
                "breakdown": {
                  "liveness_detected": {
                    "properties": {},
                    "result": "clear"
                  },
                  "spoofing_detection": {
                    "properties": {
                      "score": 0.9512
                    },
                    "result": "clear"
                  }
                },
                "result": "clear"
              }
            },
            "result": "clear",
            "documents": [
              {
                "id": "fe4a1818-cdee-4352-bf68-f6984737cfc6"
              },
              {
                "id": "763caf59-603c-4805-89d2-606db4b2b060"
              }
            ],
            "id": "2cd98de4-3996-48df-803c-da26b3efbd58",
            "properties": {},
            "status": "complete",
            "created_at": "2025-11-07T17:38:26Z",
            "href": "/v3.6/reports/2cd98de4-3996-48df-803c-da26b3efbd58"
          }
        },
        "data": {
          "dob": "2000-01-05T00:00:00.000Z",
          "name": {
            "first": "S&#xE9;",
            "last": "Stewart",
            "other": "Idris"
          }
        },
        "result": "consider",
        "documents": [
          "d472x5w23amg030w7xtg"
        ],
        "id": "d472x5c23amg030w7xn0",
        "status": "closed",
        "createdAt": "2025-11-07T17:38:29.711Z"
      },
      "documents:selfie": {
        "breakdown": {
          "documents": [
            {
              "id": "d472x5m23amg030w7xq0",
              "type": "selfie"
            }
          ]
        },
        "data": {},
        "result": "unknown",
        "documents": [
          "d472x5m23amg030w7xq0"
        ],
        "id": "d472x5m23amg030w7xp0",
        "status": "complete",
        "createdAt": "2025-11-07T17:38:30.434Z"
      },
      "footprint": {
        "breakdown": {
          "data_count": {
            "properties": {
              "score": 0
            },
            "result": "consider"
          },
          "data_quality": {
            "properties": {
              "score": 0
            },
            "result": "consider"
          },
          "service_name": "Authenticateplus",
          "documents": [
            {
              "id": "d472x2423amg030w7xf0",
              "type": "poa"
            }
          ],
          "rules": [
            {
              "id": "U000",
              "name": "",
              "score": 0,
              "text": "No trace of supplied Address(es), or manual Authentication required by the Applicant"
            }
          ]
        },
        "data": {
          "dob": "2000-01-05T00:00:00.000Z",
          "name": {
            "first": "S&#xE9;",
            "last": "Stewart",
            "other": "Idris"
          },
          "address": {
            "postcode": "TR15 2ND",
            "country": "GBR",
            "street": "Southgate Street",
            "building_number": "94",
            "town": "Redruth"
          }
        },
        "result": "fail",
        "documents": [
          "d472x2423amg030w7xf0"
        ],
        "id": "d472x2c23amg030w7xgg",
        "status": "closed",
        "createdAt": "2025-11-07T17:38:17.650Z"
      }
    },
    "consumerPhone": "+447493580033",
    "pdfReady": true,
    "checkType": "electronic-id",
    "initiatedAt": "2025-11-06T16:37:23.440Z",
    "considerReasons": [
      "address verification",
      "digital footprint",
      "document integrity"
    ],
    "pdfS3Key": "protected/zaRRkhW",
    "consumerName": "Se Idris Stewart",
    "tasks": [
      "report:identity",
      "report:footprint",
      "report:peps",
      "documents:poa",
      "report:sof-v1",
      "report:bank-statement",
      "report:bank-summary"
    ],
    "updates": [
      {
        "timestamp": "2025-11-06T16:37:23.440Z",
        "update": "Electronic ID check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
      },
      {
        "timestamp": "2025-11-07T17:38:39.262Z",
        "update": "PEPs & Sanctions task completed"
      },
      {
        "timestamp": "2025-11-07T17:39:25.999Z",
        "update": "PDF received and uploaded to S3 - CONSIDER: address verification, digital footprint, document integrity"
      }
    ],
    "status": "closed",
    "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
    "piiData": {
      "name": {
        "first": "S&#xE9;",
        "last": "Stewart",
        "other": "Idris"
      },
      "address": {
        "postcode": "TR15 2ND",
        "country": "GBR",
        "street": "Southgate Street",
        "building_number": "94",
        "town": "Redruth"
      },
      "dob": "2000-01-05T00:00:00.000Z",
      "document": {
        "number": "999999999"
      }
    },
    "hasMonitoring": true,
    "thirdfortResponse": {
      "name": "Purchase of 21 Green Lane",
      "request": {
        "actor": {
          "name": "Se Idris Stewart",
          "phone": "+447493580033"
        },
        "tasks": [
          {
            "opts": {
              "nfc": "preferred"
            },
            "type": "report:identity"
          },
          {
            "opts": {
              "consent": false
            },
            "type": "report:footprint"
          },
          {
            "opts": {
              "monitored": true
            },
            "type": "report:peps"
          },
          {
            "type": "documents:poa"
          },
          {
            "type": "report:sof-v1"
          },
          {
            "type": "report:bank-statement"
          },
          {
            "type": "report:bank-summary"
          }
        ]
      },
      "ref": "21 Green Lane",
      "id": "d46cxge23amg030rw7r0",
      "reports": [],
      "status": "open",
      "metadata": {
        "notify": {
          "type": "http",
          "data": {
            "hmac_key": "0mF1p3cyDWZ51HIsGXPecer4a7uFQIXBk0JLO56Wr0U=",
            "method": "POST",
            "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
          }
        },
        "created_by": "d3t0auq9io6g00ak3kkg",
        "print": {
          "team": "Cashiers",
          "tenant": "Thurstan Hoskin Solicitors LLP",
          "user": "THS Bot"
        },
        "context": {
          "gid": "d3t2k5a9io6g00ak3km0",
          "uid": "d3t0auq9io6g00ak3kkg",
          "team_id": "d3t2k5a9io6g00ak3km0",
          "tenant_id": "d3t2ifa9io6g00ak3klg"
        },
        "ce": {
          "uri": "/v1/checks/4151797877"
        },
        "created_at": "2025-11-06T16:37:19.858Z"
      },
      "type": "v2",
      "opts": {
        "peps": {
          "monitored": true
        }
      }
    },
    "hasAlerts": true,
    "redFlags": [
      {
        "description": "Gifts Received",
        "supporting_data": "1 gift received - &#xA3;5,000",
        "threshold_amount": "Any gifts flagged",
        "source": "Source of Funds"
      },
      {
        "description": "Declared savings > actual savings",
        "declared": "&#xA3;5,000",
        "actual": "&#xA3;2.75",
        "source": "Bank Linking"
      }
    ],
    "pdfAddedAt": "2025-11-07T17:39:25.998Z",
    "smsSent": true,
    "transactionId": "d46cxge23amg030rw7r0"
            },
            // Mock Check 5: Jacob Robert Archer-Moran - Electronic ID - Additional Only
            {
                "taskOutcomes": {
                  "sof:v1": {
                    "breakdown": {
                      "property": {
                        "address": {
                          "postcode": "TR11 5TL",
                          "country": "GBR",
                          "street": "Poplar Terrace",
                          "building_number": "1",
                          "town": "Falmouth"
                        },
                        "new_build": false,
                        "price": 45000000,
                        "stamp_duty": 500000
                      },
                      "funds": [
                        {
                          "data": {
                            "amount": 35000000,
                            "lender": "natwest",
                            "location": "GBR"
                          },
                          "metadata": {
                            "created_at": 1762452156261
                          },
                          "type": "fund:mortgage"
                        },
                        {
                          "data": {
                            "amount": 2000000,
                            "location": "GBR",
                            "people": [
                              {
                                "actor": true,
                                "name": "Jacob Robert Archer-Moran",
                                "incomes": [
                                  {
                                    "reference": "varies",
                                    "source": "salary",
                                    "description": "",
                                    "annual_total": 3000000,
                                    "frequency": "other"
                                  }
                                ],
                                "employment_status": "independent",
                                "phone": "+447506430094"
                              },
                              {
                                "actor": false,
                                "name": "Se Stewart",
                                "incomes": [
                                  {
                                    "reference": "ladywell",
                                    "source": "salary",
                                    "description": "",
                                    "annual_total": 3000000,
                                    "frequency": "monthly"
                                  }
                                ],
                                "employment_status": "employed",
                                "phone": "+447493580033"
                              }
                            ]
                          },
                          "metadata": {
                            "created_at": 1762452156419
                          },
                          "type": "fund:savings"
                        },
                        {
                          "data": {
                            "amount": 1000000,
                            "giftor": {
                              "contactable": true,
                              "name": "Barbara Archer",
                              "phone": "+447581408576",
                              "relationship": "Mother"
                            },
                            "location": "GBR",
                            "repayable": false
                          },
                          "metadata": {
                            "created_at": 1762452156581
                          },
                          "type": "fund:gift"
                        },
                        {
                          "data": {
                            "location": "GBR",
                            "amount": 5000000,
                            "date": "2025-11-03T00:00:00.000Z",
                            "status": "complete",
                            "lawyer": "Thurstan hoskin"
                          },
                          "metadata": {
                            "created_at": 1762452156739
                          },
                          "type": "fund:sale:property"
                        },
                        {
                          "data": {
                            "amount": 500000,
                            "description": "Van",
                            "location": "GBR"
                          },
                          "metadata": {
                            "created_at": 1762452156900
                          },
                          "type": "fund:sale:assets"
                        },
                        {
                          "data": {
                            "amount": 1000000,
                            "location": "GBR",
                            "type": "lisa"
                          },
                          "metadata": {
                            "created_at": 1762452157074
                          },
                          "type": "fund:htb"
                        },
                        {
                          "data": {
                            "location": "GBR",
                            "is_owner": true,
                            "amount": 1000000,
                            "date": "2025-08-12T00:00:00.000Z",
                            "from": "Mary archer"
                          },
                          "metadata": {
                            "created_at": 1762452157228
                          },
                          "type": "fund:inheritance"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [],
                    "id": "d46e6fs23amg030rw98g",
                    "status": "closed",
                    "createdAt": "2025-11-06T18:04:47.285Z"
                  },
                  "documents:savings": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d46e76c23amg030rw9f0",
                          "type": "savings"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d46e76c23amg030rw9f0"
                    ],
                    "id": "d46e77423amg030rw9tg",
                    "status": "closed",
                    "createdAt": "2025-11-06T18:06:20.615Z"
                  },
                  "documents:mortgage": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d46e6wb23amg030rw9e0",
                          "type": "mortgage"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d46e6wb23amg030rw9e0"
                    ],
                    "id": "d46e77423amg030rw9mg",
                    "status": "closed",
                    "createdAt": "2025-11-06T18:06:20.074Z"
                  },
                  "documents:poa": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d46e3v723amg030rw8z0",
                          "type": "poa"
                        },
                        {
                          "id": "d46e3vf23amg030rw8zg",
                          "type": "poa"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d46e3v723amg030rw8z0",
                      "d46e3vf23amg030rw8zg"
                    ],
                    "id": "d46e6fh23amg030rw910",
                    "status": "closed",
                    "createdAt": "2025-11-06T18:04:46.035Z"
                  },
                  "bank:summary": {
                    "breakdown": {
                      "summary": {
                        "by_ccy": {
                          "EUR": {
                            "top_in": [
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-06T15:28:41.212Z",
                                "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                                "amount": 3613.9,
                                "id": "5c649b28a5641841b68b2bab28d23d05",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "JACOB ARCHER-MORANGWN25",
                                "amount": 2400,
                                "id": "ee587010c1a76619f7888e7448df3dac",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-07-09T10:07:54.167Z",
                                "description": "SWIFTELEX LIMITED SwiftElex Limited",
                                "amount": 2355,
                                "id": "04c554385e5106117f24163d80f2a849",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-02T00:00:00Z",
                                "description": "JACOB ARCHER-MORANGWD25",
                                "amount": 2300,
                                "id": "d5fdf791a4294d42275adabc74e82413",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-01T15:45:28.701Z",
                                "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                                "amount": 2281.4,
                                "id": "0da74102e67736d0d00b6ba34242ccf7",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-24T00:00:00Z",
                                "description": "THUR HOSK SO LLP W/E 24/10 SCREWFIX",
                                "amount": 2272.48,
                                "id": "9ff7a8f1b4bb4337e257c78ad2629d25",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-07-19T12:31:46.982Z",
                                "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                                "amount": 1260,
                                "id": "e3349fb77f4ca0852d5bd241627a8aad",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-01-20T10:25:12.536Z",
                                "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                                "amount": 965,
                                "id": "b62f6e06ed23090d50b4e650e60bb22f",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-05-30T07:58:04.461Z",
                                "description": "E&C EVENTS LTD BALTER 25",
                                "amount": 800,
                                "id": "e86445c66a21cf38609e252ea5d45add",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-06T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 6.9.25",
                                "amount": 800,
                                "id": "4eb4becb238395fa3a60bff26b2e4797",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 3.10.25",
                                "amount": 660,
                                "id": "65bea463c180e32c536ebf770ad4f6db",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-07T00:00:00Z",
                                "description": "Arc-McDo B Greece",
                                "amount": 500,
                                "id": "908b356faa560c1910ab62699105519e",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "Arc-McDo B holiday BGC",
                                "amount": 250,
                                "id": "6d74678683171682a62ffc97c03953d8",
                                "account_id": "91c6769dcb61767289208a454930c7b7",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-30T00:00:00Z",
                                "description": "STEWART S Holidayxx",
                                "amount": 245,
                                "id": "1abd212b42e55440112ca9b8e2b87d9f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-12T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 12.9.25",
                                "amount": 220,
                                "id": "2eb349e09df20e7e811525c18130a684",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-28T00:00:00Z",
                                "description": "STEWART S Holidayxx",
                                "amount": 200,
                                "id": "d1c97b4c29623482d6ff920ded9ffddc",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-27T19:27:13.285Z",
                                "description": "Arch-Mo J R work return iou",
                                "amount": 150,
                                "id": "d3cdcae5db4e4d841b712edacbea2e63",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-31T00:00:00Z",
                                "description": "STEWART S Holidayxx",
                                "amount": 150,
                                "id": "db76f59f7ac5395ab94ec1a7d5648ee2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "404434 21857479 INTERNET TRANSFER",
                                "amount": 130,
                                "id": "6260e8341669381eaa8163ab03e303e1",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-04-28T11:02:21.196Z",
                                "description": "Arch-Mo J R work",
                                "amount": 100,
                                "id": "de8f49e2fd5434dd6270b112c8022645",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              }
                            ],
                            "top_out": [
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T13:34:27.36Z",
                                "description": "Jacob Robert arche GWN25",
                                "amount": -2400,
                                "id": "573b7ae1980c153f29d339e0287e6380",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-02T13:10:35.762Z",
                                "description": "Jacob Robert arche GWD25",
                                "amount": -2300,
                                "id": "92c3449a9c1be6eee3b5ca3158f42142",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-07-09T18:52:09.029Z",
                                "description": "Jacob Robert arche Powderham Presents",
                                "amount": -2200,
                                "id": "09a91579d867b94d34dd00f5bfbce4a0",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-10-02T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -2034.26,
                                "id": "313deb3db30a087d274b7429bc9637b9",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -1500,
                                "id": "f64c8549d4927508cbee937952190e20",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-07-21T11:14:19.861Z",
                                "description": "Jacob Robert arche EGB",
                                "amount": -1200,
                                "id": "d0725de51ca36db9224996992bea9661",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T13:31:33.02Z",
                                "description": "BARBARA ARCHER owings x8",
                                "amount": -1200,
                                "id": "b7ccd74b1bc5f769843be499609633db",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-09-07T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -1065.68,
                                "id": "0ea56de940d75d4b26c76aeee4ba8ddc",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-02-03T10:54:24.847Z",
                                "description": "Jacob Robert arche Exeter Showbitz",
                                "amount": -1000,
                                "id": "ada94dca78b3d2e68d07a32135cad2d7",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -1000,
                                "id": "282a0116410532bb12df1fce68ff2ca2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-06-02T00:31:32.136Z",
                                "description": "Jacob Robert arche Balter",
                                "amount": -800,
                                "id": "311d09c0be0d33a8e36dd4951cd8d0a8",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "B ARCHER Rent & Owings x4",
                                "amount": -600,
                                "id": "c84f0526ba6a0e5fbfb96fb23e3ae47f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -550.67,
                                "id": "14b11a87620190e2b202574bdfb2d2e4",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "Buy BTW2509122529521 amount in EUR364.19 on 12 SEP reference exchange rate 1.155709 Final GBP amount inc. margin &#xA3;8.92",
                                "amount": -324.04,
                                "id": "a340d0e9eecc82a393a2c4cfd23d5688",
                                "account_id": "91c6769dcb61767289208a454930c7b7",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "B ARCHER Rent & Owings x2",
                                "amount": -300,
                                "id": "fc339ff805ae07fb3bc7355dce8f7050",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "B ARCHER Owings finl",
                                "amount": -200,
                                "id": "4f1d2724e46e78ebd57b6ba524790134",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-08-30T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -200,
                                "id": "7792426ac76f46c4c60e6aa0d15f15a2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-25T00:00:00Z",
                                "description": "Klarna Financial SYA777777777713C9YB",
                                "amount": -199.56,
                                "id": "2e6ee436a7394f2406fdebb7664f0dc1",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "HMRC GOV.UK SA GLASGOW",
                                "amount": -197.6,
                                "id": "85edd8e1479758f6319dbaddf1c7ea07",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -160.31,
                                "id": "3c8640af1c234df97be59a19b6af559b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              }
                            ]
                          },
                          "GBP": {
                            "top_in": [
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-06T15:28:41.212Z",
                                "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                                "amount": 3613.9,
                                "id": "5c649b28a5641841b68b2bab28d23d05",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "JACOB ARCHER-MORANGWN25",
                                "amount": 2400,
                                "id": "ee587010c1a76619f7888e7448df3dac",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-07-09T10:07:54.167Z",
                                "description": "SWIFTELEX LIMITED SwiftElex Limited",
                                "amount": 2355,
                                "id": "04c554385e5106117f24163d80f2a849",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-02T00:00:00Z",
                                "description": "JACOB ARCHER-MORANGWD25",
                                "amount": 2300,
                                "id": "d5fdf791a4294d42275adabc74e82413",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-01T15:45:28.701Z",
                                "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                                "amount": 2281.4,
                                "id": "0da74102e67736d0d00b6ba34242ccf7",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-24T00:00:00Z",
                                "description": "THUR HOSK SO LLP W/E 24/10 SCREWFIX",
                                "amount": 2272.48,
                                "id": "9ff7a8f1b4bb4337e257c78ad2629d25",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-07-19T12:31:46.982Z",
                                "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                                "amount": 1260,
                                "id": "e3349fb77f4ca0852d5bd241627a8aad",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-01-20T10:25:12.536Z",
                                "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                                "amount": 965,
                                "id": "b62f6e06ed23090d50b4e650e60bb22f",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-05-30T07:58:04.461Z",
                                "description": "E&C EVENTS LTD BALTER 25",
                                "amount": 800,
                                "id": "e86445c66a21cf38609e252ea5d45add",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-06T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 6.9.25",
                                "amount": 800,
                                "id": "4eb4becb238395fa3a60bff26b2e4797",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 3.10.25",
                                "amount": 660,
                                "id": "65bea463c180e32c536ebf770ad4f6db",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-07T00:00:00Z",
                                "description": "Arc-McDo B Greece",
                                "amount": 500,
                                "id": "908b356faa560c1910ab62699105519e",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "Arc-McDo B holiday BGC",
                                "amount": 250,
                                "id": "6d74678683171682a62ffc97c03953d8",
                                "account_id": "91c6769dcb61767289208a454930c7b7",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-08-30T00:00:00Z",
                                "description": "STEWART S Holidayxx",
                                "amount": 245,
                                "id": "1abd212b42e55440112ca9b8e2b87d9f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-12T00:00:00Z",
                                "description": "THUR HOSK SO LLP work w/e 12.9.25",
                                "amount": 220,
                                "id": "2eb349e09df20e7e811525c18130a684",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-28T00:00:00Z",
                                "description": "STEWART S Holidayxx",
                                "amount": 200,
                                "id": "d1c97b4c29623482d6ff920ded9ffddc",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-27T19:27:13.285Z",
                                "description": "Arch-Mo J R work return iou",
                                "amount": 150,
                                "id": "d3cdcae5db4e4d841b712edacbea2e63",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-31T00:00:00Z",
                                "description": "STEWART S Holidayxx",
                                "amount": 150,
                                "id": "db76f59f7ac5395ab94ec1a7d5648ee2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-01T00:00:00Z",
                                "description": "404434 21857479 INTERNET TRANSFER",
                                "amount": 130,
                                "id": "6260e8341669381eaa8163ab03e303e1",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-04-28T11:02:21.196Z",
                                "description": "Arch-Mo J R work",
                                "amount": 100,
                                "id": "de8f49e2fd5434dd6270b112c8022645",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "CREDIT",
                                "classification": null,
                                "type": "CREDIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              }
                            ],
                            "top_out": [
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T13:34:27.36Z",
                                "description": "Jacob Robert arche GWN25",
                                "amount": -2400,
                                "id": "573b7ae1980c153f29d339e0287e6380",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-02T13:10:35.762Z",
                                "description": "Jacob Robert arche GWD25",
                                "amount": -2300,
                                "id": "92c3449a9c1be6eee3b5ca3158f42142",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-07-09T18:52:09.029Z",
                                "description": "Jacob Robert arche Powderham Presents",
                                "amount": -2200,
                                "id": "09a91579d867b94d34dd00f5bfbce4a0",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-10-02T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -2034.26,
                                "id": "313deb3db30a087d274b7429bc9637b9",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -1500,
                                "id": "f64c8549d4927508cbee937952190e20",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-07-21T11:14:19.861Z",
                                "description": "Jacob Robert arche EGB",
                                "amount": -1200,
                                "id": "d0725de51ca36db9224996992bea9661",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T13:31:33.02Z",
                                "description": "BARBARA ARCHER owings x8",
                                "amount": -1200,
                                "id": "b7ccd74b1bc5f769843be499609633db",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-09-07T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -1065.68,
                                "id": "0ea56de940d75d4b26c76aeee4ba8ddc",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-02-03T10:54:24.847Z",
                                "description": "Jacob Robert arche Exeter Showbitz",
                                "amount": -1000,
                                "id": "ada94dca78b3d2e68d07a32135cad2d7",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -1000,
                                "id": "282a0116410532bb12df1fce68ff2ca2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-06-02T00:31:32.136Z",
                                "description": "Jacob Robert arche Balter",
                                "amount": -800,
                                "id": "311d09c0be0d33a8e36dd4951cd8d0a8",
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "B ARCHER Rent & Owings x4",
                                "amount": -600,
                                "id": "c84f0526ba6a0e5fbfb96fb23e3ae47f",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -550.67,
                                "id": "14b11a87620190e2b202574bdfb2d2e4",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-15T00:00:00Z",
                                "description": "Buy BTW2509122529521 amount in EUR364.19 on 12 SEP reference exchange rate 1.155709 Final GBP amount inc. margin &#xA3;8.92",
                                "amount": -324.04,
                                "id": "a340d0e9eecc82a393a2c4cfd23d5688",
                                "account_id": "91c6769dcb61767289208a454930c7b7",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "B ARCHER Rent & Owings x2",
                                "amount": -300,
                                "id": "fc339ff805ae07fb3bc7355dce8f7050",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-08T00:00:00Z",
                                "description": "B ARCHER Owings finl",
                                "amount": -200,
                                "id": "4f1d2724e46e78ebd57b6ba524790134",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-08-30T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -200,
                                "id": "7792426ac76f46c4c60e6aa0d15f15a2",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-09-25T00:00:00Z",
                                "description": "Klarna Financial SYA777777777713C9YB",
                                "amount": -199.56,
                                "id": "2e6ee436a7394f2406fdebb7664f0dc1",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "DEBIT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "",
                                "timestamp": "2025-10-03T00:00:00Z",
                                "description": "HMRC GOV.UK SA GLASGOW",
                                "amount": -197.6,
                                "id": "85edd8e1479758f6319dbaddf1c7ea07",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "PURCHASE",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              },
                              {
                                "merchant_name": "Tesco Bank",
                                "timestamp": "2025-10-27T00:00:00Z",
                                "description": "TESCO BANK 518652******0936",
                                "amount": -160.31,
                                "id": "3c8640af1c234df97be59a19b6af559b",
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "currency": "GBP",
                                "category": "BILL_PAYMENT",
                                "classification": null,
                                "type": "DEBIT",
                                "counterparty_name": "",
                                "counterparty_iban": ""
                              }
                            ]
                          }
                        }
                      },
                      "accounts": {
                        "6d7afbac29de4842775ee1763b86fc68": {
                          "number": {
                            "iban": "GB10BUKB20272673049558",
                            "number": "73049558",
                            "sort_code": "20-27-26",
                            "swift_bic": ""
                          },
                          "name": "EUR travel wallet",
                          "provider": {
                            "id": "ob-barclays",
                            "name": "BARCLAYS"
                          },
                          "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "balance": {
                            "available": 20.54,
                            "current": 20.54,
                            "overdraft": 0
                          },
                          "info": [
                            {
                              "full_name": "MR JACOB ROBERT ARCHER-MORAN",
                              "phones": null,
                              "date_of_birth": "",
                              "emails": null,
                              "update_timestamp": "2025-11-06T18:04:44.3093359Z",
                              "addresses": null
                            }
                          ],
                          "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "currency": "EUR",
                          "metadata": {
                            "created_at": 1762452286148,
                            "encryption": null,
                            "tl": {
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "debug_id": "",
                              "download_status": "complete",
                              "task_id": "2c986ba6-e546-459f-b1a3-a10c2fdcfe49"
                            },
                            "updated_at": 1762452285237
                          },
                          "type": "TRANSACTION"
                        },
                        "91c6769dcb61767289208a454930c7b7": {
                          "number": {
                            "iban": "GB10BUKB20272673049558",
                            "number": "73049558",
                            "sort_code": "20-27-26",
                            "swift_bic": ""
                          },
                          "name": "Barclays Bank Account",
                          "provider": {
                            "id": "ob-barclays",
                            "name": "BARCLAYS"
                          },
                          "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "balance": {
                            "available": 8.84,
                            "current": 8.84,
                            "overdraft": 0
                          },
                          "info": [
                            {
                              "full_name": "MR JACOB ROBERT ARCHER-MORAN",
                              "phones": null,
                              "date_of_birth": "",
                              "emails": null,
                              "update_timestamp": "2025-11-06T18:04:44.3093359Z",
                              "addresses": null
                            }
                          ],
                          "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "currency": "GBP",
                          "metadata": {
                            "created_at": 1762452286048,
                            "encryption": null,
                            "tl": {
                              "account_id": "91c6769dcb61767289208a454930c7b7",
                              "debug_id": "",
                              "download_status": "complete",
                              "task_id": "e3105542-2fcd-4e05-9cfd-63d829421185"
                            },
                            "updated_at": 1762452285237
                          },
                          "type": "TRANSACTION"
                        },
                        "4c82630f5b8bccce242ff3fbb4740b8d": {
                          "number": {
                            "iban": "GB63MIDL40443471857460",
                            "number": "71857460",
                            "sort_code": "40-44-34",
                            "swift_bic": ""
                          },
                          "name": "BANK A/C",
                          "provider": {
                            "id": "ob-hsbc",
                            "name": "HSBC"
                          },
                          "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "balance": {
                            "available": 5.83,
                            "current": 5.83,
                            "overdraft": 0
                          },
                          "info": [
                            {
                              "full_name": "Mr Jacob Robert Archer-Moran",
                              "phones": null,
                              "date_of_birth": "",
                              "emails": null,
                              "update_timestamp": "2025-11-06T18:03:12.7946689Z",
                              "addresses": null
                            }
                          ],
                          "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "currency": "GBP",
                          "metadata": {
                            "created_at": 1762452195837,
                            "encryption": null,
                            "tl": {
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "debug_id": "",
                              "download_status": "complete",
                              "task_id": "fa3e06c2-b9c5-4fcf-b015-a3fb91f5de2b"
                            },
                            "updated_at": 1762452194836
                          },
                          "type": "TRANSACTION"
                        },
                        "071fc97cd0cf36290a519783bb8f1114": {
                          "number": {
                            "iban": "GB13MIDL40443421857479",
                            "number": "21857479",
                            "sort_code": "40-44-34",
                            "swift_bic": ""
                          },
                          "name": "FLEX SAVER",
                          "provider": {
                            "id": "ob-hsbc",
                            "name": "HSBC"
                          },
                          "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "balance": {
                            "available": 50.3,
                            "current": 50.3,
                            "overdraft": 0
                          },
                          "info": [
                            {
                              "full_name": "Mr Jacob Robert Archer-Moran",
                              "phones": null,
                              "date_of_birth": "",
                              "emails": null,
                              "update_timestamp": "2025-11-06T18:03:12.7946689Z",
                              "addresses": null
                            }
                          ],
                          "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "currency": "GBP",
                          "metadata": {
                            "created_at": 1762452195941,
                            "encryption": null,
                            "tl": {
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "debug_id": "",
                              "download_status": "complete",
                              "task_id": "6e9ab6b3-75ec-4717-99f1-e89318a60451"
                            },
                            "updated_at": 1762452194836
                          },
                          "type": "SAVINGS"
                        },
                        "6f1032d40aa61c12cec47fe3295d6a22": {
                          "number": {
                            "iban": "GB30TSBS77856600948872",
                            "number": "00948872",
                            "sort_code": "77-85-66",
                            "swift_bic": ""
                          },
                          "name": "Spend & Save Account",
                          "provider": {
                            "id": "ob-tsb",
                            "name": "TSB"
                          },
                          "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "balance": {
                            "available": 168.2,
                            "current": 168.2,
                            "overdraft": 0
                          },
                          "info": [
                            {
                              "full_name": "JACOB ARCHER-MORAN",
                              "phones": null,
                              "date_of_birth": "",
                              "emails": null,
                              "update_timestamp": "2025-11-06T18:03:50.8306147Z",
                              "addresses": null
                            }
                          ],
                          "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                          "currency": "GBP",
                          "metadata": {
                            "created_at": 1762452231890,
                            "encryption": null,
                            "tl": {
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "debug_id": "",
                              "download_status": "complete",
                              "task_id": "1d27c4ca-4f32-42cb-b047-856c3c8af4f7"
                            },
                            "updated_at": 1762452231221
                          },
                          "type": "TRANSACTION"
                        }
                      }
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [],
                    "id": "d46e6gt23amg030rw9b0",
                    "status": "closed",
                    "createdAt": "2025-11-06T18:04:51.181Z"
                  },
                  "bank:statement": {
                    "breakdown": {
                      "accounts": {
                        "6d7afbac29de4842775ee1763b86fc68": {
                          "info": {
                            "number": {
                              "iban": "GB10BUKB20272673049558",
                              "number": "73049558",
                              "sort_code": "20-27-26",
                              "swift_bic": ""
                            },
                            "name": "EUR travel wallet",
                            "provider": {
                              "id": "ob-barclays",
                              "name": "BARCLAYS"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 20.54,
                              "current": 20.54,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "MR JACOB ROBERT ARCHER-MORAN",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-06T18:04:44.3093359Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "EUR",
                            "metadata": {
                              "created_at": 1762452286148,
                              "tl": {
                                "account_id": "6d7afbac29de4842775ee1763b86fc68",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "2c986ba6-e546-459f-b1a3-a10c2fdcfe49"
                              },
                              "updated_at": 1762452285237
                            },
                            "type": "TRANSACTION"
                          },
                          "statement": [
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-18T18:11:18Z",
                              "description": "LIXOURI ON 18/09/2025 CARD PURCHASE ATHENAS ESTIASI LIXOURI GR",
                              "amount": -33.5,
                              "id": "c1b8b38592ef0f234df4fca8de1ea202",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-17T13:07:51Z",
                              "description": "RATZAKLI ON 17/09/2025 CARD PURCHASE MARIA KEFALA RATZAKLI GR",
                              "amount": -18.7,
                              "id": "d4a9e4295f38bae8ce358fd0d8c182e6",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-17T09:52:59Z",
                              "description": "POROS KEFALLO ON 17/09/2025 CARD PURCHASE OLIVE GARDEN POROS KEFALLO GR",
                              "amount": -8,
                              "id": "4be32b8911ecda6eb1e610e7472b2268",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-17T08:35:12Z",
                              "description": "SAMI ON 17/09/2025 CARD PURCHASE FLAMIATOU CHRYSAV. SAMI GR",
                              "amount": -5,
                              "id": "730dd473547662d027b04f30a5387375",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-16T19:32:47Z",
                              "description": "SAMI ON 16/09/2025 CARD PURCHASE CARTONE SAMI GR",
                              "amount": -10.7,
                              "id": "03cea6c07ed020f29bedf0400d4db289",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-16T19:21:28Z",
                              "description": "SAMIS ON 16/09/2025 CARD PURCHASE FAMILIA SAMIS GR",
                              "amount": -59,
                              "id": "f86b8b8dfd40a6729ad20b37a740ff72",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-16T16:44:17Z",
                              "description": "KEFALLONIA ON 16/09/2025 CARD PURCHASE S/M BAZAAR KEFALLONIA GR",
                              "amount": -20.88,
                              "id": "ae6d7658df900f499c9ec899a36edb99",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-16T14:49:45Z",
                              "description": "SAMI ON 16/09/2025 CARD PURCHASE FLAMIATOU CHRYSAV. SAMI GR",
                              "amount": -4,
                              "id": "8f61b6d855559654f78783f09341f831",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-16T13:15:54Z",
                              "description": "DREPANO ACHAI ON 16/09/2025 CARD PURCHASE V-KTR SERVICES E.E. DREPANO ACHAI GR",
                              "amount": -8.5,
                              "id": "6c2b81caefd266efe58bbc9b42777570",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-16T11:49:00Z",
                              "description": "SAMI ON 16/09/2025 CARD PURCHASE EXAIL SAMI GR",
                              "amount": -40.8,
                              "id": "f2aa2bbb3872ad69dfca33f5da9483e6",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T19:25:06Z",
                              "description": "KEFALLONIA ON 15/09/2025 CARD PURCHASE GERASIMOS KAVVADIAS KEFALLONIA GR",
                              "amount": -83,
                              "id": "90b3268e9033cbe4deb0d2e0f5ea5eff",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T19:25:06Z",
                              "description": "KEFALLONIA ON 15/09/2025 CARD PURCHASE GERASIMOS KAVVADIAS KEFALLONIA GR",
                              "amount": -83,
                              "id": "b313e4d32fd1730ec75ff9a94639e447",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T12:31:05Z",
                              "description": "LIXOURI ON 15/09/2025 CARD PURCHASE IONION LINES LIXOURI GR",
                              "amount": -14,
                              "id": "ccd4e6214a5729bcd0f164f87fdaf9e6",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T12:15:42Z",
                              "description": "VASILIKH ON 15/09/2025 CARD PURCHASE KOLYVAS IOANNIS VASILIKH GR",
                              "amount": -34,
                              "id": "5767d4e379c485def6e4d82db959810b",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T11:31:51Z",
                              "description": "VASILIKI ON 15/09/2025 CARD PURCHASE SOUPER MARKET POLI VASILIKI GR",
                              "amount": -3.2,
                              "id": "6a7fd25f62c8da4faddd0df470193879",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-14T20:54:55Z",
                              "description": "LEFKADA ON 14/09/2025 CARD PURCHASE THERAPOS SPYROGIANNI LEFKADA GR",
                              "amount": -18.5,
                              "id": "4af7537252f4f07a33544cc36a8b7336",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-14T20:22:04Z",
                              "description": "LEFKADA ON 14/09/2025 CONTACTLESS ITEM KIOSK VATHIS LEFKADA GR",
                              "amount": -17.68,
                              "id": "2f14015da19ae1bd61c744d2ead4cc1d",
                              "account_id": "6d7afbac29de4842775ee1763b86fc68",
                              "currency": "EUR",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            }
                          ]
                        },
                        "91c6769dcb61767289208a454930c7b7": {
                          "info": {
                            "number": {
                              "iban": "GB10BUKB20272673049558",
                              "number": "73049558",
                              "sort_code": "20-27-26",
                              "swift_bic": ""
                            },
                            "name": "Barclays Bank Account",
                            "provider": {
                              "id": "ob-barclays",
                              "name": "BARCLAYS"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 8.84,
                              "current": 8.84,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "MR JACOB ROBERT ARCHER-MORAN",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-06T18:04:44.3093359Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": 1762452286048,
                              "tl": {
                                "account_id": "91c6769dcb61767289208a454930c7b7",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "e3105542-2fcd-4e05-9cfd-63d829421185"
                              },
                              "updated_at": 1762452285237
                            },
                            "type": "TRANSACTION"
                          },
                          "statement": [
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "Buy BTW2509122529521 amount in EUR364.19 on 12 SEP reference exchange rate 1.155709 Final GBP amount inc. margin &#xA3;8.92",
                              "amount": -324.04,
                              "id": "a340d0e9eecc82a393a2c4cfd23d5688",
                              "account_id": "91c6769dcb61767289208a454930c7b7",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "Arch-Mo J R holiday BGC",
                              "amount": 15,
                              "id": "525f95c9eeeaf311e3c61196801ade8d",
                              "account_id": "91c6769dcb61767289208a454930c7b7",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "Arch-Mo J R holiday BGC",
                              "amount": 10,
                              "id": "19f23841755f5f748f6d27d11d85d597",
                              "account_id": "91c6769dcb61767289208a454930c7b7",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "Arc-McDo B holiday BGC",
                              "amount": 250,
                              "id": "6d74678683171682a62ffc97c03953d8",
                              "account_id": "91c6769dcb61767289208a454930c7b7",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            }
                          ]
                        },
                        "4c82630f5b8bccce242ff3fbb4740b8d": {
                          "info": {
                            "number": {
                              "iban": "GB63MIDL40443471857460",
                              "number": "71857460",
                              "sort_code": "40-44-34",
                              "swift_bic": ""
                            },
                            "name": "BANK A/C",
                            "provider": {
                              "id": "ob-hsbc",
                              "name": "HSBC"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 5.83,
                              "current": 5.83,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "Mr Jacob Robert Archer-Moran",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-06T18:03:12.7946689Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": 1762452195837,
                              "tl": {
                                "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "fa3e06c2-b9c5-4fcf-b015-a3fb91f5de2b"
                              },
                              "updated_at": 1762452194836
                            },
                            "type": "TRANSACTION"
                          },
                          "statement": [
                            {
                              "merchant_name": "Google",
                              "timestamp": "2025-11-06T00:00:00Z",
                              "description": "GOOGLE *Google Plag.co/helppay#",
                              "amount": -29.97,
                              "id": "0fa775e9fa58f8a57b2281d856f4677d",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-11-05T00:00:00Z",
                              "description": "HLTN03 VOIPSTUDIO.",
                              "amount": -18,
                              "id": "57efabbf4332c55d74b2145b3ed89a52",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Amazon Prime Video",
                              "timestamp": "2025-11-05T00:00:00Z",
                              "description": "HLTN05 PRIME VIDE",
                              "amount": -5,
                              "id": "05b28649733c15d4d1d0d2e9af83ad56",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Amazon Prime Video",
                              "timestamp": "2025-11-05T00:00:00Z",
                              "description": "HLTN04 PRIME VIDEO",
                              "amount": -4,
                              "id": "74e37a254758995c00bce013d15264e6",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Transport for London",
                              "timestamp": "2025-11-05T00:00:00Z",
                              "description": "HLTN06 TFL TRAVEL",
                              "amount": -3.1,
                              "id": "88cff579b837c22234f7e3613bf5c321",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Google",
                              "timestamp": "2025-11-04T00:00:00Z",
                              "description": "GOOGLE *Google Plag.co/helppay#",
                              "amount": -12.99,
                              "id": "5f375a74644bd908e00fd03834d1e579",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Vape Club",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "VAPE CLUB LTD WATFORD",
                              "amount": -39.97,
                              "id": "5ff7571700be937346932392ded4e84b",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "b4e6e3e698d83bd34493d70b864ef210",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "CAR STEWART S",
                              "amount": 70,
                              "id": "9738cf4da5ca96b561a70e21a6b8e666",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "77bda169d7f18df9e0350118929e55c1",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "c4e8a8624a787db81490123872b4c090",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Driver And Vehicle Licensing Agency",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "DVLA-WF60YWP",
                              "amount": -18.81,
                              "id": "0375fd775ea648bae3eea8ec7de8b713",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Driver And Vehicle Licensing Agency",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "DVLA-OE62WGD",
                              "amount": -29.31,
                              "id": "8b815c0f80804a7933ef4966d278015f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "REVERSAL OF 03-11 ADMIRAL INSURANCE",
                              "amount": 90.18,
                              "id": "41f008d187aacafb9284eb4c05aa1229",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Admiral",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "ADMIRAL INSURANCE",
                              "amount": -90.18,
                              "id": "4c188f7806f94d3181ee32fc0e341764",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-11-03T00:00:00Z",
                              "description": "PROSPECT UNION",
                              "amount": -11.25,
                              "id": "5ecbcc1af74c6fb0b4f46f84010380c0",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-31T00:00:00Z",
                              "description": "STEWART S Holidayxx",
                              "amount": 150,
                              "id": "db76f59f7ac5395ab94ec1a7d5648ee2",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Trainline",
                              "timestamp": "2025-10-31T00:00:00Z",
                              "description": "HLTN02 TRAINLINE",
                              "amount": -14.2,
                              "id": "be44b1efe0dfa1282da88d4d90446f0f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-30T00:00:00Z",
                              "description": "Non-Sterling Transaction Fee",
                              "amount": -0.24,
                              "id": "0fed04a35afb73104eb934f0b51a734c",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-30T00:00:00Z",
                              "description": "INT'L 0066211166 DUOFAX.COM PRAHA 4 EUR 10.00 @ 1.1376 Visa Rate",
                              "amount": -8.79,
                              "id": "1e9ddbd0ab75bae40bd07f0c33934013",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Trainline",
                              "timestamp": "2025-10-30T00:00:00Z",
                              "description": "TRAINLINE WWW.THETRAINL",
                              "amount": -10,
                              "id": "69fceaa63ab5cf18b7104dc18aa37cbe",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Trainline",
                              "timestamp": "2025-10-29T00:00:00Z",
                              "description": "HLTN01 TRAINLINE",
                              "amount": -10,
                              "id": "195adc7b7f10efe1bfda62c24dbd0a07",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-28T00:00:00Z",
                              "description": "Se Iou",
                              "amount": -110,
                              "id": "2789d8f6f89e6d2f4dec2a99dd406980",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-28T00:00:00Z",
                              "description": "404434 21857479 INTERNET TRANSFER",
                              "amount": 50,
                              "id": "e8dc9f623531137194dad9a1eda4b000",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "Jacob TSB work return iou",
                              "amount": -150,
                              "id": "6cc540e761172036d41dca37fce01d38",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Tesco Bank",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "TESCO BANK 518652******0936",
                              "amount": -160.31,
                              "id": "3c8640af1c234df97be59a19b6af559b",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Tesco Bank",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "TESCO BANK 518652******0936",
                              "amount": -1000,
                              "id": "282a0116410532bb12df1fce68ff2ca2",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "B ARCHER Rent & Owings x4",
                              "amount": -600,
                              "id": "c84f0526ba6a0e5fbfb96fb23e3ae47f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "Se Iou",
                              "amount": -100,
                              "id": "8aaca016c37aae8ae9737b19a065d93a",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "The Cock Tavern",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "The Cock Tavern London",
                              "amount": -10,
                              "id": "7df7f2e338caa7671e1ae19794a33cdf",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "e5eb85608f0211749d34f470bac543e2",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "14315818ab265b9e865341971ca3cf7e",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "f0f4a7e4a0b6e57308ecd882243d9d6f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-27T00:00:00Z",
                              "description": "HLTN PREMIUM",
                              "amount": -150,
                              "id": "4e74dc5b71f6cab998e729cb943a5805",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-24T00:00:00Z",
                              "description": "THUR HOSK SO LLP W/E 24/10 SCREWFIX",
                              "amount": 2272.48,
                              "id": "9ff7a8f1b4bb4337e257c78ad2629d25",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-22T00:00:00Z",
                              "description": "LEE CAJ CAROLINE is fab",
                              "amount": 20,
                              "id": "3a05881505230f565f56c9770184af71",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Google Moon",
                              "timestamp": "2025-10-22T00:00:00Z",
                              "description": "HLTN48 GOOGLE GOOG",
                              "amount": -25,
                              "id": "e43c2d9863475454a2b188d11b304331",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Just Eat",
                              "timestamp": "2025-10-20T00:00:00Z",
                              "description": "Just Eat.Co.UK LtdLondon",
                              "amount": -22.47,
                              "id": "d09c63041f2cb6c6d38f8ff828617356",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-20T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "3fa9b21c0eb1d3c8b5c0603c6440bc7b",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-10-20T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "15698d426b434690ca629a80c68bbc9a",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-10-20T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "473567e154be184192a74a2fd31e8171",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-17T00:00:00Z",
                              "description": "ICO",
                              "amount": -47,
                              "id": "efc07b773f209dd7258ffbedf7735585",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Amazon",
                              "timestamp": "2025-10-17T00:00:00Z",
                              "description": "HLTN47 AMAZON.CO.U",
                              "amount": -7,
                              "id": "816c182fd4846287a6555db48f99500a",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Amazon",
                              "timestamp": "2025-10-15T00:00:00Z",
                              "description": "HLTN45 AMAZON.CO.U",
                              "amount": -14,
                              "id": "1574fbd61b751b043d1a70f4eacc534f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Amazon Prime Video",
                              "timestamp": "2025-10-15T00:00:00Z",
                              "description": "HLTN46 PRIME VIDE",
                              "amount": -4,
                              "id": "a1655eeb312498a610245c1cc2c2b12c",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Amazon",
                              "timestamp": "2025-10-14T00:00:00Z",
                              "description": "HLTN44 AMAZON.CO.U",
                              "amount": -4,
                              "id": "787afb76f56828da3d4df278d4ab4256",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Just Eat",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "Just Eat.Co.UK LtdLondon",
                              "amount": -25.96,
                              "id": "480b4c4823d8d7e8da089e9e95878bda",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Vape Club",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "VAPE CLUB LTD WATFORD",
                              "amount": -49.97,
                              "id": "6e4bfc8286eb54cbf5cf1d7030175d54",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "000fdb8c5d670d5a1cfc9298e6a9aa08",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "c104d08004a929187f8611aa62d6141b",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-10-13T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "6d8e97047838357c619ae9de7b76e52e",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Just Eat",
                              "timestamp": "2025-10-08T00:00:00Z",
                              "description": "Just Eat.Co.UK LtdLondon",
                              "amount": -15.75,
                              "id": "b5a5ae621bbe8bac674b027f047bac97",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "Non-Sterling Transaction Fee",
                              "amount": -0.24,
                              "id": "61ac548a6c55b987e741d3c70b7bf82e",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "INT'L 0066184243 DUOFAX.COM PRAHA 4 EUR 10.00 @ 1.1454 Visa Rate",
                              "amount": -8.73,
                              "id": "e1affbffd520a240dfcfe1636eb7edf5",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Vape Club",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "VAPE CLUB LTD WATFORD",
                              "amount": -47.98,
                              "id": "3e7088d0021f50795f1bb6636abd1f2f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Just Eat",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "Just Eat.Co.UK LtdLondon",
                              "amount": -25.96,
                              "id": "7354365839e01f9ae93d96ed75ddf5ee",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Google",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "GOOGLE *Google Plag.co/helppay#",
                              "amount": -12.99,
                              "id": "92d3324c249c1da1648506bf22a36a2f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "fea61beecc5bc5a72a5bdb0976c7bb25",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "9e462d0d506872cbc794e034eb96a8bd",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "0309bc1935d09be5822855cf322f70cc",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Amazon Prime Video",
                              "timestamp": "2025-10-06T00:00:00Z",
                              "description": "HLTN43 PRIME VIDE",
                              "amount": -5,
                              "id": "c4dfdfe558fe18e7863df736090484b0",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-03T00:00:00Z",
                              "description": "B ARCHER Rent & Owings x2",
                              "amount": -300,
                              "id": "fc339ff805ae07fb3bc7355dce8f7050",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-03T00:00:00Z",
                              "description": "THUR HOSK SO LLP work w/e 3.10.25",
                              "amount": 660,
                              "id": "65bea463c180e32c536ebf770ad4f6db",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-03T00:00:00Z",
                              "description": "HMRC GOV.UK SA GLASGOW",
                              "amount": -197.6,
                              "id": "85edd8e1479758f6319dbaddf1c7ea07",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-03T00:00:00Z",
                              "description": "HLTN42 VOIPSTUDIO.",
                              "amount": -18,
                              "id": "689739b38b650b11fe07cffa4ae44318",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Paypal",
                              "timestamp": "2025-10-02T00:00:00Z",
                              "description": "PAYPAL *UBERTRIP 35314369001",
                              "amount": -1.5,
                              "id": "978597377aad280b5e524a94a4e97d28",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Tesco Bank",
                              "timestamp": "2025-10-02T00:00:00Z",
                              "description": "TESCO BANK 518652******0936",
                              "amount": -2034.26,
                              "id": "313deb3db30a087d274b7429bc9637b9",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-02T00:00:00Z",
                              "description": "JACOB ARCHER-MORANGWD25",
                              "amount": 2300,
                              "id": "d5fdf791a4294d42275adabc74e82413",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Experian",
                              "timestamp": "2025-10-02T00:00:00Z",
                              "description": "HLTN41 EXPERIAN LT",
                              "amount": -15,
                              "id": "d44b2966f183387818cb0915d7782198",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Apple",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "PAYPAL *APPLE.COM/35314369001",
                              "amount": -0.99,
                              "id": "f5c08a758d1d481bcf1f07d088161874",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "CAR STEWART S",
                              "amount": 70,
                              "id": "ea13d2a5a3d225c323b8193b4a5d1dd8",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Driver And Vehicle Licensing Agency",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "DVLA-WF60YWP",
                              "amount": -18.81,
                              "id": "f918f881fb7eee736b8db824fb0f42bf",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Driver And Vehicle Licensing Agency",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "DVLA-OE62WGD",
                              "amount": -29.31,
                              "id": "43580b657664533030bf8af3bfd6ad8e",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Admiral",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "ADMIRAL INSURANCE",
                              "amount": -90.18,
                              "id": "db20112ffe29f638cf31e056b0678467",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-01T00:00:00Z",
                              "description": "PROSPECT UNION",
                              "amount": -11.25,
                              "id": "148fff3918e5d81fda9aa0a6a6d32dbf",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Just Eat",
                              "timestamp": "2025-09-30T00:00:00Z",
                              "description": "Just Eat.Co.UK LtdLondon",
                              "amount": -25.57,
                              "id": "748ebfbf7f8d39bed8c5eaf4e11a6eff",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Omaze Uk",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "SP OMAZE UK ALTRINCHAM",
                              "amount": -15,
                              "id": "35411103828cce4fb150e3706921a73c",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Just Eat",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "Just Eat.Co.UK LtdLondon",
                              "amount": -38.38,
                              "id": "66c9b09401a82e6a93c16a4686eb972f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "Just Eat.Co.UK LtdLondon",
                              "amount": 7,
                              "id": "ec03370db9358e8140d4705606e97f61",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "e3d73daf8064029bd77095eb288626df",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "725d9bb576d08331bc049efeb5175250",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-29T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "58410776ed94bee425e6802e9d8bfb08",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-28T00:00:00Z",
                              "description": "STEWART S Holidayxx",
                              "amount": 200,
                              "id": "d1c97b4c29623482d6ff920ded9ffddc",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Deliveroo",
                              "timestamp": "2025-09-25T00:00:00Z",
                              "description": "DELIVEROO LONDON",
                              "amount": -12.08,
                              "id": "db00abb4cb860f45ae492c01ef9e2678",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Vape Club",
                              "timestamp": "2025-09-25T00:00:00Z",
                              "description": "VAPE CLUB LTD WATFORD",
                              "amount": -28.99,
                              "id": "f51ae34cf58f79774ef91ff72fd2a4f4",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-25T00:00:00Z",
                              "description": "Klarna Financial SYA777777777713C9YB",
                              "amount": -199.56,
                              "id": "2e6ee436a7394f2406fdebb7664f0dc1",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Deliveroo",
                              "timestamp": "2025-09-24T00:00:00Z",
                              "description": "DELIVEROO LONDON",
                              "amount": -17.54,
                              "id": "63016b02bf97950287954693ee4e39c5",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Co-op",
                              "timestamp": "2025-09-24T00:00:00Z",
                              "description": "CO-OP GROUP FOOD LONDON",
                              "amount": -1.95,
                              "id": "42a9f5445f421a3152bbd97cf66bc2f3",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Klarna",
                              "timestamp": "2025-09-24T00:00:00Z",
                              "description": "KLARNA",
                              "amount": -19.96,
                              "id": "e85d67c773a0a59136dad03d27b89f8c",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-22T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "3e30d63678a3853fa0c6c72ea04cd3cc",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-22T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "de57508d74169eda397e6758d2709f0c",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-22T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "f0cb165438e9f457043b6291208f8142",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-19T00:00:00Z",
                              "description": "Non-Sterling Transaction Fee",
                              "amount": -0.04,
                              "id": "a49711695aee358ffcd41a31223ae9d8",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-19T00:00:00Z",
                              "description": "INT'L 0048286545 2CO.COM&#xA6;MALWAREBYTAMSTERDAM EUR 1.90 @ 1.1515 Visa Rate",
                              "amount": -1.65,
                              "id": "793a721d100c4c9d39da959262398a9e",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-18T00:00:00Z",
                              "description": "GREAT WESTERN TRAI",
                              "amount": 75.25,
                              "id": "443f1383ff63083d556fd8bdebaba1dd",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-16T00:00:00Z",
                              "description": "HLTN40 VOIPSTUDIO.",
                              "amount": -18,
                              "id": "66794a0e3d6f8d55d6bb0bd2476c8667",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Deliveroo",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "DELIVEROO LONDON",
                              "amount": -14.4,
                              "id": "9881ca248ed50b787bb58df2f5b3c777",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Deliveroo",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "DELIVEROO LONDON",
                              "amount": -20.98,
                              "id": "fd6d855773564077849e35ffb31b0d5c",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "BIG PENNY SOCIAL LONDON",
                              "amount": -30.58,
                              "id": "e3fa3c1e6b036b1f400eacf7135c0a91",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Vape Club",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "VAPE CLUB LTD WATFORD",
                              "amount": -46.97,
                              "id": "0aa200fd9617c25aa5984a9395e1ffe8",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "5f930488e74ed312a8480764c4981aa4",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "6517ef405e4e6df7ad3a02ca3303ff02",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-15T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "18cc7f418b45382939ab155c3342a88b",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-12T00:00:00Z",
                              "description": "Jacob Barclays holiday",
                              "amount": -15,
                              "id": "4ff304ac4c5d83b264e2077ee5742cfd",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-12T00:00:00Z",
                              "description": "Jacob Barclays holiday",
                              "amount": -10,
                              "id": "2f48a0db6c06f72b2f2453e033c45d59",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-12T00:00:00Z",
                              "description": "THUR HOSK SO LLP work w/e 12.9.25",
                              "amount": 220,
                              "id": "2eb349e09df20e7e811525c18130a684",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Deliveroo",
                              "timestamp": "2025-09-11T00:00:00Z",
                              "description": "DELIVEROO LONDON",
                              "amount": -18.68,
                              "id": "e6c038ae8032d7c918c6816cf8f24a59",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Tesco Bank",
                              "timestamp": "2025-09-08T00:00:00Z",
                              "description": "TESCO BANK 518652******0936",
                              "amount": -550.67,
                              "id": "14b11a87620190e2b202574bdfb2d2e4",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-08T00:00:00Z",
                              "description": "Se Iou",
                              "amount": -100,
                              "id": "3a6fc65196ab7f60ff8cca5d9a1d6d73",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Tesco Bank",
                              "timestamp": "2025-09-08T00:00:00Z",
                              "description": "TESCO BANK 518652******0936",
                              "amount": -1500,
                              "id": "f64c8549d4927508cbee937952190e20",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-08T00:00:00Z",
                              "description": "B ARCHER Owings finl",
                              "amount": -200,
                              "id": "4f1d2724e46e78ebd57b6ba524790134",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-08T00:00:00Z",
                              "description": "JACOB ARCHER-MORANGWN25",
                              "amount": 2400,
                              "id": "ee587010c1a76619f7888e7448df3dac",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-08T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "d75cef9e6315bb83253b19168862250f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-08T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "ae6eed564313fee88ec7c7c5438918ab",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-08T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "542682a6285d84feca8f41b770f3e51d",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Tesco Bank",
                              "timestamp": "2025-09-07T00:00:00Z",
                              "description": "TESCO BANK 518652******0936",
                              "amount": -1065.68,
                              "id": "0ea56de940d75d4b26c76aeee4ba8ddc",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-07T00:00:00Z",
                              "description": "Arc-McDo B Greece",
                              "amount": 500,
                              "id": "908b356faa560c1910ab62699105519e",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-06T00:00:00Z",
                              "description": "THUR HOSK SO LLP work w/e 6.9.25",
                              "amount": 800,
                              "id": "4eb4becb238395fa3a60bff26b2e4797",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-04T00:00:00Z",
                              "description": "Non-Sterling Transaction Fee",
                              "amount": -0.23,
                              "id": "ea0be3b2bdf96aae306c31f03a7dce57",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-04T00:00:00Z",
                              "description": "INT'L 0037058365 DUOFAX.COM PRAHA 4 EUR 10.00 @ 1.1481 Visa Rate",
                              "amount": -8.71,
                              "id": "652937aac30a98c6022e1a134f3fcb60",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Google",
                              "timestamp": "2025-09-04T00:00:00Z",
                              "description": "GOOGLE *Google Plag.co/helppay#",
                              "amount": -12.99,
                              "id": "278277a7b541c44bc889fb469bb9dfad",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Amazon Prime Video",
                              "timestamp": "2025-09-04T00:00:00Z",
                              "description": "HLTN39 PRIME VIDE",
                              "amount": -5,
                              "id": "99cf0d9025219e9db05846853a886e41",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Tesco",
                              "timestamp": "2025-09-03T00:00:00Z",
                              "description": "HLTN38 TESCO STORE",
                              "amount": -3.3,
                              "id": "0d09b7e15204724f016ad93b16d0b610",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-02T00:00:00Z",
                              "description": "THUR HOSK SO LLP CPC Expenses",
                              "amount": 29.52,
                              "id": "2084d3432b19833661dd626133b0c011",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Apple",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "PAYPAL *APPLE.COM/35314369001",
                              "amount": -0.99,
                              "id": "77de55dd13ff2d0e4d5b567d0c3d64c4",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Paypal",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "PAYPAL *UBERTRIP 35314369001",
                              "amount": -4.99,
                              "id": "ea9f9e6c2df2b1ba21ee791671120703",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "404434 21857479 INTERNET TRANSFER",
                              "amount": 130,
                              "id": "6260e8341669381eaa8163ab03e303e1",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "CAR STEWART S",
                              "amount": 70,
                              "id": "fabe29bf4ded2b8b45199b2de974cacb",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "24003b987c8d8caf48030c00403c100f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "f80b053a0dec8f9fcc2f804ff9dec59b",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "b4df868d5c5422886bea471a5174e409",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Driver And Vehicle Licensing Agency",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "DVLA-WF60YWP",
                              "amount": -18.81,
                              "id": "db806b00827eff941557b092e65eb54e",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Driver And Vehicle Licensing Agency",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "DVLA-OE62WGD",
                              "amount": -29.31,
                              "id": "95d09ab23421509f6c09ad72aac77364",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Admiral",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "ADMIRAL INSURANCE",
                              "amount": -90.18,
                              "id": "5aaed144c1a4ae4e6d79906103c4e3e9",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "PROSPECT UNION",
                              "amount": -11.25,
                              "id": "3742b35a64f665ca2dafbf728f778757",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Tesco Bank",
                              "timestamp": "2025-08-30T00:00:00Z",
                              "description": "TESCO BANK 518652******0936",
                              "amount": -200,
                              "id": "7792426ac76f46c4c60e6aa0d15f15a2",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-30T00:00:00Z",
                              "description": "STEWART S Holidayxx",
                              "amount": 245,
                              "id": "1abd212b42e55440112ca9b8e2b87d9f",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-26T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "27604ce52ddf620af046a390ebee4221",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-08-26T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "0455665fdc4e6f857f8aa209093f6b1c",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-08-26T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "ed9a9f36174e9d87770cbef4723ae752",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Klarna",
                              "timestamp": "2025-08-26T00:00:00Z",
                              "description": "KLARNA",
                              "amount": -19.96,
                              "id": "b19e2c02f668f78678effca245c1f9e2",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-23T00:00:00Z",
                              "description": "Se Iou",
                              "amount": -50,
                              "id": "02747dcd4efaac2d613cd130ade34a7c",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "BILL_PAYMENT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Booking.com",
                              "timestamp": "2025-08-21T00:00:00Z",
                              "description": "HLTN37 BOOKING.COM",
                              "amount": -46.9,
                              "id": "a237465f6e362d37cdc703b64a22a153",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Wix",
                              "timestamp": "2025-08-19T00:00:00Z",
                              "description": "WIX.COM LONDON",
                              "amount": -27.6,
                              "id": "a3e6fe9e6de03e974c4008c18a27161c",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-18T00:00:00Z",
                              "description": "ME GROUP INTERNATIME Group Refund",
                              "amount": 7,
                              "id": "724af9b44b895a3513293f8b501e94bf",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-18T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "36f55f318292670ffe01e57043bd6f5b",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-08-18T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "6d29b0e8f86cf4e577a73692c6702b67",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-08-18T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "11d40f95b89886b124b16f1fb2d55d78",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Amazon Prime Video",
                              "timestamp": "2025-08-15T00:00:00Z",
                              "description": "HLTN36 PRIME VIDE",
                              "amount": -4,
                              "id": "981f25ee4c213239859270fd6b1ad6c7",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "WM Morrisons",
                              "timestamp": "2025-08-11T00:00:00Z",
                              "description": "WM MORRISONS STOREFAKENHAM",
                              "amount": -51.5,
                              "id": "4dd658bb513f80a1f873c6268248b798",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "PURCHASE",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-11T00:00:00Z",
                              "description": "LISA Arc-McDo B",
                              "amount": 20,
                              "id": "5343cd69b6e062310b6c47f3191c255d",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-08-11T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "3ad70ec958f634869ebd7364f9ac747a",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Moneybox",
                              "timestamp": "2025-08-11T00:00:00Z",
                              "description": "MONEYBOX",
                              "amount": -30,
                              "id": "fdc93358e0c4f27e4191ac62f83ebf65",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "Nhs Prescription Prepayment Certificates",
                              "timestamp": "2025-08-11T00:00:00Z",
                              "description": "NHSBSA PPC 2",
                              "amount": -11.45,
                              "id": "3b8c304a7d6d3f2c5eaaacc4fea7b182",
                              "account_id": "4c82630f5b8bccce242ff3fbb4740b8d",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            }
                          ]
                        },
                        "071fc97cd0cf36290a519783bb8f1114": {
                          "info": {
                            "number": {
                              "iban": "GB13MIDL40443421857479",
                              "number": "21857479",
                              "sort_code": "40-44-34",
                              "swift_bic": ""
                            },
                            "name": "FLEX SAVER",
                            "provider": {
                              "id": "ob-hsbc",
                              "name": "HSBC"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 50.3,
                              "current": 50.3,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "Mr Jacob Robert Archer-Moran",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-06T18:03:12.7946689Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": 1762452195941,
                              "tl": {
                                "account_id": "071fc97cd0cf36290a519783bb8f1114",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "6e9ab6b3-75ec-4717-99f1-e89318a60451"
                              },
                              "updated_at": 1762452194836
                            },
                            "type": "SAVINGS"
                          },
                          "statement": [
                            {
                              "merchant_name": "",
                              "timestamp": "2025-11-06T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "05a65b1d49babb4d449db63687f32262",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-30T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "30f053128f38de8ef7e0262302cffc8b",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-28T00:00:00Z",
                              "description": "404434 71857460 INTERNET TRANSFER",
                              "amount": -50,
                              "id": "0e25dc2e339a922ea4d407d861cf0465",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-23T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "8b60e9df59164c3719eb8ba2a3737066",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-20T00:00:00Z",
                              "description": "GROSS INTEREST TO 19OCT2025",
                              "amount": 0.05,
                              "id": "dc8ccae8b5d94ff4a6f84b741f21c4f0",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "INTEREST",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-16T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "9c2d073f614ff5cf9c5c4c89f98c5548",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-09T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "0fd34b36a11b2a5beaed5d0bdfb71e2a",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-02T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "2f161e27a5d0124a855fb5958ba8d4ca",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-25T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "d78230be74370f682fa0ef2a3427fa9e",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-20T00:00:00Z",
                              "description": "GROSS INTEREST TO 19SEP2025",
                              "amount": 0.06,
                              "id": "e293c607abb4a95228cf43e765873533",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "INTEREST",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-18T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "5a7ab01dbe8e3f6f16da8623e1180077",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-11T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "7e155bf256e41c799e87179c9e435440",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-04T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "b4e3c8cbc22858e1f742715fcf60d9ce",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-01T00:00:00Z",
                              "description": "404434 71857460 INTERNET TRANSFER",
                              "amount": -130,
                              "id": "104b2be93860d304d1bc5e53291b36f7",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-28T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "7073d71d64314581f68658976cb5b8bd",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-21T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "3cb960a06eed48da5a7b09ab486254d8",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-20T00:00:00Z",
                              "description": "GROSS INTEREST TO 19AUG2025",
                              "amount": 0.1,
                              "id": "2e171add99d24c5785fc3f538ceefc46",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "INTEREST",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-08-14T00:00:00Z",
                              "description": "GRANDAD Arc-McDo B",
                              "amount": 10,
                              "id": "7516e2bdd553795219da981866e5510b",
                              "account_id": "071fc97cd0cf36290a519783bb8f1114",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            }
                          ]
                        },
                        "6f1032d40aa61c12cec47fe3295d6a22": {
                          "info": {
                            "number": {
                              "iban": "GB30TSBS77856600948872",
                              "number": "00948872",
                              "sort_code": "77-85-66",
                              "swift_bic": ""
                            },
                            "name": "Spend & Save Account",
                            "provider": {
                              "id": "ob-tsb",
                              "name": "TSB"
                            },
                            "_key": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "balance": {
                              "available": 168.2,
                              "current": 168.2,
                              "overdraft": 0
                            },
                            "info": [
                              {
                                "full_name": "JACOB ARCHER-MORAN",
                                "phones": null,
                                "date_of_birth": "",
                                "emails": null,
                                "update_timestamp": "2025-11-06T18:03:50.8306147Z",
                                "addresses": null
                              }
                            ],
                            "credentials_id": "&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;",
                            "currency": "GBP",
                            "metadata": {
                              "created_at": 1762452231890,
                              "tl": {
                                "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                                "debug_id": "",
                                "download_status": "complete",
                                "task_id": "1d27c4ca-4f32-42cb-b047-856c3c8af4f7"
                              },
                              "updated_at": 1762452231221
                            },
                            "type": "TRANSACTION"
                          },
                          "statement": [
                            {
                              "merchant_name": "",
                              "timestamp": "2025-11-04T00:18:28.578Z",
                              "description": "PC/SIMPLY BUSINESS REFERENCE: 04AEID7113/021/101",
                              "amount": -29.17,
                              "id": "ef80b7ecc4a206ce875d0ff7a55e1e40",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-27T19:27:13.285Z",
                              "description": "Arch-Mo J R work return iou",
                              "amount": 150,
                              "id": "d3cdcae5db4e4d841b712edacbea2e63",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-22T10:55:41.267Z",
                              "description": "S I STEWART work",
                              "amount": -150,
                              "id": "ef4894288d0bd608da7f62ab0c8620ff",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-02T13:10:35.762Z",
                              "description": "Jacob Robert arche GWD25",
                              "amount": -2300,
                              "id": "92c3449a9c1be6eee3b5ca3158f42142",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-10-01T15:45:28.701Z",
                              "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                              "amount": 2281.4,
                              "id": "0da74102e67736d0d00b6ba34242ccf7",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-08T13:34:27.36Z",
                              "description": "Jacob Robert arche GWN25",
                              "amount": -2400,
                              "id": "573b7ae1980c153f29d339e0287e6380",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-08T13:31:33.02Z",
                              "description": "BARBARA ARCHER owings x8",
                              "amount": -1200,
                              "id": "b7ccd74b1bc5f769843be499609633db",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-09-06T15:28:41.212Z",
                              "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                              "amount": 3613.9,
                              "id": "5c649b28a5641841b68b2bab28d23d05",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-07-27T23:36:15.32Z",
                              "description": "PC/SIMPLY BUSINESS REFERENCE: 04AEID7113/020/110",
                              "amount": -31.45,
                              "id": "92375813d37ae5e6c2126206f655d6d3",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-07-21T11:14:19.861Z",
                              "description": "Jacob Robert arche EGB",
                              "amount": -1200,
                              "id": "d0725de51ca36db9224996992bea9661",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-07-19T12:31:46.982Z",
                              "description": "SHOWBITZ LTD SHOWITZ LIMITED",
                              "amount": 1260,
                              "id": "e3349fb77f4ca0852d5bd241627a8aad",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-07-09T18:52:09.029Z",
                              "description": "Jacob Robert arche Powderham Presents",
                              "amount": -2200,
                              "id": "09a91579d867b94d34dd00f5bfbce4a0",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-07-09T10:07:54.167Z",
                              "description": "SWIFTELEX LIMITED SwiftElex Limited",
                              "amount": 2355,
                              "id": "04c554385e5106117f24163d80f2a849",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-06-29T23:51:36.853Z",
                              "description": "PC/SIMPLY BUSINESS REFERENCE: 04AEID7113/020/109",
                              "amount": -31.45,
                              "id": "b663e499c45ed0724782343398e4985d",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-06-02T00:31:32.136Z",
                              "description": "Jacob Robert arche Balter",
                              "amount": -800,
                              "id": "311d09c0be0d33a8e36dd4951cd8d0a8",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-05-30T07:58:04.461Z",
                              "description": "E&C EVENTS LTD BALTER 25",
                              "amount": 800,
                              "id": "e86445c66a21cf38609e252ea5d45add",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "CREDIT",
                              "classification": null,
                              "type": "CREDIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            },
                            {
                              "merchant_name": "",
                              "timestamp": "2025-05-27T23:26:32.766Z",
                              "description": "PC/SIMPLY BUSINESS REFERENCE: 04AEID7113/020/108",
                              "amount": -31.45,
                              "id": "b180018880cdbf89cf6683a8e45f1d43",
                              "account_id": "6f1032d40aa61c12cec47fe3295d6a22",
                              "currency": "GBP",
                              "category": "DIRECT_DEBIT",
                              "classification": null,
                              "type": "DEBIT",
                              "counterparty_name": "",
                              "counterparty_iban": ""
                            }
                          ]
                        }
                      },
                      "analysis": {
                        "id": "4151814597",
                        "repeating_transactions": [
                          {
                            "sort_score": 3613.9,
                            "items": [
                              "0da74102e67736d0d00b6ba34242ccf7",
                              "5c649b28a5641841b68b2bab28d23d05",
                              "e3349fb77f4ca0852d5bd241627a8aad"
                            ]
                          },
                          {
                            "sort_score": 2400,
                            "items": [
                              "573b7ae1980c153f29d339e0287e6380",
                              "92c3449a9c1be6eee3b5ca3158f42142"
                            ]
                          },
                          {
                            "sort_score": 2400,
                            "items": [
                              "d5fdf791a4294d42275adabc74e82413",
                              "ee587010c1a76619f7888e7448df3dac"
                            ]
                          },
                          {
                            "sort_score": 2034.26,
                            "items": [
                              "0ea56de940d75d4b26c76aeee4ba8ddc",
                              "14b11a87620190e2b202574bdfb2d2e4",
                              "282a0116410532bb12df1fce68ff2ca2",
                              "313deb3db30a087d274b7429bc9637b9",
                              "3c8640af1c234df97be59a19b6af559b",
                              "7792426ac76f46c4c60e6aa0d15f15a2",
                              "f64c8549d4927508cbee937952190e20"
                            ]
                          },
                          {
                            "sort_score": 800,
                            "items": [
                              "2eb349e09df20e7e811525c18130a684",
                              "4eb4becb238395fa3a60bff26b2e4797",
                              "65bea463c180e32c536ebf770ad4f6db"
                            ]
                          },
                          {
                            "sort_score": 600,
                            "items": [
                              "c84f0526ba6a0e5fbfb96fb23e3ae47f",
                              "fc339ff805ae07fb3bc7355dce8f7050"
                            ]
                          },
                          {
                            "sort_score": 245,
                            "items": [
                              "1abd212b42e55440112ca9b8e2b87d9f",
                              "d1c97b4c29623482d6ff920ded9ffddc",
                              "db76f59f7ac5395ab94ec1a7d5648ee2"
                            ]
                          },
                          {
                            "sort_score": 130,
                            "items": [
                              "0e25dc2e339a922ea4d407d861cf0465",
                              "104b2be93860d304d1bc5e53291b36f7"
                            ]
                          },
                          {
                            "sort_score": 130,
                            "items": [
                              "6260e8341669381eaa8163ab03e303e1",
                              "e8dc9f623531137194dad9a1eda4b000"
                            ]
                          },
                          {
                            "sort_score": 110,
                            "items": [
                              "02747dcd4efaac2d613cd130ade34a7c",
                              "2789d8f6f89e6d2f4dec2a99dd406980",
                              "3a6fc65196ab7f60ff8cca5d9a1d6d73",
                              "8aaca016c37aae8ae9737b19a065d93a"
                            ]
                          },
                          {
                            "sort_score": 90.18,
                            "items": [
                              "4c188f7806f94d3181ee32fc0e341764",
                              "5aaed144c1a4ae4e6d79906103c4e3e9",
                              "db20112ffe29f638cf31e056b0678467"
                            ]
                          },
                          {
                            "sort_score": 83,
                            "items": [
                              "90b3268e9033cbe4deb0d2e0f5ea5eff",
                              "b313e4d32fd1730ec75ff9a94639e447"
                            ]
                          },
                          {
                            "sort_score": 70,
                            "items": [
                              "9738cf4da5ca96b561a70e21a6b8e666",
                              "ea13d2a5a3d225c323b8193b4a5d1dd8",
                              "fabe29bf4ded2b8b45199b2de974cacb"
                            ]
                          },
                          {
                            "sort_score": 49.97,
                            "items": [
                              "0aa200fd9617c25aa5984a9395e1ffe8",
                              "3e7088d0021f50795f1bb6636abd1f2f",
                              "5ff7571700be937346932392ded4e84b",
                              "6e4bfc8286eb54cbf5cf1d7030175d54",
                              "f51ae34cf58f79774ef91ff72fd2a4f4"
                            ]
                          },
                          {
                            "sort_score": 38.38,
                            "items": [
                              "480b4c4823d8d7e8da089e9e95878bda",
                              "66c9b09401a82e6a93c16a4686eb972f",
                              "7354365839e01f9ae93d96ed75ddf5ee",
                              "748ebfbf7f8d39bed8c5eaf4e11a6eff",
                              "b5a5ae621bbe8bac674b027f047bac97",
                              "d09c63041f2cb6c6d38f8ff828617356"
                            ]
                          },
                          {
                            "sort_score": 31.45,
                            "items": [
                              "92375813d37ae5e6c2126206f655d6d3",
                              "b180018880cdbf89cf6683a8e45f1d43",
                              "b663e499c45ed0724782343398e4985d",
                              "ef80b7ecc4a206ce875d0ff7a55e1e40"
                            ]
                          },
                          {
                            "sort_score": 30,
                            "items": [
                              "0309bc1935d09be5822855cf322f70cc",
                              "0455665fdc4e6f857f8aa209093f6b1c",
                              "11d40f95b89886b124b16f1fb2d55d78",
                              "14315818ab265b9e865341971ca3cf7e",
                              "15698d426b434690ca629a80c68bbc9a",
                              "18cc7f418b45382939ab155c3342a88b",
                              "3ad70ec958f634869ebd7364f9ac747a",
                              "473567e154be184192a74a2fd31e8171",
                              "542682a6285d84feca8f41b770f3e51d",
                              "58410776ed94bee425e6802e9d8bfb08",
                              "6517ef405e4e6df7ad3a02ca3303ff02",
                              "6d29b0e8f86cf4e577a73692c6702b67",
                              "6d8e97047838357c619ae9de7b76e52e",
                              "725d9bb576d08331bc049efeb5175250",
                              "77bda169d7f18df9e0350118929e55c1",
                              "9e462d0d506872cbc794e034eb96a8bd",
                              "ae6eed564313fee88ec7c7c5438918ab",
                              "b4df868d5c5422886bea471a5174e409",
                              "c104d08004a929187f8611aa62d6141b",
                              "c4e8a8624a787db81490123872b4c090",
                              "de57508d74169eda397e6758d2709f0c",
                              "ed9a9f36174e9d87770cbef4723ae752",
                              "f0cb165438e9f457043b6291208f8142",
                              "f0f4a7e4a0b6e57308ecd882243d9d6f",
                              "f80b053a0dec8f9fcc2f804ff9dec59b",
                              "fdc93358e0c4f27e4191ac62f83ebf65"
                            ]
                          },
                          {
                            "sort_score": 29.97,
                            "items": [
                              "0fa775e9fa58f8a57b2281d856f4677d",
                              "278277a7b541c44bc889fb469bb9dfad",
                              "5f375a74644bd908e00fd03834d1e579",
                              "92d3324c249c1da1648506bf22a36a2f"
                            ]
                          },
                          {
                            "sort_score": 29.31,
                            "items": [
                              "0375fd775ea648bae3eea8ec7de8b713",
                              "43580b657664533030bf8af3bfd6ad8e",
                              "8b815c0f80804a7933ef4966d278015f",
                              "95d09ab23421509f6c09ad72aac77364",
                              "db806b00827eff941557b092e65eb54e",
                              "f918f881fb7eee736b8db824fb0f42bf"
                            ]
                          },
                          {
                            "sort_score": 20.98,
                            "items": [
                              "63016b02bf97950287954693ee4e39c5",
                              "9881ca248ed50b787bb58df2f5b3c777",
                              "db00abb4cb860f45ae492c01ef9e2678",
                              "e6c038ae8032d7c918c6816cf8f24a59",
                              "fd6d855773564077849e35ffb31b0d5c"
                            ]
                          },
                          {
                            "sort_score": 20,
                            "items": [
                              "000fdb8c5d670d5a1cfc9298e6a9aa08",
                              "24003b987c8d8caf48030c00403c100f",
                              "27604ce52ddf620af046a390ebee4221",
                              "36f55f318292670ffe01e57043bd6f5b",
                              "3e30d63678a3853fa0c6c72ea04cd3cc",
                              "3fa9b21c0eb1d3c8b5c0603c6440bc7b",
                              "5343cd69b6e062310b6c47f3191c255d",
                              "5f930488e74ed312a8480764c4981aa4",
                              "b4e6e3e698d83bd34493d70b864ef210",
                              "d75cef9e6315bb83253b19168862250f",
                              "e3d73daf8064029bd77095eb288626df",
                              "e5eb85608f0211749d34f470bac543e2",
                              "fea61beecc5bc5a72a5bdb0976c7bb25"
                            ]
                          },
                          {
                            "sort_score": 19.96,
                            "items": [
                              "b19e2c02f668f78678effca245c1f9e2",
                              "e85d67c773a0a59136dad03d27b89f8c"
                            ]
                          },
                          {
                            "sort_score": 18,
                            "items": [
                              "57efabbf4332c55d74b2145b3ed89a52",
                              "66794a0e3d6f8d55d6bb0bd2476c8667",
                              "689739b38b650b11fe07cffa4ae44318"
                            ]
                          },
                          {
                            "sort_score": 15,
                            "items": [
                              "19f23841755f5f748f6d27d11d85d597",
                              "525f95c9eeeaf311e3c61196801ade8d"
                            ]
                          },
                          {
                            "sort_score": 15,
                            "items": [
                              "2f48a0db6c06f72b2f2453e033c45d59",
                              "4ff304ac4c5d83b264e2077ee5742cfd"
                            ]
                          },
                          {
                            "sort_score": 14.2,
                            "items": [
                              "195adc7b7f10efe1bfda62c24dbd0a07",
                              "be44b1efe0dfa1282da88d4d90446f0f"
                            ]
                          },
                          {
                            "sort_score": 14,
                            "items": [
                              "1574fbd61b751b043d1a70f4eacc534f",
                              "787afb76f56828da3d4df278d4ab4256",
                              "816c182fd4846287a6555db48f99500a"
                            ]
                          },
                          {
                            "sort_score": 11.25,
                            "items": [
                              "148fff3918e5d81fda9aa0a6a6d32dbf",
                              "3742b35a64f665ca2dafbf728f778757",
                              "5ecbcc1af74c6fb0b4f46f84010380c0"
                            ]
                          },
                          {
                            "sort_score": 10,
                            "items": [
                              "05a65b1d49babb4d449db63687f32262",
                              "0fd34b36a11b2a5beaed5d0bdfb71e2a",
                              "2f161e27a5d0124a855fb5958ba8d4ca",
                              "30f053128f38de8ef7e0262302cffc8b",
                              "3cb960a06eed48da5a7b09ab486254d8",
                              "5a7ab01dbe8e3f6f16da8623e1180077",
                              "7073d71d64314581f68658976cb5b8bd",
                              "7516e2bdd553795219da981866e5510b",
                              "7e155bf256e41c799e87179c9e435440",
                              "8b60e9df59164c3719eb8ba2a3737066",
                              "9c2d073f614ff5cf9c5c4c89f98c5548",
                              "b4e3c8cbc22858e1f742715fcf60d9ce",
                              "d78230be74370f682fa0ef2a3427fa9e"
                            ]
                          },
                          {
                            "sort_score": 8.79,
                            "items": [
                              "1e9ddbd0ab75bae40bd07f0c33934013",
                              "652937aac30a98c6022e1a134f3fcb60",
                              "e1affbffd520a240dfcfe1636eb7edf5"
                            ]
                          },
                          {
                            "sort_score": 5,
                            "items": [
                              "05b28649733c15d4d1d0d2e9af83ad56",
                              "981f25ee4c213239859270fd6b1ad6c7",
                              "99cf0d9025219e9db05846853a886e41",
                              "a1655eeb312498a610245c1cc2c2b12c",
                              "c4dfdfe558fe18e7863df736090484b0"
                            ]
                          },
                          {
                            "sort_score": 5,
                            "items": [
                              "730dd473547662d027b04f30a5387375",
                              "8f61b6d855559654f78783f09341f831"
                            ]
                          },
                          {
                            "sort_score": 4.99,
                            "items": [
                              "978597377aad280b5e524a94a4e97d28",
                              "ea9f9e6c2df2b1ba21ee791671120703"
                            ]
                          },
                          {
                            "sort_score": 0.99,
                            "items": [
                              "77de55dd13ff2d0e4d5b567d0c3d64c4",
                              "f5c08a758d1d481bcf1f07d088161874"
                            ]
                          },
                          {
                            "sort_score": 0.24,
                            "items": [
                              "0fed04a35afb73104eb934f0b51a734c",
                              "61ac548a6c55b987e741d3c70b7bf82e",
                              "a49711695aee358ffcd41a31223ae9d8",
                              "ea0be3b2bdf96aae306c31f03a7dce57"
                            ]
                          },
                          {
                            "sort_score": 0.1,
                            "items": [
                              "2e171add99d24c5785fc3f538ceefc46",
                              "dc8ccae8b5d94ff4a6f84b741f21c4f0",
                              "e293c607abb4a95228cf43e765873533"
                            ]
                          }
                        ],
                        "large_one_off_transactions": [
                          "09a91579d867b94d34dd00f5bfbce4a0",
                          "b7ccd74b1bc5f769843be499609633db",
                          "d0725de51ca36db9224996992bea9661",
                          "311d09c0be0d33a8e36dd4951cd8d0a8",
                          "a340d0e9eecc82a393a2c4cfd23d5688",
                          "4f1d2724e46e78ebd57b6ba524790134",
                          "2e6ee436a7394f2406fdebb7664f0dc1",
                          "85edd8e1479758f6319dbaddf1c7ea07",
                          "4e74dc5b71f6cab998e729cb943a5805",
                          "6cc540e761172036d41dca37fce01d38",
                          "04c554385e5106117f24163d80f2a849",
                          "9ff7a8f1b4bb4337e257c78ad2629d25",
                          "e86445c66a21cf38609e252ea5d45add",
                          "908b356faa560c1910ab62699105519e",
                          "6d74678683171682a62ffc97c03953d8",
                          "d3cdcae5db4e4d841b712edacbea2e63",
                          "41f008d187aacafb9284eb4c05aa1229",
                          "443f1383ff63083d556fd8bdebaba1dd",
                          "2084d3432b19833661dd626133b0c011",
                          "3a05881505230f565f56c9770184af71"
                        ],
                        "sof_matches": {
                          "gift": [
                            "d5fdf791a4294d42275adabc74e82413",
                            "ee587010c1a76619f7888e7448df3dac"
                          ]
                        }
                      }
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [],
                    "id": "d46e77423amg030rw9vg",
                    "status": "closed",
                    "createdAt": "2025-11-06T18:06:20.781Z"
                  },
                  "documents:inheritance": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d46e6r323amg030rw9dg",
                          "type": "inheritance"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d46e6r323amg030rw9dg"
                    ],
                    "id": "d46e76w23amg030rw9gg",
                    "status": "closed",
                    "createdAt": "2025-11-06T18:06:19.414Z"
                  },
                  "documents:sale-assets": {
                    "breakdown": {
                      "documents": [
                        {
                          "id": "d46e71m23amg030rw9eg",
                          "type": "sale-assets"
                        }
                      ]
                    },
                    "data": {},
                    "result": "clear",
                    "documents": [
                      "d46e71m23amg030rw9eg"
                    ],
                    "id": "d46e77423amg030rw9pg",
                    "status": "closed",
                    "createdAt": "2025-11-06T18:06:20.221Z"
                  }
                },
                "updatedAt": "2025-11-06T18:06:27.223Z",
                "consumerPhone": "+447506430094",
                "pdfReady": true,
                "checkType": "electronic-id",
                "completedAt": "2025-11-06T18:06:27.223Z",
                "sofAnnotations": [
                  {
                    "timestamp": "2025-11-11T15:08:35.483Z",
                    "_id": "mNCK9K6",
                    "notes": {
                      "timestamp": "2025-11-11T15:08:34.983Z",
                      "fundingMethods": [
                        {
                          "fundType": "fund:savings",
                          "fundIdx": "1",
                          "note": "",
                          "transactionMarkers": {
                            "0da74102e67736d0d00b6ba34242ccf7": "accepted",
                            "5c649b28a5641841b68b2bab28d23d05": "accepted",
                            "e3349fb77f4ca0852d5bd241627a8aad": "accepted",
                            "04c554385e5106117f24163d80f2a849": "accepted"
                          },
                          "redFlags": [],
                          "verified": []
                        },
                        {
                          "fundType": "fund:gift",
                          "fundIdx": "2",
                          "note": "AML, ID and SoF/SoW conducted on gifter and all clear",
                          "transactionMarkers": {
                            "d5fdf791a4294d42275adabc74e82413": "rejected",
                            "ee587010c1a76619f7888e7448df3dac": "rejected"
                          },
                          "redFlags": [
                            {
                              "flagIdx": "0",
                              "status": "dismissed",
                              "note": "AML, ID and SoF/SoW conducted on gifter and all clear"
                            }
                          ],
                          "verified": [
                            "gift_checks"
                          ]
                        },
                        {
                          "fundType": "fund:sale:property",
                          "fundIdx": "3",
                          "note": "we acted previously in the sale under 50/998",
                          "transactionMarkers": {},
                          "redFlags": [],
                          "verified": []
                        },
                        {
                          "fundType": "fund:sale:assets",
                          "fundIdx": "4",
                          "note": "",
                          "transactionMarkers": {
                            "e86445c66a21cf38609e252ea5d45add": "accepted"
                          },
                          "redFlags": [],
                          "verified": []
                        },
                        {
                          "fundType": "fund:htb",
                          "fundIdx": "5",
                          "note": "confirmed funds in our account direct from moneybox",
                          "transactionMarkers": {},
                          "redFlags": [],
                          "verified": []
                        },
                        {
                          "fundType": "fund:inheritance",
                          "fundIdx": "6",
                          "note": "we actee in the estate under 50/998",
                          "transactionMarkers": {},
                          "redFlags": [],
                          "verified": []
                        }
                      ],
                      "chains": [],
                      "property": {
                        "reviewed": true,
                        "note": "All match our details"
                      },
                      "bankAnalysisItems": [
                        {
                          "groupIndex": 0,
                          "comment": "salary",
                          "flag": "cleared",
                          "type": "repeating-group",
                          "linkedToFundIdx": "0"
                        },
                        {
                          "groupIndex": 1,
                          "comment": "salary",
                          "flag": "cleared",
                          "type": "repeating-group",
                          "linkedToFundIdx": "0"
                        },
                        {
                          "groupIndex": 2,
                          "comment": "salary",
                          "flag": "cleared",
                          "type": "repeating-group",
                          "linkedToFundIdx": "0"
                        },
                        {
                          "groupIndex": 3,
                          "comment": "Credit card payments",
                          "flag": "cleared",
                          "type": "repeating-group",
                          "linkedToFundIdx": "0"
                        },
                        {
                          "groupIndex": 4,
                          "comment": "salary",
                          "flag": "cleared",
                          "type": "repeating-group",
                          "linkedToFundIdx": "1"
                        },
                        {
                          "groupIndex": 5,
                          "comment": "current rent",
                          "flag": "cleared",
                          "type": "repeating-group",
                          "linkedToFundIdx": "0"
                        },
                        {
                          "groupIndex": 7,
                          "comment": "Suspicious payment",
                          "flag": "suspicious",
                          "type": "repeating-group",
                          "linkedToFundIdx": "0"
                        },
                        {
                          "comment": "Klarna is a payment service, why such large payment?",
                          "flag": "review",
                          "type": "transaction",
                          "transactionId": "2e6ee436a7394f2406fdebb7664f0dc1"
                        }
                      ],
                      "transactions": [
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "0da74102e67736d0d00b6ba34242ccf7"
                        },
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "5c649b28a5641841b68b2bab28d23d05"
                        },
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "e3349fb77f4ca0852d5bd241627a8aad"
                        },
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "04c554385e5106117f24163d80f2a849"
                        },
                        {
                          "linkedToFunds": [
                            "4"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "e86445c66a21cf38609e252ea5d45add"
                        }
                      ],
                      "accounts": [
                        {
                          "accountId": "6d7afbac29de4842775ee1763b86fc68",
                          "accountIdx": "0",
                          "reviewed": true,
                          "note": "not connected to purchase"
                        },
                        {
                          "accountId": "91c6769dcb61767289208a454930c7b7",
                          "accountIdx": "1",
                          "reviewed": true,
                          "note": "Not connected to pch"
                        },
                        {
                          "accountId": "4c82630f5b8bccce242ff3fbb4740b8d",
                          "accountIdx": "2",
                          "reviewed": true,
                          "note": "Clients main account"
                        },
                        {
                          "accountId": "071fc97cd0cf36290a519783bb8f1114",
                          "accountIdx": "3",
                          "reviewed": true,
                          "note": "Clients savings account"
                        },
                        {
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "accountIdx": "4",
                          "reviewed": true,
                          "note": "found and linked salary transactions"
                        }
                      ]
                    },
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-11T12:04:32.129Z",
                    "_id": "UG17nnZ",
                    "notes": {
                      "timestamp": "2025-11-11T12:04:31.061Z",
                      "fundingMethods": [
                        {
                          "fundType": "fund:gift",
                          "fundIdx": "2",
                          "note": "",
                          "transactionMarkers": {
                            "d5fdf791a4294d42275adabc74e82413": "rejected",
                            "ee587010c1a76619f7888e7448df3dac": "rejected"
                          },
                          "redFlags": [],
                          "verified": []
                        }
                      ],
                      "chains": [],
                      "property": {
                        "reviewed": true,
                        "note": "All match our details"
                      },
                      "bankAnalysisItems": [
                        {
                          "type": "repeating-group",
                          "flag": "",
                          "comment": "Credit card payments",
                          "groupIndex": 3
                        },
                        {
                          "type": "repeating-group",
                          "flag": "",
                          "comment": "current rent",
                          "groupIndex": 5
                        },
                        {
                          "type": "repeating-group",
                          "flag": "",
                          "comment": "Suspicious payment",
                          "groupIndex": 7
                        }
                      ],
                      "transactions": [
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "0da74102e67736d0d00b6ba34242ccf7"
                        },
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "5c649b28a5641841b68b2bab28d23d05"
                        },
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "e3349fb77f4ca0852d5bd241627a8aad"
                        },
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "04c554385e5106117f24163d80f2a849"
                        },
                        {
                          "linkedToFunds": [
                            "4"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "e86445c66a21cf38609e252ea5d45add"
                        }
                      ],
                      "accounts": [
                        {
                          "accountId": "6d7afbac29de4842775ee1763b86fc68",
                          "accountIdx": "0",
                          "reviewed": true,
                          "note": "not connected to purchase"
                        },
                        {
                          "accountId": "91c6769dcb61767289208a454930c7b7",
                          "accountIdx": "1",
                          "reviewed": true,
                          "note": "Not connected to pch"
                        },
                        {
                          "accountId": "4c82630f5b8bccce242ff3fbb4740b8d",
                          "accountIdx": "2",
                          "reviewed": true,
                          "note": "Clients main account"
                        },
                        {
                          "accountId": "071fc97cd0cf36290a519783bb8f1114",
                          "accountIdx": "3",
                          "reviewed": true,
                          "note": "Clients savings account"
                        },
                        {
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "accountIdx": "4",
                          "reviewed": true,
                          "note": "found and linked salary transactions"
                        }
                      ]
                    },
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-09T21:09:58.395Z",
                    "_id": "FBJNd5P",
                    "notes": {
                      "timestamp": "2025-11-09T21:09:56.575Z",
                      "fundingMethods": [
                        {
                          "fundType": "fund:savings",
                          "fundIdx": "1",
                          "note": "",
                          "transactionMarkers": {},
                          "redFlags": [
                            {
                              "flagIdx": "1",
                              "status": "dismissed",
                              "note": "Revieiwed and found salary transactions"
                            }
                          ],
                          "verified": [
                            "savings_statements",
                            "savings_balance",
                            "savings_income"
                          ]
                        },
                        {
                          "fundType": "fund:gift",
                          "fundIdx": "2",
                          "note": "",
                          "transactionMarkers": {
                            "d5fdf791a4294d42275adabc74e82413": "rejected",
                            "ee587010c1a76619f7888e7448df3dac": "rejected"
                          },
                          "redFlags": [],
                          "verified": []
                        }
                      ],
                      "chains": [],
                      "property": null,
                      "transactions": [
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "0da74102e67736d0d00b6ba34242ccf7"
                        },
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "5c649b28a5641841b68b2bab28d23d05"
                        },
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "e3349fb77f4ca0852d5bd241627a8aad"
                        },
                        {
                          "linkedToFunds": [
                            "1"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "04c554385e5106117f24163d80f2a849"
                        },
                        {
                          "linkedToFunds": [
                            "4"
                          ],
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "note": "",
                          "flag": "linked",
                          "txId": "e86445c66a21cf38609e252ea5d45add"
                        }
                      ],
                      "accounts": [
                        {
                          "accountId": "6f1032d40aa61c12cec47fe3295d6a22",
                          "accountIdx": "4",
                          "reviewed": true,
                          "note": "found and linked salary transactions"
                        }
                      ]
                    },
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-09T12:41:17.744Z",
                    "_id": "xa44wBD",
                    "notes": {
                      "fundingMethods": [
                        {
                          "fundType": "fund:mortgage",
                          "fundIdx": "0",
                          "note": "Checked mortgage offer and confirmed with provider",
                          "transactionMarkers": {},
                          "redFlags": [],
                          "verified": [
                            "mortgage_offer",
                            "mortgage_affordability"
                          ]
                        },
                        {
                          "fundType": "fund:savings",
                          "fundIdx": "1",
                          "note": "",
                          "transactionMarkers": {},
                          "redFlags": [
                            {
                              "flagIdx": "0",
                              "status": "confirmed",
                              "note": "Need to obtain further proof of savings held"
                            }
                          ],
                          "verified": []
                        },
                        {
                          "fundType": "fund:gift",
                          "fundIdx": "2",
                          "note": "",
                          "transactionMarkers": {
                            "d5fdf791a4294d42275adabc74e82413": "rejected",
                            "ee587010c1a76619f7888e7448df3dac": "rejected"
                          },
                          "redFlags": [
                            {
                              "flagIdx": "0",
                              "status": "confirmed",
                              "note": "Need to coduct AML & SOF on gifter"
                            }
                          ],
                          "verified": [
                            "gift_relationship"
                          ]
                        },
                        {
                          "fundType": "fund:sale:property",
                          "fundIdx": "3",
                          "note": "we acted in the sale under 50/998",
                          "transactionMarkers": {},
                          "redFlags": [],
                          "verified": [
                            "sale_documents",
                            "sale_proceeds"
                          ]
                        },
                        {
                          "fundType": "fund:sale:assets",
                          "fundIdx": "4",
                          "note": "reviewed sale invoice and payment confirmation",
                          "transactionMarkers": {},
                          "redFlags": [],
                          "verified": [
                            "sale_documents",
                            "sale_proceeds"
                          ]
                        },
                        {
                          "fundType": "fund:htb",
                          "fundIdx": "5",
                          "note": "funds recieved into client account from LISA",
                          "transactionMarkers": {},
                          "redFlags": [],
                          "verified": [
                            "generic_verified"
                          ]
                        },
                        {
                          "fundType": "fund:inheritance",
                          "fundIdx": "6",
                          "note": "we acted in the estate 2 years ago",
                          "transactionMarkers": {},
                          "redFlags": [],
                          "verified": [
                            "generic_verified"
                          ]
                        }
                      ],
                      "chains": [],
                      "transactions": [],
                      "timestamp": "2025-11-09T12:41:17.226Z"
                    },
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  }
                ],
                "initiatedAt": "2025-11-06T17:58:26.507Z",
                "pdfS3Key": "protected/lXlh3Yd",
                "consumerName": "Jacob Robert Moran",
                "tasks": [
                  "documents:poa",
                  "report:sof-v1",
                  "report:bank-statement",
                  "report:bank-summary"
                ],
                "updates": [
                  {
                    "timestamp": "2025-11-06T17:58:26.507Z",
                    "update": "Electronic ID check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-06T18:06:27.223Z",
                    "update": "Transaction completed - awaiting PDF"
                  },
                  {
                    "timestamp": "2025-11-06T18:07:35.445Z",
                    "update": "PDF received and uploaded to S3 - CLEAR"
                  },
                  {
                    "timestamp": "2025-11-09T21:09:58.395Z",
                    "update": "SoF investigation notes added by jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-11T12:04:32.129Z",
                    "update": "SoF investigation notes added by jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-11T15:08:35.483Z",
                    "update": "SoF investigation notes added by jacob.archer-moran"
                  }
                ],
                "status": "closed",
                "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                "piiData": {
                  "name": {},
                  "address": {},
                  "document": {}
                },
                "hasMonitoring": false,
                "redFlags": [
                  {
                    "description": "Gifts Received",
                    "supporting_data": "1 gift received - &#xA3;10,000.00",
                    "threshold_amount": "Any gifts flagged",
                    "source": "Source of Funds"
                  },
                  {
                    "description": "Declared savings > actual savings",
                    "declared": "&#xA3;20,000.00",
                    "actual": "&#xA3;253.71",
                    "source": "Bank Linking"
                  }
                ],
                "thirdfortResponse": {
                  "name": "Purchase of 21 Green Lane",
                  "request": {
                    "actor": {
                      "name": "Jacob Robert Moran",
                      "phone": "+447506430094"
                    },
                    "tasks": [
                      {
                        "type": "documents:poa"
                      },
                      {
                        "type": "report:sof-v1"
                      },
                      {
                        "type": "report:bank-statement"
                      },
                      {
                        "type": "report:bank-summary"
                      }
                    ]
                  },
                  "ref": "21 Green Lane",
                  "id": "d46e3ge23amg030rw8y0",
                  "reports": [],
                  "status": "open",
                  "metadata": {
                    "notify": {
                      "type": "http",
                      "data": {
                        "hmac_key": "GgUi5IyCFm4TOsMy3Q4cvq6bnQEBJq/0uRqECCRoz+4=",
                        "method": "POST",
                        "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                      }
                    },
                    "created_by": "d3t0auq9io6g00ak3kkg",
                    "print": {
                      "team": "Cashiers",
                      "tenant": "Thurstan Hoskin Solicitors LLP",
                      "user": "THS Bot"
                    },
                    "context": {
                      "gid": "d3t2k5a9io6g00ak3km0",
                      "uid": "d3t0auq9io6g00ak3kkg",
                      "team_id": "d3t2k5a9io6g00ak3km0",
                      "tenant_id": "d3t2ifa9io6g00ak3klg"
                    },
                    "ce": {
                      "uri": "/v1/checks/4151797881"
                    },
                    "created_at": "2025-11-06T17:58:24.527Z"
                  },
                  "type": "v2",
                  "opts": {}
                },
                "hasAlerts": false,
                "pdfAddedAt": "2025-11-06T18:07:35.445Z",
                "smsSent": true,
                "transactionId": "d46e3ge23amg030rw8y0"
            },
            {
                "updatedAt": "2025-11-06T17:57:36.875Z",
                "consumerPhone": "+447506430094",
                "checkType": "electronic-id",
                "initiatedAt": "2025-11-06T17:32:25.039Z",
                "consumerName": "Jacob Robert Moran",
                "tasks": [
                  "report:footprint",
                  "documents:poa",
                  "report:sof-v1",
                  "report:bank-statement",
                  "report:bank-summary"
                ],
                "updates": [
                  {
                    "timestamp": "2025-11-06T17:32:25.039Z",
                    "update": "Electronic ID check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-06T17:57:29.081Z",
                    "update": "Check aborted by jacob.archer-moran@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-06T17:57:36.875Z",
                    "update": "Transaction aborted"
                  }
                ],
                "status": "aborted",
                "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                "hasMonitoring": false,
                "thirdfortResponse": {
                  "name": "Purchase of 21 Green Lane",
                  "request": {
                    "actor": {
                      "name": "Jacob Robert Moran",
                      "phone": "+447506430094"
                    },
                    "tasks": [
                      {
                        "opts": {
                          "consent": false
                        },
                        "type": "report:footprint"
                      },
                      {
                        "type": "documents:poa"
                      },
                      {
                        "type": "report:sof-v1"
                      },
                      {
                        "type": "report:bank-statement"
                      },
                      {
                        "type": "report:bank-summary"
                      }
                    ]
                  },
                  "ref": "21 Green Lane",
                  "id": "d46dq9x23amg030rw80g",
                  "reports": [],
                  "status": "open",
                  "metadata": {
                    "notify": {
                      "type": "http",
                      "data": {
                        "hmac_key": "GgUi5IyCFm4TOsMy3Q4cvq6bnQEBJq/0uRqECCRoz+4=",
                        "method": "POST",
                        "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                      }
                    },
                    "created_by": "d3t0auq9io6g00ak3kkg",
                    "print": {
                      "team": "Cashiers",
                      "tenant": "Thurstan Hoskin Solicitors LLP",
                      "user": "THS Bot"
                    },
                    "context": {
                      "gid": "d3t2k5a9io6g00ak3km0",
                      "uid": "d3t0auq9io6g00ak3kkg",
                      "team_id": "d3t2k5a9io6g00ak3km0",
                      "tenant_id": "d3t2ifa9io6g00ak3klg"
                    },
                    "ce": {
                      "uri": "/v1/checks/4151797880"
                    },
                    "created_at": "2025-11-06T17:32:23.745Z"
                  },
                  "type": "v2",
                  "opts": {}
                },
                "smsSent": true,
                "transactionId": "d46dq9x23amg030rw80g"
            },
            // Mock Check 7: Se Idris Stewart - Electronic ID - PENDING
            {
                "consumerPhone": "+447493580033",
                "checkType": "electronic-id",
                "initiatedAt": "2025-11-06T16:37:23.440Z",
                "consumerName": "Se Idris Stewart",
                "tasks": [
                  "report:identity",
                  "report:footprint",
                  "report:peps",
                  "documents:poa",
                  "report:sof-v1",
                  "report:bank-statement",
                  "report:bank-summary"
                ],
                "updates": [
                  {
                    "timestamp": "2025-11-06T16:37:23.440Z",
                    "update": "Electronic ID check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                  }
                ],
                "status": "open",
                "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                "hasMonitoring": true,
                "thirdfortResponse": {
                  "name": "Purchase of 21 Green Lane",
                  "request": {
                    "actor": {
                      "name": "Se Idris Stewart",
                      "phone": "+447493580033"
                    },
                    "tasks": [
                      {
                        "opts": {
                          "nfc": "preferred"
                        },
                        "type": "report:identity"
                      },
                      {
                        "opts": {
                          "consent": false
                        },
                        "type": "report:footprint"
                      },
                      {
                        "opts": {
                          "monitored": true
                        },
                        "type": "report:peps"
                      },
                      {
                        "type": "documents:poa"
                      },
                      {
                        "type": "report:sof-v1"
                      },
                      {
                        "type": "report:bank-statement"
                      },
                      {
                        "type": "report:bank-summary"
                      }
                    ]
                  },
                  "ref": "21 Green Lane",
                  "id": "d46cxge23amg030rw7r0",
                  "reports": [],
                  "status": "open",
                  "metadata": {
                    "notify": {
                      "type": "http",
                      "data": {
                        "hmac_key": "0mF1p3cyDWZ51HIsGXPecer4a7uFQIXBk0JLO56Wr0U=",
                        "method": "POST",
                        "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                      }
                    },
                    "created_by": "d3t0auq9io6g00ak3kkg",
                    "print": {
                      "team": "Cashiers",
                      "tenant": "Thurstan Hoskin Solicitors LLP",
                      "user": "THS Bot"
                    },
                    "context": {
                      "gid": "d3t2k5a9io6g00ak3km0",
                      "uid": "d3t0auq9io6g00ak3kkg",
                      "team_id": "d3t2k5a9io6g00ak3km0",
                      "tenant_id": "d3t2ifa9io6g00ak3klg"
                    },
                    "ce": {
                      "uri": "/v1/checks/4151797877"
                    },
                    "created_at": "2025-11-06T16:37:19.858Z"
                  },
                  "type": "v2",
                  "opts": {
                    "peps": {
                      "monitored": true
                    }
                  }
                },
                "smsSent": true,
                "transactionId": "d46cxge23amg030rw7r0"
            },
            // Mock Check 8: Jacob Robert Archer-Moran - IDV - COMPLETED
            {
                "taskOutcomes": {
                  "identity:lite": {
                    "breakdown": {
                      "document": {
                        "name": "document",
                        "breakdown": {
                          "compromised_document": {
                            "result": "clear"
                          },
                          "data_consistency": {
                            "breakdown": {
                              "first_name": {
                                "properties": {},
                                "result": "clear"
                              },
                              "date_of_expiry": {
                                "properties": {},
                                "result": "clear"
                              },
                              "date_of_birth": {
                                "properties": {},
                                "result": "clear"
                              },
                              "last_name": {
                                "properties": {},
                                "result": "clear"
                              },
                              "nationality": {
                                "properties": {},
                                "result": "clear"
                              },
                              "issuing_country": {
                                "properties": {},
                                "result": "clear"
                              },
                              "document_numbers": {
                                "properties": {},
                                "result": "clear"
                              },
                              "document_type": {
                                "properties": {},
                                "result": "clear"
                              },
                              "gender": {
                                "properties": {},
                                "result": "consider"
                              }
                            },
                            "result": "consider"
                          },
                          "data_comparison": {
                            "breakdown": {
                              "first_name": {
                                "properties": {},
                                "result": "clear"
                              },
                              "date_of_expiry": {
                                "properties": {},
                                "result": "clear"
                              },
                              "date_of_birth": {
                                "properties": {},
                                "result": "clear"
                              },
                              "last_name": {
                                "properties": {},
                                "result": "clear"
                              },
                              "issuing_country": {
                                "properties": {},
                                "result": "clear"
                              },
                              "document_numbers": {
                                "properties": {},
                                "result": "clear"
                              },
                              "document_type": {
                                "properties": {},
                                "result": "clear"
                              },
                              "gender": {
                                "properties": {},
                                "result": "clear"
                              }
                            },
                            "result": "clear"
                          },
                          "data_validation": {
                            "breakdown": {
                              "mrz": {
                                "properties": {},
                                "result": "clear"
                              },
                              "date_of_birth": {
                                "properties": {},
                                "result": "clear"
                              },
                              "document_numbers": {
                                "properties": {},
                                "result": "clear"
                              },
                              "expiry_date": {
                                "properties": {},
                                "result": "clear"
                              },
                              "document_expiration": {
                                "properties": {},
                                "result": "clear"
                              },
                              "gender": {
                                "properties": {},
                                "result": "clear"
                              }
                            },
                            "result": "clear"
                          },
                          "image_integrity": {
                            "breakdown": {
                              "colour_picture": {
                                "properties": {},
                                "result": "clear"
                              },
                              "conclusive_document_quality": {
                                "properties": {},
                                "result": "clear"
                              },
                              "image_quality": {
                                "properties": {},
                                "result": "clear"
                              },
                              "supported_document": {
                                "properties": {},
                                "result": "clear"
                              }
                            },
                            "result": "clear"
                          },
                          "visual_authenticity": {
                            "breakdown": {
                              "face_detection": {
                                "properties": {},
                                "result": "clear"
                              },
                              "fonts": {
                                "properties": {},
                                "result": "clear"
                              },
                              "picture_face_integrity": {
                                "properties": {},
                                "result": "clear"
                              },
                              "original_document_present": {
                                "properties": {},
                                "result": "clear"
                              },
                              "security_features": {
                                "properties": {},
                                "result": "clear"
                              },
                              "digital_tampering": {
                                "properties": {},
                                "result": "clear"
                              },
                              "template": {
                                "properties": {},
                                "result": "clear"
                              },
                              "other": {
                                "properties": {},
                                "result": "clear"
                              }
                            },
                            "result": "clear"
                          },
                          "age_validation": {
                            "breakdown": {
                              "minimum_accepted_age": {
                                "properties": {},
                                "result": "clear"
                              }
                            },
                            "result": "clear"
                          },
                          "police_record": {
                            "result": "clear"
                          }
                        },
                        "result": "clear",
                        "documents": [
                          {
                            "id": "15c3d5a5-27fe-4205-8d1e-993bdd12425f"
                          }
                        ],
                        "id": "1c6010af-de27-438f-b4fe-2925922d9233",
                        "properties": {
                          "first_name": "Jacob",
                          "date_of_expiry": "2031-05-28",
                          "issuing_date": "2018-08-16",
                          "date_of_birth": "1990-01-01",
                          "last_name": "Moran",
                          "nationality": null,
                          "issuing_country": "GBR",
                          "document_numbers": [
                            {
                              "type": "document_number",
                              "value": "999999999"
                            }
                          ],
                          "document_type": "passport",
                          "gender": null
                        },
                        "status": "complete",
                        "created_at": "2025-11-06T14:24:13Z",
                        "href": "/v3.6/reports/1c6010af-de27-438f-b4fe-2925922d9233",
                        "sub_result": "clear"
                      }
                    },
                    "data": {
                      "name": {
                        "first": "Jacob",
                        "last": "Moran",
                        "other": "Robert"
                      }
                    },
                    "result": "clear",
                    "documents": [
                      "d46az5m23amg030rw7e0"
                    ],
                    "id": "d46az5423amg030rw7d0",
                    "status": "closed",
                    "createdAt": "2025-11-06T14:24:20.118Z"
                  }
                },
                "updatedAt": "2025-11-06T14:24:24.286Z",
                "pdfReady": true,
                "checkType": "idv",
                "completedAt": "2025-11-06T14:24:24.286Z",
                "documentsUploaded": true,
                "initiatedAt": "2025-11-06T14:24:07.606Z",
                "pdfS3Key": "protected/T0pW749",
                "updates": [
                  {
                    "timestamp": "2025-11-06T14:24:07.606Z",
                    "update": "IDV check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-06T14:24:12.835Z",
                    "update": "Documents uploaded by jacob.archer-moran@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-06T14:24:24.286Z",
                    "update": "Check completed - awaiting PDF"
                  },
                  {
                    "timestamp": "2025-11-06T14:24:41.148Z",
                    "update": "PDF received and uploaded to S3 - CLEAR"
                  }
                ],
                "status": "closed",
                "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                "documentType": "passport",
                "hasMonitoring": false,
                "thirdfortResponse": {
                  "name": "Jacob Robert Moran - Document Verification",
                  "request": {
                    "data": {
                      "name": {
                        "first": "Jacob",
                        "last": "Moran",
                        "other": "Robert"
                      }
                    },
                    "reports": [
                      {
                        "type": "identity:lite"
                      }
                    ]
                  },
                  "ref": "50/52",
                  "id": "d46az1c23amg030rw740",
                  "reports": [],
                  "status": "open",
                  "metadata": {
                    "notify": {
                      "type": "http",
                      "data": {
                        "hmac_key": "Ues4QT63f9iE7YP6/AEgfV0oAxPz9ewWRrBNN2+XrfI=",
                        "method": "POST",
                        "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                      }
                    },
                    "created_by": "d3t2m5q9io6g00ak3kmg",
                    "print": {
                      "team": "Cashiers",
                      "tenant": "Thurstan Hoskin Solicitors LLP",
                      "user": "Jacob Archer-Moran"
                    },
                    "context": {
                      "gid": "d3t2k5a9io6g00ak3km0",
                      "uid": "d3t2m5q9io6g00ak3kmg",
                      "team_id": "d3t2k5a9io6g00ak3km0",
                      "tenant_id": "d3t2ifa9io6g00ak3klg"
                    },
                    "ce": {
                      "uri": "/v1/checks/4151797872"
                    },
                    "created_at": "2025-11-06T14:24:05.185Z"
                  },
                  "type": "document"
                },
                "companyData": {
                  "name": {
                    "first": "Jacob",
                    "last": "Moran",
                    "other": "Robert"
                  },
                  "numbers": []
                },
                "checkId": "d46az1c23amg030rw740",
                "hasAlerts": false,
                "pdfAddedAt": "2025-11-06T14:24:41.148Z"
            },
            // Mock Check 9: Jacob Robert Archer-Moran - Lite Screen - COMPLETED
            {
                "taskOutcomes": {
                  "address": {
                    "result": "fail",
                    "status": "closed",
                    "data": {
                      "quality": 0
                    }
                  },
                  "peps": {
                    "breakdown": {
                      "total_hits": 2,
                      "hits": [
                        {
                          "name": "Jake Moran",
                          "assets": [],
                          "dob": {
                            "main": "",
                            "other": []
                          },
                          "score": 0.1,
                          "flag_types": [
                            "adverse-media",
                            "adverse-media-violent-crime"
                          ],
                          "source_notes": {
                            "complyadvantage-adverse-media": {
                              "aml_types": [
                                "adverse-media",
                                "adverse-media-violent-crime"
                              ],
                              "country_codes": [
                                "US"
                              ],
                              "name": "ComplyAdvantage Adverse Media"
                            }
                          },
                          "institutions": [],
                          "spouses": [],
                          "political_positions": [],
                          "countries": [
                            "United States"
                          ],
                          "aka": [
                            "Jake Moran"
                          ],
                          "id": "CPPFOJFI8OCU4PE",
                          "match_types": [
                            "equivalent_name",
                            "name_variations_removal"
                          ],
                          "roles": [],
                          "fields": [
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "United States"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "United States"
                            },
                            {
                              "name": "Countries",
                              "source": "",
                              "value": "United States"
                            }
                          ],
                          "media": [
                            {
                              "date": "2014-05-21T00:00:00Z",
                              "snippet": "But after suffering a gut-wrenching 29-27, 20-25, 29-27 setback to the Redwings, the RedHawks rebounded to take down St. Patrick (25-19, 25-22) in another conference clash. Spearheading Marist's winning effort was Jake Moran, who registered five kills and six digs. Tom Inzinga equaled Moran's kill total, while Nick O'Gorman chipped in four kills and a service ace.",
                              "title": "Community sports news - Southwest Community Publishing",
                              "url": "https://www.southwestregionalpublishing.com/2014/05/21/community-sports-news-05-21-14-2/"
                            },
                            {
                              "date": "2016-05-21T00:00:00Z",
                              "snippet": "The best challenge to the Patriot stronghold, as evidenced this weekend, is O'Gorman, which took four of six heads-up championship matches against Lincoln. Sam Heckman (Flight 3), Jake Moran (Flight 4) and Michael Yousef (Flight 6) all racked up singles titles, while Flight 2 runner-up Wil McDowell and Heckman took home the Flight 2 doubles crown. \"They performed like I thought they would, and also expected,\" said Coach Don Barnes.",
                              "title": "Lincoln caps third straight tennis title",
                              "url": "https://www.argusleader.com/story/sports/high-school-sports/2016/05/21/midst-dynasty---lincoln-caps-third-straight-title/84666134/"
                            }
                          ],
                          "associates": []
                        },
                        {
                          "name": "Jacob Moran",
                          "assets": [],
                          "dob": {
                            "main": "",
                            "other": []
                          },
                          "score": 0.1,
                          "flag_types": [
                            "adverse-media",
                            "adverse-media-general",
                            "adverse-media-violent-crime"
                          ],
                          "source_notes": {
                            "complyadvantage-adverse-media": {
                              "aml_types": [
                                "adverse-media",
                                "adverse-media-general",
                                "adverse-media-violent-crime"
                              ],
                              "country_codes": [
                                "CA",
                                "US"
                              ],
                              "name": "ComplyAdvantage Adverse Media"
                            }
                          },
                          "institutions": [],
                          "spouses": [],
                          "political_positions": [],
                          "countries": [
                            "Canada",
                            "United States"
                          ],
                          "aka": [
                            "Jacob Benning Moran",
                            "Jacob Moran"
                          ],
                          "id": "5F0CGJUQGD3KXR6",
                          "match_types": [
                            "aka_exact",
                            "name_variations_removal"
                          ],
                          "roles": [],
                          "fields": [
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "Canada"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "Canada, United States"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "United States"
                            },
                            {
                              "name": "Countries",
                              "source": "",
                              "value": "Canada, United States"
                            }
                          ],
                          "media": [
                            {
                              "date": "0001-01-01T00:00:00Z",
                              "snippet": "GPD is in direct communication with the Michigan State Police and are working with them on the case following his capture, the agency said.<\\/p>\\n Shortly after GPD announced that Jacob Moran was in custody, the Johnson County Coroner\\u2019s Office formally identified Shaun Moran as the man who was killed in the shooting. The office ruled his death as homicide caused by a single gunshot wound.<\\/p>\\n",
                              "title": "(no title)",
                              "url": "https://dailyjournal.net/wp-json/wp/v2/posts/1816390"
                            },
                            {
                              "date": "2021-03-01T00:00:00Z",
                              "snippet": "They detained Moran and learned he had urinated on a tire of the car. \"Moran was heavily intoxicated on marijuana. He was arrested for prowling, public urination and public intoxication,\" police said.",
                              "title": "530 Crime Watch: Man tried to rob bank across street from police station",
                              "url": "https://www.usatoday.com/story/news/local/2021/03/01/530-crime-watch-arrest-jail-redding-police-shasta-sheriff/6870286002/?gnt-cfr=1"
                            },
                            {
                              "date": "2023-08-29T00:00:00Z",
                              "snippet": "Court documents show that Jacob Moran had allegedly assaulted his father twice in the hours before the shooting. Jacob Moran was charged Tuesday with residential entry, a Level 6 felony, and two counts of domestic battery both as a Level 6 felony and a misdemeanor, for the incidents. Charges for the shooting have not yet been filed.",
                              "title": "Greenwood domestic dispute ends in fatal shooting - Daily Journal",
                              "url": "https://dailyjournal.net/2023/08/29/greenwood-domestic-dispute-ends-in-fatal-shooting/"
                            },
                            {
                              "date": "2024-11-15T00:00:00Z",
                              "snippet": "Jacob Moran had been staying at his father's home but had reportedly been causing issues and been asked to leave the home. After being asked to leave the first time, Jacob Moran allegedly assaulted his father, leading to police being called. Later that day, he returned and again allegedly assaulted Shaun Moran, according to court documents.",
                              "title": "Greenwood man convicted of murder of father following domestic dispute - Daily Journal",
                              "url": "https://dailyjournal.net/2024/11/15/greenwood-man-convicted-of-murder-of-father-following-domestic-dispute/"
                            },
                            {
                              "date": "2023-09-07T00:00:00Z",
                              "snippet": "The gun's serial number was a match to the gun box that was found in the garage, court documents show. Jacob Moran was then arrested and taken to a Sturgis, Michigan jail on a charge of possession of an unregistered handgun. The BMW was impounded, court documents say.",
                              "title": "Greenwood man, 22, charged with his father's murder - Daily Journal",
                              "url": "https://dailyjournal.net/2023/09/07/greenwood-man-22-charged-with-his-fathers-murder/"
                            },
                            {
                              "date": "0001-01-01T00:00:00Z",
                              "snippet": "As deputies attempted to place Moran into custody for his warrant, Moran began to physically resist deputies. While resisting, Moran twice attempted to unholster a deputy's service firearm. After a brief struggle, Moran was arrested and then booked into the Humboldt County Correctional Facility on fresh charges of attempting to remove a peace officer's firearm (PC 148(d)) and resisting a peace officer (PC 148(a)(1)), in addition to his warrant charges of assault (PC 240) and battery (PC 242).",
                              "title": "News Flash &#x2022; County of Humboldt &#x2022; CivicEngage",
                              "url": "https://humboldtgov.org/CivicAlerts.aspx?AID=4279"
                            },
                            {
                              "date": "2021-03-26T00:00:00Z",
                              "snippet": "They immediately detained Moran and learned he urinated on a tire of the same car. Moran was \"heavily intoxicated on marijuana,\" and was ultimately arrested for public intoxication, public urination, and prowling.",
                              "title": "Officers arrest prowler looking inside, and urinating on, a vehicle in Redding on Friday",
                              "url": "https://krcrtv.com/news/local/bicycle-officers-catch-prowler-looking-inside-cars-in-redding-on-friday"
                            },
                            {
                              "date": "2015-04-01T00:00:00Z",
                              "snippet": "Moran then emerged, ran toward the plaintiff, and punched him. The officers arrested Moran. The plaintiff commenced this action against, among others, the defendant City of New York, alleging that the officers were negligent in failing to protect the plaintiff.",
                              "title": "PHILIP v. MORAN | 127 A.D.3d 717 (2015) | 20150401440 | Leagle.com",
                              "url": "https://www.leagle.com/decision/innyco20150401440"
                            },
                            {
                              "date": "2023-08-29T00:00:00Z",
                              "snippet": "When they arrived they found, Shaun Moran dead of an apparent gunshot wound in the home's garage, police say. Police say Jacob Moran is suspect in the shooting. It was reported that he was angry with Shaun Moran about being told to move out of the home, according to the news release.",
                              "title": "UPDATE: Suspect in custody after deadly Greenwood shooting - Daily Journal",
                              "url": "https://dailyjournal.net/2023/08/29/update-suspect-in-custody-after-deadly-greenwood-shooting/"
                            },
                            {
                              "date": "2021-10-13T00:00:00Z",
                              "snippet": "16 p.m., Humboldt County Sheriff's deputies on patrol in the 2400 block of Myrtle Avenue observed a suspicious male exhibiting behavior consistent with attempting a car burglary. Deputies contacted the man, 20-year-old Jacob Benning Moran, and learned that Moran had an outstanding misdemeanor warrant for his arrest. As deputies attempted to place Moran into custody for his warrant, Moran began to physically resist deputies.",
                              "title": "Warrant suspect tries to grab deputy's gun during arrest in Myrtletown, HCSO says",
                              "url": "https://krcrtv.com/north-coast-news/eureka-local-news/warrant-suspect-tries-to-grab-deputys-gun-during-arrest-in-myrtletown-hcso-says"
                            }
                          ],
                          "associates": []
                        }
                      ]
                    },
                    "data": {
                      "dob": "2001-01-11T00:00:00.000Z",
                      "name": {
                        "first": "Jacob",
                        "last": "Moran",
                        "other": "Robert"
                      },
                      "address": {
                        "postcode": "TR15 2ND",
                        "country": "GBR",
                        "building_name": "94",
                        "street": "Southgate Street",
                        "building_number": "94",
                        "town": "Redruth"
                      }
                    },
                    "result": "consider",
                    "documents": [],
                    "id": "d46dq0m23amg030rw7y0",
                    "status": "closed",
                    "createdAt": "2025-11-06T17:31:46.879Z"
                  },
                  "footprint": {
                    "breakdown": {
                      "data_count": {
                        "properties": {
                          "score": 0
                        },
                        "result": "consider"
                      },
                      "data_quality": {
                        "properties": {
                          "score": 0
                        },
                        "result": "consider"
                      },
                      "rules": [
                        {
                          "id": "U000",
                          "name": "",
                          "score": 0,
                          "text": "No trace of supplied Address(es), or manual Authentication required by the Applicant"
                        }
                      ],
                      "service_name": "Authenticateplus"
                    },
                    "data": {
                      "address": {
                        "postcode": "TR15 2ND",
                        "country": "GBR",
                        "building_name": "94",
                        "street": "Southgate Street",
                        "building_number": "94",
                        "town": "Redruth"
                      },
                      "dob": "2001-01-11T00:00:00.000Z",
                      "name": {
                        "first": "Jacob",
                        "last": "Moran",
                        "other": "Robert"
                      }
                    },
                    "result": "fail",
                    "documents": [],
                    "id": "d46dpzv23amg030rw7w0",
                    "status": "closed",
                    "createdAt": "2025-11-06T17:31:43.354Z"
                  }
                },
                "updatedAt": "2025-11-06T17:31:53.390Z",
                "considerAnnotations": [
                  {
                    "timestamp": "2025-11-09T12:37:02.558Z",
                    "_id": "g22U9bn",
                    "newStatus": "clear",
                    "reason": "2 proof of address provided by client",
                    "originalStatus": "consider",
                    "taskType": "address",
                    "objectivePath": "address.data_count",
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  },
                  {
                    "timestamp": "2025-11-09T12:37:02.558Z",
                    "_id": "lglLjO5",
                    "newStatus": "clear",
                    "reason": "2 proof of address provided by client",
                    "originalStatus": "consider",
                    "taskType": "address",
                    "objectivePath": "address.data_quality",
                    "user": "jacob.archer-moran@thurstanhoskin.co.uk",
                    "userName": "jacob.archer-moran"
                  }
                ],
                "pdfReady": true,
                "checkType": "lite-screen",
                "completedAt": "2025-11-06T17:31:53.390Z",
                "initiatedAt": "2025-11-06T17:31:35.205Z",
                "considerReasons": [
                  "address verification",
                  "digital footprint",
                  "PEP hits"
                ],
                "pdfS3Key": "protected/EOk8JBq",
                "consumerName": "Jacob Moran",
                "tasks": [
                  "report:footprint",
                  "report:peps"
                ],
                "updates": [
                  {
                    "timestamp": "2025-11-06T17:31:35.205Z",
                    "update": "Lite Screen check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-06T17:31:53.390Z",
                    "update": "Transaction completed - awaiting PDF"
                  },
                  {
                    "timestamp": "2025-11-06T17:35:50.369Z",
                    "update": "PDF received and uploaded to S3 - CONSIDER: address verification, digital footprint, PEP hits"
                  },
                  {
                    "timestamp": "2025-11-06T17:35:52.182Z",
                    "update": "PEPs & Sanctions task completed"
                  },{
                    "timestamp": "2025-11-09T12:37:02.558Z",
                    "update": "2 consider annotations added by jacob.archer-moran"
                  }
                ],
                "status": "closed",
                "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                "piiData": {
                  "name": {
                    "first": "Jacob",
                    "last": "Moran",
                    "other": "Robert"
                  },
                  "address": {
                    "postcode": "TR15 2ND",
                    "country": "GBR",
                    "building_name": "94",
                    "street": "Southgate Street",
                    "building_number": "94",
                    "town": "Redruth"
                  },
                  "dob": "2001-01-11T00:00:00.000Z",
                  "document": {}
                },
                "hasMonitoring": true,
                "thirdfortResponse": {
                  "name": "Jacob Moran - Lite Screening",
                  "request": {
                    "tasks": [
                      {
                        "opts": {
                          "consent": false
                        },
                        "type": "report:footprint"
                      },
                      {
                        "opts": {
                          "monitored": true
                        },
                        "type": "report:peps"
                      }
                    ]
                  },
                  "ref": "21 Green Lane",
                  "id": "d46dpx323amg030rw7tg",
                  "reports": [],
                  "status": "open",
                  "metadata": {
                    "notify": {
                      "type": "http",
                      "data": {
                        "hmac_key": "GgUi5IyCFm4TOsMy3Q4cvq6bnQEBJq/0uRqECCRoz+4=",
                        "method": "POST",
                        "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                      }
                    },
                    "created_by": "d3t0auq9io6g00ak3kkg",
                    "print": {
                      "team": "Cashiers",
                      "tenant": "Thurstan Hoskin Solicitors LLP",
                      "user": "THS Bot"
                    },
                    "context": {
                      "gid": "d3t2k5a9io6g00ak3km0",
                      "uid": "d3t0auq9io6g00ak3kkg",
                      "team_id": "d3t2k5a9io6g00ak3km0",
                      "tenant_id": "d3t2ifa9io6g00ak3klg"
                    },
                    "ce": {
                      "uri": "/v1/checks/4151797879"
                    },
                    "created_at": "2025-11-06T17:31:31.840Z"
                  },
                  "type": "v2",
                  "opts": {
                    "peps": {
                      "monitored": true
                    }
                  }
                },
                "expectations": {
                  "name": {
                    "data": {
                      "first": "Jacob",
                      "last": "Moran",
                      "other": "Robert"
                    }
                  },
                  "dob": {
                    "data": "2001-01-11T00:00:00.000Z"
                  },
                  "address": {
                    "data": {
                      "postcode": "TR15 2ND",
                      "country": "GBR",
                      "building_name": "94",
                      "flat_number": "",
                      "street": "Southgate Street",
                      "building_number": "94",
                      "sub_street": "",
                      "town": "Redruth"
                    }
                  }
                },
                "hasAlerts": true,
                "pdfAddedAt": "2025-11-06T17:35:50.369Z",
                "transactionId": "d46dpx323amg030rw7tg"
            },
            // Mock Check 10: Nigel Farage - Lite Screen - COMPLETED
            {
                "taskOutcomes": {
                  "screening:lite": {
                    "breakdown": {
                      "total_hits": 2,
                      "hits": [
                        {
                          "name": "Farage Nigel",
                          "assets": [
                            {
                              "public_url": "http://complyadvantage-asset-development.s3.amazonaws.com/e0fe3b97-e0eb-448f-a61c-93a3111355a1.jpg",
                              "type": "picture"
                            },
                            {
                              "public_url": "http://complyadvantage-asset-development.s3.amazonaws.com/bc450214-b99b-4063-9546-9a06bfe0e74d.jpg",
                              "type": "picture"
                            },
                            {
                              "public_url": "http://complyadvantage-asset.s3.amazonaws.com/a0caf84e-0a3c-4dc6-89ee-b3e4db2fd3ac.pdf",
                              "type": "pdf"
                            }
                          ],
                          "dob": {
                            "main": "1964",
                            "other": [
                              "1964-04-03",
                              "1964-03-04"
                            ]
                          },
                          "score": 1,
                          "flag_types": [
                            "adverse-media",
                            "adverse-media-financial-crime",
                            "adverse-media-fraud",
                            "adverse-media-general",
                            "adverse-media-narcotics",
                            "adverse-media-sexual-crime",
                            "adverse-media-terrorism",
                            "adverse-media-violent-crime",
                            "pep",
                            "pep-class-1",
                            "pep-class-2",
                            "pep-class-4"
                          ],
                          "source_notes": {
                            "united-kingdom-political-parties-leadership": {
                              "aml_types": [
                                "pep-class-1"
                              ],
                              "country_codes": [
                                "GB"
                              ],
                              "name": "United Kingdom Political Parties Leadership"
                            },
                            "united-kingdom-elected-parliament": {
                              "aml_types": [
                                "pep-class-1"
                              ],
                              "country_codes": [
                                "GB"
                              ],
                              "name": "United Kingdom Elected Parliament"
                            },
                            "complyadvantage": {
                              "aml_types": [
                                "pep-class-1",
                                "pep-class-2",
                                "pep-class-4"
                              ],
                              "country_codes": [
                                "GB"
                              ],
                              "name": "ComplyAdvantage PEP Data"
                            },
                            "complyadvantage-adverse-media": {
                              "aml_types": [
                                "adverse-media",
                                "adverse-media-financial-crime",
                                "adverse-media-fraud",
                                "adverse-media-general",
                                "adverse-media-narcotics",
                                "adverse-media-sexual-crime",
                                "adverse-media-terrorism",
                                "adverse-media-violent-crime"
                              ],
                              "country_codes": [
                                "BR",
                                "ES",
                                "FR",
                                "GB",
                                "IR",
                                "LK"
                              ],
                              "name": "ComplyAdvantage Adverse Media"
                            },
                            "pep-european-parliament-meps": {
                              "aml_types": [
                                "pep-class-2"
                              ],
                              "country_codes": [
                                "GB"
                              ],
                              "name": "European Union Parliament Leadership"
                            },
                            "pep-uk-parliament": {
                              "aml_types": [
                                "pep-class-1"
                              ],
                              "country_codes": [
                                "GB"
                              ],
                              "name": "United Kingdom Parliament"
                            },
                            "company-am": {
                              "aml_types": [
                                "adverse-media",
                                "adverse-media-financial-crime",
                                "adverse-media-fraud",
                                "adverse-media-general"
                              ],
                              "country_codes": [
                                "BE",
                                "GB",
                                "JP",
                                "MT"
                              ],
                              "name": "company AM"
                            }
                          },
                          "political_positions": [
                            "Member of the European Parliament",
                            "Member of the European Parliament",
                            "Member of the National Legislature",
                            "Member of the National Legislature",
                            "Senior Political Party Official"
                          ],
                          "countries": [
                            "Belgium",
                            "Brazil",
                            "France",
                            "Iran",
                            "Japan",
                            "Malta",
                            "Spain",
                            "Sri Lanka",
                            "United Kingdom"
                          ],
                          "aka": [
                            "Farage",
                            "Nigel Farage",
                            "Nigel Farge",
                            "Modi Nigel Farage",
                            "Farage Nigel",
                            "Nigel Farange",
                            "Nigel Paul Farage"
                          ],
                          "id": "MBCV344J0BV3UD0",
                          "match_types": [
                            "name_exact",
                            "year_of_birth"
                          ],
                          "fields": [
                            {
                              "name": "Original Place of Birth Text",
                              "source": "pep-european-parliament-meps",
                              "value": "Farnborough"
                            },
                            {
                              "name": "Original Place of Birth Text",
                              "source": "complyadvantage",
                              "value": "Farnborough"
                            },
                            {
                              "name": "Country",
                              "source": "company-am",
                              "value": "Belgium"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "company-am",
                              "value": "Belgium, Malta, United Kingdom"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "Brazil"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "Brazil, Spain"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "France"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "France, Iran"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "Iran"
                            },
                            {
                              "name": "Country",
                              "source": "company-am",
                              "value": "Japan"
                            },
                            {
                              "name": "Country",
                              "source": "united-kingdom-elected-parliament",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "company-am",
                              "value": "Japan, United Kingdom"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "united-kingdom-elected-parliament",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Country",
                              "source": "company-am",
                              "value": "Malta"
                            },
                            {
                              "name": "Country",
                              "source": "pep-uk-parliament",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "pep-uk-parliament",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "Spain"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "Sri Lanka"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "Sri Lanka"
                            },
                            {
                              "name": "Country",
                              "source": "pep-european-parliament-meps",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage-adverse-media",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "pep-european-parliament-meps",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Country",
                              "source": "united-kingdom-political-parties-leadership",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "united-kingdom-political-parties-leadership",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage-adverse-media",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Country",
                              "source": "complyadvantage",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "complyadvantage",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Place of Birth",
                              "source": "pep-uk-parliament",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Original Place of Birth Text",
                              "source": "pep-uk-parliament",
                              "value": "Farnborough, Kent, England"
                            },
                            {
                              "name": "Active Start Date",
                              "source": "united-kingdom-elected-parliament",
                              "value": "2024-07-17"
                            },
                            {
                              "name": "Active Start Date",
                              "source": "pep-uk-parliament",
                              "value": "2024-06-03"
                            },
                            {
                              "name": "Date of Birth",
                              "source": "complyadvantage",
                              "value": "1964"
                            },
                            {
                              "name": "Date of Birth",
                              "source": "complyadvantage",
                              "value": "1964-04-03"
                            },
                            {
                              "name": "Country",
                              "source": "company-am",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Date of Birth",
                              "source": "pep-european-parliament-meps",
                              "value": "1964-03-04"
                            },
                            {
                              "name": "Date of Birth",
                              "source": "pep-uk-parliament",
                              "value": "1964-04-03"
                            },
                            {
                              "name": "Political Position",
                              "source": "pep-european-parliament-meps",
                              "value": "Member of the European Parliament"
                            },
                            {
                              "name": "Political Position",
                              "source": "complyadvantage",
                              "value": "Member of the European Parliament"
                            },
                            {
                              "name": "Political Position",
                              "source": "united-kingdom-elected-parliament",
                              "value": "Member of the National Legislature"
                            },
                            {
                              "name": "Political Position",
                              "source": "pep-uk-parliament",
                              "value": "Member of the National Legislature"
                            },
                            {
                              "name": "Date of Birth",
                              "source": "complyadvantage-adverse-media",
                              "value": "1964"
                            },
                            {
                              "name": "Political Position",
                              "source": "united-kingdom-political-parties-leadership",
                              "value": "Senior Political Party Official"
                            },
                            {
                              "name": "Additional Information",
                              "source": "complyadvantage",
                              "value": "A member of the European Parliament."
                            },
                            {
                              "name": "Chamber",
                              "source": "united-kingdom-elected-parliament",
                              "value": "Parliament"
                            },
                            {
                              "name": "Chamber",
                              "source": "pep-european-parliament-meps",
                              "value": "European Parliament"
                            },
                            {
                              "name": "Chamber",
                              "source": "pep-uk-parliament",
                              "value": "Parliament"
                            },
                            {
                              "name": "Chamber",
                              "source": "united-kingdom-political-parties-leadership",
                              "value": "Reform UK"
                            },
                            {
                              "name": "Chamber",
                              "source": "complyadvantage",
                              "value": "SURREY HEATH BOROUGH"
                            },
                            {
                              "name": "City",
                              "source": "complyadvantage",
                              "value": "Surrey"
                            },
                            {
                              "name": "Function",
                              "source": "united-kingdom-political-parties-leadership",
                              "value": "Leader"
                            },
                            {
                              "name": "Function",
                              "source": "united-kingdom-elected-parliament",
                              "value": "MPs"
                            },
                            {
                              "name": "Institution Type",
                              "source": "united-kingdom-elected-parliament",
                              "value": "National Bicameral Legislature"
                            },
                            {
                              "name": "Institution Type",
                              "source": "pep-uk-parliament",
                              "value": "National Bicameral Legislature"
                            },
                            {
                              "name": "Institution Type",
                              "source": "united-kingdom-political-parties-leadership",
                              "value": "Political Party"
                            },
                            {
                              "name": "Other Info",
                              "source": "pep-european-parliament-meps",
                              "value": "Non-attached Members"
                            },
                            {
                              "name": "Other Info",
                              "source": "united-kingdom-political-parties-leadership",
                              "value": "Officers"
                            },
                            {
                              "name": "Political Group",
                              "source": "complyadvantage",
                              "value": "Europe of Freedom and Direct Democracy Group"
                            },
                            {
                              "name": "Political Party",
                              "source": "united-kingdom-elected-parliament",
                              "value": "Reform UK"
                            },
                            {
                              "name": "Political Party",
                              "source": "pep-uk-parliament",
                              "value": "Reform UK"
                            },
                            {
                              "name": "Political Party",
                              "source": "pep-european-parliament-meps",
                              "value": "The Brexit Party"
                            },
                            {
                              "name": "Political Region",
                              "source": "united-kingdom-elected-parliament",
                              "value": "Clacton"
                            },
                            {
                              "name": "Political Region",
                              "source": "pep-uk-parliament",
                              "value": "Clacton"
                            },
                            {
                              "name": "Related URL",
                              "source": "complyadvantage",
                              "value": "http://surreyheath.moderngov.co.uk/mgMemberIndexMEP.aspx?bcr=7"
                            },
                            {
                              "name": "Related URL",
                              "source": "pep-uk-parliament",
                              "value": "https://members.parliament.uk/member/5091/contact"
                            },
                            {
                              "name": "Locationurl",
                              "source": "complyadvantage",
                              "value": "https://dbpedia.org/data/Nigel_Farage.json"
                            },
                            {
                              "name": "Locationurl",
                              "source": "pep-uk-parliament",
                              "value": "https://en.wikipedia.org/wiki/Nigel_Farage"
                            },
                            {
                              "name": "Locationurl",
                              "source": "complyadvantage",
                              "value": "https://en.wikipedia.org/wiki/Nigel_Farage"
                            },
                            {
                              "name": "Locationurl",
                              "source": "united-kingdom-political-parties-leadership",
                              "value": "https://search.electoralcommission.org.uk/English/Registrations/PP7931"
                            },
                            {
                              "name": "Locationurl",
                              "source": "complyadvantage",
                              "value": "https://www.google.com/search?hl=en-us&q=who+is+Farage&ucbcb=1"
                            },
                            {
                              "name": "Locationurl",
                              "source": "complyadvantage",
                              "value": "https://www.google.com/search?hl=en-us&q=who+is+Nigel+Farage&ucbcb=1"
                            },
                            {
                              "name": "Locationurl",
                              "source": "complyadvantage",
                              "value": "https://www.google.com/search?hl=en-us&q=who+is+Nigel+Paul+Farage&ucbcb=1"
                            },
                            {
                              "name": "Locationurl",
                              "source": "united-kingdom-elected-parliament",
                              "value": "https://www.parallelparliament.co.uk/MPs"
                            },
                            {
                              "name": "Picture URL Internal",
                              "source": "pep-european-parliament-meps",
                              "value": "http://complyadvantage-asset-development.s3.amazonaws.com/bc450214-b99b-4063-9546-9a06bfe0e74d.jpg"
                            },
                            {
                              "name": "Picture URL Internal",
                              "source": "complyadvantage",
                              "value": "http://complyadvantage-asset-development.s3.amazonaws.com/e0fe3b97-e0eb-448f-a61c-93a3111355a1.jpg"
                            },
                            {
                              "name": "Countries",
                              "value": "Belgium, Brazil, France, Iran, Japan, Malta, Spain, Sri Lanka, United Kingdom"
                            }
                          ],
                          "media": [
                            {
                              "date": "0001-01-01T00:00:00Z",
                              "snippet": "\" Farage should face highest penalty for serious breach of EP code of conduct<\\/a><\\/blockquote>\\n",
                              "title": "(no title)",
                              "url": "https://cde.news/wp-json/oembed/1.0/embed?url=https://cde.news/farage-should-face-highest-penalty-for-serious-breach-of-ep-code-of-conduct/"
                            },
                            {
                              "date": "2025-08-14T00:00:00Z",
                              "snippet": "The public was also not informed for months that Rudakubana had been referred to the anti-terror Prevent programme multiple times, but the police had dismissed him as a threat. For having questioned if there was a potential terror motive, figures such as Reform UK leader Nigel Farage were accused of spreading \"conspiracy theories\" and establishment media even blamed the Brexit boss for stoking the riots which broke out in the wake of the attack. However, the government's independent reviewer of terrorism legislation, Jonathan Hall KC, later vindicated Farage by acknowledging that the information released by the police was \" inadequet \" and that the \"public could have been told immediately that there had been an attack by a 17-year-old male who was black, British, born in Wales and has lived in the UK all his life.\"",
                              "title": "British Police Told Reveal Ethnicity, Migration Status of Suspects in High-Profile Cases",
                              "url": "https://www.breitbart.com/europe/2025/08/14/british-police-told-reveal-ethnicity-migration-status-of-suspects-in-high-profile-cases/"
                            },
                            {
                              "date": "2024-08-12T00:00:00Z",
                              "snippet": ": atendendo ao apelo de Nigel Farange, o chefe fascista ingl&#xEA;s, hordas de hooligans de extrema-direita depredaram albergues para imigrantes e tocaram o terror por uma semana em uma das principais economias do Ocidente. Com efeito, a cena internacional se altera rapidamente.",
                              "title": "Caminhamos bem no Brics, mas o quadro da uni&#xE3;o na Am&#xE9;rica Latina &#xE9; desolador &#x2013; Opini&#xE3;o &#x2013; CartaCapital",
                              "url": "https://www.cartacapital.com.br/opiniao/caminhamos-bem-no-brics-mas-o-quadro-da-uniao-na-america-latina-e-desolador/?utm_medium=leiamais"
                            },
                            {
                              "date": "2018-03-13T00:00:00Z",
                              "snippet": "While Nigel Farage's successor-but-one Paul \"Dr Nutty\" Nuttall protests that he never doctored a CV with an invented university PhD, Ukip's ritzy nonpareil continues to enjoy the high life. My informant spied Farage, the self-appointed people's chief revolter, relaxing in first class on a British Airways flight from New York to Blighty. Drinking three types of champagne doesn't come cheap at &#xA3;8,00 0 one-way, so either the Brexit elitist is earning big bucks or he has found a sugar daddy.",
                              "title": "Commons Confidential: Money for old Gove",
                              "url": "https://www.newstatesman.com/politics/uk/2016/12/commons-confidential-money-old-gove?page=2&qt-trending=1"
                            },
                            {
                              "date": "2016-02-11T00:00:00Z",
                              "snippet": "Cameron is well aware of this. This week, he was accused of deploying \"Project Fear\" - a tactic utilized by playing on voters' security concerns - by saying that a vote to leave the EU would result in the migrant camp in Calais moving to Dover. These may be baseless claims from the prime minister, but the bloodcurdling warnings about the dangers of leaving the EU, coupled with a weak oppositional campaign, will be enough to scare voters into staying.",
                              "title": "David Cameron's EU Deal Isn't Great - But It's Enough to Secure a Referendum Victory | Huffington Post",
                              "url": "http://www.huffingtonpost.co.uk/sami-quadri/eu-referendum_b_9204882.html"
                            },
                            {
                              "date": "2018-04-15T00:00:00Z",
                              "snippet": ": British MEP and UKIP leader Nigel Farage has been accused of employing both his wife and alleged mistress out of his Parliament allowances Want to contribute?",
                              "title": "EU Tweets of the Week: The Good, the Sad and the Ugly &#x2013; 14 March 2014",
                              "url": "https://www.european-views.com/2018/04/eu-tweets-of-the-week-the-good-the-sad-and-the-ugly-14-march-2014/"
                            },
                            {
                              "date": "2001-09-11T00:00:00Z",
                              "snippet": "In the meantime, the populist radical rightwing parties have been trying to show a vociferous reaction to these terror attacks by describing them as a direct result of the multicultural policies adopted by various European states. Nigel Paul Farage, leader of the UK Independence Party, has charged Islamist groups as being a fifth column of London's enemies in the country, while Geert Wilders, leader of the Netherlands Freedom Party, has noted that it is time to fight against the Islamization of the country. In Germany, a radical group called PEGIDA, meaning the \"Patriots against the Islamization of the West\", has been organizing mass protests in various cities in Germany in protest to what it calls the Islamization of Europe.",
                              "title": "Europe's radical Right against Muslims",
                              "url": "http://english.irib.ir/radioislam/commentaries/item/205796-europe"
                            },
                            {
                              "date": "0001-01-01T00:00:00Z",
                              "snippet": "Those party leaders that oppose the EU , all seem to be taken to court . We will have to see if Petry , Le Penn , Farage etc , are found guilty , or if not , whether the EU has abused its position to make false allegations . Posted on 10/4/17",
                              "title": "Ex-AfD leader Frauke Petry charged with perjury &#x2013; POLITICO",
                              "url": "https://www.politico.eu/article/frauke-petry-ex-afd-leader-charged-with-perjury/"
                            },
                            {
                              "date": "2018-02-25T00:00:00Z",
                              "snippet": "WikiLeaks published troves of hacked e-mails last year that damaged Hillary Clinton 's campaign and is suspected of having co-operated with Russia through third parties, according to recent congressional testimony by the former CIA director John Brennan, who also said the adamant denials of collusion by Assange and Russia were disingenuous. Farage has not been accused of wrongdoing and is not a suspect or a target of the US investigation. But being a 'person of interest ' means investigators believe he may have information about the acts that are under investigation and he may therefore be subject to their scrutiny.",
                              "title": "Farage &#x642;&#x20AC; &#x303;person of interest&#x642;&#x20AC;TM in FBI probe into Trump, Russia",
                              "url": "http://www.gulf-times.com/story/551866/Farage-person-of-interest-in-FBI-probe-into-Trump-Russia"
                            },
                            {
                              "date": "2018-03-16T00:00:00Z",
                              "snippet": "Farage's exploitation of the Charlie Hebdo murders is a new low Farage's exploitation of the Charlie Hebdo murders is a new low Farage 's exploitation of the Charlie Hebdo murders is a new low The Ukip leader's attack on multiculturalism is a demonstration of his malign intent.",
                              "title": "Farage's exploitation of the Charlie Hebdo murders is a new low",
                              "url": "https://www.newstatesman.com/politics/2015/01/farages-exploitation-charlie-hebdo-murders-new-low?qt-trending=1"
                            },
                            {
                              "date": "2018-03-13T00:00:00Z",
                              "snippet": "What came through very quickly during the interviews was how little the Leave activists particularly Farage's gang were concerned about the official Remain campaign.",
                              "title": "Huge Egos, Dark Plotting And Deep Suspicion: Welcome To The Brexit Club",
                              "url": "http://www.huffingtonpost.co.uk/owen-bennett/brexit-club_b_12466130.html?utm_hp_ref=uk"
                            },
                            {
                              "date": "2018-03-03T00:00:00Z",
                              "snippet": "Nigel Farage could be passing secret communications to Julian Assange inside the Ecuadorian embassy, a US intelligence expert has speculated, weeks after the MEP was pictured there Roger Stone, a Republican close to Trump, said he has 'back-channel communications' with Assange through an intermediary. Asked if that person was Farage, he denied it Now a senior US intelligence source, speaking to the Observer , has poured fuel on the fire by suggesting that Farage could be a conduit for secret communications. The unnamed source said",
                              "title": "Is Farage acting as a courier for Assange? | Daily Mail Online",
                              "url": "http://www.dailymail.co.uk/news/article-4436828/Is-Farage-acting-courier-Assange.html"
                            },
                            {
                              "date": "2024-08-01T00:00:00Z",
                              "snippet": "No knife attacks or bombings or such like. I remember the NF who were much more extreme and were violent against immigrants and wanted them all out. They were known as criminals but the word terrorist never used, I think it's thrown about too easily these days",
                              "title": "Japan Today",
                              "url": "https://japantoday.com/member/jimizo"
                            },
                            {
                              "date": "2025-10-22T00:00:00Z",
                              "snippet": "Reform's leader in Wales until 2021, Mr Gill admitted eight counts of bribery after making statements in favour of Russia. In his initial statement following Mr Gill's conviction, Mr Farage took a swipe at Ukraine claiming it is \"a country beset by corruption\", while not once criticising Russia. This has seen the party make a humiliating mockup of Mr Farage and Putin as Russian dolls, suggesting Reform's energy plan would see the UK forced to rely on the Kremlin.",
                              "title": "Labour slams Farage over Putin praise: 'What's really inside Reform's energy plan?' - The Mirror",
                              "url": "https://www.mirror.co.uk/news/politics/labour-ramp-up-attacks-nigel-36114108"
                            },
                            {
                              "date": "2025-10-14T00:00:00Z",
                              "snippet": "which Mr Farage described as \"pretty chilling\". Sentencing judge Mrs Justice Steyn told Fayaz Khan she agreed with Nigel Farage that his threats to kill the politician were \"pretty chilling\". Undated handout screengrab taken from a video issued by the Crown Prosecution Service of Fayaz Khan making threats to Nigel Farage.",
                              "title": "Man who threatened to kill Farage in Tiktok post jailed for five years",
                              "url": "https://www.itv.com/news/2025-10-14/man-who-threatened-to-kill-farage-jailed-for-five-years"
                            },
                            {
                              "date": "2025-10-30T00:00:00Z",
                              "snippet": "Crypto sleuth ZachXBT said the \"wallet address belongs to George Cottrell with high confidence.\" \"He's been an adviser to Nigel Farage, is known for high-stakes gambling, and was found guilty of wire fraud,\" he added. During the lead-up to Trump's election win, the wallet named \"GCottrell93\" reportedly bought $9 million of Trump Polymarket shares and won $13 million.",
                              "title": "Nigel Farage Adviser Reportedly Whale Behind Polymarket's Major Trump Bets",
                              "url": "https://www.ccn.com/news/crypto/nigel-farage-adviser-reportedly-whale-behind-polymarkets-major-trump-bets/"
                            },
                            {
                              "date": "2018-03-13T00:00:00Z",
                              "snippet": "Nigel Farage says Angela Merkel should \"take responsibility\" for Berlin attack https //t.co/A4LWiJ1oDD pic.twitter.com/lRRpyljtAO On the day of Jo Cox's murder, Farage launched an anti-immigration poster depicting a queue of refugees, with the slogan \"Breaking Point\". It was criticised by other Leave campaigners such as Douglas Carswell and Michael Gove.",
                              "title": "Nigel Farage attacks Jo Cox's widower: \"He would know more about extremists than me\"",
                              "url": "https://www.newstatesman.com/2016/12/nigel-farage-attacks-jo-coxs-widower-he-would-know-more-about-extremists-me?page=3&qt-trending=1"
                            },
                            {
                              "date": "2023-12-11T00:00:00Z",
                              "snippet": "Four other blokes stripped naked.\" Farage, 59, also revealed ITV had messed up with a drinking trial Down Your Sorrows on day seven which he did with Tony Bellew. Farage insisted he had made them change it midway through the challenge because it was too tough and claimed they would never repeat the trial in the way they had to do it because it was dangerous for their health.",
                              "title": "Nigel Farage in furious row with ITV bosses over breaching I'm A Celebrity rules - Mirror Online",
                              "url": "https://www.mirror.co.uk/tv/tv-news/nigel-farage-furious-row-itv-31648505.amp"
                            },
                            {
                              "date": "2025-11-03T00:00:00Z",
                              "snippet": "Manifesto tax cuts 'only ever aspirations' But Mr Farage is also being accused of U-turning on the tax cuts he pledged in Reform UK's 2024 general election manifesto, which was called \"Our Contract With You\". Key measures in the document included raising the minimum threshold of income tax to &#xA3;20,000, raising the higher rate threshold from &#xA3;50,271 to &#xA3;70,000, abolishing stamp duty for properties below &#xA3;750,000, and abolishing taxes on inheritances below &#xA3;2m.",
                              "title": "Nigel Farage says Reform UK could cut minimum wage for young people - and defends U-turn on tax pledges",
                              "url": "https://news.sky.com/story/nigel-farage-says-reform-uk-could-cut-minimum-wage-for-young-people-and-defends-u-turn-on-tax-pledges-13463252"
                            },
                            {
                              "date": "2018-03-13T00:00:00Z",
                              "snippet": "Others were equally disgusted at the Ukip politician 's comments. Farage was also accused on social media of political point-scoring in the wake of last night 's attack, which police are treating as a \"terror attack \". Some echoed Cox 's sentiments and asked whether Farage should be held to account for the actions \"of those who support your agenda \".",
                              "title": "Nigel Farage's Brendan Cox Comments Spark Outrage In Wake Of Berlin Terror Attack",
                              "url": "http://www.huffingtonpost.co.uk/entry/brendan-cox-takes-down-nigel-farage-over-berlin-terror-tweet_uk_5858f018e4b0acb6e4b8ebc4"
                            },
                            {
                              "date": "2018-03-13T00:00:00Z",
                              "snippet": "\"Could I lead Ukip? Yeah, I think I could\" How much longer will Nigel Farage be in charge? His deputy leader, Paul Nuttall, has his eye on the top job.",
                              "title": "Paul Nuttall: 'Could I lead Ukip? Yeah, I think I could'",
                              "url": "https://www.newstatesman.com/politics/2015/01/paul-nuttall-could-i-lead-ukip-yeah-i-think-i-could?page=2&qt-trending=1"
                            },
                            {
                              "date": "2025-09-05T00:00:00Z",
                              "snippet": "The decision to embrace Malhotra is one of several actions by Farage that suggest Reform is heading towards closer policy alignment with Trump and Project 2025. In May 2024, Farage was himself accused by the World Health Organisation (WHO) of \"spreading misinformation\" after becoming the face of Action on World Health (AWH), a campaign for the UK to end its membership of the World Health Organisation (WHO). AWH has received favourable coverage in right-wing newspapers, repeating the narratives of groups associated with coordinated COVID disinformation that has seeped into the mainstream media via outlets like the Telegraph, GB News and TalkTV.",
                              "title": "Reform UK Conference: Anti-Vax Misinformation Doctor Given Prime Health Slot &#x2013; Byline Times",
                              "url": "https://bylinetimes.com/2025/09/05/reform-conference-aseem-malhotra/"
                            },
                            {
                              "date": "2023-07-19T00:00:00Z",
                              "snippet": "- Referred to NF's controversial profile in public life and politics, reflected in the adverse press outlined in the paper presented. - Despite the adverse press, from a legal perspective NF has not been formally charged of any wrongdoing, and is not subject to any regulatory censure.",
                              "title": "Revealed: The Coutts files on Nigel Farage | The Spectator",
                              "url": "https://www.spectator.co.uk/article/the-coutts-files-on-nigel-farage/"
                            },
                            {
                              "date": "2014-05-27T00:00:00Z",
                              "snippet": "&#xAB;Son mode de vie me fait peur. Nigel boit et fume beaucoup trop&#xBB;. La prochaine &#xE9;tape pour Nigel Farage est de rendre respectable son parti, tr&#xE8;s souvent assimil&#xE9; &#xE0; la droite extr&#xEA;me en Grande-Bretagne.",
                              "title": "Royaume-Uni - Nigel Farage, le visage des europhobes britanniques",
                              "url": "https://www.parismatch.com/Actu/International/Nigel-Farage-le-visage-des-europhobes-britanniques-566248"
                            },
                            {
                              "date": "2023-07-18T00:00:00Z",
                              "snippet": "\"Team uncovered adverse press. This included various reports that claimed NF incited race hate when he compared the Black Lives Matter (BLM) movement to the Taliban and Islamic extremists in relation to the toppling of the Colston statue in Bristol.\" It also cites adverse press relating to \"appearances on InfoWars (the American conspiracy show run by far-Right pundit Alex Jones) and continued support for Alex Jones\" despite him being ordered to pay $1 billion in damages to the families of the victims of the 2012 Sandy Hook mass shooting for claiming it was faked.",
                              "title": "The dossier that blows apart the Coutts claims about closing Nigel Farage's account",
                              "url": "https://www.telegraph.co.uk/news/2023/07/18/coutts-records-undermine-claim-exiting-farage-not-political/?li_medium=liftigniter-onward-journey&li_source=LI"
                            },
                            {
                              "date": "2018-03-13T00:00:00Z",
                              "snippet": "The day before, she and her family had joined the \"Battle of Brexit\" on the Thames . She was known as a refugee campaigner - the morning of her murder, Nigel Farage had already sparked controversy with a \"Breaking Point\" poster featuring a line of refugees. For those who had already been complaining about the hate-fuelled rhetoric, an \"I told you so\" can't be far from their lips.",
                              "title": "The murder of Jo Cox is rallying Remain - but score political points at your peril",
                              "url": "https://www.newstatesman.com/politics/staggers/2016/06/murder-jo-cox-rallying-remain-score-political-points-your-peril?page=2&qt-trending=1"
                            },
                            {
                              "date": "2019-05-21T00:00:00Z",
                              "snippet": "Other anti-EU candidates not associated with the Brexit Party have also been targeted by milkshakes in recent weeks. Farage, a 55-year-old former commodities broker, played an instrumental role in persuading Britain 's mainstream political parties to hold a referendum on leaving the European Union in 2016, and then convincing voters to back Brexit during the subsequent campaign. Britain remains deeply divided over the issue and parliament has been unable to agree when, how or even if the country should leave the bloc.",
                              "title": "Times Online - Daily Online Edition of The Sunday Times Sri Lanka",
                              "url": "http://www.sundaytimes.lk/article/1088665/all-shook-up-brexit-partys-nigel-farage-doused-with-milkshake-on-campaign"
                            },
                            {
                              "date": "2018-03-13T00:00:00Z",
                              "snippet": "And...would Nigel Farage be in charge? Banks and Farage are close friends, and Banks has little enthusiasm for Ukip without Farage in charge. He admires his leadership abilities.",
                              "title": "Will Arron Banks' new party be Ukip 2.0 or a right-wing Momentum?",
                              "url": "https://www.newstatesman.com/politics/staggers/2017/03/will-arron-banks-new-party-be-ukip-20-or-right-wing-momentum?page=3&qt-trending=1"
                            },
                            {
                              "date": "2025-10-10T00:00:00Z",
                              "snippet": "Your Party will put the working class \"back at the heart of politics\", Zarah Sultana said, as she warned fascism is \"growling at the door\". The Independent MP for Coventry South accused Nigel Farage of \"peddling racism\" to distract people from his \"real agenda\". Co-founder Jeremy Corbyn also said the new political party must offer something \"very, very different\" from the \"simplistic appeal\" of the Reform UK leader.",
                              "title": "Your Party will put working class 'back at heart of politics' &#x2013; Sultana",
                              "url": "https://www.irishnews.com/news/uk/your-party-will-put-working-class-back-at-heart-of-politics-sultana-HW323N42EJJMXF3JTNWXE5UXD4/"
                            },
                            {
                              "date": "2016-06-30T00:00:00Z",
                              "snippet": "La democracia necesita de la participaci&#xF3;n. Si a alguien un agitador como Nigel Farange o un partido sacudido por la corrupci&#xF3;n como el PP le dan miedo, lo puede manifestar en las urnas. Por otra parte, tampoco se ha de pensar que",
                              "title": "&#xBF;Un abismo politico entre las generaciones? - Mallorca Zeitung",
                              "url": "http://www.mallorcazeitung.es/meinung/2016/06/30/abismo-politico-generaciones-54170173.html"
                            }
                          ],
                          "associates": [
                            {
                              "association": "parent",
                              "name": "Barbara Stevens"
                            },
                            {
                              "association": "former spouse",
                              "name": "Gr&#xE1;inne Hayes"
                            },
                            {
                              "association": "spouse",
                              "name": "Gr&#xE1;inne Hayes"
                            },
                            {
                              "association": "parent",
                              "name": "Guy Justus Oscar Farage"
                            },
                            {
                              "association": "child",
                              "name": "Isabelle Farage"
                            },
                            {
                              "association": "spouse",
                              "name": "Kirsten Farage"
                            },
                            {
                              "association": "spouse",
                              "name": "Kirsten Mehr"
                            },
                            {
                              "association": "child",
                              "name": "Samuel Farage"
                            },
                            {
                              "association": "child",
                              "name": "Thomas Farage"
                            },
                            {
                              "association": "child",
                              "name": "Victoria Farage"
                            }
                          ]
                        },
                        {
                          "name": "Nigel Farage",
                          "dob": {
                            "main": "1964-04-03",
                            "other": []
                          },
                          "score": 1,
                          "flag_types": [
                            "pep",
                            "pep-class-1"
                          ],
                          "source_notes": {
                            "complyadvantage": {
                              "aml_types": [
                                "pep-class-1"
                              ],
                              "name": "ComplyAdvantage PEP Data"
                            },
                            "united-kingdom-mps-and-lords-rca": {
                              "aml_types": [
                                "pep-class-1"
                              ],
                              "country_codes": [
                                "GB"
                              ],
                              "name": "United Kingdom MPs and Lords RCA"
                            }
                          },
                          "political_positions": [
                            "Member of the National Legislature"
                          ],
                          "countries": [
                            "United Kingdom"
                          ],
                          "aka": [
                            "Nigel Farage"
                          ],
                          "id": "D655PR5UHW408JL",
                          "match_types": [
                            "name_exact",
                            "year_of_birth"
                          ],
                          "fields": [
                            {
                              "name": "Country",
                              "source": "united-kingdom-mps-and-lords-rca",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Original Country Text",
                              "source": "united-kingdom-mps-and-lords-rca",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Place of Birth",
                              "source": "united-kingdom-mps-and-lords-rca",
                              "value": "United Kingdom"
                            },
                            {
                              "name": "Original Place of Birth Text",
                              "source": "united-kingdom-mps-and-lords-rca",
                              "value": "Farnborough, Kent, England"
                            },
                            {
                              "name": "Date of Birth",
                              "source": "complyadvantage",
                              "value": "1964-04-03"
                            },
                            {
                              "name": "Political Position",
                              "source": "united-kingdom-mps-and-lords-rca",
                              "value": "Member of the National Legislature"
                            },
                            {
                              "name": "Locationurl",
                              "source": "united-kingdom-mps-and-lords-rca",
                              "value": "https://en.wikipedia.org/wiki/Nigel_Farage"
                            },
                            {
                              "name": "Locationurl",
                              "source": "complyadvantage",
                              "value": "https://en.wikipedia.org/wiki/Nigel_Farage"
                            },
                            {
                              "name": "Locationurl",
                              "source": "united-kingdom-mps-and-lords-rca",
                              "value": "https://simple.wikipedia.org/wiki/Nigel_Farage#Personal_life"
                            },
                            {
                              "name": "Countries",
                              "value": "United Kingdom"
                            }
                          ],
                          "associates": [
                            {
                              "association": "parent",
                              "name": "Barbara Farage"
                            },
                            {
                              "association": "former spouse",
                              "name": "Gr&#xE1;inne Hayes"
                            },
                            {
                              "association": "parent",
                              "name": "Guy Justus Oscar Farage"
                            },
                            {
                              "association": "child",
                              "name": "Isabelle Farage"
                            },
                            {
                              "association": "former spouse",
                              "name": "Kirsten Mehr"
                            },
                            {
                              "association": "partner",
                              "name": "Laure Ferrari"
                            },
                            {
                              "association": "child",
                              "name": "Samuel Farage"
                            },
                            {
                              "association": "child",
                              "name": "Thomas Farage"
                            },
                            {
                              "association": "child",
                              "name": "Victoria Farage"
                            }
                          ]
                        }
                      ]
                    },
                    "data": {
                      "yob": "1964",
                      "name:lite": {
                        "first": "Nigel",
                        "last": "Farage"
                      },
                      "country": "GBR"
                    },
                    "result": "consider",
                    "documents": [
                      "d46awh223amg030rw720"
                    ],
                    "id": "d46atm223amg030rw6yg",
                    "status": "closed",
                    "createdAt": "2025-11-06T14:14:40.874Z"
                  }
                },
                "updatedAt": "2025-11-06T14:14:47.605Z",
                "pdfReady": true,
                "checkType": "lite-screen",
                "completedAt": "2025-11-06T14:14:47.605Z",
                "initiatedAt": "2025-11-06T14:14:36.793Z",
                "considerReasons": [
                  "PEP hits"
                ],
                "pdfS3Key": "protected/ptw6KVD",
                "consumerName": " ",
                "tasks": [
                  "report:screening:lite"
                ],
                "updates": [
                  {
                    "timestamp": "2025-11-06T14:14:36.793Z",
                    "update": "Lite Screen check initiated by jacob.archer-moran@thurstanhoskin.co.uk"
                  },
                  {
                    "timestamp": "2025-11-06T14:14:47.605Z",
                    "update": "Transaction completed - awaiting PDF"
                  },
                  {
                    "timestamp": "2025-11-06T14:19:01.253Z",
                    "update": "PDF received and uploaded to S3 - CONSIDER: PEP hits"
                  },
                  {
                    "timestamp": "2025-11-06T14:19:22.647Z",
                    "update": "PDF received and uploaded to S3 - CONSIDER: PEP hits"
                  }
                ],
                "status": "closed",
                "initiatedBy": "jacob.archer-moran@thurstanhoskin.co.uk",
                "piiData": {
                  "name": {},
                  "address": {},
                  "document": {}
                },
                "thirdfortResponse": {
                  "name": "Nigel Farage - Lite Screening",
                  "request": {
                    "tasks": [
                      {
                        "opts": {
                          "monitored": false
                        },
                        "type": "report:screening:lite"
                      }
                    ]
                  },
                  "ref": "Lite Screening Check",
                  "id": "d46atjj23amg030rw6x0",
                  "reports": [],
                  "status": "open",
                  "metadata": {
                    "notify": {
                      "type": "http",
                      "data": {
                        "hmac_key": "9YHj0N6aqWq3ealMttvU5hNycILlzz8zLEC3GvHBwNA=",
                        "method": "POST",
                        "uri": "https://www.thurstanhoskin.co.uk/_functions-dev/thirdfortWebhook"
                      }
                    },
                    "created_by": "d3t2m5q9io6g00ak3kmg",
                    "print": {
                      "team": "Cashiers",
                      "tenant": "Thurstan Hoskin Solicitors LLP",
                      "user": "Jacob Archer-Moran"
                    },
                    "context": {
                      "gid": "d3t2k5a9io6g00ak3km0",
                      "uid": "d3t2m5q9io6g00ak3kmg",
                      "team_id": "d3t2k5a9io6g00ak3km0",
                      "tenant_id": "d3t2ifa9io6g00ak3klg"
                    },
                    "ce": {
                      "uri": "/v1/checks/4151797870"
                    },
                    "created_at": "2025-11-06T14:14:33.622Z"
                  },
                  "type": "v2",
                  "opts": {
                    "screening": {
                      "monitored": false
                    }
                  }
                },
                "expectations": {
                  "name:lite": {
                    "data": {
                      "first": "Nigel",
                      "last": "Farage"
                    }
                  },
                  "yob": {
                    "data": "1964"
                  },
                  "country": {
                    "data": "GBR"
                  }
                },
                "hasAlerts": true,
                "pdfAddedAt": "2025-11-06T14:19:22.647Z",
                "transactionId": "d46atjj23amg030rw6x0"
            }
        ];
    }
    
    // ===================================================================
    // ANNOTATION OVERLAYS
    // ===================================================================
    
    /**
     * Render annotations for a specific task
     */
    renderTaskAnnotations(taskType, check) {
        const annotations = check.considerAnnotations || [];
        const sofNotes = check.sofAnnotations || [];
        const pepDismissals = check.pepDismissals || [];
        
        // Filter annotations for this task
        const taskAnnotations = annotations.filter(ann => ann.taskType === taskType);
        
        // Check for SoF notes if this is an SoF task
        const isSofTask = taskType === 'sof:v1';
        
        // Check for PEP dismissals if this is a screening task
        const isPepTask = taskType === 'screening' || taskType === 'peps' || taskType === 'screening:lite';
        
        // Check for Bank task - show account reviews from SOF annotations
        const isBankTask = taskType === 'bank';
        
        if (taskAnnotations.length === 0 && (!isSofTask || sofNotes.length === 0) && (!isPepTask || pepDismissals.length === 0) && (!isBankTask || sofNotes.length === 0)) {
            return '';
        }
        
        let html = '<div class="task-annotations-section">';
        
        // Show consider annotations - grouped by user + timestamp + newStatus
        if (taskAnnotations.length > 0) {
            html += '<div class="task-annotations-header">Cashier Updates</div>';
            
            // Group annotations by user + timestamp + newStatus
            const groups = {};
            taskAnnotations.forEach(ann => {
                // Create a unique key for grouping: user_timestamp_newStatus
                const groupKey = `${ann.user}_${ann.timestamp}_${ann.newStatus}`;
                if (!groups[groupKey]) {
                    groups[groupKey] = {
                        user: ann.userName || ann.user,
                        timestamp: ann.timestamp,
                        newStatus: ann.newStatus,
                        reason: ann.reason,
                        objectives: []
                    };
                }
                groups[groupKey].objectives.push({
                    path: ann.objectivePath,
                    originalStatus: ann.originalStatus,
                    newStatus: ann.newStatus
                });
            });
            
            // Render each group as a mini card
            Object.values(groups).forEach(group => {
                const date = new Date(group.timestamp).toLocaleString('en-GB', { 
                    day: '2-digit', 
                    month: 'short', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                html += '<div class="annotation-mini-card">';
                html += '<div class="annotation-mini-header">';
                html += '<div class="annotation-mini-meta">';
                html += '<strong>' + group.user + '</strong> &#x2022; ' + date;
                html += '</div>';
                html += '</div>';
                html += '<div class="annotation-mini-body">';
                html += '<p class="annotation-mini-reason">' + group.reason + '</p>';
                html += '<div class="annotation-mini-objectives">';
                
                // Show all affected objectives with their status icons
                group.objectives.forEach(obj => {
                    const statusIcon = this.getStatusIconSVG(obj.newStatus);
                    html += '<div class="annotation-objective-item">';
                    html += statusIcon;
                    html += '<span class="annotation-objective-label">' + this.formatObjectivePath(obj.path) + '</span>';
                    html += '</div>';
                });
                
                html += '</div></div></div>';
            });
        }
        
        // Show SoF notes (formatted like consider annotations)
        if (isSofTask && sofNotes.length > 0) {
            html += '<div class="task-annotations-header">Investigation Updates</div>';
            sofNotes.forEach((note, noteIdx) => {
                const date = new Date(note.timestamp).toLocaleString('en-GB', { 
                    day: '2-digit', 
                    month: 'short', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                // Format user name - convert email to friendly name
                let userName = note.userName || note.user;
                if (userName && userName.includes('.') && !userName.includes(' ')) {
                    // Convert "jacob.archer-moran" to "Jacob Archer Moran"
                    userName = userName.split('@')[0] // Remove email domain if present
                        .split('.').join(' ')  // Replace dots with spaces
                        .split('-').join(' ')  // Replace hyphens with spaces
                        .replace(/\b\w/g, l => l.toUpperCase()); // Capitalize each word
                }
                
                const investigation = note.notes || {};
                
                // Check if there's any content to display
                let hasPropertyContent = false;
                let hasFundingContent = false;
                let hasRedFlagContent = false;
                let hasTransactionContent = false;
                
                if (investigation.property && (investigation.property.reviewed || investigation.property.note)) {
                    hasPropertyContent = true;
                }
                
                if (investigation.fundingMethods && investigation.fundingMethods.length > 0) {
                    hasFundingContent = investigation.fundingMethods.some(fm => {
                        const hasNote = fm.note && fm.note.trim();
                        const hasVerified = fm.verified && fm.verified.length > 0;
                        return hasNote || hasVerified;
                    });
                }
                
                if (investigation.redFlags && investigation.redFlags.length > 0) {
                    hasRedFlagContent = true;
                }
                
                if (investigation.transactions && investigation.transactions.length > 0) {
                    hasTransactionContent = true;
                }
                
                // Only show the update card if there's content to display
                if (!hasPropertyContent && !hasFundingContent && !hasRedFlagContent && !hasTransactionContent) {
                    return; // Skip this update
                }
                
                // Build summary tags
                let summaryTags = '';
                const fundingMethodsWithContent = investigation.fundingMethods?.filter(fm => {
                    const hasNote = fm.note && fm.note.trim();
                    const hasVerified = fm.verified && fm.verified.length > 0;
                    return hasNote || hasVerified;
                }) || [];
                
                if (hasPropertyContent) {
                    summaryTags += '<span class="annotation-summary-tag neutral">Property Reviewed</span>';
                }
                if (fundingMethodsWithContent.length > 0) {
                    summaryTags += '<span class="annotation-summary-tag neutral">' + fundingMethodsWithContent.length + ' Funding Method' + (fundingMethodsWithContent.length !== 1 ? 's' : '') + '</span>';
                }
                if (hasTransactionContent) {
                    const txCount = investigation.transactions.length;
                    summaryTags += '<span class="annotation-summary-tag neutral">' + txCount + ' Transaction' + (txCount !== 1 ? 's' : '') + ' Linked</span>';
                }
                if (hasRedFlagContent) {
                    const confirmedFlags = investigation.redFlags.filter(rf => rf.status === 'confirmed').length;
                    const dismissedFlags = investigation.redFlags.filter(rf => rf.status === 'dismissed').length;
                    const pendingFlags = investigation.redFlags.filter(rf => !rf.status || rf.status === 'pending').length;
                    
                    if (confirmedFlags > 0) {
                        summaryTags += '<span class="annotation-summary-tag confirmed">' + confirmedFlags + ' Flag' + (confirmedFlags !== 1 ? 's' : '') + ' Confirmed</span>';
                    }
                    if (dismissedFlags > 0) {
                        summaryTags += '<span class="annotation-summary-tag dismissed">' + dismissedFlags + ' Flag' + (dismissedFlags !== 1 ? 's' : '') + ' Dismissed</span>';
                    }
                    if (pendingFlags > 0) {
                        summaryTags += '<span class="annotation-summary-tag pending">' + pendingFlags + ' Flag' + (pendingFlags !== 1 ? 's' : '') + ' Reviewed</span>';
                    }
                }
                
                html += '<div class="annotation-card collapsed" data-sof-annotation-idx="' + noteIdx + '">';
                html += '<div class="annotation-card-header" onclick="toggleSofAnnotationCard(event, ' + noteIdx + ')">';
                html += '<div class="annotation-header-main">';
                html += '<div class="annotation-mini-meta">';
                html += '<strong>' + userName + '</strong> &#x2022; ' + date;
                html += '</div>';
                html += '<span class="expand-indicator">&#x25BC;</span>';
                html += '</div>';
                html += '<div class="annotation-summary-tags">' + summaryTags + '</div>';
                html += '</div>';
                html += '<div class="annotation-card-body">';
                
                // Show property review
                if (hasPropertyContent) {
                    html += '<div class="annotation-mini-objectives">';
                    html += '<div class="annotation-objective-item">';
                    html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                    html += '<span class="annotation-objective-label"><strong>Property:</strong> Reviewed' + (investigation.property.note ? ' - ' + investigation.property.note : '') + '</span>';
                    html += '</div>';
                    html += '</div>';
                }
                
                // Show funding methods investigated (only if they have notes or verified items)
                if (hasFundingContent) {
                    const fundingMethodsWithContent = investigation.fundingMethods.filter(fm => {
                        const hasNote = fm.note && fm.note.trim();
                        const hasVerified = fm.verified && fm.verified.length > 0;
                        return hasNote || hasVerified;
                    });
                    
                    html += '<div class="annotation-mini-objectives">';
                    fundingMethodsWithContent.forEach(fm => {
                        // Map funding types to friendly names
                        const typeMap = {
                            'fund:mortgage': 'Mortgage',
                            'fund:savings': 'Savings',
                            'fund:gift': 'Gift',
                            'fund:sale:property': 'Property Sale',
                            'fund:sale:assets': 'Asset Sale',
                            'fund:inheritance': 'Inheritance',
                            'fund:htb': 'Help to Buy / LISA',
                            'fund:income': 'Income',
                            'fund:loan': 'Loan',
                            'fund:investment': 'Investment'
                        };
                        const fundLabel = typeMap[fm.fundType] || (fm.fundType || '').replace('fund:', '').replace(/:/g, ' ').replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        
                        html += '<div class="annotation-objective-item">';
                        html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                        html += '<span class="annotation-objective-label"><strong>' + fundLabel + '</strong>' + (fm.note ? ' - ' + fm.note : '') + '</span>';
                        html += '</div>';
                        
                        // Show verified items with friendly names
                        if (fm.verified && fm.verified.length > 0) {
                            const verifiedLabels = fm.verified.map(v => {
                                const labelMap = {
                                    'mortgage_offer': 'Mortgage Offer',
                                    'mortgage_affordability': 'Affordability',
                                    'gift_relationship': 'Giftor Relationship',
                                    'gift_capacity': 'Giftor Capacity',
                                    'gift_declaration': 'Gift Declaration',
                                    'sale_documents': 'Sale Documents',
                                    'sale_proceeds': 'Sale Proceeds',
                                    'savings_statements': 'Bank Statements',
                                    'savings_balance': 'Balance Verified',
                                    'savings_income': 'Income Source',
                                    'generic_verified': 'Verified',
                                    'htb_lisa': 'HTB/LISA Documents',
                                    'inheritance_documents': 'Estate Documents'
                                };
                                return labelMap[v] || v.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            });
                            
                            html += '<div style="margin-left: 28px; font-size: 12px; color: #388e3c; margin-top: 4px;">';
                            html += '<svg viewBox="0 0 300 300" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                            html += '<span style="font-weight: 500;">Verified:</span> ' + verifiedLabels.join(', ');
                            html += '</div>';
                        }
                    });
                    html += '</div>';
                }
                
                // Show transaction linking summary
                if (hasTransactionContent) {
                    // Group transactions by funding method
                    const txByFund = {};
                    investigation.transactions.forEach(tx => {
                        if (tx.linkedToFunds && tx.linkedToFunds.length > 0) {
                            tx.linkedToFunds.forEach(fundIdx => {
                                if (!txByFund[fundIdx]) {
                                    txByFund[fundIdx] = [];
                                }
                                txByFund[fundIdx].push(tx);
                            });
                        }
                    });
                    
                    // Get funding method names from check
                    const sofFunds = check.taskOutcomes?.['sof:v1']?.breakdown?.funds || [];
                    
                    if (Object.keys(txByFund).length > 0) {
                        html += '<div class="annotation-mini-objectives" style="margin-top: 8px;">';
                        Object.entries(txByFund).forEach(([fundIdx, txs]) => {
                            const fund = sofFunds[parseInt(fundIdx)];
                            let fundName = 'Funding Method ' + fundIdx;
                            if (fund) {
                                const typeMap = {
                                    'fund:mortgage': 'Mortgage',
                                    'fund:savings': 'Savings',
                                    'fund:gift': 'Gift',
                                    'fund:sale:property': 'Property Sale',
                                    'fund:sale:assets': 'Asset Sale',
                                    'fund:inheritance': 'Inheritance',
                                    'fund:htb': 'Help to Buy / LISA',
                                    'fund:income': 'Income'
                                };
                                fundName = typeMap[fund.type] || fund.type.replace('fund:', '');
                            }
                            
                            html += '<div class="annotation-objective-item">';
                            html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#2196f3" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M150 75c-8.284 0-15 6.716-15 15v60c0 8.284 6.716 15 15 15s15-6.716 15-15V90c0-8.284-6.716-15-15-15zm0 120c-8.284 0-15 6.716-15 15s6.716 15 15 15 15-6.716 15-15-6.716-15-15-15z"/></svg>';
                            html += '<span class="annotation-objective-label"><strong>Linked:</strong> ' + txs.length + ' transaction' + (txs.length !== 1 ? 's' : '') + ' to ' + fundName + '</span>';
                            html += '</div>';
                        });
                        html += '</div>';
                    }
                }
                
                // Show red flags investigated
                if (hasRedFlagContent) {
                    // Only show separator if there were funding methods with content displayed above
                    if (hasFundingContent || hasTransactionContent) {
                        html += '<div style="margin: 8px 0; border-top: 1px solid #e1e4e8;"></div>';
                    }
                    html += '<div class="annotation-mini-objectives">';
                    investigation.redFlags.forEach(rf => {
                        const flagLabel = rf.flagType || 'Red Flag';
                        html += '<div class="annotation-objective-item">';
                        html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#d32f2f" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
                        html += '<span class="annotation-objective-label"><strong>Red Flag:</strong> ' + flagLabel + (rf.note ? ' - ' + rf.note : '') + '</span>';
                        html += '</div>';
                    });
                    html += '</div>';
                }
                
                html += '</div></div>'; // Close annotation-card-body and annotation-card
            });
        }
        
        // Note: PEP dismissals are now shown inline in the hit cards themselves, not as a separate section
        
        // Show Bank account reviews from SOF annotations
        if (isBankTask && sofNotes.length > 0) {
            // Get account names from check
            const taskOutcomes = check.taskOutcomes || {};
            const bankStatement = taskOutcomes['bank:statement'];
            const bankSummary = taskOutcomes['bank:summary'];
            const docsBankStatement = taskOutcomes['documents:bank-statement'];
            
            const accounts = bankStatement?.breakdown?.accounts || 
                           bankSummary?.breakdown?.accounts || 
                           docsBankStatement?.breakdown?.accounts || {};
            
            // Check if any SOF notes have account reviews or transaction annotations
            const accountReviews = [];
            sofNotes.forEach(note => {
                const reviewAccounts = note.notes?.accounts || [];
                const transactions = note.notes?.transactions || [];
                const bankAnalysisItems = note.notes?.bankAnalysisItems || [];
                const fundingMethods = note.notes?.fundingMethods || [];
                
                // Include this annotation if it has any bank-related content
                if (reviewAccounts.length > 0 || transactions.length > 0 || bankAnalysisItems.length > 0 || fundingMethods.length > 0) {
                    accountReviews.push({
                        user: note.userName || note.user,
                        timestamp: note.timestamp,
                        accounts: reviewAccounts,
                        transactions: transactions,
                        bankAnalysisItems: bankAnalysisItems,
                        fundingMethods: fundingMethods,
                        notes: note.notes
                    });
                }
            });
            
            if (accountReviews.length > 0) {
                html += '<div class="task-annotations-header">Investigation Updates</div>';
                accountReviews.forEach((review, reviewIdx) => {
                    const date = new Date(review.timestamp).toLocaleString('en-GB', { 
                        day: '2-digit', 
                        month: 'short', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    // Format user name - convert email to friendly name
                    let userName = review.user;
                    if (userName && userName.includes('.') && !userName.includes(' ')) {
                        userName = userName.split('@')[0]
                            .split('.').join(' ')
                            .split('-').join(' ')
                            .replace(/\b\w/g, l => l.toUpperCase());
                    }
                    
                    // Build summary tags based on what was done
                    let summaryTags = '';
                    
                    if (review.accounts.length > 0) {
                        summaryTags += '<span class="annotation-summary-tag neutral">' + review.accounts.length + ' Account' + (review.accounts.length !== 1 ? 's' : '') + '</span>';
                    }
                    
                    // Count linked transactions
                    const linkedTxs = review.transactions.filter(tx => tx.linkedToFunds && tx.linkedToFunds.length > 0);
                    if (linkedTxs.length > 0) {
                        summaryTags += '<span class="annotation-summary-tag neutral">' + linkedTxs.length + ' Transaction' + (linkedTxs.length !== 1 ? 's' : '') + ' Linked</span>';
                    }
                    
                    // Count flagged transactions
                    const flaggedTxs = review.transactions.filter(tx => tx.flag);
                    if (flaggedTxs.length > 0) {
                        const suspiciousCount = flaggedTxs.filter(tx => tx.flag === 'suspicious').length;
                        const reviewCount = flaggedTxs.filter(tx => tx.flag === 'review').length;
                        const clearedCount = flaggedTxs.filter(tx => tx.flag === 'cleared').length;
                        
                        if (suspiciousCount > 0) summaryTags += '<span class="annotation-summary-tag confirmed">' + suspiciousCount + ' Suspicious</span>';
                        if (reviewCount > 0) summaryTags += '<span class="annotation-summary-tag pending">' + reviewCount + ' Review</span>';
                        if (clearedCount > 0) summaryTags += '<span class="annotation-summary-tag dismissed">' + clearedCount + ' Cleared</span>';
                    }
                    
                    // Count bank analysis items
                    if (review.bankAnalysisItems.length > 0) {
                        summaryTags += '<span class="annotation-summary-tag neutral">' + review.bankAnalysisItems.length + ' Analysis Item' + (review.bankAnalysisItems.length !== 1 ? 's' : '') + '</span>';
                    }
                    
                    // Count funding method markers
                    let markerCount = 0;
                    review.fundingMethods.forEach(fm => {
                        markerCount += Object.keys(fm.transactionMarkers || {}).length;
                    });
                    if (markerCount > 0) {
                        summaryTags += '<span class="annotation-summary-tag neutral">' + markerCount + ' Marker' + (markerCount !== 1 ? 's' : '') + '</span>';
                    }
                    
                    html += '<div class="annotation-card collapsed" data-bank-review-idx="' + reviewIdx + '">';
                    html += '<div class="annotation-card-header" onclick="toggleBankReviewCard(event, ' + reviewIdx + ')">';
                    html += '<div class="annotation-header-main">';
                    html += '<div class="annotation-mini-meta">';
                    html += '<strong>' + userName + '</strong> &#x2022; ' + date;
                    html += '</div>';
                    html += '<span class="expand-indicator">&#x25BC;</span>';
                    html += '</div>';
                    html += '<div class="annotation-summary-tags">' + summaryTags + '</div>';
                    html += '</div>';
                    html += '<div class="annotation-card-body">';
                    html += '<div class="annotation-mini-objectives">';
                    
                    // Show reviewed accounts
                    review.accounts.forEach(acc => {
                        let accountName = 'Account ' + acc.accountIdx;
                        if (acc.accountId && accounts[acc.accountId]) {
                            const accountInfo = accounts[acc.accountId].info || accounts[acc.accountId];
                            const providerName = accountInfo.provider?.name || '';
                            const accName = accountInfo.name || accountInfo.account_name || '';
                            accountName = providerName && accName ? `${providerName} ${accName}` : (accName || providerName || accountName);
                        }
                        
                        html += '<div class="annotation-objective-item">';
                        html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                        html += '<span class="annotation-objective-label"><strong>' + accountName + ':</strong> Reviewed' + (acc.note ? ' - ' + acc.note : '') + '</span>';
                        html += '</div>';
                    });
                    
                    // Show linked transactions summary
                    if (linkedTxs.length > 0) {
                        // Group by funding method
                        const txByFund = {};
                        linkedTxs.forEach(tx => {
                            tx.linkedToFunds.forEach(fundIdx => {
                                if (!txByFund[fundIdx]) txByFund[fundIdx] = [];
                                txByFund[fundIdx].push(tx);
                            });
                        });
                        
                        const sofFunds = check.taskOutcomes?.['sof:v1']?.breakdown?.funds || [];
                        Object.entries(txByFund).forEach(([fundIdx, txs]) => {
                            const fund = sofFunds[parseInt(fundIdx)];
                            const typeMap = {
                                'fund:mortgage': 'Mortgage',
                                'fund:savings': 'Savings',
                                'fund:gift': 'Gift',
                                'fund:sale:property': 'Property Sale',
                                'fund:sale:assets': 'Asset Sale',
                                'fund:inheritance': 'Inheritance',
                                'fund:htb': 'Help to Buy / LISA',
                                'fund:income': 'Income'
                            };
                            const fundName = fund ? (typeMap[fund.type] || fund.type.replace('fund:', '')) : 'Funding';
                            
                            html += '<div class="annotation-objective-item">';
                            html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#2196f3" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M150 75c-8.284 0-15 6.716-15 15v60c0 8.284 6.716 15 15 15s15-6.716 15-15V90c0-8.284-6.716-15-15-15zm0 120c-8.284 0-15 6.716-15 15s6.716 15 15 15 15-6.716 15-15-6.716-15-15-15z"/></svg>';
                            html += '<span class="annotation-objective-label"><strong>Linked:</strong> ' + txs.length + ' transaction' + (txs.length !== 1 ? 's' : '') + ' to ' + fundName + '</span>';
                            html += '</div>';
                        });
                    }
                    
                    // Show flagged transactions summary
                    if (flaggedTxs.length > 0) {
                        const suspiciousCount = flaggedTxs.filter(tx => tx.flag === 'suspicious').length;
                        const reviewCount = flaggedTxs.filter(tx => tx.flag === 'review').length;
                        const clearedCount = flaggedTxs.filter(tx => tx.flag === 'cleared').length;
                        
                        if (suspiciousCount > 0) {
                            html += '<div class="annotation-objective-item">';
                            html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#f44336" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>';
                            html += '<span class="annotation-objective-label"><strong>Flagged:</strong> ' + suspiciousCount + ' suspicious transaction' + (suspiciousCount !== 1 ? 's' : '') + '</span>';
                            html += '</div>';
                        }
                        if (reviewCount > 0) {
                            html += '<div class="annotation-objective-item">';
                            html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#ff9800" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
                            html += '<span class="annotation-objective-label"><strong>Review:</strong> ' + reviewCount + ' transaction' + (reviewCount !== 1 ? 's' : '') + '</span>';
                            html += '</div>';
                        }
                        if (clearedCount > 0) {
                            html += '<div class="annotation-objective-item">';
                            html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#4caf50" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                            html += '<span class="annotation-objective-label"><strong>Cleared:</strong> ' + clearedCount + ' transaction' + (clearedCount !== 1 ? 's' : '') + '</span>';
                            html += '</div>';
                        }
                    }
                    
                    // Show bank analysis items summary
                    if (review.bankAnalysisItems.length > 0) {
                        const groupItems = review.bankAnalysisItems.filter(i => i.type === 'repeating-group');
                        const chainItems = review.bankAnalysisItems.filter(i => i.type === 'chain');
                        
                        if (groupItems.length > 0) {
                            html += '<div class="annotation-objective-item">';
                            html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#9c27b0" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><circle cx="150" cy="150" r="50" fill="none" stroke="#ffffff" stroke-width="20"/></svg>';
                            html += '<span class="annotation-objective-label"><strong>Repeating Groups:</strong> ' + groupItems.length + ' flagged/linked</span>';
                            html += '</div>';
                        }
                        if (chainItems.length > 0) {
                            html += '<div class="annotation-objective-item">';
                            html += '<svg class="annotation-status-icon" viewBox="0 0 300 300"><path fill="#ff9800" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><circle cx="150" cy="150" r="50" fill="none" stroke="#ffffff" stroke-width="20"/></svg>';
                            html += '<span class="annotation-objective-label"><strong>Chains:</strong> ' + chainItems.length + ' flagged/linked</span>';
                            html += '</div>';
                        }
                    }
                    
                    html += '</div></div></div>'; // Close annotation-mini-objectives, annotation-card-body, annotation-card
                });
            }
        }
        
        html += '</div>';
        
        return html;
    }
    
    /**
     * Find all consider/fail items in task outcomes (recursive)
     * Only returns nested objectives, not top-level tasks
     */
    findConsiderFailItems(taskOutcomes) {
        const items = [];
        
        for (const [taskType, outcome] of Object.entries(taskOutcomes)) {
            // Skip if no outcome or status
            if (!outcome) continue;
            
            // Get reason text for this task
            const reasonText = this.getTaskConsiderReason(taskType, outcome);
            
            // Only add top-level task if it has no nested items but has consider/fail
            const hasNested = (outcome.data && Object.keys(outcome.data).length > 0) || 
                             (outcome.breakdown && Object.keys(outcome.breakdown).length > 0);
            
            // Special case: KYB tasks with unobtainable status should always be annotatable
            const isUnobtainableKybTask = outcome.status === 'unobtainable' && 
                                         (taskType === 'company:ubo' || taskType === 'company:beneficial-check' || 
                                          taskType === 'company:shareholders' || taskType === 'company:summary');
            
            if (isUnobtainableKybTask || (!hasNested && (outcome.result === 'consider' || outcome.result === 'fail'))) {
                items.push({
                    taskType,
                    path: taskType,
                    label: this.getTaskTitle(taskType),
                    status: outcome.result,
                    level: 0,
                    reasonText
                });
            }
            
            // Recursively check nested data and breakdown
            if (outcome.data) {
                const nested = this.findNestedConsiderFail(outcome.data, taskType, taskType, 1, outcome);
                items.push(...nested);
            }
            
            if (outcome.breakdown) {
                const nestedBreakdown = this.findNestedConsiderFail(outcome.breakdown, taskType, taskType, 1, outcome);
                items.push(...nestedBreakdown);
            }
        }
        
        return items;
    }
    
    /**
     * Get consider/fail reason text for display
     */
    getTaskConsiderReason(taskType, outcome) {
        // Handle different task types and their specific reasons
        
        // Skipped tasks
        if (outcome.status === 'skipped') {
            return 'Client skipped in app';
        }
        
        // Unobtainable tasks
        if (outcome.status === 'unobtainable') {
            if (taskType === 'nfc' || taskType === 'biometrics') {
                return 'NFC unobtainable - Original ID completed instead';
            }
            if (taskType === 'company:ubo') {
                const pscsCount = outcome.breakdown?.pscs?.length || 0;
                if (pscsCount > 0) {
                    return `UBO information unobtainable - ${pscsCount} PSC${pscsCount > 1 ? 's' : ''} found from Companies House`;
                }
                return 'UBO information unobtainable - manual review required';
            }
            if (taskType === 'company:beneficial-check') {
                return 'PSC Extract unobtainable - manual review required';
            }
            if (taskType === 'company:shareholders') {
                return 'Shareholders information unobtainable - manual review required';
            }
            return 'Information unobtainable';
        }
        
        // Address/footprint specific
        if (taskType === 'address' || taskType === 'footprint') {
            const rules = outcome.breakdown?.rules || [];
            let reasonText = '';
            
            if (rules.length > 0 && rules[0].text) {
                reasonText = rules[0].text;
            } else {
                reasonText = 'Address verification issues';
            }
            
            // Check if Proof of Address documents exist
            const poaDocs = outcome.breakdown?.documents || [];
            if (poaDocs.length > 0 && (outcome.result === 'consider' || outcome.result === 'fail')) {
                reasonText += ` - Review ${poaDocs.length} uploaded Proof of Address document${poaDocs.length > 1 ? 's' : ''}`;
            }
            
            return reasonText;
        }
        
        // Identity/NFC specific - check for name mismatch details
        if (taskType === 'identity' || taskType === 'nfc') {
            // Check if Enhanced was requested but NFC unobtainable
            if (taskType === 'identity' && outcome.status === 'unobtainable') {
                return 'Enhanced ID requested but Original completed as NFC unobtainable';
            }
            
            // Check NFC data comparison for name mismatch
            const nfcComparison = outcome.breakdown?.nfc?.breakdown?.data_comparison?.breakdown?.name || 
                                 outcome.breakdown?.data_comparison?.breakdown?.name ||
                                 outcome.data?.comparison;
            
            if (nfcComparison && nfcComparison.result === 'consider') {
                const matchPct = nfcComparison.properties?.levenshtein_pct;
                const nfcName = outcome.data?.nfc?.name;
                
                // Get client-entered name
                const clientName = outcome.data?.name;
                let clientNameStr = '';
                if (clientName) {
                    const parts = [clientName.first, clientName.other, clientName.last].filter(p => p);
                    clientNameStr = parts.join(' ');
                }
                
                if (nfcName && clientNameStr && matchPct) {
                    return `Name mismatch: NFC shows "${nfcName}" but client entered "${clientNameStr}" (${matchPct}% match)`;
                } else if (nfcName && matchPct) {
                    return `Name mismatch: NFC shows "${nfcName}" (${matchPct}% match)`;
                } else if (matchPct) {
                    return `Name mismatch detected (${matchPct}% match)`;
                }
            }
            
            // Check for general NFC consider
            if (outcome.breakdown?.nfc?.result === 'consider') {
                return 'NFC verification requires review';
            }
        }
        
        // NFC/Biometrics unobtainable
        if (taskType === 'nfc' || taskType === 'biometrics') {
            if (outcome.status === 'unobtainable') {
                return 'Enhanced ID requested but Original completed as NFC unobtainable';
            }
        }
        
        // Default based on status
        if (outcome.result === 'fail') {
            return 'Failed verification';
        }
        if (outcome.result === 'consider') {
            return 'Requires review';
        }
        
        return '';
    }
    
    /**
     * Recursively find consider/fail in nested objects
     */
    findNestedConsiderFail(obj, taskType, parentPath, level, parentOutcome = null) {
        const items = [];
        
        if (!obj || typeof obj !== 'object') return items;
        
        for (const [key, value] of Object.entries(obj)) {
            if (!value || typeof value !== 'object') continue;
            
            const currentPath = `${parentPath}.${key}`;
            
            // Check if this object has a result field
            if (value.result === 'consider' || value.result === 'fail') {
                // Get reason text - try from this object or parent
                let reasonText = '';
                if (value.text) {
                    reasonText = value.text;
                } else if (value.status === 'unobtainable') {
                    reasonText = 'Information unobtainable';
                } else if (parentOutcome) {
                    reasonText = this.getTaskConsiderReason(taskType, parentOutcome);
                }
                
                items.push({
                    taskType,
                    path: currentPath,
                    label: this.formatObjectivePath(currentPath),
                    status: value.result,
                    level,
                    reasonText
                });
            }
            
            // Recurse deeper
            const deeper = this.findNestedConsiderFail(value, taskType, currentPath, level + 1, parentOutcome || value);
            items.push(...deeper);
        }
        
        return items;
    }
    
    /**
     * Format objective path for display (simplified, no parent task prefix)
     */
    formatObjectivePath(path) {
        const parts = path.split('.');
        
        // Remove first part (task type) and 'breakdown' parts
        const filteredParts = parts
            .slice(1)  // Remove task type prefix (identity, address, etc.)
            .filter(part => part !== 'breakdown' && part !== 'data')  // Remove 'breakdown' and 'data' noise
            .map(part => {
                // Convert snake_case to Title Case
                return part
                    .replace(/_/g, ' ')
                    .replace(/\b\w/g, l => l.toUpperCase());
            });
        
        // If we end up with nothing (top-level task), use the task title
        if (filteredParts.length === 0) {
            // Try to get friendly task title
            const taskTitle = this.getTaskTitle(path);
            // If we got a friendly title, use it; otherwise fall back to formatting the path
            if (taskTitle && taskTitle !== path) {
                return taskTitle;
            }
            // Fallback: format the last part
            return parts[parts.length - 1]
                .replace(/_/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase());
        }
        
        return filteredParts.join(' ');
    }
    
    /**
     * Check if check has consider/fail items
     */
    hasConsiderFailItems(check) {
        if (!check.taskOutcomes || check.status !== 'closed') return false;
        const items = this.findConsiderFailItems(check.taskOutcomes);
        return items.length > 0;
    }
    
    /**
     * Check if check has SoF/Bank tasks
     */
    hasSofBankTasks(check) {
        if (check.status !== 'closed') return false;
        const outcomes = check.taskOutcomes || {};
        return outcomes['sof:v1'] || outcomes['bank:summary'] || outcomes['bank:statement'];
    }
    
    /**
     * Check if check has PEP/Sanctions hits
     * Checks all possible structures: peps, screening:lite, screening (renamed), sanctions, company:peps, company:sanctions
     */
    hasPepSanctionsHits(check) {
        if (check.status !== 'closed') return false;
        const outcomes = check.taskOutcomes || {};
        
        // Individual checks
        const peps = outcomes['peps'];
        const screeningLite = outcomes['screening:lite'];
        const screening = outcomes['screening']; // Could be renamed from 'peps' or 'screening:lite'
        const sanctions = outcomes['sanctions'];
        
        // Company checks (KYB)
        const companyPeps = outcomes['company:peps'];
        const companySanctions = outcomes['company:sanctions'];
        
        // Count hits from all sources
        const pepHits = (peps?.breakdown?.total_hits || 0);
        const screeningLiteHits = (screeningLite?.breakdown?.total_hits || 0);
        const screeningHits = (screening?.breakdown?.total_hits || 0);
        const sanctionHits = (sanctions?.breakdown?.total_hits || 0);
        const companyPepHits = (companyPeps?.breakdown?.total_hits || 0);
        const companySanctionHits = (companySanctions?.breakdown?.total_hits || 0);
        
        const totalHits = pepHits + screeningLiteHits + screeningHits + sanctionHits + companyPepHits + companySanctionHits;
        
        return totalHits > 0;
    }
    
    /**
     * Render Consider Overlay with update queue system
     */
    renderConsiderOverlay(check) {
        const items = this.findConsiderFailItems(check.taskOutcomes);
        const existingAnnotations = check.considerAnnotations || [];
        
        // Initialize pending updates array
        if (!this.pendingUpdates) {
            this.pendingUpdates = [];
        }
        
        // Build overlay HTML
        let overlayHTML = '<div class="annotation-overlay" id="considerOverlay">';
        overlayHTML += '<div class="annotation-overlay-backdrop" onclick="manager.closeConsiderOverlay()"></div>';
        overlayHTML += '<div class="annotation-overlay-content">';
        
        // Header with SAVE and EXPORT PDF buttons
        overlayHTML += '<div class="annotation-overlay-header">';
        overlayHTML += '<h2>Update Task Outcomes</h2>';
        overlayHTML += '<div class="header-actions">';
        overlayHTML += '<button class="btn-secondary-small" onclick="manager.generateConsiderPDF()" style="margin-right: 8px;">EXPORT PDF</button>';
        if (this.mode === 'edit') {
            overlayHTML += '<button class="btn-primary-small" onclick="manager.savePendingUpdates()" id="saveAllBtn" disabled>SAVE</button>';
        }
        overlayHTML += '<button class="overlay-close-btn" onclick="manager.closeConsiderOverlay()">&#x2715;</button>';
        overlayHTML += '</div></div>';
        
        overlayHTML += '<div class="annotation-overlay-body">';
        
        // Updates to add section (queue)
        overlayHTML += '<div class="updates-queue-section">';
        overlayHTML += '<h3>Updates to add</h3>';
        overlayHTML += '<div id="updatesQueue" class="updates-queue">';
        if (this.pendingUpdates.length === 0) {
            overlayHTML += '<p class="text-muted">No updates queued. Select objectives below and add an update.</p>';
        }
        overlayHTML += '</div></div>';
        
        // Add Update section
        if (this.mode === 'edit') {
            overlayHTML += '<div class="add-update-section">';
            overlayHTML += '<h3>Add Update</h3>';
            
            // Group items by task type
            const groupedItems = {};
            items.forEach(item => {
                if (!groupedItems[item.taskType]) {
                    groupedItems[item.taskType] = [];
                }
                groupedItems[item.taskType].push(item);
            });
            
            // Checkboxes for objectives
            overlayHTML += '<div class="objectives-grid">';
            for (const [taskType, taskItems] of Object.entries(groupedItems)) {
                overlayHTML += '<div class="objective-column">';
                overlayHTML += `<h4>${this.getTaskTitle(taskType)}</h4>`;
                
                // Show reason text once for the task group
                if (taskItems[0].reasonText) {
                    overlayHTML += '<p class="task-reason-text">' + taskItems[0].reasonText + '</p>';
                }
                
                taskItems.forEach(item => {
                    overlayHTML += '<label class="objective-radio">';
                    overlayHTML += `<input type="checkbox" name="objectives" value="${item.path}" data-task="${taskType}" data-status="${item.status}" data-label="${item.label}">`;
                    overlayHTML += '<span>' + item.label + '</span>';
                    overlayHTML += '</label>';
                });
                
                overlayHTML += '</div>';
            }
            overlayHTML += '</div>';
            
            // Status dropdown
            overlayHTML += '<div class="form-group">';
            overlayHTML += '<label for="updateStatus">Status</label>';
            overlayHTML += '<select id="updateStatus">';
            overlayHTML += '<option value="clear">CLEAR</option>';
            overlayHTML += '<option value="consider">CONSIDER</option>';
            overlayHTML += '<option value="fail">FAIL</option>';
            overlayHTML += '</select></div>';
            
            // Reason textarea
            overlayHTML += '<div class="form-group">';
            overlayHTML += '<label for="updateReason">Reason</label>';
            overlayHTML += '<textarea id="updateReason" rows="3" placeholder="Explain the reason for this status update..."></textarea>';
            overlayHTML += '</div>';
            
            // Add update button
            overlayHTML += '<button type="button" class="btn-add-update" onclick="manager.addUpdateToQueue()">Add update</button>';
            
            overlayHTML += '</div>';
        }
        
        // Show existing annotations from database (grouped by user + timestamp + newStatus)
        if (existingAnnotations.length > 0) {
            overlayHTML += '<div class="annotation-history-section">';
            overlayHTML += '<h3>Previous Updates</h3>';
            
            // Group annotations by user + timestamp + newStatus
            const groups = {};
            existingAnnotations.forEach(ann => {
                const groupKey = `${ann.user}_${ann.timestamp}_${ann.newStatus}`;
                if (!groups[groupKey]) {
                    groups[groupKey] = {
                        user: ann.userName || ann.user,
                        timestamp: ann.timestamp,
                        newStatus: ann.newStatus,
                        reason: ann.reason,
                        objectives: []
                    };
                }
                groups[groupKey].objectives.push({
                    path: ann.objectivePath,
                    originalStatus: ann.originalStatus,
                    newStatus: ann.newStatus
                });
            });
            
            // Render each group as a mini card (same as task cards)
            Object.values(groups).forEach(group => {
                const date = new Date(group.timestamp).toLocaleString('en-GB', { 
                    day: '2-digit', 
                    month: 'short', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                overlayHTML += '<div class="annotation-mini-card">';
                overlayHTML += '<div class="annotation-mini-header">';
                overlayHTML += '<div class="annotation-mini-meta">';
                overlayHTML += '<strong>' + group.user + '</strong> &#x2022; ' + date;
                overlayHTML += '</div>';
                overlayHTML += '</div>';
                overlayHTML += '<div class="annotation-mini-body">';
                overlayHTML += '<p class="annotation-mini-reason">' + group.reason + '</p>';
                overlayHTML += '<div class="annotation-mini-objectives">';
                
                // Show all affected objectives with their status icons
                group.objectives.forEach(obj => {
                    const statusIcon = this.getStatusIconSVG(obj.newStatus);
                    overlayHTML += '<div class="annotation-objective-item">';
                    overlayHTML += statusIcon;
                    overlayHTML += '<span class="annotation-objective-label">' + this.formatObjectivePath(obj.path) + '</span>';
                    overlayHTML += '</div>';
                });
                
                overlayHTML += '</div></div></div>';
            });
            
            overlayHTML += '</div>';
        }
        
        overlayHTML += '</div></div></div>';
        
        // Add to DOM
        document.body.insertAdjacentHTML('beforeend', overlayHTML);
        
        // Render any pending updates
        this.renderPendingUpdates();
    }
    
    /**
     * Add selected objectives to update queue
     */
    addUpdateToQueue() {
        const selectedObjectives = Array.from(document.querySelectorAll('#considerOverlay input[name="objectives"]:checked'));
        const status = document.getElementById('updateStatus').value;
        const reason = document.getElementById('updateReason').value.trim();
        
        if (selectedObjectives.length === 0) {
            alert('Please select at least one objective');
            return;
        }
        
        if (!reason) {
            alert('Please provide a reason');
            return;
        }
        
        // Create update object
        const update = {
            id: Date.now(),
            objectives: selectedObjectives.map(cb => ({
                path: cb.value,
                taskType: cb.dataset.task,
                label: cb.dataset.label,
                originalStatus: cb.dataset.status
            })),
            status,
            reason
        };
        
        this.pendingUpdates.push(update);
        
        // Clear form
        selectedObjectives.forEach(cb => cb.checked = false);
        document.getElementById('updateReason').value = '';
        
        // Re-render queue
        this.renderPendingUpdates();
        
        // Enable save button
        document.getElementById('saveAllBtn').disabled = false;
    }
    
    /**
     * Render pending updates queue (styled like task cards)
     */
    renderPendingUpdates() {
        const queueContainer = document.getElementById('updatesQueue');
        if (!queueContainer) return;
        
        if (this.pendingUpdates.length === 0) {
            queueContainer.innerHTML = '<p class="text-muted">No updates queued. Select objectives below and add an update.</p>';
            return;
        }
        
        let queueHTML = '';
        this.pendingUpdates.forEach(update => {
            const taskTitle = this.getTaskTitle(update.objectives[0].taskType);
            
            // Get status icon based on new status
            let statusIcon = '';
            let borderClass = '';
            
            if (update.status === 'clear') {
                borderClass = 'clear';
                statusIcon = '<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
            } else if (update.status === 'consider') {
                borderClass = 'consider';
                statusIcon = '<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
            } else if (update.status === 'fail') {
                borderClass = 'alert';
                statusIcon = '<svg class="task-status-icon" viewBox="0 0 300 300"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>';
            }
            
            // Get icon code based on status
            let objectiveIconCode = 'CL';  // Default clear
            if (update.status === 'consider') {
                objectiveIconCode = 'CO';
            } else if (update.status === 'fail') {
                objectiveIconCode = 'AL';
            }
            
            // Build objectives list with matching status icons
            let objectivesHTML = '<div class="task-checks-grid">';
            update.objectives.forEach(obj => {
                objectivesHTML += '<div class="task-check-item">';
                objectivesHTML += this.getTaskCheckIcon(objectiveIconCode);
                objectivesHTML += '<span class="task-check-text">' + obj.label + '</span>';
                objectivesHTML += '</div>';
            });
            objectivesHTML += '</div>';
            
            // Render as task card
            queueHTML += '<div class="task-card update-queue-card ' + borderClass + '">';
            queueHTML += '<div class="task-header">';
            queueHTML += statusIcon;
            queueHTML += '<div class="task-title">' + taskTitle + '</div>';
            queueHTML += '<button class="remove-update-btn" onclick="manager.removeUpdateFromQueue(' + update.id + ')" title="Remove from queue">';
            queueHTML += '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">';
            queueHTML += '<path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>';
            queueHTML += '</svg>';
            queueHTML += '</button>';
            queueHTML += '</div>';
            queueHTML += '<div class="task-details" style="display: block;">';
            queueHTML += '<div class="update-reason-text">' + update.reason + '</div>';
            queueHTML += objectivesHTML;
            queueHTML += '</div></div>';
        });
        
        queueContainer.innerHTML = queueHTML;
    }
    
    /**
     * Remove update from queue
     */
    removeUpdateFromQueue(updateId) {
        this.pendingUpdates = this.pendingUpdates.filter(u => u.id !== updateId);
        this.renderPendingUpdates();
        
        // Disable save button if queue is empty
        if (this.pendingUpdates.length === 0) {
            const saveBtn = document.getElementById('saveAllBtn');
            if (saveBtn) saveBtn.disabled = true;
        }
    }
    
    /**
     * Save all pending updates
     */
    savePendingUpdates() {
        if (this.pendingUpdates.length === 0) {
            alert('No updates to save');
            return;
        }
        
        const check = this.currentCheck;
        
        // Convert pending updates to annotations format
        const annotations = [];
        this.pendingUpdates.forEach(update => {
            update.objectives.forEach(obj => {
                annotations.push({
                    taskType: obj.taskType,
                    objectivePath: obj.path,
                    originalStatus: obj.originalStatus,
                    newStatus: update.status,
                    reason: update.reason,
                    timestamp: new Date().toISOString()
                });
            });
        });
        
        // Send to parent and wait for success
        this.sendMessage('save-consider-annotations', {
            checkId: check.checkId || check.transactionId,
            annotations
        });
        
        // Store context for success handler (including annotations for PDF generation)
        this.pendingSave = {
            type: 'consider',
            check: check,
            annotations: annotations
        };
        
        // Clear pending updates
        this.pendingUpdates = [];
    }
    
    closeConsiderOverlay() {
        const overlay = document.getElementById('considerOverlay');
        if (overlay) overlay.remove();
        // Clear pending updates when closing
        this.pendingUpdates = [];
    }
    
    /**
     * Render SoF Overlay
     */
    renderSofOverlay(check) {
        const outcomes = check.taskOutcomes || {};
        const sofTask = outcomes['sof:v1'];
        const bankSummary = outcomes['bank:summary'];
        const bankStatement = outcomes['bank:statement'];
        const existingAnnotations = check.sofAnnotations || [];
        
        const breakdown = sofTask?.breakdown || {};
        const funds = breakdown.funds || [];
        const property = breakdown.property || {};
        
        // Get accounts and matches - check all possible sources
        const docsBankStatement = outcomes['documents:bank-statement'];
        const accounts = bankStatement?.breakdown?.accounts || 
                        bankSummary?.breakdown?.accounts || 
                        docsBankStatement?.breakdown?.accounts || {};
        const sofMatches = bankSummary?.breakdown?.analysis?.sof_matches || 
                          bankStatement?.breakdown?.analysis?.sof_matches || 
                          docsBankStatement?.breakdown?.analysis?.sof_matches || {};
        
        // Get bank analysis data
        const analysis = bankStatement?.breakdown?.analysis || bankSummary?.breakdown?.analysis || {};
        const chains = analysis.chain_analysis || [];
        const largeTransactions = analysis.largest_individual_transactions || [];
        
        let overlayHTML = '<div class="annotation-overlay sof-investigation-overlay" id="sofOverlay">';
        overlayHTML += '<div class="annotation-overlay-backdrop" onclick="manager.closeSofOverlay()"></div>';
        overlayHTML += '<div class="annotation-overlay-content">';
        
        // Header with SAVE and EXPORT PDF buttons
        overlayHTML += '<div class="annotation-overlay-header">';
        overlayHTML += '<h2>Source of Funds Investigation</h2>';
        overlayHTML += '<div class="header-actions">';
        overlayHTML += '<button class="btn-secondary-small" onclick="manager.generateSofPDF()" style="margin-right: 8px;">EXPORT PDF</button>';
        if (this.mode === 'edit') {
            overlayHTML += '<button class="btn-primary-small" type="button" onclick="manager.saveSofInvestigation()">SAVE</button>';
        }
        overlayHTML += '<button class="overlay-close-btn" onclick="manager.closeSofOverlay()">&#x2715;</button>';
        overlayHTML += '</div></div>';
        
        overlayHTML += '<div class="annotation-overlay-body">';
        overlayHTML += '<form id="sofInvestigationForm">';
        
        // Property Info Section (from task card)
        if (property.address) {
            const addr = property.address;
            const fullAddress = `${addr.building_number || ''} ${addr.street || ''}, ${addr.town || ''}, ${addr.postcode || ''}`.trim();
            const price = property.price ? `&#xA3;${(property.price / 100).toLocaleString()}` : 'Not specified';
            const sdlt = property.stamp_duty ? `&#xA3;${(property.stamp_duty / 100).toLocaleString()}` : 'Not specified';
            const newBuild = property.new_build ? 'Yes' : 'No';
            
            // Check for existing property review
            const propertyReview = existingAnnotations.find(ann => ann.notes?.property);
            const wasReviewed = propertyReview?.notes?.property?.reviewed || false;
            const existingPropertyNote = propertyReview?.notes?.property?.note || '';
            
            overlayHTML += '<div class="sof-section">';
            overlayHTML += '<h3>Property Details</h3>';
            overlayHTML += '<div class="sof-property-details">';
            overlayHTML += `<div class="property-bullet">&#xD83D;&#xDCCD; <strong>Property:</strong> ${fullAddress}</div>`;
            overlayHTML += `<div class="property-bullet">&#xD83D;&#xDCB7; <strong>Purchase Price:</strong> ${price}</div>`;
            overlayHTML += `<div class="property-bullet">&#xD83D;&#xDCCB; <strong>Stamp Duty:</strong> ${sdlt}</div>`;
            overlayHTML += `<div class="property-bullet"> <strong>New Build:</strong> ${newBuild}</div>`;
            overlayHTML += '</div>';
            
            // Property review section
            overlayHTML += '<div class="property-review-section">';
            overlayHTML += '<label class="property-reviewed-label">';
            overlayHTML += `<input type="checkbox" class="property-reviewed-checkbox" ${wasReviewed ? 'checked' : ''}>`;
            overlayHTML += '<strong>Property Reviewed</strong>';
            overlayHTML += '</label>';
            overlayHTML += '<div class="form-group" style="margin-top: 8px;">';
            overlayHTML += '<label><strong>Property Notes</strong></label>';
            overlayHTML += `<textarea class="property-note-input" rows="2" placeholder="Add notes about the property...">${existingPropertyNote}</textarea>`;
            overlayHTML += '</div>';
            overlayHTML += '</div>';
            
            overlayHTML += '</div>';
        }
        
        // Get red flags to associate with funding methods
        const redFlags = this.extractRedFlags(check);
        
        // Linked Bank Accounts Section
        if (Object.keys(accounts).length > 0) {
            overlayHTML += '<div class="sof-section">';
            overlayHTML += '<h3>Linked Bank Accounts</h3>';
            overlayHTML += '<div class="accounts-investigation-container">';
            
            Object.entries(accounts).forEach(([accountId, accountData], accountIdx) => {
                overlayHTML += this.createAccountInvestigationCard(accountId, accountData, accountIdx, sofMatches, existingAnnotations, check);
            });
            
            overlayHTML += '</div></div>';
        }
        
        // Funding Methods Section
        if (funds.length > 0) {
            overlayHTML += '<div class="sof-section">';
            overlayHTML += '<h3>Funding Methods</h3>';
            overlayHTML += '<div class="funding-methods-investigation-container">';
            
            funds.forEach((fund, fundIdx) => {
                // Find red flags related to this funding method
                const relatedFlags = this.getRelatedRedFlags(fund, redFlags);
                overlayHTML += this.createSofFundingCard(fund, fundIdx, sofMatches, accounts, check, relatedFlags, existingAnnotations);
            });
            
            overlayHTML += '</div>';
            overlayHTML += '</div>';
        }
        
        // Bank Analysis Section - Full analysis with selectable items
        if (Object.keys(analysis).length > 0 && Object.keys(accounts).length > 0) {
            overlayHTML += '<div class="sof-section">';
            overlayHTML += '<h3>Bank Analysis</h3>';
            overlayHTML += '<p class="section-hint">Select transactions, chains, or groups to flag or add comments</p>';
            
            // Render full bank analysis sections with selectable items
            overlayHTML += this.createSofBankAnalysisSections(analysis, accounts, check, existingAnnotations);
            
            overlayHTML += '</div>';
        }
        
        // Biggest Transactions by Currency Section (from bank:summary)
        const summaryByCcy = bankSummary?.breakdown?.summary?.by_ccy;
        if (summaryByCcy && Object.keys(summaryByCcy).length > 0) {
            overlayHTML += '<div class="sof-section">';
            overlayHTML += '<h3>Largest Transactions by Currency</h3>';
            overlayHTML += '<p class="section-hint">Top transactions for each currency with flag and comment options</p>';
            
            // Render biggest transactions section with flag buttons
            overlayHTML += this.createSofBiggestTransactionsSection(summaryByCcy, accounts, check, existingAnnotations);
            
            overlayHTML += '</div>';
        }
        
        // Previous Annotations Section
        if (existingAnnotations.length > 0) {
            overlayHTML += '<div class="annotation-history-section">';
            overlayHTML += '<h3>Investigation History</h3>';
            
            existingAnnotations.forEach((annotation, annIdx) => {
                // Format date nicely
                const dateObj = new Date(annotation.timestamp);
                const formattedDate = dateObj.toLocaleDateString('en-GB', { 
                    day: '2-digit', 
                    month: 'short', 
                    year: 'numeric' 
                }) + ' at ' + dateObj.toLocaleTimeString('en-GB', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                // Format user name
                const userName = annotation.userName || annotation.user || 'Unknown';
                const formattedUserName = userName
                    .split(/[-._]/)
                    .map(part => part.charAt(0).toUpperCase() + part.slice(1).toLowerCase())
                    .join(' ');
                
                const notes = annotation.notes || {};
                
                // Calculate summary tags
                const summaryTags = [];
                
                // Property
                if (notes.property) {
                    summaryTags.push({ label: 'Property', type: 'neutral' });
                }
                
                // Accounts
                if (notes.accounts && notes.accounts.length > 0) {
                    summaryTags.push({ label: `${notes.accounts.length} Account${notes.accounts.length > 1 ? 's' : ''}`, type: 'neutral' });
                }
                
                // Transactions
                if (notes.transactions && notes.transactions.length > 0) {
                    summaryTags.push({ label: `${notes.transactions.length} Transaction${notes.transactions.length > 1 ? 's' : ''}`, type: 'neutral' });
                }
                
                // Chains
                if (notes.chains && notes.chains.length > 0) {
                    summaryTags.push({ label: `${notes.chains.length} Chain${notes.chains.length > 1 ? 's' : ''}`, type: 'neutral' });
                }
                
                // Funding Methods with red flag status
                if (notes.fundingMethods && notes.fundingMethods.length > 0) {
                    notes.fundingMethods.forEach(fm => {
                        // Better formatting for funding types
                        let fundLabel = (fm.fundType || '').replace('fund:', '');
                        
                        // Map specific types to friendly names
                        const typeMap = {
                            'mortgage': 'Mortgage',
                            'savings': 'Savings',
                            'gift': 'Gift',
                            'sale-property': 'Property Sale',
                            'sale:property': 'Property Sale',
                            'sale-assets': 'Asset Sale',
                            'sale:assets': 'Asset Sale',
                            'inheritance': 'Inheritance',
                            'htb': 'Help to Buy / LISA',
                            'htb_lisa': 'Help to Buy / LISA',
                            'investment': 'Investment',
                            'business': 'Business Income',
                            'loan': 'Loan',
                            'income': 'Income',
                            'other': 'Other'
                        };
                        
                        fundLabel = typeMap[fundLabel] || fundLabel.replace(/[-:_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        
                        // Check for red flags and their statuses
                        if (fm.redFlags && fm.redFlags.length > 0) {
                            const confirmedCount = fm.redFlags.filter(rf => rf.status === 'confirmed').length;
                            const dismissedCount = fm.redFlags.filter(rf => rf.status === 'dismissed').length;
                            const pendingCount = fm.redFlags.filter(rf => !rf.status || rf.status === 'pending').length;
                            
                            if (confirmedCount > 0) {
                                summaryTags.push({ label: `${fundLabel}: ${confirmedCount} Confirmed`, type: 'confirmed' });
                            }
                            if (dismissedCount > 0) {
                                summaryTags.push({ label: `${fundLabel}: ${dismissedCount} Dismissed`, type: 'dismissed' });
                            }
                            if (pendingCount > 0) {
                                summaryTags.push({ label: `${fundLabel}: ${pendingCount} Pending`, type: 'pending' });
                            }
                        } else {
                            summaryTags.push({ label: fundLabel, type: 'neutral' });
                        }
                    });
                }
                
                overlayHTML += `<div class="annotation-card collapsed" data-annotation-idx="${annIdx}">`;
                overlayHTML += `<div class="annotation-card-header" onclick="manager.toggleAnnotationCard(event, ${annIdx});">`;
                overlayHTML += '<div class="annotation-header-main">';
                overlayHTML += '<span class="annotation-user">' + formattedUserName + '</span>';
                overlayHTML += '<span class="annotation-date">' + formattedDate + '</span>';
                overlayHTML += '</div>';
                
                // Summary tags
                if (summaryTags.length > 0) {
                    overlayHTML += '<div class="annotation-summary-tags">';
                    summaryTags.forEach(tag => {
                        overlayHTML += `<span class="annotation-summary-tag ${tag.type}">${tag.label}</span>`;
                    });
                    overlayHTML += '</div>';
                }
                
                overlayHTML += '<span class="expand-indicator">&#x25BC;</span>';
                overlayHTML += '</div>';
                overlayHTML += '<div class="annotation-card-body">';
                
                // Show property review
                if (notes.property) {
                    overlayHTML += '<div class="prev-annotation-item">';
                    overlayHTML += '<strong>Property:</strong> ';
                    if (notes.property.reviewed) {
                        const reviewIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                        overlayHTML += '<span class="prev-status">' + reviewIcon + 'Reviewed</span>';
                    }
                    if (notes.property.note) overlayHTML += '<div class="prev-note">' + notes.property.note + '</div>';
                    overlayHTML += '</div>';
                }
                
                // Show account reviews
                if (notes.accounts && notes.accounts.length > 0) {
                    notes.accounts.forEach(acc => {
                        overlayHTML += '<div class="prev-annotation-item">';
                        overlayHTML += '<strong>Account ' + acc.accountIdx + ':</strong> ';
                        if (acc.reviewed) {
                            const reviewIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                            overlayHTML += '<span class="prev-status">' + reviewIcon + 'Reviewed</span>';
                        }
                        if (acc.note) overlayHTML += '<div class="prev-note">' + acc.note + '</div>';
                        overlayHTML += '</div>';
                    });
                }
                
                // Show transaction flags/notes
                if (notes.transactions && notes.transactions.length > 0) {
                    const txCount = notes.transactions.length;
                    overlayHTML += '<div class="prev-annotation-item">';
                    overlayHTML += '<strong>Transactions:</strong> ' + txCount + ' transaction' + (txCount > 1 ? 's' : '') + ' reviewed';
                    
                    const flagCounts = {};
                    notes.transactions.forEach(tx => {
                        if (tx.flag) {
                            flagCounts[tx.flag] = (flagCounts[tx.flag] || 0) + 1;
                        }
                    });
                    
                    if (Object.keys(flagCounts).length > 0) {
                        overlayHTML += '<div class="prev-tx-flags" style="margin-top: 4px; display: flex; gap: 4px; flex-wrap: wrap;">';
                        if (flagCounts.linked) overlayHTML += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e3f2fd; color: #2196f3; border: 1px solid #2196f3;">&#x2713; ' + flagCounts.linked + ' linked</span>';
                        if (flagCounts.suspicious) overlayHTML += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #ffebee; color: #f44336; border: 1px solid #f44336;">&#x2717; ' + flagCounts.suspicious + ' suspicious</span>';
                        if (flagCounts.review) overlayHTML += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #fff3e0; color: #ff9800; border: 1px solid #ff9800;">&#x2014; ' + flagCounts.review + ' review</span>';
                        if (flagCounts.cleared) overlayHTML += '<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #e8f5e9; color: #4caf50; border: 1px solid #4caf50;">&#x25CB; ' + flagCounts.cleared + ' cleared</span>';
                        overlayHTML += '</div>';
                    }
                    overlayHTML += '</div>';
                }
                
                // Show chains reviewed
                if (notes.chains && notes.chains.length > 0) {
                    overlayHTML += '<div class="prev-annotation-item">';
                    overlayHTML += '<strong>Transaction Chains:</strong> ' + notes.chains.length + ' chain' + (notes.chains.length > 1 ? 's' : '') + ' reviewed';
                    overlayHTML += '</div>';
                }
                
                // Show funding method annotations
                if (notes.fundingMethods && notes.fundingMethods.length > 0) {
                    notes.fundingMethods.forEach(fm => {
                        overlayHTML += '<div class="prev-annotation-item">';
                        
                        // Use friendly names for funding types
                        let fundLabel = (fm.fundType || '').replace('fund:', '');
                        const typeMap = {
                            'mortgage': 'Mortgage',
                            'savings': 'Savings',
                            'gift': 'Gift',
                            'sale-property': 'Property Sale',
                            'sale:property': 'Property Sale',
                            'sale-assets': 'Asset Sale',
                            'sale:assets': 'Asset Sale',
                            'inheritance': 'Inheritance',
                            'htb': 'Help to Buy / LISA',
                            'htb_lisa': 'Help to Buy / LISA',
                            'investment': 'Investment',
                            'business': 'Business Income',
                            'loan': 'Loan',
                            'income': 'Income',
                            'other': 'Other'
                        };
                        fundLabel = typeMap[fundLabel] || fundLabel.replace(/[-:_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        
                        overlayHTML += '<strong>' + fundLabel + ':</strong>';
                        
                        if (fm.verified && fm.verified.length > 0) {
                            const verificationLabelMap = {
                                'gift_relationship': 'Giftor relationship confirmed',
                                'gift_checks': 'Giftor ID and AML checks completed',
                                'gift_transactions': 'Transactions reviewed and linked',
                                'savings_statements': 'Account statements reviewed',
                                'savings_balance': 'Balance verified via Bank Summary',
                                'savings_income': 'Income sources verified',
                                'sale_documents': 'Supporting documents reviewed',
                                'sale_proceeds': 'Sale proceeds confirmed',
                                'mortgage_offer': 'Mortgage offer reviewed',
                                'mortgage_affordability': 'Affordability assessment completed',
                                'generic_verified': 'Source verified and documented'
                            };
                            const verifiedLabels = fm.verified.map(v => verificationLabelMap[v] || v.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()));
                            const checkIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                            overlayHTML += '<div class="prev-checkboxes">' + checkIcon + verifiedLabels.join(', ') + '</div>';
                        }
                        
                        if (fm.transactionMarkers && Object.keys(fm.transactionMarkers).length > 0) {
                            const markerCount = Object.keys(fm.transactionMarkers).length;
                            overlayHTML += '<div class="prev-tx-markers">' + markerCount + ' transaction marker' + (markerCount > 1 ? 's' : '') + '</div>';
                        }
                        
                        if (fm.redFlags && fm.redFlags.length > 0) {
                            overlayHTML += '<div class="prev-red-flags">';
                            fm.redFlags.forEach(rf => {
                                let statusIcon = '';
                                if (rf.status === 'confirmed') {
                                    statusIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"><path fill="#d32f2f" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
                                } else if (rf.status === 'dismissed') {
                                    statusIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                                } else {
                                    statusIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
                                }
                                overlayHTML += '<div class="prev-red-flag-item">';
                                overlayHTML += statusIcon + 'Red Flag: ' + (rf.status || 'pending').charAt(0).toUpperCase() + (rf.status || 'pending').slice(1);
                                if (rf.note) overlayHTML += ' - ' + rf.note;
                                overlayHTML += '</div>';
                            });
                            overlayHTML += '</div>';
                        }
                        
                        if (fm.note) {
                            overlayHTML += '<div class="prev-note">' + fm.note + '</div>';
                        }
                        
                        overlayHTML += '</div>';
                    });
                }
                
                overlayHTML += '</div></div>';
            });
            
            overlayHTML += '</div>';
        }
        
        overlayHTML += '</form></div></div></div>';
        
        // Add to DOM
        document.body.insertAdjacentHTML('beforeend', overlayHTML);
    }
    
    createAccountInvestigationCard(accountId, accountData, accountIdx, sofMatches, existingAnnotations, check) {
        const accountInfo = accountData.info || accountData;
        const accountName = accountInfo.name || accountInfo.account_name || 'Account';
        const providerName = accountInfo.provider?.name || 'Bank';
        const balance = accountInfo.balance?.current || accountInfo.balance?.available || 0;
        const statement = accountData.statement || [];
        
        // Check if this is from manual upload (needs deduplication)
        const taskOutcomes = check.taskOutcomes || {};
        const isManualUpload = taskOutcomes['documents:bank-statement']?.breakdown?.accounts?.[accountId];
        
        // Get logo
        const logoHtml = this.getBankLogo(providerName, providerName);
        const hasLogo = logoHtml.includes('<img');
        
        // Check for existing account annotations
        const accountAnnotations = existingAnnotations.flatMap(ann => {
            const accounts = ann.notes?.accounts || [];
            return accounts.filter(acc => acc.accountId === accountId);
        });
        
        const wasReviewed = accountAnnotations.some(acc => acc.reviewed);
        const existingNote = accountAnnotations.length > 0 ? accountAnnotations[0].note : '';
        
        // Get transaction markers, notes, and SOF links from ALL annotation sources
        const transactionMarkers = {};
        const transactionNotes = {};
        const transactionSofLinks = {};
        
        statement.forEach(tx => {
            const txAnnotations = this.getTransactionAnnotations(tx.id, check);
            if (txAnnotations.flag) transactionMarkers[tx.id] = txAnnotations.flag;
            if (txAnnotations.note) transactionNotes[tx.id] = txAnnotations.note;
            if (txAnnotations.linkedFundingMethods.length > 0) {
                transactionSofLinks[tx.id] = txAnnotations.linkedFundingMethods;
            }
            // Also include marker state for visual display
            if (txAnnotations.marker) transactionMarkers[tx.id] = txAnnotations.marker;
        });
        
        // Calculate summary counts for tags
        let linkedCount = 0;
        let reviewCount = 0;
        let flaggedCount = 0;
        
        statement.forEach(tx => {
            const txFlag = transactionMarkers[tx.id];
            const txLinks = transactionSofLinks[tx.id];
            
            if (txLinks && txLinks.length > 0) linkedCount++;
            if (txFlag === 'review') reviewCount++;
            if (txFlag === 'suspicious') flaggedCount++;
        });
        
        let html = `<div class="account-investigation-card collapsed" data-account-card="${accountId}">`;
        
        // Account Header - clickable to toggle
        html += `<div class="account-investigation-header" onclick="manager.toggleAccountCard(event, '${accountId}');">`;
        
        if (hasLogo) {
            const styledLogoHtml = logoHtml.replace(
                /class="bank-logo"/,
                'class="bank-logo" style="width: auto !important; height: auto !important; max-width: 60px !important; max-height: 40px !important; object-fit: contain !important; border: none !important; background: transparent !important; padding: 0 !important; border-radius: 0 !important;"'
            );
            html += `<div style="width: 60px; height: 40px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">${styledLogoHtml}</div>`;
        } else {
            html += `<div style="font-weight: 600; color: #003c71; font-size: 12px; flex-shrink: 0; width: 60px;">${providerName}</div>`;
        }
        
        html += '<div class="account-investigation-info">';
        html += `<div class="account-investigation-name">`;
        html += accountName;
        // Add tick icon if account reviewed
        if (wasReviewed) {
            html += ' <svg viewBox="0 0 300 300" style="width: 14px; height: 14px; vertical-align: middle; margin-left: 4px;"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
        }
        html += `</div>`;
        html += `<div class="account-investigation-balance">Balance: &#xA3;${balance.toLocaleString()}</div>`;
        
        // Add summary tags
        html += '<div class="account-summary-tags">';
        if (reviewCount > 0) {
            html += `<span class="account-tag review">${reviewCount} review pending</span>`;
        }
        if (linkedCount > 0) {
            html += `<span class="account-tag linked">${linkedCount} transaction${linkedCount > 1 ? 's' : ''} linked</span>`;
        }
        if (flaggedCount > 0) {
            html += `<span class="account-tag flagged">${flaggedCount} flagged</span>`;
        }
        html += '</div>';
        
        html += '</div>';
        html += '<span class="expand-indicator">&#x25BC;</span>';
        html += '</div>';
        
        // Account Details (expanded)
        html += '<div class="account-investigation-details" onclick="event.stopPropagation();">';
        
        // Account review controls
        html += '<div class="account-review-section">';
        html += '<label class="account-reviewed-label">';
        html += `<input type="checkbox" class="account-reviewed-checkbox" data-account-id="${accountId}" data-account-idx="${accountIdx}" ${wasReviewed ? 'checked' : ''}>`;
        html += '<strong>Account Reviewed</strong>';
        html += '</label>';
        html += '<div class="form-group" style="margin-top: 8px;">';
        html += '<label><strong>Account Notes</strong></label>';
        html += `<textarea class="account-note-input" data-account-id="${accountId}" data-account-idx="${accountIdx}" rows="2" placeholder="Add notes about this account...">${existingNote}</textarea>`;
        html += '</div>';
        html += '</div>';
        
        // Transactions list with flagging capabilities
        if (statement.length > 0) {
            html += '<div class="account-transactions-section">';
            html += `<div class="account-transactions-header">Transactions (${statement.length})</div>`;
            
            statement.forEach((tx, txIdx) => {
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                const currencySymbol = this.getCurrencyFlag(tx.currency || 'GBP');
                const amount = tx.amount;
                const amountClass = amount >= 0 ? 'positive' : 'negative';
                const sign = amount >= 0 ? '+' : '';
                
                const existingFlag = transactionMarkers[tx.id] || '';
                const existingTxNote = transactionNotes[tx.id] || '';
                
                const hasExpanded = existingFlag || existingTxNote || (transactionSofLinks[tx.id] && transactionSofLinks[tx.id].length > 0);
                const linkedFundIdx = (transactionSofLinks[tx.id] && transactionSofLinks[tx.id].length > 0) ? transactionSofLinks[tx.id][0] : '';
                
                html += '<div class="transaction-investigation-row">';
                html += '<div class="transaction-investigation-main">';
                html += '<div class="transaction-investigation-info">';
                html += `<span class="tx-inv-date">${date}</span>`;
                html += `<span class="tx-inv-desc">${tx.description || tx.merchant_name || 'Transaction'}</span>`;
                html += `<span class="tx-inv-amount ${amountClass}">${sign}${currencySymbol}${Math.abs(amount).toFixed(2)}</span>`;
                html += '</div>';
                
                // Transaction flag buttons - small squares inline
                html += '<div class="tx-flag-buttons-inline">';
                // Green - Clear/Verified
                html += `<button type="button" class="tx-flag-btn-square linked ${existingFlag === 'linked' ? 'active' : ''}" data-account-id="${accountId}" data-tx-id="${tx.id}" data-flag="linked" title="Clear - Verified" onclick="event.stopPropagation(); manager.toggleTransactionExpand(this);">`;
                html += '<svg viewBox="0 0 300 300"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                html += '</button>';
                // Red - Suspicious
                html += `<button type="button" class="tx-flag-btn-square suspicious ${existingFlag === 'suspicious' ? 'active' : ''}" data-account-id="${accountId}" data-tx-id="${tx.id}" data-flag="suspicious" title="Suspicious" onclick="event.stopPropagation(); manager.toggleTransactionExpand(this);">`;
                html += '<svg viewBox="0 0 300 300"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>';
                html += '</button>';
                // Orange - Under Review
                html += `<button type="button" class="tx-flag-btn-square review ${existingFlag === 'review' ? 'active' : ''}" data-account-id="${accountId}" data-tx-id="${tx.id}" data-flag="review" title="Under Review" onclick="event.stopPropagation(); manager.toggleTransactionExpand(this);">`;
                html += '<svg viewBox="0 0 300 300"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
                html += '</button>';
                // Blue + - Link to Funding
                html += `<button type="button" class="tx-flag-btn-square link-funding ${linkedFundIdx ? 'active' : ''}" data-account-id="${accountId}" data-tx-id="${tx.id}" data-action="link" title="Link to Funding Method" onclick="event.stopPropagation(); manager.toggleTransactionLinking(this);">`;
                html += '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="none" fill="currentColor"/><path d="M12 6v12M6 12h12" stroke="white" stroke-width="2" fill="none"/></svg>';
                html += '</button>';
                html += '</div>';
                html += '</div>'; // Close transaction-investigation-main
                
                // Expandable sections (hidden by default)
                html += `<div class="tx-expand-section ${hasExpanded ? '' : 'collapsed'}" onclick="event.stopPropagation();">`;
                
                // Manual SOF linking dropdown (only visible when blue + is clicked)
                html += `<div class="tx-sof-linking ${linkedFundIdx ? '' : 'hidden'}">`;
                html += '<label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>';
                html += `<select class="tx-sof-link-select" data-account-id="${accountId}" data-tx-id="${tx.id}" style="width: 100%; font-size: 11px; padding: 6px;">`;
                html += '<option value="">-- Select funding method --</option>';
                
                // Get funding methods from check
                const sofTask = check.taskOutcomes?.['sof:v1'];
                const funds = sofTask?.breakdown?.funds || [];
                funds.forEach((fund, fIdx) => {
                    const fundType = fund.type || '';
                    const fundData = fund.data || {};
                    const fundAmount = fundData.amount ? `&#xA3;${(fundData.amount / 100).toLocaleString()}` : '';
                    const fundLabel = fundType.replace('fund:', '').replace(/:/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    const isSelected = linkedFundIdx === fIdx.toString();
                    html += `<option value="${fIdx}" ${isSelected ? 'selected' : ''}>${fundLabel} ${fundAmount}</option>`;
                });
                
                html += '</select>';
                html += '</div>';
                
                // Transaction note (visible when any button is clicked)
                html += `<div class="tx-note-field">`;
                html += `<textarea class="tx-note-input" data-account-id="${accountId}" data-tx-id="${tx.id}" rows="2" placeholder="Add transaction notes...">${existingTxNote}</textarea>`;
                html += '</div>';
                
                html += '</div>'; // Close tx-expand-section
                
                html += '</div>';
            });
            
            html += '</div>';
        }
        
        html += '</div>'; // Close account-investigation-details
        html += '</div>'; // Close account-investigation-card
        
        return html;
    }
    
    getRelatedRedFlags(fund, allRedFlags) {
        const type = fund.type || '';
        const relatedFlags = [];
        
        allRedFlags.forEach((flag, globalIndex) => {
            const flagDesc = flag.description || '';
            
            // Map red flags to funding types and preserve global index
            if (flagDesc === 'Gifts Received' && type === 'fund:gift') {
                relatedFlags.push({ ...flag, globalIndex });
            } else if (flagDesc.includes('savings') && type === 'fund:savings') {
                relatedFlags.push({ ...flag, globalIndex });
            } else if (flagDesc === 'Cryptocurrency Funding' && type.includes('crypto')) {
                relatedFlags.push({ ...flag, globalIndex });
            } else if (flagDesc === 'Funds from Overseas' && (type.includes('overseas') || type.includes('foreign'))) {
                relatedFlags.push({ ...flag, globalIndex });
            }
        });
        
        return relatedFlags;
    }
    
    createSofFundingCard(fund, fundIdx, sofMatches, accounts, check, relatedFlags = [], existingAnnotations = []) {
        const type = fund.type || 'unknown';
        const data = fund.data || {};
        const amount = data.amount ? `&#xA3;${(data.amount / 100).toLocaleString()}` : 'Not specified';
        
        // Get matched transactions (including user-linked ones)
        const matchedTxIds = this.getMatchedTransactions(type, sofMatches, fund, fundIdx, check);
        const hasMatches = matchedTxIds.length > 0;
        
        // Map funding type to display name
        const cleanType = type.replace('fund:', '').replace(/:/g, '-');
        const typeNames = {
            'mortgage': 'Mortgage',
            'savings': 'Savings',
            'gift': 'Gift',
            'sale-property': 'Sale of Property',
            'sale-assets': 'Sale of Assets',
            'inheritance': 'Inheritance',
            'divorce': 'Divorce',
            'cryptocurrency': 'Cryptocurrency',
            'htb': 'Lifetime ISA',
            'htb_lisa': 'Lifetime ISA',
            'investment': 'Investment',
            'business': 'Business Income',
            'loan': 'Loan',
            'income': 'Income',
            'other': 'Other'
        };
        const typeName = typeNames[cleanType] || cleanType;
        
        // Check for existing annotations for this funding method
        const fundAnnotations = existingAnnotations.flatMap(ann => {
            const fundingMethods = ann.notes?.fundingMethods || [];
            return fundingMethods.filter(fm => fm.fundType === type && fm.fundIdx === fundIdx.toString());
        });
        
        const verifiedItems = fundAnnotations.flatMap(fm => fm.verified || []);
        const hasNote = fundAnnotations.some(fm => fm.note && fm.note.trim());
        
        // Get transaction markers for this funding method from ALL sources
        const fundTransactionMarkers = {};
        
        // First, get markers explicitly set for this funding method
        fundAnnotations.forEach(fm => {
            Object.assign(fundTransactionMarkers, fm.transactionMarkers || {});
        });
        
        // Then, for each matched transaction, also check for annotations from other sources
        matchedTxIds.forEach(txId => {
            const txAnnotations = this.getTransactionAnnotations(txId, check);
            // If there's a marker and we don't already have one for this funding method, use it
            if (txAnnotations.marker && !fundTransactionMarkers[txId]) {
                fundTransactionMarkers[txId] = txAnnotations.marker;
            }
        });
        
        // Format verified items as readable text with proper labels
        const verificationLabelMap = {
            'gift_relationship': 'Giftor relationship confirmed',
            'gift_checks': 'Giftor ID and AML checks completed',
            'gift_transactions': 'Transactions reviewed and linked',
            'savings_statements': 'Account statements reviewed',
            'savings_balance': 'Balance verified via Bank Summary',
            'savings_income': 'Income sources verified',
            'sale_documents': 'Supporting documents reviewed',
            'sale_proceeds': 'Sale proceeds confirmed',
            'mortgage_offer': 'Mortgage offer reviewed',
            'mortgage_affordability': 'Affordability assessment completed',
            'generic_verified': 'Source verified and documented'
        };
        
        const verifiedLabels = verifiedItems.map(item => 
            verificationLabelMap[item] || item.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())
        );
        
        // Calculate transaction status counts
        let acceptedCount = 0;
        let rejectedCount = 0;
        let reviewCount = 0;
        
        matchedTxIds.forEach(txId => {
            const marker = fundTransactionMarkers[txId];
            if (marker === 'accepted') acceptedCount++;
            else if (marker === 'rejected') rejectedCount++;
            else if (marker === 'review') reviewCount++;
        });
        
        let hasRedFlag = relatedFlags.length > 0;
        
        // Build collapsed header summary
        let summaryText = '';
        if (data.giftor?.name) summaryText = data.giftor.name;
        else if (data.lender) summaryText = data.lender;
        else if (data.people && data.people.length > 0) summaryText = data.people.map(p => p.name).filter(n => n).join(', ');
        
        const originBadge = this.getFundingOriginBadge(data.location);

        let html = `<div class="funding-investigation-card collapsed" data-funding-card="${fundIdx}">`;
        
        // Funding Header (collapsed view) - clickable to toggle
        html += `<div class="funding-investigation-header" onclick="manager.toggleFundingCard(event, ${fundIdx});">`;
        html += '<div class="funding-investigation-info">';
        html += `<div class="funding-investigation-name">${typeName}</div>`;
        html += '<div class="funding-investigation-meta">';
        if (originBadge) {
            html += originBadge;
        }
        html += `<span class="funding-investigation-amount">${amount}</span>`;
        html += '</div>';
        if (summaryText) {
            html += `<div class="funding-investigation-summary">${summaryText}</div>`;
        }
        
        // Summary tags
        html += '<div class="funding-summary-tags">';
        if (verifiedLabels.length > 0) {
            html += `<span class="funding-tag confirmed">&#x2713; ${verifiedLabels.join(', ')}</span>`;
        }
        if (acceptedCount > 0) {
            html += `<span class="funding-tag accepted">${acceptedCount} accepted</span>`;
        }
        if (rejectedCount > 0) {
            html += `<span class="funding-tag rejected">${rejectedCount} rejected</span>`;
        }
        if (reviewCount > 0) {
            html += `<span class="funding-tag review-tx">${reviewCount} under review</span>`;
        }
        if (matchedTxIds.length > acceptedCount + rejectedCount + reviewCount) {
            const unmarkedCount = matchedTxIds.length - acceptedCount - rejectedCount - reviewCount;
            html += `<span class="funding-tag linked">${unmarkedCount} unreviewed</span>`;
        }
        if (hasRedFlag) {
            html += `<span class="funding-tag redflag">${relatedFlags.length} red flag${relatedFlags.length > 1 ? 's' : ''}</span>`;
        }
        html += '</div>';
        
        html += '</div>';
        html += '<span class="expand-indicator">&#x25BC;</span>';
        html += '</div>';
        
        // Funding Details (expanded view)
        html += '<div class="funding-investigation-details" onclick="event.stopPropagation();">';
        
        // Type-specific details (same as task card)
        html += this.createFundingDetailsSection(fund, originBadge);
        
        // Matched transactions (same as task card)
        if (hasMatches) {
            html += this.createFundingMatchedTxSection(matchedTxIds, accounts, type, fundTransactionMarkers, check, fundIdx, sofMatches);
        }
        
        // Document status (same as task card)
        const docTaskKey = `documents:${cleanType}`;
        const docOutcome = check.taskOutcomes ? check.taskOutcomes[docTaskKey] : null;
        const documentCount = this.getDocumentCount(docOutcome);
        const hasDocuments = documentCount > 0;
        const docLines = [];
        const defaultReminder = 'Check the report pdf for evidence or obtain from the client and review manually';
        const shouldShowManualReview = !hasMatches && type !== 'fund:mortgage';

        if (hasDocuments) {
            const uploadedLabel = `${documentCount} document${documentCount === 1 ? '' : 's'} uploaded`;
            docLines.push({ status: 'clear', text: uploadedLabel });
            } else {
            docLines.push({ status: 'consider', text: defaultReminder });
        }

        if (shouldShowManualReview) {
            docLines.push({ status: 'consider', text: 'No linked bank transactions detected, manual review required.' });
        }

        if (docLines.length === 0) {
            docLines.push({ status: hasDocuments ? 'clear' : 'consider', text: defaultReminder });
        }
        
        html += '<div class="funding-doc-status">';
        html += '<div class="doc-status-text">';
        docLines.forEach(line => {
            const icon = this.getTaskCheckIcon(line.status === 'clear' ? 'CL' : line.status === 'fail' ? 'FA' : 'CO');
            html += `<div class="doc-status-line">${icon}<span>${line.text}</span></div>`;
        });
        html += '</div>';
        html += '</div>';
        
        // Red Flags Section (if applicable) - Show full details like in task card
        if (relatedFlags.length > 0) {
            const redCircleIcon = `<svg class="inline-icon" viewBox="0 0 24 24" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;"><circle cx="12" cy="12" r="10" fill="#d32f2f"/><line x1="7" y1="12" x2="17" y2="12" stroke="white" stroke-width="2"/></svg>`;
            
            html += '<div class="red-flags-subsection">';
            html += `<div class="red-flag-header">${redCircleIcon}Red Flags</div>`;
            
            relatedFlags.forEach((flag, flagIdx) => {
                html += '<div class="red-flag-item">';
                html += `<div class="red-flag-title">${flag.description || 'Red Flag'}</div>`;
                
                // Show full details based on flag type
                const flagDesc = flag.description || '';
                
                // For savings discrepancy - show declared vs actual with accounts
                if (flagDesc.includes('savings')) {
                    // Get task outcomes for account data
                    const taskOutcomes = check.taskOutcomes || {};
                    const sofTask = taskOutcomes['sof:v1'];
                    const bankStatement = taskOutcomes['bank:statement'];
                    const bankSummary = taskOutcomes['bank:summary'];
                    const docsBankStatement = taskOutcomes['documents:bank-statement'];
                    
                    // Calculate declared savings
                    let totalDeclared = 0;
                    const savingsFunds = sofTask?.breakdown?.funds?.filter(f => f.type === 'fund:savings') || [];
                    savingsFunds.forEach(fund => {
                        totalDeclared += fund.data?.amount || 0;
                    });
                    
                    // Calculate actual savings
                    const bankAccounts = bankStatement?.breakdown?.accounts || 
                                       bankSummary?.breakdown?.accounts || 
                                       docsBankStatement?.breakdown?.accounts || 
                                       {};
                    let totalActual = 0;
                    const providerTotals = {};
                    
                    Object.values(bankAccounts).forEach(account => {
                        const accountInfo = account.info || account;
                        const balance = accountInfo.balance?.current || accountInfo.balance?.available || 0;
                        
                        if (balance > 0) {
                            totalActual += balance;
                            const providerName = accountInfo.provider?.name || 'Unknown Provider';
                            const providerId = accountInfo.provider?.id || providerName;
                            
                            if (!providerTotals[providerId]) {
                                providerTotals[providerId] = {
                                    name: providerName,
                                    total: 0,
                                    accounts: []
                                };
                            }
                            providerTotals[providerId].total += balance;
                            providerTotals[providerId].accounts.push({
                                name: accountInfo.name || accountInfo.account_name || accountInfo.type || 'Account',
                                balance: balance
                            });
                        }
                    });
                    
                    html += `<div class="red-flag-details" style="margin-top: 10px;">`;
                    html += `<div style="font-size: 12px; color: #666; margin-bottom: 8px;"><strong>Declared:</strong> &#xA3;${(totalDeclared / 100).toLocaleString()}</div>`;
                    html += `<div style="font-size: 12px; color: #666; margin-bottom: 8px;"><strong>Actual:</strong> &#xA3;${totalActual.toLocaleString()}</div>`;
                    
                    // Show account breakdown by provider (like in red flags task card)
                    if (Object.keys(providerTotals).length > 0) {
                        html += `<div style="margin-top: 12px;">`;
                        Object.values(providerTotals).forEach(provider => {
                            const logoHtml = this.getBankLogo(provider.name, provider.name);
                            const hasLogo = logoHtml.includes('<img');
                            
                            html += `<div style="display: flex; align-items: stretch; gap: 10px; padding: 10px 12px; background: white; border: 1px solid #e1e4e8; border-radius: 8px; margin-bottom: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">`;
                            
                            if (hasLogo) {
                                // Show logo - full height of card, no border - add inline styles directly to img tag
                                const styledLogoHtml = logoHtml.replace(
                                    /class="bank-logo"/,
                                    'class="bank-logo" style="width: auto !important; height: auto !important; max-width: 90px !important; max-height: 100% !important; object-fit: contain !important; border: none !important; background: transparent !important; padding: 0 !important; border-radius: 0 !important;"'
                                );
                                html += `<div style="width: 90px; flex-shrink: 0; display: flex; align-items: center; justify-content: center;">${styledLogoHtml}</div>`;
                                html += `<div style="flex: 1;">`;
                                html += `<div style="font-size: 13px; font-weight: 600; color: #003c71; margin-bottom: 4px;">&#xA3;${provider.total.toLocaleString()}</div>`;
                                provider.accounts.forEach((acc, idx) => {
                                    html += `<div style="font-size: 10px; color: #666; ${idx < provider.accounts.length - 1 ? 'margin-bottom: 1px;' : ''}">${acc.name}: &#xA3;${acc.balance.toLocaleString()}</div>`;
                                });
                                html += `</div>`;
                            } else {
                                // No logo - show name
                                html += `<div style="flex: 1;">`;
                                html += `<div style="font-size: 13px; font-weight: 600; color: #003c71; margin-bottom: 3px;">${provider.name}</div>`;
                                html += `<div style="font-size: 13px; font-weight: 600; color: #388e3c; margin-bottom: 4px;">&#xA3;${provider.total.toLocaleString()}</div>`;
                                provider.accounts.forEach((acc, idx) => {
                                    html += `<div style="font-size: 10px; color: #666; ${idx < provider.accounts.length - 1 ? 'margin-bottom: 1px;' : ''}">${acc.name}: &#xA3;${acc.balance.toLocaleString()}</div>`;
                                });
                                html += `</div>`;
                            }
                            
                            html += `</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    html += `</div>`;
                } 
                // For gift - don't duplicate giftor info (already shown in funding method details above)
                else if (flagDesc === 'Gifts Received') {
                    html += `<div class="red-flag-details" style="margin-top: 10px; font-size: 12px; color: #666;">Giftor details shown above in funding method</div>`;
                }
                // For other flags - show basic details
                else if (flag.details) {
                    html += `<div class="red-flag-details">${flag.details}</div>`;
                }
                
                // Red flag status selector with icons
                html += '<div class="red-flag-status" style="margin-top: 12px;">';
                html += '<label><strong>Status:</strong></label>';
                html += `<select class="red-flag-status-select" data-fund-idx="${fundIdx}" data-flag-idx="${flag.globalIndex}">`;
                html += '<option value="">-- Select Action --</option>';
                html += '<option value="confirmed">&#x2717; Confirmed - Requires attention</option>';
                html += '<option value="dismissed">&#x2713; Clear - Not applicable</option>';
                html += '<option value="review">&#x2014; Consider - Under review</option>';
                html += '</select>';
                html += '</div>';
                
                // Red flag notes
                html += '<div class="form-group">';
                html += `<label><strong>Red Flag Notes</strong></label>`;
                html += `<textarea class="red-flag-note-input" data-fund-idx="${fundIdx}" data-flag-idx="${flag.globalIndex}" rows="2" placeholder="Add notes about this red flag..."></textarea>`;
                html += '</div>';
                
                html += '</div>';
            });
            
            html += '</div>';
        }
        
        // INVESTIGATION FEATURES
        html += '<div class="funding-investigation-controls">';
        
        // Verification checkboxes
        html += this.createFundingVerificationChecks(type, data, matchedTxIds, existingAnnotations);
        
        // Notes textarea
        html += '<div class="form-group" style="margin-top: 12px;">';
        html += '<label><strong>Investigation Notes</strong></label>';
        html += `<textarea class="sof-note-input" data-fund-idx="${fundIdx}" data-fund-type="${type}" rows="3" placeholder="Add investigation notes..."></textarea>`;
        html += '</div>';
        
        html += '</div>'; // Close funding-investigation-controls
        html += '</div>'; // Close funding-investigation-details
        html += '</div>'; // Close funding-investigation-card
        
        return html;
    }
    
    createFundingDetailsSection(fund, originBadge = '') {
        const detailHtml = this.buildFundingDetailContent(fund, { originBadge });
        if (!detailHtml) return '';
        return `<div class="funding-meta-container">${detailHtml}</div>`;
    }
    
    createFundingMatchedTxSection(matchedTxIds, accounts, type, transactionMarkers = {}, check = null, fundIdx = null, sofMatches = {}) {
        const labelMap = {
            'fund:gift': 'Potential Gift Deposits',
            'fund:mortgage': 'Potential Mortgage Deposits',
            'fund:savings': 'Verified Salary Deposits',
            'fund:income': 'Verified Salary Deposits',
            'fund:property_sale': 'Potential Property Sale Proceeds',
            'fund:sale:property': 'Potential Property Sale Proceeds',
            'fund:asset_sale': 'Potential Asset Sale Proceeds',
            'fund:sale:assets': 'Potential Asset Sale Proceeds',
            'fund:htb': 'Potential Lifetime ISA Deposits',
            'fund:htb_lisa': 'Potential Lifetime ISA Deposits',
            'fund:inheritance': 'Potential Inheritance Deposits',
            'fund:loan': 'Potential Loan Deposits',
            'fund:investment': 'Potential Investment Deposits',
            'fund:business': 'Potential Business Income',
            'fund:other': 'Potential Matched Transactions'
        };
        const matchLabel = labelMap[type] || 'Potential Matched Transactions';
        
        // Get comprehensive annotations for all transactions from ALL sources
        const userLinkedTxIds = new Set();
        const transactionNotes = {};
        const transactionFlags = {};
        
        if (check && fundIdx !== null) {
            // Use getTransactionAnnotations for each transaction to get ALL sources
            matchedTxIds.forEach(txId => {
                const txAnnotations = this.getTransactionAnnotations(txId, check);
                
                // Check if linked to THIS funding method
                if (txAnnotations.linkedFundingMethods.includes(fundIdx.toString())) {
                    userLinkedTxIds.add(txId);
                }
                
                // Get notes from all sources
                if (txAnnotations.note) {
                    transactionNotes[txId] = txAnnotations.note;
                }
                
                // Get flags from bank analysis items
                if (txAnnotations.flag) {
                    transactionFlags[txId] = txAnnotations.flag;
                }
            });
        }
        
        // Get Thirdfort auto-matched transaction IDs
        const autoMatchedTxIds = new Set();
        const fundTypeMap = {
            'fund:gift': ['gift', 'gift_transactions'],
            'fund:mortgage': ['mortgage', 'mortgage_transactions'],
            'fund:savings': ['savings', 'savings_transactions', 'salary_transactions'],
            'fund:income': ['salary_transactions', 'income_transactions']
        };
        const matchKeys = fundTypeMap[type] || [];
        matchKeys.forEach(key => {
            if (sofMatches[key] && Array.isArray(sofMatches[key])) {
                sofMatches[key].forEach(txId => autoMatchedTxIds.add(txId));
            }
        });
        
        let html = '<div class="matched-transactions-section"><div class="matched-tx-label">' + matchLabel + '</div>';
        
        matchedTxIds.forEach(txId => {
            let tx = null;
            let accountName = '';
            for (const [accountId, accountData] of Object.entries(accounts)) {
                const statement = accountData.statement || [];
                tx = statement.find(t => t.id === txId);
                if (tx) {
                    accountName = (accountData.info || accountData).name || 'Account';
                    break;
                }
            }
            
            if (tx) {
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                const currencySymbol = this.getCurrencyFlag(tx.currency || 'GBP');
                const txAmount = tx.amount >= 0 ? '+' : '';
                
                // Get existing marker for this transaction
                const existingMarker = transactionMarkers[txId] || '';
                
                // Get flag from bank analysis
                const flag = transactionFlags[txId];
                let flagBadge = '';
                if (flag === 'cleared') {
                    flagBadge = '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                } else if (flag === 'suspicious') {
                    flagBadge = '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                } else if (flag === 'review') {
                    flagBadge = '<span class="tx-marker-badge review">&#x2014; Review</span>';
                } else if (flag === 'linked') {
                    flagBadge = '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                }
                
                // Determine source badge
                const isUserLinked = userLinkedTxIds.has(txId);
                const isAutoMatched = autoMatchedTxIds.has(txId);
                let sourceBadge = '';
                if (isUserLinked && !isAutoMatched) {
                    sourceBadge = '<span class="tx-source-badge user-linked" title="Manually linked by cashier">&#xD83D;&#xDC64; User Linked</span>';
                } else if (isUserLinked && isAutoMatched) {
                    sourceBadge = '<span class="tx-source-badge both-matched" title="Auto-matched by Thirdfort and confirmed by cashier">&#x2713; Confirmed</span>';
                }
                
                // Get transaction note
                const txNote = transactionNotes[txId] || '';
                
                html += '<div class="matched-tx-row-with-markers">';
                html += '<div class="matched-tx-info">';
                html += `<span class="matched-tx-date">${date}</span>`;
                html += `<span class="matched-tx-desc">${tx.description || tx.merchant_name || 'Transaction'}${flagBadge}${sourceBadge}</span>`;
                html += `<span class="matched-tx-account">${accountName}</span>`;
                html += `<span class="matched-tx-amount">${txAmount}${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>`;
                html += '</div>';
                html += '<div class="tx-marker-actions">';
                // Accepted icon (green tick)
                html += `<button type="button" class="tx-marker-btn accepted ${existingMarker === 'accepted' ? 'active' : ''}" data-tx-id="${txId}" data-marker="accepted" title="Accepted - Linked" onclick="event.stopPropagation(); manager.toggleTransactionMarker(this)">`;
                html += '<svg viewBox="0 0 300 300" style="width: 16px; height: 16px;"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                html += '</button>';
                // Rejected icon (red cross)
                html += `<button type="button" class="tx-marker-btn rejected ${existingMarker === 'rejected' ? 'active' : ''}" data-tx-id="${txId}" data-marker="rejected" title="Rejected - Not linked" onclick="event.stopPropagation(); manager.toggleTransactionMarker(this)">`;
                html += '<svg viewBox="0 0 300 300" style="width: 16px; height: 16px;"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>';
                html += '</button>';
                // Review icon (orange dash)
                html += `<button type="button" class="tx-marker-btn review ${existingMarker === 'review' ? 'active' : ''}" data-tx-id="${txId}" data-marker="review" title="Needs review" onclick="event.stopPropagation(); manager.toggleTransactionMarker(this)">`;
                html += '<svg viewBox="0 0 300 300" style="width: 16px; height: 16px;"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
                html += '</button>';
                html += '</div>';
                
                // Show transaction note if exists
                if (txNote) {
                    html += '<div class="matched-tx-note">';
                    html += '<svg viewBox="0 0 24 24" style="width: 14px; height: 14px; margin-right: 4px; vertical-align: middle;"><path fill="#666" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>';
                    html += `<span style="color: #666; font-size: 12px; font-style: italic;">${txNote}</span>`;
                    html += '</div>';
                }
                
                html += '</div>';
            }
        });
        
        html += '</div>';
        
        return html;
    }
    
    createFundingVerificationChecks(type, data, matchedTxIds, existingAnnotations = []) {
        // Check which items were previously verified
        const previouslyVerified = new Set();
        existingAnnotations.forEach(ann => {
            const notes = ann.notes || {};
            const fundingMethods = notes.fundingMethods || [];
            fundingMethods.forEach(fm => {
                if (fm.fundType === type && fm.verified) {
                    fm.verified.forEach(v => previouslyVerified.add(v));
                }
            });
        });
        
        let html = '<div class="verification-checks">';
        
        const createCheckbox = (value, label) => {
            const wasVerified = previouslyVerified.has(value);
            const indicator = wasVerified ? ' <span style="color: #39b549; font-size: 11px;">(Previously verified &#x2713;)</span>' : '';
            return `<label><input type="checkbox" name="verification" value="${value}"> ${label}${indicator}</label>`;
        };
        
        if (type === 'fund:gift') {
            html += createCheckbox('gift_relationship', 'Giftor relationship confirmed');
            html += createCheckbox('gift_checks', 'Giftor ID and AML checks completed');
            if (matchedTxIds.length > 0) {
                html += createCheckbox('gift_transactions', 'Transactions reviewed and linked');
            }
        } 
        else if (type === 'fund:savings') {
            html += createCheckbox('savings_statements', 'Account statements reviewed');
            html += createCheckbox('savings_balance', 'Balance verified via Bank Summary');
            html += createCheckbox('savings_income', 'Income sources verified');
        } 
        else if (type.includes('sale')) {
            html += createCheckbox('sale_documents', 'Supporting documents reviewed');
            html += createCheckbox('sale_proceeds', 'Sale proceeds confirmed');
        } 
        else if (type === 'fund:mortgage') {
            html += createCheckbox('mortgage_offer', 'Mortgage offer reviewed');
            html += createCheckbox('mortgage_affordability', 'Affordability assessment completed');
        } 
        else {
            html += createCheckbox('generic_verified', 'Source verified and documented');
        }
        
        html += '</div>';
        
        return html;
    }
    
    getMatchedTransactions(fundType, sofMatches, fund = null, fundIdx = null, check = null) {
        const fundTypeMap = {
            'fund:gift': ['gift', 'gift_transactions'],
            'fund:mortgage': ['mortgage', 'mortgage_transactions'],
            'fund:savings': ['savings', 'savings_transactions', 'salary_transactions'],
            'fund:property_sale': ['property_sale', 'property_sale_transactions'],
            'fund:sale:property': ['property_sale', 'property_sale_transactions'],
            'fund:asset_sale': ['asset_sale', 'asset_sale_transactions'],
            'fund:sale:assets': ['asset_sale', 'asset_sale_transactions'],
            'fund:htb': ['htb_lisa', 'htb_transactions', 'htb_lisa_transactions'],
            'fund:htb_lisa': ['htb_lisa', 'htb_transactions', 'htb_lisa_transactions'],
            'fund:inheritance': ['inheritance', 'inheritance_transactions'],
            'fund:income': ['salary_transactions', 'income_transactions']
        };
        
        let matchKeys = fundTypeMap[fundType] || [];
        
        // For savings with people/incomes data, prioritize salary_transactions
        if (fundType === 'fund:savings' && fund) {
            const data = fund.data || {};
            if (data.people && data.people.some(p => p.incomes && p.incomes.length > 0)) {
                matchKeys = ['salary_transactions', ...matchKeys];
            }
        }
        
        let matchedTxIds = [];
        
        // Get Thirdfort automatic matches
        for (const key of matchKeys) {
            if (sofMatches[key] && Array.isArray(sofMatches[key])) {
                matchedTxIds = [...matchedTxIds, ...sofMatches[key]];
            }
        }
        
        // Add user-manually-linked transactions from annotations
        if (check && fundIdx !== null) {
            const sofAnnotations = check.sofAnnotations || [];
            sofAnnotations.forEach(ann => {
                // Direct transaction links
                const transactions = ann.notes?.transactions || [];
                transactions.forEach(tx => {
                    // Check if this transaction is linked to this funding method
                    if (tx.linkedToFunds && tx.linkedToFunds.includes(fundIdx.toString())) {
                        matchedTxIds.push(tx.txId);
                    }
                });
                
                // Bank analysis items (chains, repeating groups) linked to this funding method
                const bankAnalysisItems = ann.notes?.bankAnalysisItems || [];
                bankAnalysisItems.forEach(item => {
                    if (item.linkedToFundIdx === fundIdx.toString()) {
                        // Get the transactions that are part of this item
                        if (item.type === 'transaction' && item.transactionId) {
                            matchedTxIds.push(item.transactionId);
                        } else if (item.type === 'chain' && item.chainId) {
                            // Chain IDs are composite of transaction IDs separated by |
                            const chainTxIds = item.chainId.split('|');
                            matchedTxIds.push(...chainTxIds);
                        } else if (item.type === 'repeating-group' && item.groupIndex !== undefined) {
                            // Get all transactions in this repeating group
                            const taskOutcomes = check.taskOutcomes || {};
                            const bankStatement = taskOutcomes['bank:statement'];
                            const bankSummary = taskOutcomes['bank:summary'];
                            const docsBankStatement = taskOutcomes['documents:bank-statement'];
                            const analysis = bankStatement?.breakdown?.analysis || 
                                           bankSummary?.breakdown?.analysis || 
                                           docsBankStatement?.breakdown?.analysis;
                            
                            if (analysis && analysis.repeating_transactions) {
                                const group = analysis.repeating_transactions[item.groupIndex];
                                if (group && group.items) {
                                    matchedTxIds.push(...group.items);
                                }
                            }
                        }
                    }
                });
            });
        }
        
        return [...new Set(matchedTxIds)];
    }
    
    createSofChainCard(chain, chainIdx, check, existingAnnotations = []) {
        let html = '<div class="sof-chain-card">';
        
        // Chain description
        html += '<div class="chain-description">';
        html += '<strong>Chain ' + (chainIdx + 1) + ':</strong> ';
        
        // Build chain description
        const steps = [];
        if (chain.source) steps.push('Income');
        steps.push('Transfer Out');
        if (chain.in) steps.push('Transfer In');
        html += steps.join(' &#x2192; ');
        
        html += '</div>';
        
        // Chain transactions preview
        html += '<div class="chain-preview">';
        
        if (chain.source) {
            const sourceAmount = Math.abs(chain.source.amount).toFixed(2);
            html += `<span class="chain-step">&#xA3;${sourceAmount} (${chain.source.description || 'Income'})</span>`;
            html += ' &#x2192; ';
        }
        
        const outAmount = Math.abs(chain.out.amount).toFixed(2);
        html += `<span class="chain-step">&#xA3;${outAmount} (${chain.out.description || 'Transfer'})</span>`;
        
        html += '</div>';
        
        // Flag buttons (consistent style with transaction flags)
        html += '<div class="tx-flag-buttons" style="margin-top: 12px;">';
        html += `<button type="button" class="tx-flag-btn linked" data-chain-idx="${chainIdx}" data-flag="linked" title="Linked to SoF" onclick="event.stopPropagation(); this.classList.toggle('active');">`;
        html += '<svg viewBox="0 0 300 300" style="width: 14px; height: 14px;"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
        html += '</button>';
        html += `<button type="button" class="tx-flag-btn suspicious" data-chain-idx="${chainIdx}" data-flag="suspicious" title="Suspicious" onclick="event.stopPropagation(); this.classList.toggle('active');">`;
        html += '<svg viewBox="0 0 300 300" style="width: 14px; height: 14px;"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>';
        html += '</button>';
        html += `<button type="button" class="tx-flag-btn review" data-chain-idx="${chainIdx}" data-flag="review" title="Under review" onclick="event.stopPropagation(); this.classList.toggle('active');">`;
        html += '<svg viewBox="0 0 300 300" style="width: 14px; height: 14px;"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
        html += '</button>';
        html += `<button type="button" class="tx-flag-btn cleared" data-chain-idx="${chainIdx}" data-flag="cleared" title="Reviewed & Clear" onclick="event.stopPropagation(); this.classList.toggle('active');">`;
        html += '<svg viewBox="0 0 24 24" style="width: 14px; height: 14px;"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M8 12l2 2 4-4" stroke="currentColor" stroke-width="2" fill="none"/></svg>';
        html += '</button>';
        html += '</div>';
        
        // Notes textarea
        html += '<div class="form-group" style="margin-top: 12px;">';
        html += `<textarea class="chain-note-input" data-chain-idx="${chainIdx}" rows="2" placeholder="Add note for this chain..."></textarea>`;
        html += '</div>';
        
        html += '</div>';
        
        return html;
    }
    
    createSofTransactionCard(tx, txIdx, accounts, check, existingAnnotations = []) {
        const txDate = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
        const txAmount = Math.abs(tx.amount).toFixed(2);
        const txDesc = tx.description || tx.merchant_name || 'Transaction';
        const amountClass = tx.amount >= 0 ? 'positive' : 'negative';
        const sign = tx.amount >= 0 ? '+' : '';
        const currencySymbol = this.getCurrencyFlag(tx.currency || 'GBP');
        
        // Find account name and ID
        let accountName = '';
        let accountId = '';
        for (const [accId, accountData] of Object.entries(accounts)) {
            const statement = accountData.statement || [];
            if (statement.find(t => t.id === tx.id)) {
                accountName = (accountData.info || accountData).name || 'Account';
                accountId = accId;
                break;
            }
        }
        
        let html = '<div class="sof-tx-card">';
        
        // Transaction details
        html += '<div class="tx-details">';
        html += `<span class="tx-date">${txDate}</span>`;
        html += `<span class="tx-desc">${txDesc}</span>`;
        html += `<span class="tx-account">${accountName}</span>`;
        html += `<span class="tx-amount ${amountClass}">${sign}${currencySymbol}${txAmount}</span>`;
        html += '</div>';
        
        // Flag buttons (consistent style with transaction flags)
        html += '<div class="tx-flag-buttons" style="margin-top: 12px;">';
        html += `<button type="button" class="tx-flag-btn linked" data-large-tx-idx="${txIdx}" data-tx-id="${tx.id}" data-flag="linked" title="Linked to SoF" onclick="event.stopPropagation(); this.classList.toggle('active');">`;
        html += '<svg viewBox="0 0 300 300" style="width: 14px; height: 14px;"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
        html += '</button>';
        html += `<button type="button" class="tx-flag-btn suspicious" data-large-tx-idx="${txIdx}" data-tx-id="${tx.id}" data-flag="suspicious" title="Suspicious" onclick="event.stopPropagation(); this.classList.toggle('active');">`;
        html += '<svg viewBox="0 0 300 300" style="width: 14px; height: 14px;"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>';
        html += '</button>';
        html += `<button type="button" class="tx-flag-btn review" data-large-tx-idx="${txIdx}" data-tx-id="${tx.id}" data-flag="review" title="Under review" onclick="event.stopPropagation(); this.classList.toggle('active');">`;
        html += '<svg viewBox="0 0 300 300" style="width: 14px; height: 14px;"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
        html += '</button>';
        html += `<button type="button" class="tx-flag-btn cleared" data-large-tx-idx="${txIdx}" data-tx-id="${tx.id}" data-flag="cleared" title="Reviewed & Clear" onclick="event.stopPropagation(); this.classList.toggle('active');">`;
        html += '<svg viewBox="0 0 24 24" style="width: 14px; height: 14px;"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M8 12l2 2 4-4" stroke="currentColor" stroke-width="2" fill="none"/></svg>';
        html += '</button>';
        html += '</div>';
        
        // Notes textarea
        html += '<div class="form-group" style="margin-top: 12px;">';
        html += `<textarea class="tx-note-input large-tx-note" data-large-tx-idx="${txIdx}" data-tx-id="${tx.id}" rows="2" placeholder="Add note..."></textarea>`;
        html += '</div>';
        
        html += '</div>';
        
        return html;
    }
    
    saveSofInvestigation() {
        const check = this.currentCheck;
        const form = document.getElementById('sofInvestigationForm');
        
        // Collect all data
        const investigation = {
            property: null,
            fundingMethods: [],
            accounts: [],
            transactions: [],
            chains: [],
            timestamp: new Date().toISOString()
        };
        
        // Collect property review data
        const propertyCheckbox = form.querySelector('.property-reviewed-checkbox');
        const propertyNoteField = form.querySelector('.property-note-input');
        if (propertyCheckbox || propertyNoteField) {
            const reviewed = propertyCheckbox ? propertyCheckbox.checked : false;
            const note = propertyNoteField ? propertyNoteField.value.trim() : '';
            
            if (reviewed || note) {
                investigation.property = {
                    reviewed: reviewed,
                    note: note
                };
            }
        }
        
        // Collect account review data
        const accountCards = form.querySelectorAll('.account-investigation-card');
        accountCards.forEach((card) => {
            const checkbox = card.querySelector('.account-reviewed-checkbox');
            const noteTextarea = card.querySelector('.account-note-input');
            
            if (checkbox) {
                const accountId = checkbox.dataset.accountId;
                const accountIdx = checkbox.dataset.accountIdx;
                const reviewed = checkbox.checked;
                const note = noteTextarea ? noteTextarea.value.trim() : '';
                
                if (reviewed || note) {
                    investigation.accounts.push({
                        accountId: accountId,
                        accountIdx: accountIdx,
                        reviewed: reviewed,
                        note: note
                    });
                }
            }
        });
        
        // Collect transaction flags and notes from account investigation cards
        const txInvestigationRows = form.querySelectorAll('.transaction-investigation-row');
        txInvestigationRows.forEach((row) => {
            // Get active flag button (using new square button class)
            const activeBtn = row.querySelector('.tx-flag-btn-square.active');
            const txNoteField = row.querySelector('.tx-note-input');
            const sofLinkSelect = row.querySelector('.tx-sof-link-select');
            
            // Get linked funding method (single select)
            let linkedFundIdx = '';
            if (sofLinkSelect && sofLinkSelect.value) {
                linkedFundIdx = sofLinkSelect.value;
            }
            
            if (activeBtn || (txNoteField && txNoteField.value.trim()) || linkedFundIdx) {
                const accountId = activeBtn ? activeBtn.dataset.accountId : 
                               txNoteField ? txNoteField.dataset.accountId :
                               sofLinkSelect ? sofLinkSelect.dataset.accountId : '';
                const txId = activeBtn ? activeBtn.dataset.txId : 
                           txNoteField ? txNoteField.dataset.txId :
                           sofLinkSelect ? sofLinkSelect.dataset.txId : '';
                const flag = activeBtn ? activeBtn.dataset.flag : '';
                const note = txNoteField ? txNoteField.value.trim() : '';
                
                if (flag || note || linkedFundIdx) {
                    investigation.transactions.push({
                        accountId: accountId,
                        txId: txId,
                        flag: flag,
                        note: note,
                        linkedToFunds: linkedFundIdx ? [linkedFundIdx] : []
                    });
                }
            }
        });
        
        // Collect funding method notes, verifications, and transaction markers
        // Find all funding cards to process each one
        const fundingCards = form.querySelectorAll('.funding-investigation-card');
        fundingCards.forEach((card, idx) => {
            const textarea = card.querySelector('textarea.sof-note-input');
            if (!textarea) return;
            
            const note = textarea.value.trim();
            const fundIdx = textarea.dataset.fundIdx;
            const fundType = textarea.dataset.fundType;
            
            // Get verification checkboxes WITHIN THIS FUNDING CARD ONLY
            const checkboxes = card.querySelectorAll('.verification-checks input[type="checkbox"]:checked');
            const verified = [];
            checkboxes.forEach(cb => {
                verified.push(cb.value);
            });
            
            // Get transaction markers WITHIN THIS FUNDING CARD ONLY
            const transactionMarkers = {};
            const markerButtons = card.querySelectorAll('.tx-marker-btn.active');
            markerButtons.forEach(btn => {
                const txId = btn.dataset.txId;
                const marker = btn.dataset.marker; // 'verified', 'rejected', 'review'
                if (txId) {
                    transactionMarkers[txId] = marker;
                }
            });
            
            // Get red flag status and notes for this funding method
            const redFlags = [];
            const redFlagSelects = card.querySelectorAll(`.red-flag-status-select[data-fund-idx="${fundIdx}"]`);
            redFlagSelects.forEach(select => {
                const flagIdx = select.dataset.flagIdx;
                const status = select.value;
                const noteTextarea = card.querySelector(`.red-flag-note-input[data-fund-idx="${fundIdx}"][data-flag-idx="${flagIdx}"]`);
                const flagNote = noteTextarea ? noteTextarea.value.trim() : '';
                
                if (status || flagNote) {
                    redFlags.push({
                        flagIdx: flagIdx,
                        status: status,
                        note: flagNote
                    });
                }
            });
            
            // Only add if there's a note, verification, transaction markers, or red flag annotations
            if (note || verified.length > 0 || Object.keys(transactionMarkers).length > 0 || redFlags.length > 0) {
                investigation.fundingMethods.push({
                    fundIdx: fundIdx,
                    fundType: fundType,
                    note: note,
                    verified: verified,
                    transactionMarkers: transactionMarkers,
                    redFlags: redFlags
                });
            }
        });
        
        // Collect chain flags and notes
        const chainCards = form.querySelectorAll('.sof-chain-card');
        chainCards.forEach(card => {
            const activeBtn = card.querySelector('.tx-flag-btn.active[data-chain-idx]');
            const noteTextarea = card.querySelector('textarea.chain-note-input');
            
            if (activeBtn || (noteTextarea && noteTextarea.value.trim())) {
                const chainIdx = activeBtn ? activeBtn.dataset.chainIdx : noteTextarea.dataset.chainIdx;
                const flag = activeBtn ? activeBtn.dataset.flag : '';
                const note = noteTextarea ? noteTextarea.value.trim() : '';
                
                if (flag || note) {
                    investigation.chains.push({
                        chainIdx: chainIdx,
                        flag: flag,
                        note: note
                    });
                }
            }
        });
        
        // Collect large transaction flags and notes
        const largeTxCards = form.querySelectorAll('.sof-tx-card');
        largeTxCards.forEach(card => {
            const activeBtn = card.querySelector('.tx-flag-btn.active[data-large-tx-idx]');
            const noteTextarea = card.querySelector('textarea.large-tx-note');
            
            if (activeBtn || (noteTextarea && noteTextarea.value.trim())) {
                const largeTxIdx = activeBtn ? activeBtn.dataset.largeTxIdx : noteTextarea.dataset.largeTxIdx;
                const txId = activeBtn ? activeBtn.dataset.txId : noteTextarea.dataset.txId;
                const flag = activeBtn ? activeBtn.dataset.flag : '';
                const note = noteTextarea ? noteTextarea.value.trim() : '';
                
                if (flag || note) {
                    // Add to transactions array with a special type marker
                    investigation.transactions.push({
                        txId: txId,
                        largeTxIdx: largeTxIdx,
                        type: 'large-oneoff',
                        flag: flag,
                        note: note
                    });
                }
            }
        });
        
        // Collect transaction notes and markers
        const txNotes = form.querySelectorAll('textarea.tx-note-input');
        txNotes.forEach(textarea => {
            const note = textarea.value.trim();
            const txIdx = textarea.dataset.txIdx;
            const txId = textarea.dataset.txId;
            
            if (note) {
                investigation.transactions.push({
                    txIdx: txIdx,
                    txId: txId,
                    note: note
                });
            }
        });
        
        // Collect Bank Analysis item flags and notes (repeating groups, chains, transactions)
        if (!investigation.bankAnalysisItems) {
            investigation.bankAnalysisItems = [];
        }
        
        // Track processed items to avoid duplicates
        const processedItems = new Set();
        
        // Process all analysis items (find by parent containers)
        const analysisContainers = form.querySelectorAll('[data-group-index], [data-chain-id], .transaction-row-wrapper[data-tx-id]');
        analysisContainers.forEach(itemElement => {
            let itemType, itemKey;
            
            if (itemElement.hasAttribute('data-group-index')) {
                itemType = 'repeating-group';
                itemKey = itemElement.getAttribute('data-group-index');
            } else if (itemElement.hasAttribute('data-chain-id')) {
                itemType = 'chain';
                itemKey = itemElement.getAttribute('data-chain-id');
            } else if (itemElement.hasAttribute('data-tx-id')) {
                itemType = 'transaction';
                itemKey = itemElement.getAttribute('data-tx-id');
            } else {
                return; // Skip if no identifier
            }
            
            // Create unique key to avoid duplicates
            const uniqueKey = `${itemType}:${itemKey}`;
            if (processedItems.has(uniqueKey)) return;
            processedItems.add(uniqueKey);
            
            // Get active flag button (excluding link-funding button)
            const activeBtn = itemElement.querySelector('.tx-flag-btn-square.active:not(.link-funding)');
            const flag = activeBtn ? activeBtn.dataset.flag : '';
            
            // Get note
            const noteTextarea = itemElement.querySelector('textarea.analysis-item-note-input');
            const note = noteTextarea ? noteTextarea.value.trim() : '';
            
            // Get linked funding method - ONLY if the link dropdown is visible
            const fundingLinkContainer = itemElement.querySelector('.analysis-item-funding-link');
            const fundingSelect = itemElement.querySelector('.analysis-item-funding-select');
            let linkedFundIdx = '';
            
            // Only get the value if the dropdown is visible (user clicked link button)
            if (fundingLinkContainer && !fundingLinkContainer.classList.contains('hidden') && fundingSelect && fundingSelect.value) {
                linkedFundIdx = fundingSelect.value;
            }
            
            // Only save if there's a flag, note, or linked funding
            if (flag || note || linkedFundIdx) {
                const item = {
                    type: itemType,
                    flag: flag,
                    comment: note
                };
                
                if (itemType === 'repeating-group') {
                    item.groupIndex = parseInt(itemKey);
                } else if (itemType === 'chain') {
                    item.chainId = itemKey;
                } else if (itemType === 'transaction') {
                    item.transactionId = itemKey;
                }
                
                // Only add linkedToFundIdx if actually selected AND visible
                if (linkedFundIdx) {
                    item.linkedToFundIdx = linkedFundIdx;
                }
                
                investigation.bankAnalysisItems.push(item);
            }
        });
        
        // Check if any data was collected
        const hasData = investigation.property ||
                       investigation.fundingMethods.length > 0 || 
                       investigation.accounts.length > 0 ||
                       investigation.transactions.length > 0 ||
                       investigation.chains.length > 0 ||
                       investigation.bankAnalysisItems?.length > 0;
        
        if (!hasData) {
            alert('Please add at least one note, verification, or review');
            return;
        }
        
        // Send to parent
        this.sendMessage('save-sof-annotations', {
            checkId: check.checkId || check.transactionId,
            notes: investigation
        });
        
        // Store context for success handler
        this.pendingSave = {
            type: 'sof',
            check: check
        };
    }
    
    toggleTransactionExpand(button) {
        // Toggle the button active state
        button.classList.toggle('active');
        
        // Get the parent transaction row and expand section
        const txRow = button.closest('.transaction-investigation-row');
        const expandSection = txRow.querySelector('.tx-expand-section');
        const noteField = expandSection.querySelector('.tx-note-field');
        
        // Show expand section if any button is active
        const anyActive = txRow.querySelector('.tx-flag-btn-square.active');
        if (anyActive) {
            expandSection.classList.remove('collapsed');
        } else {
            expandSection.classList.add('collapsed');
        }
    }
    
    toggleTransactionLinking(button) {
        // Toggle the button active state
        button.classList.toggle('active');
        
        // Get the parent transaction row and expand section
        const txRow = button.closest('.transaction-investigation-row');
        const expandSection = txRow.querySelector('.tx-expand-section');
        const sofLinking = expandSection.querySelector('.tx-sof-linking');
        
        // Always show expand section when blue + is clicked
        expandSection.classList.remove('collapsed');
        
        // Toggle the SOF linking dropdown
        if (button.classList.contains('active')) {
            sofLinking.classList.remove('hidden');
        } else {
            sofLinking.classList.add('hidden');
        }
    }
    
    closeSofOverlay() {
        const overlay = document.getElementById('sofOverlay');
        if (overlay) overlay.remove();
    }
    
    toggleAccountCard(event, accountId) {
        event.stopPropagation();
        const card = document.querySelector(`[data-account-card="${accountId}"]`);
        if (card) {
            card.classList.toggle('collapsed');
        }
    }
    
    toggleFundingCard(event, fundIdx) {
        event.stopPropagation();
        const card = document.querySelector(`[data-funding-card="${fundIdx}"]`);
        if (card) {
            card.classList.toggle('collapsed');
        }
    }
    
    toggleAnnotationCard(event, annIdx) {
        event.stopPropagation();
        const card = document.querySelector(`[data-annotation-idx="${annIdx}"]`);
        if (card) {
            card.classList.toggle('collapsed');
        }
    }
    
    showTransactionDetailsOverlay(txId, check) {
        // Find the transaction across all accounts
        const taskOutcomes = check.taskOutcomes || {};
        const bankStatement = taskOutcomes['bank:statement'];
        const bankSummary = taskOutcomes['bank:summary'];
        const docsBankStatement = taskOutcomes['documents:bank-statement'];
        
        const accounts = bankStatement?.breakdown?.accounts || 
                        bankSummary?.breakdown?.accounts || 
                        docsBankStatement?.breakdown?.accounts || {};
        
        let transaction = null;
        let accountInfo = null;
        
        for (const [accountId, accountData] of Object.entries(accounts)) {
            const statement = accountData.statement || [];
            transaction = statement.find(t => t.id === txId);
            if (transaction) {
                accountInfo = accountData.info || accountData;
                break;
            }
        }
        
        if (!transaction) {
            console.error('Transaction not found:', txId);
            return;
        }
        
        // Collect all annotations for this transaction
        const sofAnnotations = check.sofAnnotations || [];
        const txAnnotations = [];
        
        sofAnnotations.forEach(ann => {
            // Check direct transaction annotations
            const transactions = ann.notes?.transactions || [];
            const txAnn = transactions.find(t => t.txId === txId);
            if (txAnn) {
                txAnnotations.push({
                    ...txAnn,
                    user: ann.userName || ann.user,
                    timestamp: ann.timestamp
                });
                return; // Already found this transaction, no need to check other sources
            }
            
            // Check if transaction is linked via funding method transaction markers
            const fundingMethods = ann.notes?.fundingMethods || [];
            for (const fm of fundingMethods) {
                const transactionMarkers = fm.transactionMarkers || {};
                if (transactionMarkers[txId]) {
                    // This transaction was marked for this funding method
                    const marker = transactionMarkers[txId]; // 'accepted' or 'rejected'
                    const flag = marker === 'accepted' ? 'linked' : 'review';
                    
                    txAnnotations.push({
                        txId: txId,
                        flag: flag,
                        linkedToFunds: [fm.fundIdx],
                        note: marker === 'accepted' ? 'Linked via funding method' : 'Marked for review',
                        user: ann.userName || ann.user,
                        timestamp: ann.timestamp
                    });
                    return; // Found it, stop checking
                }
            }
            
            // Check if transaction is part of a bank analysis item (repeating group or chain) that's linked
            const bankAnalysisItems = ann.notes?.bankAnalysisItems || [];
            for (const item of bankAnalysisItems) {
                let isPartOfItem = false;
                
                if (item.type === 'transaction' && item.transactionId === txId) {
                    isPartOfItem = true;
                } else if (item.type === 'chain') {
                    // Check if this transaction is part of the chain
                    const chainIds = (item.chainId || '').split('|');
                    if (chainIds.includes(txId)) {
                        isPartOfItem = true;
                    }
                }
                
                if (isPartOfItem && item.linkedToFundIdx) {
                    // This transaction is part of an analysis item linked to a funding method
                    txAnnotations.push({
                        txId: txId,
                        flag: item.flag || 'linked',
                        linkedToFunds: [item.linkedToFundIdx],
                        note: item.comment || 'Linked via bank analysis',
                        user: ann.userName || ann.user,
                        timestamp: ann.timestamp
                    });
                    return; // Found it
                }
            }
        });
        
        // Build overlay HTML
        const date = new Date(transaction.timestamp).toLocaleDateString('en-GB', { 
            day: '2-digit', 
            month: 'short', 
            year: 'numeric',
            weekday: 'short'
        });
        const time = new Date(transaction.timestamp).toLocaleTimeString('en-GB', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });
        const amount = transaction.amount;
        const amountClass = amount >= 0 ? 'positive' : 'negative';
        const sign = amount >= 0 ? '+' : '';
        const currencySymbol = this.getCurrencyFlag(transaction.currency || 'GBP');
        
        let overlayHTML = '<div class="annotation-overlay transaction-details-overlay" id="transactionDetailsOverlay">';
        overlayHTML += '<div class="annotation-overlay-backdrop" onclick="manager.closeTransactionDetailsOverlay()"></div>';
        overlayHTML += '<div class="annotation-overlay-content" style="max-width: 700px;">';
        
        // Header
        overlayHTML += '<div class="annotation-overlay-header">';
        overlayHTML += '<h2>Transaction Details</h2>';
        overlayHTML += '<button class="overlay-close-btn" onclick="manager.closeTransactionDetailsOverlay()">&#x2715;</button>';
        overlayHTML += '</div>';
        
        overlayHTML += '<div class="annotation-overlay-body">';
        
        // Transaction Info Card
        overlayHTML += '<div class="tx-details-card">';
        overlayHTML += '<div class="tx-details-main">';
        overlayHTML += `<div class="tx-details-desc">${transaction.description || transaction.merchant_name || 'Transaction'}</div>`;
        overlayHTML += `<div class="tx-details-amount ${amountClass}">${sign}${currencySymbol}${Math.abs(amount).toFixed(2)}</div>`;
        overlayHTML += '</div>';
        overlayHTML += '<div class="tx-details-meta">';
        overlayHTML += `<div class="tx-meta-item"><strong>Date:</strong> ${date} at ${time}</div>`;
        overlayHTML += `<div class="tx-meta-item"><strong>Account:</strong> ${accountInfo.name || 'Account'}</div>`;
        if (accountInfo.provider?.name) {
            overlayHTML += `<div class="tx-meta-item"><strong>Bank:</strong> ${accountInfo.provider.name}</div>`;
        }
        overlayHTML += '</div>';
        overlayHTML += '</div>';
        
        // Annotations History
        if (txAnnotations.length > 0) {
            overlayHTML += '<div class="tx-annotations-section">';
            overlayHTML += '<h3>Investigation History</h3>';
            
            txAnnotations.forEach(ann => {
                const annDate = new Date(ann.timestamp).toLocaleString('en-GB', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                overlayHTML += '<div class="tx-annotation-card">';
                overlayHTML += '<div class="tx-annotation-header">';
                overlayHTML += `<strong>${ann.user}</strong> &#x2022; ${annDate}`;
                overlayHTML += '</div>';
                
                // Flag status
                if (ann.flag) {
                    let flagIcon = '';
                    let flagLabel = '';
                    if (ann.flag === 'linked' || ann.flag === 'accepted') {
                        flagIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px;"><path fill="#39b549" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>';
                        flagLabel = ann.flag === 'accepted' ? 'Accepted' : 'Linked';
                    } else if (ann.flag === 'suspicious' || ann.flag === 'rejected') {
                        flagIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px;"><path fill="#ff0000" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>';
                        flagLabel = ann.flag === 'rejected' ? 'Rejected' : 'Suspicious';
                    } else if (ann.flag === 'review') {
                        flagIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px;"><path fill="#f7931e" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>';
                        flagLabel = 'Under Review';
                    } else if (ann.flag === 'cleared') {
                        flagIcon = '<svg class="inline-status-icon" viewBox="0 0 300 300" style="width: 16px; height: 16px;"><path fill="#1976d2" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><circle cx="150" cy="150" r="50" fill="none" stroke="#ffffff" stroke-width="20"/></svg>';
                        flagLabel = 'Cleared';
                    }
                    overlayHTML += `<div class="tx-annotation-flag">${flagIcon} <strong>Status:</strong> ${flagLabel}</div>`;
                }
                
                // Linked funding methods
                if (ann.linkedToFunds && ann.linkedToFunds.length > 0) {
                    const sofTask = taskOutcomes['sof:v1'];
                    const funds = sofTask?.breakdown?.funds || [];
                    const linkedFunds = ann.linkedToFunds.map(fundIdxStr => {
                        const fund = funds[parseInt(fundIdxStr)];
                        if (fund) {
                            const fundType = fund.type || '';
                            const fundAmount = fund.data?.amount ? `&#xA3;${(fund.data.amount / 100).toLocaleString()}` : '';
                            const fundLabel = fundType.replace('fund:', '').replace(/[-:_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            return `${fundLabel} ${fundAmount}`;
                        }
                        return null;
                    }).filter(f => f);
                    
                    if (linkedFunds.length > 0) {
                        overlayHTML += '<div class="tx-annotation-links">';
                        overlayHTML += '<svg viewBox="0 0 24 24" style="width: 16px; height: 16px; margin-right: 4px;"><path fill="#1976d2" d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>';
                        overlayHTML += `<strong>Linked to:</strong> ${linkedFunds.join(', ')}`;
                        overlayHTML += '</div>';
                    }
                }
                
                // Note
                if (ann.note) {
                    overlayHTML += '<div class="tx-annotation-note">';
                    overlayHTML += '<svg viewBox="0 0 24 24" style="width: 16px; height: 16px; margin-right: 4px;"><path fill="#666" d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>';
                    overlayHTML += `<span>${ann.note}</span>`;
                    overlayHTML += '</div>';
                }
                
                overlayHTML += '</div>';
            });
            
            overlayHTML += '</div>';
        } else {
            overlayHTML += '<div class="no-annotations-message">';
            overlayHTML += '<p style="color: #666; font-style: italic;">No investigation notes or flags for this transaction yet.</p>';
            overlayHTML += '</div>';
        }
        
        overlayHTML += '</div></div></div>';
        
        // Add to DOM
        document.body.insertAdjacentHTML('beforeend', overlayHTML);
    }
    
    closeTransactionDetailsOverlay() {
        const overlay = document.getElementById('transactionDetailsOverlay');
        if (overlay) overlay.remove();
    }
    
    /**
     * Render PEP Dismissal Overlay with queue system
     */
    renderPepDismissalOverlay(check) {
        const outcomes = check.taskOutcomes || {};
        
        // Support multiple structures for PEP/sanctions data
        // Individual checks: 'peps', 'screening:lite', 'screening' (renamed from peps), 'sanctions'
        // Company checks: 'company:peps', 'company:sanctions'
        // Note: renderTasksSection renames 'peps' to 'screening' for individual checks
        const pepsTask = outcomes['peps'];
        const screeningLiteTask = outcomes['screening:lite'];
        const screeningTask = outcomes['screening']; // Could be renamed from 'peps' or 'screening:lite'
        const sanctionsTask = outcomes['sanctions'];
        const companyPepsTask = outcomes['company:peps'];
        const companySanctionsTask = outcomes['company:sanctions'];
        
        const existingDismissals = check.pepDismissals || [];
        
        // Initialize pending dismissals array
        if (!this.pendingDismissals) {
            this.pendingDismissals = [];
        }
        
        const dismissedIds = new Set(existingDismissals.map(d => d.hitId));
        
        // Also exclude hits in pending dismissals
        this.pendingDismissals.forEach(dismissal => {
            dismissal.hits.forEach(hit => dismissedIds.add(hit.id));
        });
        
        // Collect all undismissed hits with full details
        const hits = [];
        
        // Individual PEPs (from 'peps' task - electronic-id checks like Nigel Farage)
        if (pepsTask?.breakdown?.hits) {
            pepsTask.breakdown.hits.forEach(hit => {
                if (!dismissedIds.has(hit.id)) {
                    hits.push({
                        id: hit.id,
                        name: hit.name,
                        type: 'peps',
                        entityType: 'individual',
                        reportId: pepsTask.id,
                        dob: hit.dob?.main || hit.dob,
                        score: hit.score,
                        flagTypes: hit.flag_types || [],
                        politicalPositions: hit.political_positions || [],
                        countries: hit.countries || [],
                        aka: hit.aka || [],
                        fullHit: hit
                    });
                }
            });
        }
        
        // Screening:lite PEPs (from 'screening:lite' task - lite-screen checks like Nigel Farage)
        if (screeningLiteTask?.breakdown?.hits) {
            screeningLiteTask.breakdown.hits.forEach(hit => {
                if (!dismissedIds.has(hit.id)) {
                    hits.push({
                        id: hit.id,
                        name: hit.name,
                        type: 'peps',
                        entityType: 'individual',
                        reportId: screeningLiteTask.id,
                        dob: hit.dob?.main || hit.dob,
                        score: hit.score,
                        flagTypes: hit.flag_types || [],
                        politicalPositions: hit.political_positions || [],
                        countries: hit.countries || [],
                        aka: hit.aka || [],
                        fullHit: hit
                    });
                }
            });
        }
        
        // Screening (renamed from 'peps' or 'screening:lite' - for checks like Jacob's lite-screen)
        // Only process if not already handled by screeningLiteTask or pepsTask
        if (screeningTask?.breakdown?.hits && !screeningLiteTask && !pepsTask) {
            screeningTask.breakdown.hits.forEach(hit => {
                if (!dismissedIds.has(hit.id)) {
                    hits.push({
                        id: hit.id,
                        name: hit.name,
                        type: 'peps',
                        entityType: 'individual',
                        reportId: screeningTask.id,
                        dob: hit.dob?.main || hit.dob,
                        score: hit.score,
                        flagTypes: hit.flag_types || [],
                        politicalPositions: hit.political_positions || [],
                        countries: hit.countries || [],
                        aka: hit.aka || [],
                        fullHit: hit
                    });
                }
            });
        }
        
        // Individual Sanctions
        if (sanctionsTask?.breakdown?.hits) {
            sanctionsTask.breakdown.hits.forEach(hit => {
                if (!dismissedIds.has(hit.id)) {
                    hits.push({
                        id: hit.id,
                        name: hit.name,
                        type: 'sanctions',
                        entityType: 'individual',
                        reportId: sanctionsTask.id,
                        score: hit.score,
                        flagTypes: hit.flag_types || [],
                        countries: hit.countries || [],
                        aka: hit.aka || [],
                        fullHit: hit
                    });
                }
            });
        }
        
        // Company PEPs (KYB checks)
        if (companyPepsTask?.breakdown?.hits) {
            companyPepsTask.breakdown.hits.forEach(hit => {
                if (!dismissedIds.has(hit.id)) {
                    hits.push({
                        id: hit.id,
                        name: hit.name,
                        type: 'peps',
                        entityType: 'company',
                        reportId: companyPepsTask.id,
                        dob: hit.dob?.main || hit.dob,
                        score: hit.score,
                        flagTypes: hit.flag_types || [],
                        politicalPositions: hit.political_positions || [],
                        countries: hit.countries || [],
                        aka: hit.aka || [],
                        fullHit: hit
                    });
                }
            });
        }
        
        // Company Sanctions (KYB checks)
        if (companySanctionsTask?.breakdown?.hits) {
            companySanctionsTask.breakdown.hits.forEach(hit => {
                if (!dismissedIds.has(hit.id)) {
                    hits.push({
                        id: hit.id,
                        name: hit.name,
                        type: 'sanctions',
                        entityType: 'company',
                        reportId: companySanctionsTask.id,
                        score: hit.score,
                        flagTypes: hit.flag_types || [],
                        countries: hit.countries || [],
                        aka: hit.aka || [],
                        fullHit: hit
                    });
                }
            });
        }
        
        let overlayHTML = '<div class="annotation-overlay" id="pepOverlay">';
        overlayHTML += '<div class="annotation-overlay-backdrop" onclick="manager.closePepOverlay()"></div>';
        overlayHTML += '<div class="annotation-overlay-content">';
        
        // Header with SAVE and EXPORT PDF buttons
        overlayHTML += '<div class="annotation-overlay-header">';
        overlayHTML += '<h2>Dismiss PEP & Sanctions Hits</h2>';
        overlayHTML += '<div class="header-actions">';
        overlayHTML += '<button class="btn-secondary-small" onclick="manager.generatePepDismissalsPDF()">EXPORT PDF</button>';
        if (this.mode === 'edit') {
            overlayHTML += '<button class="btn-primary-small" onclick="manager.savePendingDismissals()" id="saveDismissalsBtn" disabled>SAVE</button>';
        }
        overlayHTML += '<button class="overlay-close-btn" onclick="manager.closePepOverlay()">&#x2715;</button>';
        overlayHTML += '</div></div>';
        
        overlayHTML += '<div class="annotation-overlay-body">';
        
        // Dismissals queue section
        overlayHTML += '<div class="updates-queue-section">';
        overlayHTML += '<h3>Dismissals to add</h3>';
        overlayHTML += '<div id="dismissalsQueue" class="updates-queue">';
        if (this.pendingDismissals.length === 0) {
            overlayHTML += '<p class="text-muted">No dismissals queued. Select hits below and add a dismissal reason.</p>';
        }
        overlayHTML += '</div></div>';
        
        // Add Dismissal section
        if (this.mode === 'edit' && hits.length > 0) {
            overlayHTML += '<div class="add-update-section">';
            overlayHTML += '<h3>Add Dismissal</h3>';
            
            // Show each hit as a detailed card (like screening task card)
            overlayHTML += '<div class="pep-hits-list">';
            
            hits.forEach(hit => {
                overlayHTML += this.createPepHitCard(hit);
            });
            
            overlayHTML += '</div>';
            
            // Dismissal reason textarea
            overlayHTML += '<div class="form-group">';
            overlayHTML += '<label for="pepDismissalReason">Dismissal Reason</label>';
            overlayHTML += '<textarea id="pepDismissalReason" rows="3" placeholder="Explain why selected hits should be dismissed (e.g., \'Confirmed different person - different DOB\', \'Different spelling of name\')..."></textarea>';
            overlayHTML += '</div>';
            
            // Add dismissal button
            overlayHTML += '<button type="button" class="btn-add-update" onclick="manager.addDismissalToQueue()">Add dismissal</button>';
            
            overlayHTML += '</div>';
        } else if (hits.length === 0 && this.mode === 'edit') {
            overlayHTML += '<div class="add-update-section">';
            overlayHTML += '<p class="text-muted">All hits have been dismissed.</p>';
            overlayHTML += '</div>';
        }
        
        // Show previously dismissed hits from database
        if (existingDismissals.length > 0) {
            overlayHTML += '<div class="annotation-history-section">';
            overlayHTML += '<h3>Previously Dismissed</h3>';
            
            // Group dismissals by user + timestamp + reason
            const dismissalGroups = {};
            existingDismissals.forEach(dismissal => {
                const groupKey = `${dismissal.user}_${dismissal.timestamp}_${dismissal.reason}`;
                if (!dismissalGroups[groupKey]) {
                    dismissalGroups[groupKey] = {
                        user: dismissal.userName || dismissal.user,
                        timestamp: dismissal.timestamp,
                        reason: dismissal.reason,
                        reportType: dismissal.reportType,
                        hits: []
                    };
                }
                dismissalGroups[groupKey].hits.push(dismissal.hitName);
            });
            
            // Render each group
            Object.values(dismissalGroups).forEach(group => {
                const dateObj = new Date(group.timestamp);
                const formattedDate = dateObj.toLocaleDateString('en-GB', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
                const formattedTime = dateObj.toLocaleTimeString('en-GB', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Format user name
                const formattedUser = group.user
                    .split(/[-._@]/)
                    .slice(0, -1)
                    .map(part => part.charAt(0).toUpperCase() + part.slice(1).toLowerCase())
                    .join(' ');
                
                overlayHTML += '<div class="annotation-card dismissed-hit">';
                overlayHTML += '<div class="annotation-card-header">';
                overlayHTML += '<div class="annotation-header-main">';
                overlayHTML += '<span class="annotation-user">' + formattedUser + '</span>';
                overlayHTML += '<span class="annotation-date">' + formattedDate + ' at ' + formattedTime + '</span>';
                overlayHTML += '</div>';
                overlayHTML += '</div>';
                overlayHTML += '<div class="annotation-card-body">';
                overlayHTML += '<div class="dismissal-reason-box">' + group.reason + '</div>';
                overlayHTML += '<div class="dismissed-hits-list">';
                group.hits.forEach(hitName => {
                    overlayHTML += `
                        <div class="dismissed-hit-item">
                            <svg viewBox="0 0 300 300" style="width: 14px; height: 14px; margin-right: 6px;"><path fill="#388e3c" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>
                            <span>${hitName}</span>
                        </div>
                    `;
                });
                overlayHTML += '</div>';
                overlayHTML += '</div></div>';
            });
            
            overlayHTML += '</div>';
        }
        
        overlayHTML += '</div></div></div>';
        
        // Add to DOM
        document.body.insertAdjacentHTML('beforeend', overlayHTML);
        
        // Render any pending dismissals
        this.renderPendingDismissals();
    }
    
    /**
     * Create a PEP hit card for selection (compact layout with checkbox on left)
     */
    createPepHitCard(hit) {
        let html = '<div class="pep-hit-card">';
        
        // Checkbox on the left
        html += '<input type="checkbox" name="hits" value="' + hit.id + '" ';
        html += 'data-name="' + hit.name + '" ';
        html += 'data-type="' + hit.type + '" ';
        html += 'data-report-id="' + hit.reportId + '" class="hit-checkbox-left">';
        
        html += '<div class="pep-hit-content">';
        
        // Header: Name + all badges on one line
        html += '<div class="pep-hit-header">';
        html += '<strong class="pep-hit-name">' + hit.name + '</strong>';
        
        // All badges inline - organize by type
        const pepBadges = [];
        const sanctionBadges = [];
        const adverseBadges = [];
        
        if (hit.flagTypes && hit.flagTypes.length > 0) {
            const uniqueFlags = [...new Set(hit.flagTypes)];
            uniqueFlags.forEach(flag => {
                let badgeText = flag.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                
                if (flag.includes('pep')) {
                    if (flag.includes('class-1')) badgeText = 'PEP Class 1';
                    else if (flag.includes('class-2')) badgeText = 'PEP Class 2';
                    else if (flag.includes('class-3')) badgeText = 'PEP Class 3';
                    else if (flag.includes('class-4')) badgeText = 'PEP Class 4';
                    else if (flag === 'pep') badgeText = 'PEP';
                    pepBadges.push(badgeText);
                } else if (flag.includes('sanction')) {
                    sanctionBadges.push(badgeText);
                } else if (flag.includes('adverse-media')) {
                    adverseBadges.push(badgeText);
                }
            });
        }
        
        html += '<div class="pep-badges-inline">';
        
        // PEP badges (purple) - first 3
        pepBadges.slice(0, 3).forEach(badge => {
            html += '<span class="hit-badge hit-badge-pep">' + badge + '</span>';
        });
        if (pepBadges.length > 3) {
            html += '<span class="hit-badge hit-badge-pep">+' + (pepBadges.length - 3) + '</span>';
        }
        
        // Sanctions badges (red) - first 3
        sanctionBadges.slice(0, 3).forEach(badge => {
            html += '<span class="hit-badge hit-badge-sanction">' + badge + '</span>';
        });
        if (sanctionBadges.length > 3) {
            html += '<span class="hit-badge hit-badge-sanction">+' + (sanctionBadges.length - 3) + '</span>';
        }
        
        // Adverse Media badges (blue) - first 3
        adverseBadges.slice(0, 3).forEach(badge => {
            html += '<span class="hit-badge hit-badge-adverse">' + badge + '</span>';
        });
        if (adverseBadges.length > 3) {
            html += '<span class="hit-badge hit-badge-adverse">+' + (adverseBadges.length - 3) + '</span>';
        }
        
        html += '</div></div>'; // Close badges and header
        
        // AKA (full width if present)
        if (hit.aka && hit.aka.length > 0) {
            const akaList = hit.aka.slice(0, 5).join(', ');
            const extra = hit.aka.length > 5 ? ' (+' + (hit.aka.length - 5) + ' more)' : '';
            html += '<div class="pep-aka">Also Known As: ' + akaList + extra + '</div>';
        }
        
        // Two-column layout for details
        html += '<div class="pep-details-grid">';
        
        // Left column
        html += '<div class="pep-detail-item">';
        if (hit.dob) {
            html += '<span class="pep-label">Date of Birth:</span> <span class="pep-value">' + hit.dob + '</span>';
        } else {
            html += '<span class="pep-label">Date of Birth:</span> <span class="pep-value">&#x2014;</span>';
        }
        html += '</div>';
        
        // Right column
        html += '<div class="pep-detail-item">';
        if (hit.score) {
            html += '<span class="pep-label">Match Score:</span> <span class="pep-value">' + hit.score + '</span>';
        } else {
            html += '<span class="pep-label">Match Score:</span> <span class="pep-value">&#x2014;</span>';
        }
        html += '</div>';
        
        // Left column
        html += '<div class="pep-detail-item">';
        if (hit.politicalPositions && hit.politicalPositions.length > 0) {
            const pos = hit.politicalPositions[0];
            const extra = hit.politicalPositions.length > 1 ? ' (+' + (hit.politicalPositions.length - 1) + ' more)' : '';
            html += '<span class="pep-label">Position:</span> <span class="pep-value">' + pos + extra + '</span>';
        } else {
            html += '<span class="pep-label">Position:</span> <span class="pep-value">&#x2014;</span>';
        }
        html += '</div>';
        
        // Right column
        html += '<div class="pep-detail-item">';
        if (hit.fields && hit.fields.length > 0) {
            html += '<span class="pep-label">Data Sources:</span> <span class="pep-value">' + hit.fields.length + '</span>';
        } else {
            html += '<span class="pep-label">Data Sources:</span> <span class="pep-value">&#x2014;</span>';
        }
        html += '</div>';
        
        // Left column
        html += '<div class="pep-detail-item">';
        if (hit.associates && hit.associates.length > 0) {
            html += '<span class="pep-label">Associates:</span> <span class="pep-value">' + hit.associates.length + '</span>';
        } else {
            html += '<span class="pep-label">Associates:</span> <span class="pep-value">&#x2014;</span>';
        }
        html += '</div>';
        
        // Right column
        html += '<div class="pep-detail-item">';
        if (hit.media && hit.media.length > 0) {
            html += '<span class="pep-label">Media Articles:</span> <span class="pep-value">' + hit.media.length + '</span>';
        } else {
            html += '<span class="pep-label">Media Articles:</span> <span class="pep-value">&#x2014;</span>';
        }
        html += '</div>';
        
        html += '</div>'; // Close grid
        
        // Countries (full width)
        if (hit.countries && hit.countries.length > 0) {
            html += '<div class="pep-countries">Countries: ';
            hit.countries.slice(0, 5).forEach(country => {
                const flagEmoji = this.getCountryFlag(country);
                html += '<span class="country-tag">' + flagEmoji + ' ' + country + '</span>';
            });
            if (hit.countries.length > 5) {
                html += '<span class="country-tag">+' + (hit.countries.length - 5) + ' more</span>';
            }
            html += '</div>';
        }
        
        html += '</div>'; // Close pep-hit-content
        html += '</div>'; // Close pep-hit-card
        
        return html;
    }
    
    /**
     * Add selected hits to dismissal queue
     */
    addDismissalToQueue() {
        const selectedHits = Array.from(document.querySelectorAll('#pepOverlay input[name="hits"]:checked'));
        const reason = document.getElementById('pepDismissalReason').value.trim();
        
        if (selectedHits.length === 0) {
            alert('Please select at least one hit to dismiss');
            return;
        }
        
        if (!reason) {
            alert('Please provide a dismissal reason');
            return;
        }
        
        // Store full hit objects (each has its own reportId)
        const hits = selectedHits.map(cb => ({
            id: cb.value,
            name: cb.dataset.name,
            type: cb.dataset.type,
            reportId: cb.dataset.reportId // Each hit may have different reportId
        }));
        
        // Create dismissal batch
        const dismissal = {
            id: Date.now(),
            hits: hits, // Store full hit objects
            reason
        };
        
        this.pendingDismissals.push(dismissal);
        
        // Clear form
        selectedHits.forEach(cb => cb.checked = false);
        document.getElementById('pepDismissalReason').value = '';
        
        // Re-render to remove dismissed hits from list (don't clear queue)
        this.closePepOverlay(false);
        this.renderPepDismissalOverlay(this.currentCheck);
        
        // Enable save button
        const saveBtn = document.getElementById('saveDismissalsBtn');
        if (saveBtn) saveBtn.disabled = false;
    }
    
    /**
     * Render pending dismissals queue
     */
    renderPendingDismissals() {
        const queueContainer = document.getElementById('dismissalsQueue');
        if (!queueContainer) return;
        
        if (this.pendingDismissals.length === 0) {
            queueContainer.innerHTML = '<p class="text-muted">No dismissals queued. Select hits below and add a dismissal reason.</p>';
            return;
        }
        
        let queueHTML = '';
        this.pendingDismissals.forEach(dismissal => {
            // Create a dismissal card
            queueHTML += '<div class="dismissal-queue-card">';
            queueHTML += '<div class="dismissal-header">';
            queueHTML += '<span>Dismissing ' + dismissal.hits.length + ' hit' + (dismissal.hits.length > 1 ? 's' : '') + '</span>';
            queueHTML += '<button class="remove-update-btn" onclick="manager.removeDismissalFromQueue(' + dismissal.id + ')" title="Remove from queue">';
            queueHTML += '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">';
            queueHTML += '<path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>';
            queueHTML += '</svg></button>';
            queueHTML += '</div>';
            queueHTML += '<div class="dismissal-body">';
            queueHTML += '<p class="dismissal-reason">' + dismissal.reason + '</p>';
            queueHTML += '<div class="dismissed-hits-list">';
            dismissal.hits.forEach(hit => {
                queueHTML += '<span class="dismissed-hit-name">&#x2022; ' + hit.name + '</span>';
            });
            queueHTML += '</div>';
            queueHTML += '</div></div>';
        });
        
        queueContainer.innerHTML = queueHTML;
    }
    
    /**
     * Remove dismissal from queue
     */
    removeDismissalFromQueue(dismissalId) {
        this.pendingDismissals = this.pendingDismissals.filter(d => d.id !== dismissalId);
        
        // Re-render overlay to show hits again (don't clear queue)
        this.closePepOverlay(false);
        this.renderPepDismissalOverlay(this.currentCheck);
        
        // Disable save button if queue is empty
        if (this.pendingDismissals.length === 0) {
            const saveBtn = document.getElementById('saveDismissalsBtn');
            if (saveBtn) saveBtn.disabled = true;
        }
    }
    
    /**
     * Save all pending dismissals
     */
    savePendingDismissals() {
        if (this.pendingDismissals.length === 0) {
            alert('No dismissals to save');
            return;
        }
        
        const check = this.currentCheck;
        
        // Group hits by reportId across all dismissal batches
        // A single dismissal batch with same reason might have hits from different reports
        const dismissalsByReport = {};
        
        this.pendingDismissals.forEach(dismissalBatch => {
            dismissalBatch.hits.forEach(hit => {
                const reportId = hit.reportId;
                
                // Create entry for this reportId if it doesn't exist
                if (!dismissalsByReport[reportId]) {
                    dismissalsByReport[reportId] = {
                        reportId: reportId,
                        reportType: hit.type, // 'peps', 'sanctions', etc.
                        dismissals: []
                    };
                }
                
                // Find existing dismissal batch with same reason
                let existingBatch = dismissalsByReport[reportId].dismissals.find(
                    d => d.reason === dismissalBatch.reason
                );
                
                if (!existingBatch) {
                    existingBatch = {
                        reason: dismissalBatch.reason,
                        hits: []
                    };
                    dismissalsByReport[reportId].dismissals.push(existingBatch);
                }
                
                // Add hit to this batch
                existingBatch.hits.push({
                    id: hit.id,
                    name: hit.name,
                    type: hit.type
                });
            });
        });
        
        // Flatten structure for backend - array of dismissal batches with reportId
        const dismissals = [];
        Object.values(dismissalsByReport).forEach(report => {
            report.dismissals.forEach(batch => {
                dismissals.push({
                    reportId: report.reportId,
                    reportType: report.reportType,
                    hits: batch.hits,
                    reason: batch.reason
                });
            });
        });
        
        console.log('&#xD83D;&#xDCE4; Sending dismissals to backend:', dismissals);
        
        // Send single message to parent with all dismissals
        this.sendMessage('dismiss-pep-hits', {
            checkId: check.checkId || check.transactionId,
            dismissals
        });
        
        // Store context for success handler
        this.pendingSave = {
            type: 'pep-dismissal',
            check: check,
            dismissals
        };
        
        // Clear pending dismissals
        this.pendingDismissals = [];
    }
    
    closePepOverlay(clearQueue = true) {
        const overlay = document.getElementById('pepOverlay');
        if (overlay) overlay.remove();
        // Clear pending dismissals when closing (unless we're just re-rendering)
        if (clearQueue) {
            this.pendingDismissals = [];
        }
    }
    
    /**
     * Close all overlays (used when loading new checks data)
     */
    closeAllOverlays() {
        // Close consider overlay
        const considerOverlay = document.getElementById('considerOverlay');
        if (considerOverlay) {
            considerOverlay.remove();
            this.pendingUpdates = [];
        }
        
        // Close SoF overlay
        const sofOverlay = document.getElementById('sofOverlay');
        if (sofOverlay) sofOverlay.remove();
        
        // Close PEP overlay
        const pepOverlay = document.getElementById('pepOverlay');
        if (pepOverlay) {
            pepOverlay.remove();
            this.pendingDismissals = [];
        }
    }
    
    // ===================================================================
    // PDF GENERATION
    // ===================================================================
    
    generateConsiderPDF(autoSave = false) {
        const check = this.currentCheck;
        if (!check) {
            console.error('&#x274C; No current check for PDF generation');
            return;
        }
        
        const annotations = check.considerAnnotations || [];
        
        console.log('&#xD83D;&#xDCC4; Generating PDF with annotations:', annotations.length);
        console.log('&#xD83D;&#xDCC4; Annotations:', annotations);
        
        // If no annotations exist, there's nothing to generate
        if (annotations.length === 0) {
            console.error('&#x274C; No annotations to generate PDF for');
            alert('No annotations found to generate PDF');
            return;
        }
        
        const checkName = check.consumerName || check.companyName || 'Unknown';
        const checkRef = check.thirdfortResponse?.ref || check.transactionId || check.checkId;
        const checkType = this.getElectronicIDType(check) || check.checkType || 'Thirdfort Check';
        const matterName = check.thirdfortResponse?.name || check.matterName || '&#x2014;';
        const checkStatus = check.status === 'closed' ? 'Closed' : 'Open';
        const now = new Date();
        const generatedDate = now.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
        const generatedTime = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        
        // Helper to get task icon background color
        const getTaskColor = (taskType) => {
            if (taskType === 'identity') return '#5e35b1';
            if (taskType === 'address') return '#1976d2';
            if (taskType === 'screening') return '#d32f2f';
            if (taskType.includes('sof')) return '#388e3c';
            return '#666';
        };
        
        // Helper to get task label
        const getTaskLabel = (taskType) => {
            if (taskType === 'identity') return 'ID';
            if (taskType === 'address') return 'AD';
            if (taskType === 'screening') return 'SC';
            if (taskType.includes('sof')) return 'SF';
            return 'CK';
        };
        
        // Helper to get status icon CSS (PDF-friendly)
        const getStatusIcon = (status) => {
            return this.getStatusIconCSS(status);
        };
        
        // Get unique task types that have annotations
        const annotatedTaskTypes = [...new Set(annotations.map(ann => ann.taskType))];
        
        // Build original task outcomes HTML (for tasks with annotations)
        let taskOutcomesHTML = '';
        annotatedTaskTypes.forEach(taskType => {
            const outcome = check.taskOutcomes?.[taskType];
            if (!outcome) return;
            
            const taskTitle = this.getTaskTitle(taskType);
            const taskColor = getTaskColor(taskType);
            const taskLabel = getTaskLabel(taskType);
            const checks = this.getTaskChecks(taskType, outcome, check);
            
            taskOutcomesHTML += `
                <div class="task-outcomes-card" style="margin-bottom: 20px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 15px; page-break-inside: avoid;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 2px solid #dee2e6;">
                        <div class="task-icon" style="background: ${taskColor}; flex-shrink: 0;">${taskLabel}</div>
                        <div style="font-size: 16px; font-weight: bold; color: #003c71;">${taskTitle}</div>
                    </div>
            `;
            
            // Show check items (objectives)
            checks.forEach(checkItem => {
                if (checkItem.isNestedCard || checkItem.isPersonCard || checkItem.isHitCard) return;
                
                const checkIcon = this.getTaskCheckIconCSS(checkItem.status);
                const statusColor = checkItem.status === 'CL' ? '#388e3c' : (checkItem.status === 'FA' ? '#d32f2f' : '#f7931e');
                
                taskOutcomesHTML += `
                    <div style="display: flex; align-items: center; gap: 8px; padding: 6px 0; ${checkItem.indented ? 'margin-left: 30px;' : ''}">
                        ${checkIcon}
                        <span style="font-size: 12px; color: #333;">${checkItem.text}</span>
                    </div>
                `;
            });
            
            taskOutcomesHTML += `</div>`;
        });
        
        // Group annotations by user + timestamp + newStatus (like in task card display)
        const groups = {};
        annotations.forEach(ann => {
            const groupKey = `${ann.user}_${ann.timestamp}_${ann.newStatus}`;
            if (!groups[groupKey]) {
                groups[groupKey] = {
                    user: ann.userName || ann.user,
                    timestamp: ann.timestamp,
                    newStatus: ann.newStatus,
                    reason: ann.reason,
                    objectives: []
                };
            }
            groups[groupKey].objectives.push({
                taskType: ann.taskType,
                path: ann.objectivePath,
                originalStatus: ann.originalStatus,
                newStatus: ann.newStatus
            });
        });
        
        // Build annotation cards HTML (one card per group)
        let annotationsHTML = '';
        Object.values(groups).forEach(group => {
            const date = new Date(group.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
            const time = new Date(group.timestamp).toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
            
            const newStatusClass = group.newStatus === 'clear' ? 'clear' : (group.newStatus === 'fail' ? 'fail' : 'consider');
            
            annotationsHTML += `
                <div class="annotation-card">
                    <div class="annotation-header">
                        <div class="annotation-task-info">
                            <div class="annotation-task-title">Update by ${group.user}</div>
                            <div class="annotation-objective">${date}, ${time}</div>
                        </div>
                    </div>
                    
                    <div class="reason-box">
                        <div class="reason-label">Reason</div>
                        <div class="reason-text">${group.reason}</div>
                    </div>
                    
                    <div class="status-change" style="display: block;">
                        <div class="reason-label" style="margin-bottom: 8px;">Affected Objectives</div>
            `;
            
            // Show all affected objectives with their status icons
            group.objectives.forEach(obj => {
                const taskTitle = this.getTaskTitle(obj.taskType);
                const objectivePath = this.formatObjectivePath(obj.path);
                const taskColor = getTaskColor(obj.taskType);
                const taskLabel = getTaskLabel(obj.taskType);
                
                annotationsHTML += `
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px; padding: 8px; background: white; border-radius: 4px; min-width: 0;">
                        <div class="task-icon" style="background: ${taskColor}; flex-shrink: 0;">${taskLabel}</div>
                        <div style="flex: 1; min-width: 0; overflow: hidden;">
                            <div style="font-size: 13px; font-weight: 600; color: #003c71; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${taskTitle}</div>
                            <div style="font-size: 11px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${objectivePath}</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px; flex-shrink: 0; margin-left: 12px;">
                            ${getStatusIcon(obj.newStatus)}
                            <span style="font-size: 12px; font-weight: 600; color: ${obj.newStatus === 'clear' ? '#388e3c' : (obj.newStatus === 'fail' ? '#d32f2f' : '#f7931e')}; white-space: nowrap;">${obj.newStatus.toUpperCase()}</span>
                        </div>
                    </div>
                `;
            });
            
            annotationsHTML += `
                    </div>
                </div>
            `;
        });
        
        // Build task cards HTML (matching mockup structure exactly)
        let taskCardsHTML = '';
        
        annotatedTaskTypes.forEach(taskType => {
            const outcome = check.taskOutcomes?.[taskType];
            if (!outcome) return;
            
            const taskTitle = this.getTaskTitle(taskType);
            const result = outcome.result || 'unknown';
            const borderColor = result === 'clear' ? '#39b549' : (result === 'fail' ? '#ff0000' : '#f7931e');
            
            // Get status icon CSS (PDF-friendly)
            const statusIconHTML = this.getStatusIconCSS(result);
            
            // Get task annotations for this task type (grouped)
            const taskAnnotations = annotations.filter(ann => ann.taskType === taskType);
            const taskGroups = {};
            taskAnnotations.forEach(ann => {
                const groupKey = `${ann.user}_${ann.timestamp}_${ann.newStatus}`;
                if (!taskGroups[groupKey]) taskGroups[groupKey] = [];
                taskGroups[groupKey].push(ann);
            });
            const updateCount = Object.keys(taskGroups).length;
            const latestStatus = taskAnnotations[0]?.newStatus || 'consider';
            const badgeClass = latestStatus === 'clear' ? 'badge-clear' : (latestStatus === 'fail' ? 'badge-fail' : 'badge-consider');
            const badgeColor = latestStatus === 'clear' ? '#d4edda' : (latestStatus === 'fail' ? '#f8d7da' : '#fff3cd');
            const badgeTextColor = latestStatus === 'clear' ? '#155724' : (latestStatus === 'fail' ? '#721c24' : '#856404');
            
            // Get all objectives for this task
            const checks = this.getTaskChecks(taskType, outcome, check);
            let objectivesHTML = '';
            checks.forEach(checkItem => {
                if (checkItem.isNestedCard || checkItem.isPersonCard || checkItem.isHitCard) return;
                
                const checkIconHTML = this.getTaskCheckIconCSS(checkItem.status);
                const indentStyle = (checkItem.indented || checkItem.isChildItem) ? 'padding-left: 24px;' : '';
                
                objectivesHTML += `
                    <div style="display: flex; align-items: flex-start; gap: 8px; font-size: 12px; color: #333; ${indentStyle}">
                        ${checkIconHTML}
                        <span>${checkItem.text}</span>
                    </div>
                `;
            });
            
            // Build annotation mini-cards for this task
            let annotationCardsHTML = '';
            Object.values(taskGroups).forEach(groupAnnotations => {
                const ann = groupAnnotations[0];
                const date = new Date(ann.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
                const time = new Date(ann.timestamp).toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
                
                const miniStatusColor = ann.newStatus === 'clear' ? '#e8f5e9' : (ann.newStatus === 'fail' ? '#ffebee' : '#fff3e0');
                const miniStatusTextColor = ann.newStatus === 'clear' ? '#39b549' : (ann.newStatus === 'fail' ? '#d32f2f' : '#f7931e');
                const miniStatusIconHTML = getStatusIcon(ann.newStatus);
                
                annotationCardsHTML += `
                    <div style="background: white; border: 1px solid #d1d5db; border-radius: 8px; padding: 14px 16px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <div style="font-size: 12px; color: #666;">
                                <span style="font-weight: bold; color: #333;">${ann.userName}</span>
                                <span> &#x2022; </span>
                                <span style="font-style: italic; font-size: 11px; color: #999;">${date}, ${time}</span>
                            </div>
                            <span style="display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: bold; background: ${miniStatusColor}; color: ${miniStatusTextColor};">
                                ${miniStatusIconHTML}
                                ${ann.newStatus.charAt(0).toUpperCase() + ann.newStatus.slice(1)}
                            </span>
                        </div>
                        <div style="font-size: 13px; color: #444; line-height: 1.5;">
                            ${ann.reason}
                        </div>
                    </div>
                `;
            });
            
            taskCardsHTML += `
                <div style="background: white; border-radius: 8px; border-left: 4px solid ${borderColor}; padding: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); margin-bottom: 12px; page-break-inside: avoid;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="font-size: 14px; font-weight: 500; color: #003c71; flex: 1;">${taskTitle}</div>
                        <span style="padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-right: 8px; background: ${badgeColor}; color: ${badgeTextColor};">${updateCount} Update${updateCount > 1 ? 's' : ''}</span>
                        ${statusIconHTML}
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px; padding: 8px 16px;">
                        ${objectivesHTML}
                    </div>
                    <div style="padding: 12px 16px;">
                        <h4 style="font-size: 13px; font-weight: bold; color: #333; margin-bottom: 12px;">Cashier Updates</h4>
                        ${annotationCardsHTML}
                    </div>
                </div>
            `;
        });
        
        const htmlContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    :root { --primary-blue: #003c71; --secondary-blue: #1d71b8; --green: #39b549; --orange: #f7931e; --red: #d32f2f; --grey: #6c757d; --light-grey: #f8f9fa; --border-grey: #dee2e6; }
                    body { font-family: 'Trebuchet MS', 'Lucida Grande', sans-serif; padding: 40px; background: white; color: #111; line-height: 1.5; font-size: 14px; }
                    .pdf-header { border-bottom: 3px solid var(--primary-blue); padding-bottom: 20px; margin-bottom: 30px; page-break-after: avoid; }
                    .pdf-title { font-size: 26px; font-weight: bold; color: var(--primary-blue); margin-bottom: 15px; }
                    .check-info { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 13px; }
                    .check-info-item { display: flex; gap: 8px; }
                    .check-info-label { font-weight: bold; color: var(--grey); min-width: 140px; }
                    .check-info-value { color: #333; }
                    .section-title { font-size: 18px; font-weight: bold; color: var(--primary-blue); margin: 30px 0 20px 0; padding-bottom: 8px; border-bottom: 2px solid var(--border-grey); page-break-after: avoid; }
                    .task-card { page-break-inside: avoid; margin-bottom: 16px; }
                    .annotation-mini-card { page-break-inside: avoid; }
                    .pdf-footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid var(--border-grey); text-align: center; font-size: 11px; color: #999; page-break-before: avoid; }
                    .objective-icon { width: 16px; height: 16px; flex-shrink: 0; margin-top: 2px; }
                    .icon-clear { fill: var(--green); }
                    .icon-consider { fill: var(--orange); }
                    .icon-fail { fill: var(--red); }
                    @media print { body { padding: 20px; } }
                </style>
            </head>
            <body>
                <div class="pdf-header">
                    <div class="pdf-title">Consider Annotations Report</div>
                    <div class="check-info">
                        <div class="check-info-item"><span class="check-info-label">Check Type:</span><span class="check-info-value">${checkType}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Consumer:</span><span class="check-info-value">${checkName}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Check Reference:</span><span class="check-info-value">${checkRef}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Check ID:</span><span class="check-info-value">${check.checkId || check.transactionId}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Matter:</span><span class="check-info-value">${matterName}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Generated:</span><span class="check-info-value">${generatedDate}, ${generatedTime}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Status:</span><span class="check-info-value">${checkStatus}</span></div>
                    </div>
                </div>
                <div class="section-title">Tasks with Annotations</div>
                ${taskCardsHTML}
                <div class="pdf-footer">
                    <p>This report was generated from Thurstan Hoskin's Thirdfort ID Management System</p>
                    <p>Report ID: ANT-${Date.now()} | Page 1 of 1</p>
                </div>
            </body>
            </html>
        `;
        
        const element = document.createElement('div');
        element.innerHTML = htmlContent;
        
        const opt = {
            margin: [10, 10, 10, 10],
            filename: `cashier-updates-${checkRef}-${Date.now()}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true, logging: false },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
            pagebreak: { mode: 'css', avoid: 'div[style*="page-break-inside: avoid"]' }
        };
        
        console.log('&#xD83D;&#xDCC4; Checking for html2pdf library...');
        console.log('&#xD83D;&#xDCC4; html2pdf available:', typeof html2pdf !== 'undefined');
        
        if (typeof html2pdf !== 'undefined') {
            console.log('&#xD83D;&#xDCC4; Starting PDF generation...');
            // Generate PDF as blob and open in print dialog
            html2pdf().set(opt).from(element).outputPdf('blob').then((pdfBlob) => {
                console.log('&#x2705; PDF blob generated:', pdfBlob.size, 'bytes');
                
                // Check if Print.js is available
                if (typeof printJS !== 'undefined') {
                    console.log('&#xD83D;&#xDCC4; Opening print dialog with Print.js...');
                const pdfUrl = URL.createObjectURL(pdfBlob);
                    
                    // Use Print.js to open print dialog with PDF
                    printJS({
                        printable: pdfUrl,
                        type: 'pdf',
                        onPrintDialogClose: () => {
                            // Clean up blob URL after print dialog closes
                            URL.revokeObjectURL(pdfUrl);
                        }
                    });
                } else {
                    // Fallback to new tab if Print.js not loaded
                    console.warn(' Print.js not loaded, opening in new tab');
                    const pdfUrl = URL.createObjectURL(pdfBlob);
                const printWindow = window.open(pdfUrl, '_blank');
                if (!printWindow) {
                    console.error('&#x274C; Popup blocked by browser');
                    alert('PDF generated but popup was blocked. Please allow popups for this site.');
                } else {
                    // Trigger print dialogue when PDF loads
                    printWindow.addEventListener('load', () => {
                        setTimeout(() => {
                            printWindow.print();
                        }, 100);
                    });
                    }
                }
                
                // Notify parent that PDF is generated and opened (only if auto-save)
                if (autoSave) {
                    console.log('&#xD83D;&#xDCE4; Sending pdf-generated message to parent');
                    this.sendMessage('pdf-generated', { 
                        type: 'consider',
                        checkId: check.checkId || check.transactionId 
                    });
                } else {
                    console.log('&#x2139;&#xFE0F; Manual export - not sending pdf-generated message');
                }
            }).catch(err => {
                console.error('&#x274C; Error generating PDF:', err);
                alert('Error generating PDF: ' + err.message);
                // Still notify parent even on error so data can refresh (only if auto-save)
                if (autoSave) {
                    this.sendMessage('pdf-generated', { 
                        type: 'consider',
                        error: err.message 
                    });
                }
            });
        } else {
            console.error('&#x274C; html2pdf library not loaded');
            alert('PDF library not loaded. Please refresh the page.');
            // Notify parent so data can refresh (only if auto-save)
            if (autoSave) {
                this.sendMessage('pdf-generated', { 
                    type: 'consider',
                    error: 'html2pdf not loaded' 
                });
            }
        }
    }
    
    toggleAnalysisItemFlag(button) {
        // Handle clicking flag buttons on analysis items (groups, chains, transactions)
        const flag = button.dataset.flag;
        
        // Find the parent item element first
        const itemElement = button.closest('[data-group-index], [data-chain-id], [data-tx-id]');
        if (!itemElement) return;
        
        // Get item type and key from parent element
        let itemType, itemKey;
        if (itemElement.hasAttribute('data-group-index')) {
            itemType = 'repeating-group';
            itemKey = itemElement.getAttribute('data-group-index');
        } else if (itemElement.hasAttribute('data-chain-id')) {
            itemType = 'chain';
            itemKey = itemElement.getAttribute('data-chain-id'); // Use chainId
        } else if (itemElement.hasAttribute('data-tx-id')) {
            itemType = 'transaction';
            itemKey = itemElement.getAttribute('data-tx-id');
        }
        
        // Find all flag buttons in this item (exclude link-funding button)
        const allButtons = itemElement.querySelectorAll('.tx-flag-btn-square:not(.link-funding)');
        
        // Check if this button is already active
        const wasActive = button.classList.contains('active');
        
        // Remove active class from all flag buttons
        allButtons.forEach(btn => btn.classList.remove('active'));
        
        // Find or show note section
        const noteSection = itemElement.querySelector('.analysis-item-note-section');
        
        if (wasActive) {
            // Clicking same button again = remove flag
            if (noteSection) {
                noteSection.classList.add('hidden');
                const noteInput = noteSection.querySelector('.analysis-item-note-input');
                if (noteInput) noteInput.value = '';
            }
            
            // Remove from sofAnnotations
            this.removeAnalysisItemFlag(itemType, itemKey);
        } else {
            // Set new flag
            button.classList.add('active');
            if (noteSection) {
                noteSection.classList.remove('hidden');
            }
            
            // Save to sofAnnotations (will be saved when user types in note or when overlay closes)
            this.saveAnalysisItemFlag(itemType, itemKey, flag);
        }
    }
    
    toggleAnalysisItemLinking(button) {
        // Handle clicking the blue + button on analysis items to link to funding methods
        
        // Find the parent item element
        const itemElement = button.closest('[data-group-index], [data-chain-id], [data-tx-id]');
        if (!itemElement) return;
        
        // Toggle button active state
        button.classList.toggle('active');
        const isActive = button.classList.contains('active');
        
        // Find the funding link dropdown
        const fundingLink = itemElement.querySelector('.analysis-item-funding-link');
        
        // Toggle visibility
        if (isActive) {
            if (fundingLink) {
                fundingLink.classList.remove('hidden');
            }
        } else {
            if (fundingLink) {
                fundingLink.classList.add('hidden');
                // Clear selection
                const select = fundingLink.querySelector('.analysis-item-funding-select');
                if (select) select.value = '';
            }
        }
    }
    
    toggleTransactionMarker(button) {
        // Handle clicking transaction marker buttons (accepted, rejected, review)
        // in funding method matched transactions sections
        
        // Find parent transaction row (could be .matched-tx-row or .matched-tx-row-with-markers)
        const txRow = button.closest('.matched-tx-row, .matched-tx-row-with-markers');
        if (!txRow) return;
        
        // Find all marker buttons in this transaction
        const allMarkerButtons = txRow.querySelectorAll('.tx-marker-btn');
        
        // Check if this button is already active
        const wasActive = button.classList.contains('active');
        
        // Remove active from all marker buttons
        allMarkerButtons.forEach(btn => btn.classList.remove('active'));
        
        // If it wasn't active, make it active
        if (!wasActive) {
            button.classList.add('active');
        }
        // If it was active, we've already removed it, so clicking again deactivates
    }
    
    /**
     * Get all annotations for a specific transaction from all sources
     * Returns { flag, note, linkedFundingMethods, marker }
     */
    getTransactionAnnotations(txId, check) {
        if (!check || !txId) return { flag: '', note: '', linkedFundingMethods: [], marker: '' };
        
        const sofAnnotations = check.sofAnnotations || [];
        const result = {
            flag: '',           // From bank analysis items (suspicious, cleared, review)
            note: '',           // Combined notes from all sources
            linkedFundingMethods: [], // Array of fund indices
            marker: ''          // From funding method markers (accepted, rejected, review)
        };
        
        const notes = [];
        
        sofAnnotations.forEach(ann => {
            // 1. Check bank analysis items (flags on transactions/chains/repeating groups)
            const bankAnalysisItems = ann.notes?.bankAnalysisItems || [];
            bankAnalysisItems.forEach(item => {
                if (item.type === 'transaction' && item.transactionId === txId) {
                    if (item.flag) result.flag = item.flag;
                    if (item.comment) notes.push(item.comment);
                    if (item.linkedToFundIdx) {
                        if (!result.linkedFundingMethods.includes(item.linkedToFundIdx)) {
                            result.linkedFundingMethods.push(item.linkedToFundIdx);
                        }
                    }
                }
                // Also check if this transaction is part of a chain
                if (item.type === 'chain' && item.chainId) {
                    // Chain IDs are composite of transaction IDs separated by |
                    const chainTxIds = item.chainId.split('|');
                    if (chainTxIds.includes(txId)) {
                        // Transaction is part of this flagged chain
                        if (item.flag && !result.flag) result.flag = item.flag;
                        const formattedNote = `Chain: ${item.comment}`;
                        if (item.comment && !notes.includes(formattedNote)) notes.push(formattedNote);
                        if (item.linkedToFundIdx) {
                            if (!result.linkedFundingMethods.includes(item.linkedToFundIdx)) {
                                result.linkedFundingMethods.push(item.linkedToFundIdx);
                            }
                        }
                    }
                }
                // Also check if this transaction is part of a repeating group
                if (item.type === 'repeating-group' && item.groupIndex !== undefined) {
                    // We need to check if this transaction belongs to this repeating group
                    // by checking the bank analysis data
                    const taskOutcomes = check.taskOutcomes || {};
                    const bankStatement = taskOutcomes['bank:statement'];
                    const bankSummary = taskOutcomes['bank:summary'];
                    const docsBankStatement = taskOutcomes['documents:bank-statement'];
                    const analysis = bankStatement?.breakdown?.analysis || 
                                   bankSummary?.breakdown?.analysis || 
                                   docsBankStatement?.breakdown?.analysis;
                    
                    if (analysis && analysis.repeating_transactions) {
                        const group = analysis.repeating_transactions[item.groupIndex];
                        if (group && group.items && group.items.includes(txId)) {
                            // Transaction is part of this repeating group
                            if (item.flag && !result.flag) result.flag = item.flag;
                            const formattedNote = `Repeating: ${item.comment}`;
                            if (item.comment && !notes.includes(formattedNote)) notes.push(formattedNote);
                            if (item.linkedToFundIdx) {
                                if (!result.linkedFundingMethods.includes(item.linkedToFundIdx)) {
                                    result.linkedFundingMethods.push(item.linkedToFundIdx);
                                }
                            }
                        }
                    }
                }
            });
            
            // 2. Check linked accounts transactions (manual linking and notes)
            const transactions = ann.notes?.transactions || [];
            transactions.forEach(tx => {
                if (tx.txId === txId) {
                    if (tx.flag && !result.flag) result.flag = tx.flag;
                    if (tx.note) notes.push(tx.note);
                    if (tx.linkedToFunds && Array.isArray(tx.linkedToFunds)) {
                        tx.linkedToFunds.forEach(fundIdx => {
                            if (!result.linkedFundingMethods.includes(fundIdx)) {
                                result.linkedFundingMethods.push(fundIdx);
                            }
                        });
                    }
                }
            });
            
            // 3. Check funding method transaction markers (accepted/rejected/review)
            const fundingMethods = ann.notes?.fundingMethods || [];
            fundingMethods.forEach(fm => {
                if (fm.transactionMarkers && fm.transactionMarkers[txId]) {
                    result.marker = fm.transactionMarkers[txId];
                }
            });
        });
        
        // Combine all notes
        result.note = notes.join(' | ');
        
        return result;
    }
    
    saveAnalysisItemFlag(itemType, itemKey, flag) {
        const check = this.currentCheck;
        if (!check.sofAnnotations) {
            check.sofAnnotations = [];
        }
        
        // Get current user
        const timestamp = new Date().toISOString();
        const user = this.userEmail || 'unknown@example.com';
        const userName = user.split('@')[0];
        
        // Find or create annotation
        let annotation = check.sofAnnotations.find(ann => 
            ann.user === user && ann.timestamp && 
            (new Date().getTime() - new Date(ann.timestamp).getTime()) < 300000 // Within 5 minutes
        );
        
        if (!annotation) {
            annotation = {
                timestamp,
                user,
                userName,
                notes: {
                    bankAnalysisItems: []
                }
            };
            check.sofAnnotations.unshift(annotation);
        }
        
        if (!annotation.notes.bankAnalysisItems) {
            annotation.notes.bankAnalysisItems = [];
        }
        
        // Remove any existing flag for this item
        annotation.notes.bankAnalysisItems = annotation.notes.bankAnalysisItems.filter(item => {
            if (itemType === 'repeating-group') {
                return !(item.type === 'repeating-group' && item.groupIndex == itemKey);
            } else if (itemType === 'chain') {
                return !(item.type === 'chain' && item.chainId === itemKey); // Use chainId
            } else if (itemType === 'transaction') {
                return !(item.type === 'transaction' && item.transactionId === itemKey);
            }
            return true;
        });
        
        // Add new flag
        const newItem = {
            type: itemType,
            flag,
            comment: ''
        };
        
        if (itemType === 'repeating-group') {
            newItem.groupIndex = parseInt(itemKey);
        } else if (itemType === 'chain') {
            newItem.chainId = itemKey; // Store chainId (which is a composite of transaction IDs)
        } else if (itemType === 'transaction') {
            newItem.transactionId = itemKey;
        }
        
        annotation.notes.bankAnalysisItems.push(newItem);
        
        console.log('&#x2705; Saved analysis item flag:', newItem);
    }
    
    removeAnalysisItemFlag(itemType, itemKey) {
        const check = this.currentCheck;
        if (!check.sofAnnotations) return;
        
        // Remove from all annotations
        check.sofAnnotations.forEach(ann => {
            if (!ann.notes?.bankAnalysisItems) return;
            
            ann.notes.bankAnalysisItems = ann.notes.bankAnalysisItems.filter(item => {
                if (itemType === 'repeating-group') {
                    return !(item.type === 'repeating-group' && item.groupIndex == itemKey);
                } else if (itemType === 'chain') {
                    return !(item.type === 'chain' && item.chainId === itemKey); // Use chainId
                } else if (itemType === 'transaction') {
                    return !(item.type === 'transaction' && item.transactionId === itemKey);
                }
                return true;
            });
        });
        
        console.log('&#xD83D;&#xDDD1;&#xFE0F; Removed analysis item flag');
    }
    
    createSofBiggestTransactionsSection(summaryByCcy, accounts, check, existingAnnotations) {
        // Create biggest transactions by currency section for SOF overlay with flag buttons
        const currencyFlag = this.getCurrencyFlag.bind(this);
        const sofAnnotations = existingAnnotations || [];
        
        // Get SoF funding methods for linking
        const sofTask = check?.taskOutcomes?.['sof:v1'];
        const sofFunds = sofTask?.breakdown?.funds || [];
        
        // Helper to generate unique chain ID
        const getChainId = (chain) => {
            const ids = [];
            if (chain.source) ids.push(chain.source.id);
            ids.push(chain.out.id);
            if (chain.in) ids.push(chain.in.id);
            if (chain.payment) ids.push(chain.payment.id);
            return ids.join('|');
        };
        
        // Helper to get existing flags/comments for items
        const getItemAnnotation = (itemType, itemKey) => {
            for (const ann of sofAnnotations) {
                const items = ann.notes?.bankAnalysisItems || [];
                const found = items.find(item => {
                    if (itemType === 'transaction' && item.type === 'transaction') {
                        return item.transactionId === itemKey;
                    } else if (itemType === 'chain' && item.type === 'chain') {
                        return item.chainId === itemKey;
                    }
                    return false;
                });
                if (found) {
                    return { flag: found.flag, comment: found.comment, linkedToFundIdx: found.linkedToFundIdx };
                }
            }
            return null;
        };
        
        // Helper to get funding link
        const getItemLink = (itemType, itemKey) => {
            const annotation = getItemAnnotation(itemType, itemKey);
            return annotation?.linkedToFundIdx;
        };
        
        // Helper to create flag buttons
        const createFlagButtons = (itemType, itemKey, existingFlag = '', existingComment = '') => {
            const existingLink = getItemLink(itemType, itemKey);
            
            return `
                <div class="tx-flag-buttons-inline">
                    <button type="button" class="tx-flag-btn-square cleared ${existingFlag === 'cleared' ? 'active' : ''}" 
                        data-flag="cleared" 
                        title="Cleared" onclick="event.stopPropagation(); manager.toggleAnalysisItemFlag(this);">
                        <svg viewBox="0 0 300 300"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>
                    </button>
                    <button type="button" class="tx-flag-btn-square suspicious ${existingFlag === 'suspicious' ? 'active' : ''}" 
                        data-flag="suspicious" 
                        title="Suspicious" onclick="event.stopPropagation(); manager.toggleAnalysisItemFlag(this);">
                        <svg viewBox="0 0 300 300"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>
                    </button>
                    <button type="button" class="tx-flag-btn-square review ${existingFlag === 'review' ? 'active' : ''}" 
                        data-flag="review" 
                        title="Under Review" onclick="event.stopPropagation(); manager.toggleAnalysisItemFlag(this);">
                        <svg viewBox="0 0 300 300"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>
                    </button>
                    ${sofFunds.length > 0 ? `
                        <button type="button" class="tx-flag-btn-square link-funding ${existingLink ? 'active' : ''}" 
                            data-action="link" 
                            title="Link to Funding Method" onclick="event.stopPropagation(); manager.toggleAnalysisItemLinking(this);">
                            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="none" fill="currentColor"/><path d="M12 6v12M6 12h12" stroke="white" stroke-width="2" fill="none"/></svg>
                        </button>
                    ` : ''}
                </div>
            `;
        };
        
        let html = '';
        
        for (const [currency, data] of Object.entries(summaryByCcy)) {
            const topIn = data.top_in || [];
            const topOut = data.top_out || [];
            const flag = currencyFlag(currency);
            
            // Filter transactions to only include those that actually match this currency
            let filteredTopIn = topIn.filter(tx => tx.currency === currency).slice(0, 5);
            let filteredTopOut = topOut.filter(tx => tx.currency === currency).slice(0, 5);
            
            // Enrich with account names
            filteredTopIn = filteredTopIn.map(tx => {
                const accountData = accounts[tx.account_id];
                const info = accountData?.info || accountData;
                return {
                    ...tx,
                    accountName: info?.name || 'Account'
                };
            });
            filteredTopOut = filteredTopOut.map(tx => {
                const accountData = accounts[tx.account_id];
                const info = accountData?.info || accountData;
                return {
                    ...tx,
                    accountName: info?.name || 'Account'
                };
            });
            
            // Skip if no matching transactions
            if (filteredTopIn.length === 0 && filteredTopOut.length === 0) {
                continue;
            }
            
            // Chain detection (same as task card)
            const matched = [];
            const transferPairs = [];
            const transactionChains = [];
            
            // First pass: Exact cross-account transfers
            filteredTopOut.forEach(outTx => {
                if (matched.includes(outTx.id)) return;
                const outDate = new Date(outTx.timestamp);
                const outAmount = Math.abs(outTx.amount);
                
                const match = filteredTopIn.find(inTx => {
                    if (matched.includes(inTx.id)) return false;
                    const inDate = new Date(inTx.timestamp);
                    const inAmount = Math.abs(inTx.amount);
                    
                    return Math.abs(inAmount - outAmount) < 0.01 && 
                           inTx.account_id !== outTx.account_id && 
                           inDate.toDateString() === outDate.toDateString();
                });
                
                if (match) {
                    matched.push(match.id);
                    matched.push(outTx.id);
                    transferPairs.push({ out: outTx, in: match });
                }
            });
            
            // Second pass: Same-account flows
            filteredTopOut.forEach(outTx => {
                if (matched.includes(outTx.id)) return;
                const outDate = new Date(outTx.timestamp);
                const outAmount = Math.abs(outTx.amount);
                
                const match = filteredTopIn.find(inTx => {
                    if (matched.includes(inTx.id)) return false;
                    const inDate = new Date(inTx.timestamp);
                    const inAmount = Math.abs(inTx.amount);
                    const daysDiff = (outDate - inDate) / (1000 * 60 * 60 * 24);
                    
                    return inTx.account_id === outTx.account_id && 
                           daysDiff >= 0 && daysDiff <= 3 &&
                           inAmount >= outAmount &&
                           (inAmount - outAmount) <= Math.max(500, inAmount * 0.2);
                });
                
                if (match) {
                    matched.push(match.id);
                    matched.push(outTx.id);
                    transactionChains.push({ 
                        source: match, 
                        out: outTx, 
                        in: null
                    });
                }
            });
            
            // Helper to render chain with controls
            const renderChainWithControls = (chain, currencyFlag) => {
                // Generate unique chain ID from transaction IDs
                const chainId = getChainId(chain);
                const chainAnnotation = getItemAnnotation('chain', chainId);
                const chainFlag = chainAnnotation ? chainAnnotation.flag : '';
                const chainComment = chainAnnotation ? chainAnnotation.comment : '';
                const hasChainFlag = chainFlag !== '';
                const chainLinkedFund = getItemLink('chain', chainId);
                
                // Build funding dropdown
                let chainFundingDropdown = '';
                if (sofFunds.length > 0) {
                    chainFundingDropdown = `
                        <div class="analysis-item-funding-link ${chainLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                            <select class="analysis-item-funding-select" data-item-type="chain" data-chain-id="${chainId}" style="width: 100%; font-size: 11px; padding: 6px;">
                                <option value="">-- Select funding method --</option>
                                ${sofFunds.map((fund, fundIdx) => {
                                    const fundLabel = fund.data?.amount ? 
                                        `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.data.amount / 100).toLocaleString()}` :
                                        fund.type.replace('fund:', '').toUpperCase();
                                    return `<option value="${fundIdx}" ${chainLinkedFund == fundIdx ? 'selected' : ''}>${fundLabel}</option>`;
                                }).join('')}
                            </select>
                        </div>
                    `;
                }
                
                return `
                    <div class="chain-wrapper" data-chain-id="${chainId}">
                        ${this.renderChainColumnContent(chain, currencyFlag)}
                        <div class="chain-controls">
                            ${createFlagButtons('chain', chainId, chainFlag, chainComment)}
                        </div>
                        <div class="analysis-item-note-section ${hasChainFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <textarea class="analysis-item-note-input" data-item-type="chain" data-chain-id="${chainId}" rows="2" placeholder="Add notes about this chain...">${chainComment}</textarea>
                        </div>
                        ${chainFundingDropdown}
                    </div>
                `;
            };
            
            // Build chains HTML
            let chainsHtml = '';
            if (transferPairs.length > 0 || transactionChains.length > 0) {
                chainsHtml += '<div class="internal-transfers-label">Linked Transactions</div>';
                
                // Render transfer pairs with controls
                transferPairs.forEach((chain) => {
                    chainsHtml += renderChainWithControls(chain, flag);
                });
                
                // Render same-account chains with controls
                transactionChains.forEach((chain) => {
                    chainsHtml += renderChainWithControls(chain, flag);
                });
            }
            
            // Build unmatched transactions
            const unmatchedIn = filteredTopIn.filter(tx => !matched.includes(tx.id));
            const unmatchedOut = filteredTopOut.filter(tx => !matched.includes(tx.id));
            
            let incomingHtml = '';
            unmatchedIn.forEach(tx => {
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                const txAnnotation = getItemAnnotation('transaction', tx.id);
                const txFlag = txAnnotation ? txAnnotation.flag : '';
                const txComment = txAnnotation ? txAnnotation.comment : '';
                const hasTxFlag = txFlag !== '';
                const txLinkedFund = getItemLink('transaction', tx.id);
                
                // Build funding dropdown
                let txFundingDropdown = '';
                if (sofFunds.length > 0) {
                    txFundingDropdown = `
                        <div class="analysis-item-funding-link ${txLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                            <select class="analysis-item-funding-select" data-item-type="transaction" data-tx-id="${tx.id}" style="width: 100%; font-size: 11px; padding: 6px;">
                                <option value="">-- Select funding method --</option>
                                ${sofFunds.map((fund, fundIdx) => {
                                    const fundLabel = fund.data?.amount ? 
                                        `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.data.amount / 100).toLocaleString()}` :
                                        fund.type.replace('fund:', '').toUpperCase();
                                    return `<option value="${fundIdx}" ${txLinkedFund == fundIdx ? 'selected' : ''}>${fundLabel}</option>`;
                                }).join('')}
                            </select>
                        </div>
                    `;
                }
                
                incomingHtml += `
                    <div class="transaction-row-wrapper" data-tx-id="${tx.id}">
                        <div class="transaction-row incoming">
                            <span class="transaction-date">${date}</span>
                            <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}</span>
                            <span class="account-badge">${tx.accountName}</span>
                            <span class="transaction-amount positive">+${flag}${Math.abs(tx.amount).toFixed(2)}</span>
                            ${createFlagButtons('transaction', tx.id, txFlag, txComment)}
                        </div>
                        <div class="analysis-item-note-section ${hasTxFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <textarea class="analysis-item-note-input" data-item-type="transaction" data-tx-id="${tx.id}" rows="2" placeholder="Add notes...">${txComment}</textarea>
                        </div>
                        ${txFundingDropdown}
                    </div>
                `;
            });
            
            let outgoingHtml = '';
            unmatchedOut.forEach(tx => {
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                const txAnnotation = getItemAnnotation('transaction', tx.id);
                const txFlag = txAnnotation ? txAnnotation.flag : '';
                const txComment = txAnnotation ? txAnnotation.comment : '';
                const hasTxFlag = txFlag !== '';
                const txLinkedFund = getItemLink('transaction', tx.id);
                
                // Build funding dropdown
                let txFundingDropdown = '';
                if (sofFunds.length > 0) {
                    txFundingDropdown = `
                        <div class="analysis-item-funding-link ${txLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                            <select class="analysis-item-funding-select" data-item-type="transaction" data-tx-id="${tx.id}" style="width: 100%; font-size: 11px; padding: 6px;">
                                <option value="">-- Select funding method --</option>
                                ${sofFunds.map((fund, fundIdx) => {
                                    const fundLabel = fund.data?.amount ? 
                                        `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.data.amount / 100).toLocaleString()}` :
                                        fund.type.replace('fund:', '').toUpperCase();
                                    return `<option value="${fundIdx}" ${txLinkedFund == fundIdx ? 'selected' : ''}>${fundLabel}</option>`;
                                }).join('')}
                            </select>
                        </div>
                    `;
                }
                
                outgoingHtml += `
                    <div class="transaction-row-wrapper" data-tx-id="${tx.id}">
                        <div class="transaction-row outgoing">
                            <span class="transaction-date">${date}</span>
                            <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}</span>
                            <span class="account-badge">${tx.accountName}</span>
                            <span class="transaction-amount negative">${flag}${Math.abs(tx.amount).toFixed(2)}</span>
                            ${createFlagButtons('transaction', tx.id, txFlag, txComment)}
                        </div>
                        <div class="analysis-item-note-section ${hasTxFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <textarea class="analysis-item-note-input" data-item-type="transaction" data-tx-id="${tx.id}" rows="2" placeholder="Add notes...">${txComment}</textarea>
                        </div>
                        ${txFundingDropdown}
                    </div>
                `;
            });
            
            // Build columns
            let columnsHtml = '';
            if (incomingHtml || outgoingHtml) {
                if (incomingHtml && outgoingHtml) {
                    columnsHtml = `
                        <div class="transactions-columns">
                            <div class="transactions-column">
                                <div class="column-header incoming-header">Incoming</div>
                                ${incomingHtml}
                            </div>
                            <div class="transactions-column">
                                <div class="column-header outgoing-header">Outgoing</div>
                                ${outgoingHtml}
                            </div>
                        </div>
                    `;
                } else if (incomingHtml) {
                    columnsHtml = `
                        <div class="transactions-columns single-column">
                            <div class="transactions-column">
                                <div class="column-header incoming-header">Incoming</div>
                                ${incomingHtml}
                            </div>
                        </div>
                    `;
                } else {
                    columnsHtml = `
                        <div class="transactions-columns single-column">
                            <div class="transactions-column">
                                <div class="column-header outgoing-header">Outgoing</div>
                                ${outgoingHtml}
                            </div>
                        </div>
                    `;
                }
            }
            
            html += `
                <div class="currency-group-section collapsed" onclick="event.stopPropagation(); this.classList.toggle('collapsed');">
                    <div class="currency-section-header">
                        <span class="currency-section-title">${flag} ${currency}</span>
                        <span class="expand-indicator">&#x25BC;</span>
                    </div>
                    <div class="currency-section-content">
                        ${chainsHtml}
                        ${columnsHtml}
                    </div>
                </div>
            `;
        }
        
        return html;
    }
    
    createSofBankAnalysisSections(analysis, accounts, check, existingAnnotations) {
        // Create bank analysis sections for SOF overlay with SAME visualization as task card
        // But with flag buttons on chains, groups, and transactions
        
        if (!analysis) return '';
        
        let html = '';
        const sofAnnotations = existingAnnotations || [];
        const currencySymbol = this.getCurrencyFlag('GBP');
        
        // Helper to generate unique chain ID from transaction IDs
        const getChainId = (chain) => {
            const ids = [];
            if (chain.source) ids.push(chain.source.id);
            ids.push(chain.out.id);
            if (chain.in) ids.push(chain.in.id);
            if (chain.payment) ids.push(chain.payment.id);
            return ids.join('|'); // Use pipe separator to create unique ID
        };
        
        // Helper to get transaction details from ID
        const getTransactionById = (txId) => {
            for (const [accountId, accountData] of Object.entries(accounts)) {
                const statement = accountData.statement || [];
                const tx = statement.find(t => t.id === txId);
                if (tx) {
                    const accountInfo = accountData.info || accountData;
                    return { ...tx, accountName: accountInfo.name || 'Account', accountId };
                }
            }
            return null;
        };
        
        // Helper to get existing flags/comments for items
        const getItemAnnotation = (itemType, itemKey) => {
            for (const ann of sofAnnotations) {
                const items = ann.notes?.bankAnalysisItems || [];
                const found = items.find(item => {
                    if (itemType === 'repeating-group' && item.type === 'repeating-group') {
                        return item.groupIndex === itemKey;
                    } else if (itemType === 'chain' && item.type === 'chain') {
                        return item.chainId === itemKey; // Changed from chainIndex to chainId
                    } else if (itemType === 'transaction' && item.type === 'transaction') {
                        return item.transactionId === itemKey;
                    }
                    return false;
                });
                if (found) {
                    return { flag: found.flag, comment: found.comment };
                }
            }
            return null;
        };
        
        // Get SoF funding methods for linking
        const sofTask = check?.taskOutcomes?.['sof:v1'];
        const sofFunds = sofTask?.breakdown?.funds || [];
        
        // Helper to get existing link for an analysis item
        const getItemLink = (itemType, itemKey) => {
            for (const ann of sofAnnotations) {
                const items = ann.notes?.bankAnalysisItems || [];
                const found = items.find(item => {
                    if (itemType === 'repeating-group' && item.type === 'repeating-group') {
                        return item.groupIndex === itemKey;
                    } else if (itemType === 'chain' && item.type === 'chain') {
                        return item.chainId === itemKey; // Changed from chainIndex to chainId
                    } else if (itemType === 'transaction' && item.type === 'transaction') {
                        return item.transactionId === itemKey;
                    }
                    return false;
                });
                if (found && found.linkedToFundIdx) {
                    return found.linkedToFundIdx;
                }
            }
            return '';
        };
        
        // Helper to create flag buttons (same style as transaction list)
        const createFlagButtons = (itemType, itemKey, existingFlag = '', existingComment = '') => {
            // Don't add data attributes to buttons - they're on the parent card
            const existingLink = getItemLink(itemType, itemKey);
            
            return `
                <div class="tx-flag-buttons-inline">
                    <button type="button" class="tx-flag-btn-square cleared ${existingFlag === 'cleared' ? 'active' : ''}" 
                        data-flag="cleared" 
                        title="Cleared" onclick="event.stopPropagation(); manager.toggleAnalysisItemFlag(this);">
                        <svg viewBox="0 0 300 300"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m123.03 224.25-62.17-62.17 21.22-21.21 40.95 40.95 95.46-95.46 21.21 21.21z"/></svg>
                    </button>
                    <button type="button" class="tx-flag-btn-square suspicious ${existingFlag === 'suspicious' ? 'active' : ''}" 
                        data-flag="suspicious" 
                        title="Suspicious" onclick="event.stopPropagation(); manager.toggleAnalysisItemFlag(this);">
                        <svg viewBox="0 0 300 300"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="m102.122 81.21 116.673 116.672-21.213 21.213L80.909 102.423z"/><path fill="#ffffff" d="M218.086 102.417 101.413 219.09 80.2 197.877 196.873 81.204z"/></svg>
                    </button>
                    <button type="button" class="tx-flag-btn-square review ${existingFlag === 'review' ? 'active' : ''}" 
                        data-flag="review" 
                        title="Under Review" onclick="event.stopPropagation(); manager.toggleAnalysisItemFlag(this);">
                        <svg viewBox="0 0 300 300"><path fill="currentColor" d="M300 150c0 82.843-67.157 150-150 150S0 232.843 0 150 67.157 0 150 0s150 67.157 150 150"/><path fill="#ffffff" d="M67.36 135.15h165v30h-165z"/></svg>
                    </button>
                    ${sofFunds.length > 0 ? `
                        <button type="button" class="tx-flag-btn-square link-funding ${existingLink ? 'active' : ''}" 
                            data-action="link" 
                            title="Link to Funding Method" onclick="event.stopPropagation(); manager.toggleAnalysisItemLinking(this);">
                            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="none" fill="currentColor"/><path d="M12 6v12M6 12h12" stroke="white" stroke-width="2" fill="none"/></svg>
                        </button>
                    ` : ''}
                </div>
            `;
        };
        
        // 1. Repeating Transactions Section
        if (analysis.repeating_transactions && analysis.repeating_transactions.length > 0) {
            let repeatingHtml = '';
            
            analysis.repeating_transactions.forEach((group, groupIdx) => {
                const amount = group.sort_score;
                const frequency = group.items.length;
                
                // Get all transaction details
                const transactions = group.items.map(id => getTransactionById(id)).filter(tx => tx);
                if (transactions.length === 0) return;
                
                // Separate into incoming and outgoing
                const incomingTxs = transactions.filter(tx => tx.amount > 0);
                const outgoingTxs = transactions.filter(tx => tx.amount < 0);
                
                // Apply chain detection (same logic as task card)
                const matched = [];
                const chains = [];
                
                // Pass 1: Exact cross-account transfers
                outgoingTxs.forEach(outTx => {
                    if (matched.includes(outTx.id)) return;
                    const outDate = new Date(outTx.timestamp);
                    
                    const match = incomingTxs.find(inTx => {
                        if (matched.includes(inTx.id)) return false;
                        const inDate = new Date(inTx.timestamp);
                        return inDate.toDateString() === outDate.toDateString() && 
                               inTx.account_id !== outTx.account_id;
                    });
                    
                    if (match) {
                        matched.push(match.id);
                        matched.push(outTx.id);
                        chains.push({ out: outTx, in: match });
                    }
                });
                
                // Pass 2: Same-account flows
                outgoingTxs.forEach(outTx => {
                    if (matched.includes(outTx.id)) return;
                    const outDate = new Date(outTx.timestamp);
                    
                    const match = incomingTxs.find(inTx => {
                        if (matched.includes(inTx.id)) return false;
                        const inDate = new Date(inTx.timestamp);
                        const daysDiff = (outDate - inDate) / (1000 * 60 * 60 * 24);
                        
                        return inTx.account_id === outTx.account_id && 
                               daysDiff >= 0 && daysDiff <= 3;
                    });
                    
                    if (match) {
                        matched.push(match.id);
                        matched.push(outTx.id);
                        chains.push({ source: match, out: outTx, in: null });
                    }
                });
                
                // Build chains HTML with flag buttons using unique chain IDs
                let chainsHtml = '';
                chains.forEach(chain => {
                    // Generate unique chain ID from transaction IDs
                    const chainId = getChainId(chain);
                    
                    // Get existing annotation for this chain using chainId
                    const chainAnnotation = getItemAnnotation('chain', chainId);
                    const chainFlag = chainAnnotation ? chainAnnotation.flag : '';
                    const chainComment = chainAnnotation ? chainAnnotation.comment : '';
                    const hasChainFlag = chainFlag !== '';
                    const chainLinkedFund = getItemLink('chain', chainId);
                    
                    // Build funding method dropdown if there are funds
                    let chainFundingDropdown = '';
                    if (sofFunds.length > 0) {
                        chainFundingDropdown = `
                            <div class="analysis-item-funding-link ${chainLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                                <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                                <select class="analysis-item-funding-select" data-item-type="chain" data-chain-id="${chainId}" style="width: 100%; font-size: 11px; padding: 6px;">
                                    <option value="">-- Select funding method --</option>
                                    ${sofFunds.map((fund, fundIdx) => {
                                        const fundLabel = fund.data?.amount ? 
                                            `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.data.amount / 100).toLocaleString()}` :
                                            fund.type.replace('fund:', '').toUpperCase();
                                        // Convert both to strings for comparison to avoid type mismatch
                                        return `<option value="${fundIdx}" ${String(chainLinkedFund) === String(fundIdx) ? 'selected' : ''}>${fundLabel}</option>`;
                                    }).join('')}
                                </select>
                            </div>
                        `;
                    }
                    
                    chainsHtml += `
                        <div class="chain-wrapper" data-chain-id="${chainId}">
                            <div class="chain-column">
                                ${this.renderChainColumnContent(chain, currencySymbol)}
                            </div>
                            <div class="chain-controls">
                                ${createFlagButtons('chain', chainId, chainFlag, chainComment)}
                            </div>
                            <div class="analysis-item-note-section ${hasChainFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                                <textarea class="analysis-item-note-input" data-item-type="chain" data-chain-id="${chainId}" rows="2" placeholder="Add notes about this chain...">${chainComment}</textarea>
                            </div>
                            ${chainFundingDropdown}
                        </div>
                    `;
                });
                
                // Build unmatched transactions in columns
                const unmatchedIn = incomingTxs.filter(tx => !matched.includes(tx.id));
                const unmatchedOut = outgoingTxs.filter(tx => !matched.includes(tx.id));
                
                let incomingHtml = '';
                unmatchedIn.forEach(tx => {
                    const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
                    
                    // Get comprehensive annotations for this transaction
                    const txAnnotations = check ? this.getTransactionAnnotations(tx.id, check) : { flag: '', note: '', marker: '' };
                    
                    // Build badges
                    let badgesHtml = '';
                    
                    // Marker badges
                    if (txAnnotations.marker === 'accepted') {
                        badgesHtml += '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                    } else if (txAnnotations.marker === 'rejected') {
                        badgesHtml += '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                    }
                    
                    // Flag badges
                    if (txAnnotations.flag === 'cleared') {
                        badgesHtml += '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                    } else if (txAnnotations.flag === 'suspicious') {
                        badgesHtml += '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                    } else if (txAnnotations.flag === 'review') {
                        badgesHtml += '<span class="tx-marker-badge review">&#x2014; Review</span>';
                    } else if (txAnnotations.flag === 'linked') {
                        badgesHtml += '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                    }
                    
                    // User note badge
                    if (txAnnotations.note) {
                        badgesHtml += `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f5f5f5; color: #666; border: 1px solid #ddd; margin-left: 4px;">&#xD83D;&#xDCDD; ${txAnnotations.note}</span>`;
                    }
                    
                    incomingHtml += `
                        <div class="transaction-row incoming">
                            <span class="transaction-date">${date}</span>
                            <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}${badgesHtml}</span>
                            <span class="account-badge">${tx.accountName}</span>
                            <span class="transaction-amount positive">${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>
                        </div>
                    `;
                });
                
                let outgoingHtml = '';
                unmatchedOut.forEach(tx => {
                    const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
                    
                    // Get comprehensive annotations for this transaction
                    const txAnnotations = check ? this.getTransactionAnnotations(tx.id, check) : { flag: '', note: '', marker: '' };
                    
                    // Build badges
                    let badgesHtml = '';
                    
                    // Marker badges
                    if (txAnnotations.marker === 'accepted') {
                        badgesHtml += '<span class="tx-marker-badge accepted">&#x2713; Accepted</span>';
                    } else if (txAnnotations.marker === 'rejected') {
                        badgesHtml += '<span class="tx-marker-badge rejected">&#x2717; Rejected</span>';
                    }
                    
                    // Flag badges
                    if (txAnnotations.flag === 'cleared') {
                        badgesHtml += '<span class="tx-marker-badge cleared">&#x25CB; Cleared</span>';
                    } else if (txAnnotations.flag === 'suspicious') {
                        badgesHtml += '<span class="tx-marker-badge suspicious">&#x2717; Suspicious</span>';
                    } else if (txAnnotations.flag === 'review') {
                        badgesHtml += '<span class="tx-marker-badge review">&#x2014; Review</span>';
                    } else if (txAnnotations.flag === 'linked') {
                        badgesHtml += '<span class="tx-marker-badge linked">&#x2713; Linked</span>';
                    }
                    
                    // User note badge
                    if (txAnnotations.note) {
                        badgesHtml += `<span style="display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; background: #f5f5f5; color: #666; border: 1px solid #ddd; margin-left: 4px;">&#xD83D;&#xDCDD; ${txAnnotations.note}</span>`;
                    }
                    
                    outgoingHtml += `
                        <div class="transaction-row outgoing">
                            <span class="transaction-date">${date}</span>
                            <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}${badgesHtml}</span>
                            <span class="account-badge">${tx.accountName}</span>
                            <span class="transaction-amount negative">${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>
                        </div>
                    `;
                });
                
                // Build columns section
                let columnsHtml = '';
                const hasIncoming = incomingHtml.trim().length > 0;
                const hasOutgoing = outgoingHtml.trim().length > 0;
                
                if (hasIncoming || hasOutgoing) {
                    if (hasIncoming && hasOutgoing) {
                        columnsHtml = `
                            <div class="transactions-columns">
                                <div class="transactions-column">
                                    <div class="column-header incoming-header">Incoming</div>
                                    ${incomingHtml}
                                </div>
                                <div class="transactions-column">
                                    <div class="column-header outgoing-header">Outgoing</div>
                                    ${outgoingHtml}
                                </div>
                            </div>
                        `;
                    } else if (hasIncoming) {
                        columnsHtml = `
                            <div class="transactions-columns single-column">
                                <div class="transactions-column">
                                    <div class="column-header incoming-header">Incoming</div>
                                    ${incomingHtml}
                                </div>
                            </div>
                        `;
                    } else {
                        columnsHtml = `
                            <div class="transactions-columns single-column">
                                <div class="transactions-column">
                                    <div class="column-header outgoing-header">Outgoing</div>
                                    ${outgoingHtml}
                                </div>
                            </div>
                        `;
                    }
                }
                
                const accountsSet = [...new Set(transactions.map(tx => tx.accountName))];
                const groupAnnotation = getItemAnnotation('repeating-group', groupIdx);
                const groupFlag = groupAnnotation ? groupAnnotation.flag : '';
                const groupComment = groupAnnotation ? groupAnnotation.comment : '';
                const hasGroupFlag = groupFlag !== '';
                const groupLinkedFund = getItemLink('repeating-group', groupIdx);
                
                // Build funding method dropdown if there are funds
                let fundingDropdown = '';
                if (sofFunds.length > 0) {
                    fundingDropdown = `
                        <div class="analysis-item-funding-link ${groupLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                            <select class="analysis-item-funding-select" data-item-type="repeating-group" data-group-index="${groupIdx}" style="width: 100%; font-size: 11px; padding: 6px;">
                                <option value="">-- Select funding method --</option>
                                ${sofFunds.map((fund, fundIdx) => {
                                    const fundLabel = fund.data?.amount ? 
                                        `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.data.amount / 100).toLocaleString()}` :
                                        fund.type.replace('fund:', '').toUpperCase();
                                    // Convert both to strings for comparison to avoid type mismatch
                                    return `<option value="${fundIdx}" ${String(groupLinkedFund) === String(fundIdx) ? 'selected' : ''}>${fundLabel}</option>`;
                                }).join('')}
                            </select>
                        </div>
                    `;
                }
                
                repeatingHtml += `
                    <div class="analysis-item-card" data-group-index="${groupIdx}">
                        <div class="analysis-card-header">
                            <div class="analysis-card-title">
                                ${currencySymbol}${Math.abs(amount).toFixed(2)} &#xD7; ${frequency}
                            </div>
                            <div class="analysis-card-meta">
                                ${accountsSet.length > 1 ? `Between: ${accountsSet.join(' &#x2194; ')}` : `Account: ${accountsSet[0]}`}
                            </div>
                            ${createFlagButtons('repeating-group', groupIdx, groupFlag, groupComment)}
                        </div>
                        <div class="analysis-item-note-section ${hasGroupFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <textarea class="analysis-item-note-input" data-item-type="repeating-group" data-group-index="${groupIdx}" rows="2" placeholder="Add notes about this pattern...">${groupComment}</textarea>
                        </div>
                        ${fundingDropdown}
                        ${chainsHtml ? `
                            <div class="internal-transfers-label">Linked Transactions</div>
                            ${chainsHtml}
                        ` : ''}
                        ${columnsHtml}
                    </div>
                `;
            });
            
            html += `
                <div class="bank-analysis-section collapsed" onclick="event.stopPropagation(); this.classList.toggle('collapsed');">
                    <div class="analysis-section-header">
                        <span class="analysis-section-title">Repeating Transactions (${analysis.repeating_transactions.length} patterns)</span>
                        <span class="expand-indicator">&#x25BC;</span>
                    </div>
                    <div class="analysis-section-content">
                        ${repeatingHtml}
                    </div>
                </div>
            `;
        }
        
        // 2. Large One-off Transactions Section (with chain detection)
        if (analysis.large_one_off_transactions && analysis.large_one_off_transactions.length > 0) {
            const oneOffTxs = analysis.large_one_off_transactions
                .map(txId => getTransactionById(txId))
                .filter(tx => tx);
            
            const oneOffIn = oneOffTxs.filter(tx => tx.amount > 0);
            const oneOffOut = oneOffTxs.filter(tx => tx.amount < 0);
            
            // Chain detection
            const matched = [];
            const transferPairs = [];
            const chains = [];
            
            // First pass: Exact cross-account transfers
            oneOffOut.forEach(outTx => {
                if (matched.includes(outTx.id)) return;
                const outDate = new Date(outTx.timestamp);
                const outAmount = Math.abs(outTx.amount);
                
                const match = oneOffIn.find(inTx => {
                    if (matched.includes(inTx.id)) return false;
                    const inDate = new Date(inTx.timestamp);
                    const inAmount = Math.abs(inTx.amount);
                    
                    return Math.abs(inAmount - outAmount) < 0.01 && 
                           inTx.account_id !== outTx.account_id && 
                           inDate.toDateString() === outDate.toDateString();
                });
                
                if (match) {
                    matched.push(match.id);
                    matched.push(outTx.id);
                    transferPairs.push({ out: outTx, in: match });
                }
            });
            
            // Second pass: Same-account flows
            oneOffOut.forEach(outTx => {
                if (matched.includes(outTx.id)) return;
                const outDate = new Date(outTx.timestamp);
                const outAmount = Math.abs(outTx.amount);
                
                const match = oneOffIn.find(inTx => {
                    if (matched.includes(inTx.id)) return false;
                    const inDate = new Date(inTx.timestamp);
                    const inAmount = Math.abs(inTx.amount);
                    const daysDiff = (outDate - inDate) / (1000 * 60 * 60 * 24);
                    
                    return inTx.account_id === outTx.account_id && 
                           daysDiff >= 0 && daysDiff <= 3 &&
                           inAmount >= outAmount &&
                           (inAmount - outAmount) <= Math.max(500, inAmount * 0.2);
                });
                
                if (match) {
                    matched.push(match.id);
                    matched.push(outTx.id);
                    chains.push({ 
                        source: match, 
                        out: outTx, 
                        in: null
                    });
                }
            });
            
            // Third pass: Extend with preceding/subsequent
            const extendedChains = [];
            transferPairs.forEach(pair => {
                const candidateIncomes = oneOffIn.filter(precedingTx => {
                    if (matched.includes(precedingTx.id)) return false;
                    const precedingDate = new Date(precedingTx.timestamp);
                    const outDate = new Date(pair.out.timestamp);
                    const daysDiff = (outDate - precedingDate) / (1000 * 60 * 60 * 24);
                    
                    return precedingTx.account_id === pair.out.account_id && 
                           daysDiff >= 0 && daysDiff <= 3;
                });
                
                const precedingIncome = candidateIncomes.length > 0
                    ? candidateIncomes.reduce((largest, tx) => 
                        Math.abs(tx.amount) > Math.abs(largest.amount) ? tx : largest
                      )
                    : null;
                
                const subsequentPayment = oneOffOut.find(paymentTx => {
                    if (matched.includes(paymentTx.id)) return false;
                    const paymentDate = new Date(paymentTx.timestamp);
                    const inDate = new Date(pair.in.timestamp);
                    const daysDiff = (paymentDate - inDate) / (1000 * 60 * 60 * 24);
                    
                    return paymentTx.account_id === pair.in.account_id && 
                           daysDiff >= 0 && daysDiff <= 2;
                });
                
                if (precedingIncome) matched.push(precedingIncome.id);
                if (subsequentPayment) matched.push(subsequentPayment.id);
                
                extendedChains.push({
                    source: precedingIncome,
                    out: pair.out,
                    in: pair.in,
                    payment: subsequentPayment
                });
            });
            
            // Build HTML
            let oneOffHtml = '';
            
            // Combine all chains (extended and simple) for unified rendering
            const allChains = [...extendedChains, ...chains];
            
            // Render chains with flag buttons
            if (allChains.length > 0) {
                oneOffHtml += '<div class="internal-transfers-label">Linked Transactions</div>';
                
                allChains.forEach((chain, chainIdx) => {
                    // Get existing annotation for this chain
                    const chainAnnotation = getItemAnnotation('chain', chainIdx);
                    const chainFlag = chainAnnotation ? chainAnnotation.flag : '';
                    const chainComment = chainAnnotation ? chainAnnotation.comment : '';
                    const hasChainFlag = chainFlag !== '';
                    const chainLinkedFund = getItemLink('chain', chainIdx);
                    
                    // Build funding method dropdown if there are funds
                    let chainFundingDropdown = '';
                    if (sofFunds.length > 0) {
                        chainFundingDropdown = `
                            <div class="analysis-item-funding-link ${chainLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                                <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                                <select class="analysis-item-funding-select" data-item-type="chain" data-chain-index="${chainIdx}" style="width: 100%; font-size: 11px; padding: 6px;">
                                    <option value="">-- Select funding method --</option>
                                    ${sofFunds.map((fund, fundIdx) => {
                                        const fundLabel = fund.amount ? 
                                            `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.amount / 100).toLocaleString()}` :
                                            fund.type.replace('fund:', '').toUpperCase();
                                        return `<option value="${fundIdx}" ${chainLinkedFund == fundIdx ? 'selected' : ''}>${fundLabel}</option>`;
                                    }).join('')}
                                </select>
                            </div>
                        `;
                    }
                    
                    oneOffHtml += `
                        <div class="chain-wrapper" data-chain-index="${chainIdx}">
                            <div class="chain-column">
                                ${this.renderChainColumnContent(chain, currencySymbol)}
                            </div>
                            <div class="chain-controls">
                                ${createFlagButtons('chain', chainIdx, chainFlag, chainComment)}
                            </div>
                            <div class="analysis-item-note-section ${hasChainFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                                <textarea class="analysis-item-note-input" data-item-type="chain" data-chain-index="${chainIdx}" rows="2" placeholder="Add notes about this chain...">${chainComment}</textarea>
                            </div>
                            ${chainFundingDropdown}
                        </div>
                    `;
                });
            }
            
            // Render unmatched transactions
            const unmatchedIn = oneOffIn.filter(tx => !matched.includes(tx.id));
            const unmatchedOut = oneOffOut.filter(tx => !matched.includes(tx.id));
            
            let incomingHtml = '';
            unmatchedIn.forEach(tx => {
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                const txAnnotation = getItemAnnotation('transaction', tx.id);
                const txFlag = txAnnotation ? txAnnotation.flag : '';
                const txComment = txAnnotation ? txAnnotation.comment : '';
                const hasTxFlag = txFlag !== '';
                const txLinkedFund = getItemLink('transaction', tx.id);
                
                // Build funding method dropdown if there are funds
                let txFundingDropdown = '';
                if (sofFunds.length > 0) {
                    txFundingDropdown = `
                        <div class="analysis-item-funding-link ${txLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                            <select class="analysis-item-funding-select" data-item-type="transaction" data-tx-id="${tx.id}" style="width: 100%; font-size: 11px; padding: 6px;">
                                <option value="">-- Select funding method --</option>
                                ${sofFunds.map((fund, fundIdx) => {
                                    const fundLabel = fund.amount ? 
                                        `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.amount / 100).toLocaleString()}` :
                                        fund.type.replace('fund:', '').toUpperCase();
                                    return `<option value="${fundIdx}" ${txLinkedFund == fundIdx ? 'selected' : ''}>${fundLabel}</option>`;
                                }).join('')}
                            </select>
                        </div>
                    `;
                }
                
                incomingHtml += `
                    <div class="transaction-row-wrapper" data-tx-id="${tx.id}">
                        <div class="transaction-row incoming">
                            <span class="transaction-date">${date}</span>
                            <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}</span>
                            <span class="account-badge">${tx.accountName}</span>
                            <span class="transaction-amount positive">${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>
                            ${createFlagButtons('transaction', tx.id, txFlag, txComment)}
                        </div>
                        <div class="analysis-item-note-section ${hasTxFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <textarea class="analysis-item-note-input" data-item-type="transaction" data-tx-id="${tx.id}" rows="2" placeholder="Add notes...">${txComment}</textarea>
                        </div>
                        ${txFundingDropdown}
                    </div>
                `;
            });
            
            let outgoingHtml = '';
            unmatchedOut.forEach(tx => {
                const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                const txAnnotation = getItemAnnotation('transaction', tx.id);
                const txFlag = txAnnotation ? txAnnotation.flag : '';
                const txComment = txAnnotation ? txAnnotation.comment : '';
                const hasTxFlag = txFlag !== '';
                const txLinkedFund = getItemLink('transaction', tx.id);
                
                // Build funding method dropdown if there are funds
                let txFundingDropdown = '';
                if (sofFunds.length > 0) {
                    txFundingDropdown = `
                        <div class="analysis-item-funding-link ${txLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                            <select class="analysis-item-funding-select" data-item-type="transaction" data-tx-id="${tx.id}" style="width: 100%; font-size: 11px; padding: 6px;">
                                <option value="">-- Select funding method --</option>
                                ${sofFunds.map((fund, fundIdx) => {
                                    const fundLabel = fund.amount ? 
                                        `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.amount / 100).toLocaleString()}` :
                                        fund.type.replace('fund:', '').toUpperCase();
                                    return `<option value="${fundIdx}" ${txLinkedFund == fundIdx ? 'selected' : ''}>${fundLabel}</option>`;
                                }).join('')}
                            </select>
                        </div>
                    `;
                }
                
                outgoingHtml += `
                    <div class="transaction-row-wrapper" data-tx-id="${tx.id}">
                        <div class="transaction-row outgoing">
                            <span class="transaction-date">${date}</span>
                            <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}</span>
                            <span class="account-badge">${tx.accountName}</span>
                            <span class="transaction-amount negative">${currencySymbol}${Math.abs(tx.amount).toFixed(2)}</span>
                            ${createFlagButtons('transaction', tx.id, txFlag, txComment)}
                        </div>
                        <div class="analysis-item-note-section ${hasTxFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                            <textarea class="analysis-item-note-input" data-item-type="transaction" data-tx-id="${tx.id}" rows="2" placeholder="Add notes...">${txComment}</textarea>
                        </div>
                        ${txFundingDropdown}
                    </div>
                `;
            });
            
            // Build columns
            if (incomingHtml || outgoingHtml) {
                if (incomingHtml && outgoingHtml) {
                    oneOffHtml += `
                        <div class="transactions-columns">
                            <div class="transactions-column">
                                <div class="column-header incoming-header">Incoming</div>
                                ${incomingHtml}
                            </div>
                            <div class="transactions-column">
                                <div class="column-header outgoing-header">Outgoing</div>
                                ${outgoingHtml}
                            </div>
                        </div>
                    `;
                } else if (incomingHtml) {
                    oneOffHtml += `
                        <div class="transactions-columns single-column">
                            <div class="transactions-column">
                                <div class="column-header incoming-header">Incoming</div>
                                ${incomingHtml}
                            </div>
                        </div>
                    `;
                } else {
                    oneOffHtml += `
                        <div class="transactions-columns single-column">
                            <div class="transactions-column">
                                <div class="column-header outgoing-header">Outgoing</div>
                                ${outgoingHtml}
                            </div>
                        </div>
                    `;
                }
            }
            
            html += `
                <div class="bank-analysis-section collapsed" onclick="event.stopPropagation(); this.classList.toggle('collapsed');">
                    <div class="analysis-section-header">
                        <span class="analysis-section-title">Large One-Off Transactions (${analysis.large_one_off_transactions.length})</span>
                        <span class="expand-indicator">&#x25BC;</span>
                    </div>
                    <div class="analysis-section-content">
                        ${oneOffHtml}
                    </div>
                </div>
            `;
        }
        
        // 3. Largest by Currency Section - using proper filtering like task card
        if (analysis.largest_individual_transactions && analysis.largest_individual_transactions.length > 0) {
            console.log('&#xD83D;&#xDCB0; Rendering Largest Transactions by Currency section:', analysis.largest_individual_transactions.length, 'transactions');
            let largestHtml = '';
            
            // Get the summary by currency data which includes top_in and top_out
            // This is more reliable than grouping the IDs ourselves
            const bankSummary = check?.taskOutcomes?.['bank:summary'];
            const summaryByCcy = bankSummary?.breakdown?.summary?.by_ccy;
            console.log('&#xD83D;&#xDCCA; Summary by currency available?', !!summaryByCcy);
            
            // Try to use summaryByCcy first, otherwise fall back to grouping the IDs
            if (summaryByCcy && Object.keys(summaryByCcy).length > 0) {
                // Use the task card filtering logic - filter by currency and take top 5
                Object.entries(summaryByCcy).forEach(([currency, data]) => {
                    const topIn = data.top_in || [];
                    const topOut = data.top_out || [];
                    const flag = this.getCurrencyFlag(currency);
                    
                    // Filter transactions to only include those that actually match this currency
                    // and take top 5 of each
                    let filteredTopIn = topIn.filter(tx => tx.currency === currency).slice(0, 5);
                    let filteredTopOut = topOut.filter(tx => tx.currency === currency).slice(0, 5);
                    
                    // Enrich with account names
                    filteredTopIn = filteredTopIn.map(tx => {
                        const accountData = accounts[tx.account_id];
                        const info = accountData?.info || accountData;
                        return {
                            ...tx,
                            accountName: info?.name || 'Account'
                        };
                    });
                    filteredTopOut = filteredTopOut.map(tx => {
                        const accountData = accounts[tx.account_id];
                        const info = accountData?.info || accountData;
                        return {
                            ...tx,
                            accountName: info?.name || 'Account'
                        };
                    });
                    
                    // Skip this currency if no matching transactions
                    if (filteredTopIn.length === 0 && filteredTopOut.length === 0) {
                        return;
                    }
                    
                    // Combine and sort all transactions for this currency
                    const allTxs = [...filteredTopIn, ...filteredTopOut];
                    allTxs.sort((a, b) => Math.abs(b.amount) - Math.abs(a.amount));
                    
                    // Render each transaction
                    let currencyHtml = '';
                    allTxs.forEach(tx => {
                    const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                    const isIncoming = tx.amount > 0;
                    const txAnnotation = getItemAnnotation('transaction', tx.id);
                    const txFlag = txAnnotation ? txAnnotation.flag : '';
                    const txComment = txAnnotation ? txAnnotation.comment : '';
                    const hasTxFlag = txFlag !== '';
                    const txLinkedFund = getItemLink('transaction', tx.id);
                    
                    // Build funding method dropdown if there are funds
                    let txFundingDropdown = '';
                    if (sofFunds.length > 0) {
                        txFundingDropdown = `
                            <div class="analysis-item-funding-link ${txLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                                <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                                <select class="analysis-item-funding-select" data-item-type="transaction" data-tx-id="${tx.id}" style="width: 100%; font-size: 11px; padding: 6px;">
                                    <option value="">-- Select funding method --</option>
                                    ${sofFunds.map((fund, fundIdx) => {
                                        const fundLabel = fund.amount ? 
                                            `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.amount / 100).toLocaleString()}` :
                                            fund.type.replace('fund:', '').toUpperCase();
                                        return `<option value="${fundIdx}" ${txLinkedFund == fundIdx ? 'selected' : ''}>${fundLabel}</option>`;
                                    }).join('')}
                                </select>
                            </div>
                        `;
                    }
                    
                    currencyHtml += `
                        <div class="transaction-row-wrapper" data-tx-id="${tx.id}">
                            <div class="transaction-row ${isIncoming ? 'incoming' : 'outgoing'}">
                                <span class="transaction-date">${date}</span>
                                <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}</span>
                                <span class="account-badge">${tx.accountName}</span>
                                <span class="transaction-amount ${isIncoming ? 'positive' : 'negative'}">
                                    ${isIncoming ? '+' : ''}${flag}${Math.abs(tx.amount).toFixed(2)}
                                </span>
                                ${createFlagButtons('transaction', tx.id, txFlag, txComment)}
                            </div>
                            <div class="analysis-item-note-section ${hasTxFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                                <textarea class="analysis-item-note-input" data-item-type="transaction" data-tx-id="${tx.id}" rows="2" placeholder="Add notes...">${txComment}</textarea>
                            </div>
                            ${txFundingDropdown}
                        </div>
                    `;
                });
                
                    largestHtml += `
                        <div class="currency-group">
                            <div class="currency-group-header">${flag} ${currency}</div>
                            ${currencyHtml}
                        </div>
                    `;
                });
            } else {
                // Fallback: Group by currency from the transaction IDs
                console.log('&#xD83D;&#xDCCA; Using fallback grouping for largest transactions');
                const byCurrency = {};
                analysis.largest_individual_transactions.forEach(txId => {
                    const tx = getTransactionById(txId);
                    if (!tx) return;
                    const currency = tx.currency || 'GBP';
                    if (!byCurrency[currency]) byCurrency[currency] = [];
                    byCurrency[currency].push(tx);
                });
                
                // Render each currency group
                Object.entries(byCurrency).forEach(([currency, txs]) => {
                    const flag = this.getCurrencyFlag(currency);
                    
                    // Filter to only include transactions that match this currency
                    const filteredTxs = txs.filter(tx => tx.currency === currency);
                    if (filteredTxs.length === 0) return;
                    
                    let currencyHtml = '';
                    filteredTxs.forEach(tx => {
                        const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                        const isIncoming = tx.amount > 0;
                        const txAnnotation = getItemAnnotation('transaction', tx.id);
                        const txFlag = txAnnotation ? txAnnotation.flag : '';
                        const txComment = txAnnotation ? txAnnotation.comment : '';
                        const hasTxFlag = txFlag !== '';
                        const txLinkedFund = getItemLink('transaction', tx.id);
                        
                        // Build funding method dropdown if there are funds
                        let txFundingDropdown = '';
                        if (sofFunds.length > 0) {
                            txFundingDropdown = `
                                <div class="analysis-item-funding-link ${txLinkedFund ? '' : 'hidden'}" onclick="event.stopPropagation();">
                                    <label style="font-size: 11px; color: #666; margin-bottom: 4px; display: block;">Link to Funding Method:</label>
                                    <select class="analysis-item-funding-select" data-item-type="transaction" data-tx-id="${tx.id}" style="width: 100%; font-size: 11px; padding: 6px;">
                                        <option value="">-- Select funding method --</option>
                                        ${sofFunds.map((fund, fundIdx) => {
                                            const fundLabel = fund.amount ? 
                                                `${fund.type.replace('fund:', '').toUpperCase()}: &#xA3;${(fund.amount / 100).toLocaleString()}` :
                                                fund.type.replace('fund:', '').toUpperCase();
                                            return `<option value="${fundIdx}" ${txLinkedFund == fundIdx ? 'selected' : ''}>${fundLabel}</option>`;
                                        }).join('')}
                                    </select>
                                </div>
                            `;
                        }
                        
                        currencyHtml += `
                            <div class="transaction-row-wrapper" data-tx-id="${tx.id}">
                                <div class="transaction-row ${isIncoming ? 'incoming' : 'outgoing'}">
                                    <span class="transaction-date">${date}</span>
                                    <span class="transaction-description">${tx.description || tx.merchant_name || 'Transaction'}</span>
                                    <span class="account-badge">${tx.accountName}</span>
                                    <span class="transaction-amount ${isIncoming ? 'positive' : 'negative'}">
                                        ${isIncoming ? '+' : ''}${flag}${Math.abs(tx.amount).toFixed(2)}
                                    </span>
                                    ${createFlagButtons('transaction', tx.id, txFlag, txComment)}
                                </div>
                                <div class="analysis-item-note-section ${hasTxFlag ? '' : 'hidden'}" onclick="event.stopPropagation();">
                                    <textarea class="analysis-item-note-input" data-item-type="transaction" data-tx-id="${tx.id}" rows="2" placeholder="Add notes...">${txComment}</textarea>
                                </div>
                                ${txFundingDropdown}
                            </div>
                        `;
                    });
                    
                    largestHtml += `
                        <div class="currency-group">
                            <div class="currency-group-header">${flag} ${currency}</div>
                            ${currencyHtml}
                        </div>
                    `;
                });
            }
            
            // Only render section if we have content
            if (largestHtml) {
                html += `
                    <div class="bank-analysis-section collapsed" onclick="event.stopPropagation(); this.classList.toggle('collapsed');">
                        <div class="analysis-section-header">
                            <span class="analysis-section-title">Largest Transactions by Currency</span>
                            <span class="expand-indicator">&#x25BC;</span>
                        </div>
                        <div class="analysis-section-content">
                            ${largestHtml}
                        </div>
                    </div>
                `;
            }
        }
        
        return html;
    }
    
    generateSofPDF(autoSave = false) {
        console.log('&#xD83D;&#xDCC4; Starting SoF PDF generation...');
        const check = this.currentCheck;
        if (!check) {
            console.error('&#x274C; No current check for SoF PDF generation');
            return;
        }
        
        const checkName = check.consumerName || check.companyName || 'Unknown';
        const checkRef = check.thirdfortResponse?.ref || check.transactionId || check.checkId;
        const checkType = this.getElectronicIDType(check) || check.checkType || 'Thirdfort Check';
        const matterName = check.thirdfortResponse?.name || check.matterName || '&#x2014;';
        const now = new Date();
        const generatedDate = now.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
        const generatedTime = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        
        // Get SoF task details
        const outcomes = check.taskOutcomes || {};
        const sofTask = outcomes['sof:v1'];
        const bankSummary = outcomes['bank:summary'];
        const bankStatement = outcomes['bank:statement'];
        const docsBankStatement = outcomes['documents:bank-statement'];
        
        const breakdown = sofTask?.breakdown || {};
        const property = breakdown.property || {};
        const funds = breakdown.funds || [];
        
        // Get accounts and sofMatches
        const accounts = bankStatement?.breakdown?.accounts || bankSummary?.breakdown?.accounts || docsBankStatement?.breakdown?.accounts || {};
        const sofMatches = bankSummary?.breakdown?.analysis?.sof_matches || bankStatement?.breakdown?.analysis?.sof_matches || docsBankStatement?.breakdown?.analysis?.sof_matches || {};
        
        // Get red flags
        const allRedFlags = this.extractRedFlags(check);
        
        // Build property HTML
        let propertyHTML = '';
        if (property.address) {
            const addr = property.address;
            const fullAddress = `${addr.building_number || ''} ${addr.street || ''}, ${addr.town || ''}, ${addr.postcode || ''}`.trim();
            const price = property.price ? `&#xA3;${(property.price / 100).toLocaleString('en-GB', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` : 'Not specified';
            const sdlt = property.stamp_duty ? `&#xA3;${(property.stamp_duty / 100).toLocaleString('en-GB', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` : 'Not specified';
            const newBuild = property.new_build ? 'Yes' : 'No';
            
            propertyHTML = `
                <div style="background: white; border-radius: 8px; border-left: 4px solid #39b549; padding: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); margin-bottom: 24px; page-break-inside: avoid;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 13px;">
                        <div><strong style="color: #6c757d;">Address:</strong> ${fullAddress}</div>
                        <div><strong style="color: #6c757d;">Purchase Price:</strong> ${price}</div>
                        <div><strong style="color: #6c757d;">Stamp Duty:</strong> ${sdlt}</div>
                        <div><strong style="color: #6c757d;">New Build:</strong> ${newBuild}</div>
                    </div>
                </div>
            `;
        }
        
        // Build funding cards HTML (matching mockup exactly)
        let fundingCardsHTML = '';
        funds.forEach((fund, fundIdx) => {
            const type = fund.type || 'unknown';
            const data = fund.data || {};
            const amount = data.amount ? `&#xA3;${(data.amount / 100).toLocaleString('en-GB', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` : 'Amount not specified';
            
            // Get type name
            const typeNames = {
                'fund:mortgage': 'Mortgage',
                'fund:savings': 'Savings / Own Funds',
                'fund:gift': 'Gift',
                'fund:sale:property': 'Sale of Property',
                'fund:sale:assets': 'Sale of Assets',
                'fund:inheritance': 'Inheritance',
                'fund:htb': 'Help to Buy / LISA',
                'fund:htb_lisa': 'Help to Buy / LISA',
                'fund:investment': 'Investment',
                'fund:business': 'Business Income',
                'fund:loan': 'Loan',
                'fund:other': 'Other',
                'fund:income': 'Income'
            };
            const typeName = typeNames[type] || type.replace('fund:', '').replace(/:/g, ' ').replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            const cleanType = type.replace('fund:', '').replace(/:/g, '-');
            const originBadge = this.getFundingOriginBadge(data.location);
            const detailMarkup = this.buildFundingDetailContent(fund, { originBadge });
            
            // Get annotations for this funding method
            const fundAnnotations = (check.sofAnnotations || []).flatMap(ann => 
                (ann.notes?.fundingMethods || []).filter(fm => fm.fundIdx == fundIdx)
            );
            const latestNote = fundAnnotations[0]?.note || '';
            const verifiedItems = fundAnnotations[0]?.verified || [];
            const transactionMarkers = fundAnnotations[0]?.transactionMarkers || {};
            const redFlagsForFund = fundAnnotations[0]?.redFlags || [];
            
            // Get related red flags from task outcomes
            const relatedFlags = this.getRelatedRedFlags(fund, allRedFlags);
            const allFundRedFlags = [...relatedFlags, ...redFlagsForFund.map(rf => {
                const flag = allRedFlags[rf.flagIdx];
                return flag ? { ...flag, status: rf.status, investigationNote: rf.note } : null;
            }).filter(f => f)];
            
            // Get matched transactions
            const matchedTxIds = this.getMatchedTransactions(type, sofMatches, fund);
            const hasSomeMatches = matchedTxIds.length > 0;
            let matchedTxs = [];
            
            // Determine card status based on red flags and notes
            const hasRedFlags = allFundRedFlags.length > 0;
            const borderColor = hasRedFlags ? '#f7931e' : '#39b549';
            const statusIconHTML = hasRedFlags 
                ? this.getStatusIconCSS('consider')
                : this.getStatusIconCSS('clear');
            
            fundingCardsHTML += `
                <div style="background: white; border-radius: 8px; border-left: 4px solid ${borderColor}; padding: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); margin-bottom: 16px; page-break-inside: avoid;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="font-size: 14px; font-weight: 500; color: #003c71; flex: 1;">${typeName}</div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            ${originBadge || ''}
                            <span style="font-size: 14px; font-weight: bold; color: #003c71;">${amount}</span>
                        ${statusIconHTML}
                        </div>
                    </div>
                    <div style="padding: 12px 16px; border-top: 1px solid #dee2e6;">
                        ${detailMarkup}
            `;

            const labelMap = {
                'fund:gift': 'Potential Gift Deposits:',
                'fund:mortgage': 'Potential Mortgage Deposits:',
                'fund:savings': 'Verified Salary Deposits:',
                'fund:income': 'Verified Salary Deposits:',
                'fund:property_sale': 'Potential Property Sale Proceeds:',
                'fund:sale:property': 'Potential Property Sale Proceeds:',
                'fund:asset_sale': 'Potential Asset Sale Proceeds:',
                'fund:sale:assets': 'Potential Asset Sale Proceeds:',
                'fund:htb': 'Potential HTB/LISA Deposits:',
                'fund:htb_lisa': 'Potential HTB/LISA Deposits:',
                'fund:inheritance': 'Potential Inheritance Deposits:',
                'fund:loan': 'Potential Loan Deposits:',
                'fund:investment': 'Potential Investment Deposits:',
                'fund:business': 'Potential Business Income:',
                'fund:other': 'Potential Matched Transactions:'
            };
            const matchLabel = labelMap[type] || 'Potential Matched Transactions:';
            
            // Matched Transactions
            if (hasSomeMatches) {
                Object.values(accounts).forEach(acc => {
                    (acc.statement || []).forEach(tx => {
                        if (matchedTxIds.includes(tx.id)) {
                            matchedTxs.push({ ...tx, accountName: acc.account?.name || 'Account' });
                        }
                    });
                });
                
                if (matchedTxs.length > 0) {
                    fundingCardsHTML += `<div style="margin-bottom: 12px;"><div style="font-size: 12px; font-weight: bold; color: #6c757d; margin-bottom: 6px;">MATCHED TRANSACTIONS (${matchedTxs.length}):</div>`;
                    fundingCardsHTML += `<div style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px;">`;
                    matchedTxs.slice(0, 5).forEach(tx => {
                        const date = new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                        const txMarker = transactionMarkers[tx.id];
                        const markerStyle = txMarker === 'rejected' ? 'opacity: 0.65;' : '';
                        const markerText = txMarker === 'verified' ? ' &#x2713; VERIFIED' : (txMarker === 'rejected' ? ' &#x2715; REJECTED' : (txMarker === 'review' ? ' ? REVIEW' : ''));
                        const markerColor = txMarker === 'verified' ? '#39b549' : (txMarker === 'rejected' ? '#d32f2f' : '#f7931e');
                        
                        fundingCardsHTML += `<div style="margin-bottom: 6px; ${markerStyle}"><strong>${date}:</strong> ${tx.description || 'Transaction'} &#x2014; <span style="color: #39b549;">+&#xA3;${Math.abs(tx.amount).toFixed(2)}</span><span style="color: ${markerColor}; font-weight: bold; margin-left: 8px;">${markerText}</span></div>`;
                    });
                    if (matchedTxs.length > 5) {
                        fundingCardsHTML += `<div style="font-style: italic; color: #999; margin-top: 6px;">... and ${matchedTxs.length - 5} more</div>`;
                    }
                    fundingCardsHTML += `</div></div>`;
                }
            }
            if ((!hasSomeMatches || matchedTxs.length === 0) && type !== 'fund:mortgage') {
                const considerIcon = this.getTaskCheckIconCSS('CO');
                fundingCardsHTML += `
                    <div style="margin: 12px 0;">
                        <div style="font-size: 12px; font-weight: bold; color: #6c757d; margin-bottom: 6px;">${matchLabel}</div>
                        <div style="display: flex; align-items: center; gap: 6px; padding: 10px 12px; background: #fff8e6; border: 1px solid #ffd966; border-radius: 6px; font-size: 11px; color: #856404;">
                            ${considerIcon}
                            <span>No linked bank transactions detected, manual review required</span>
                        </div>
                    </div>
                `;
            }
            
            // Verification checkboxes
            if (verifiedItems.length > 0) {
                fundingCardsHTML += `<div style="margin-bottom: 12px;"><div style="font-size: 12px; font-weight: bold; color: #6c757d; margin-bottom: 6px;">VERIFICATION:</div>`;
                fundingCardsHTML += `<div style="display: flex; gap: 8px; align-items: center; font-size: 12px; flex-wrap: wrap;">`;
                verifiedItems.forEach(item => {
                    const itemLabel = item.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    fundingCardsHTML += `<span style="color: #39b549;">&#x2713;</span> ${itemLabel}`;
                });
                fundingCardsHTML += `</div></div>`;
            }
            
            const docTaskKey = `documents:${cleanType}`;
            const docOutcome = check.taskOutcomes ? check.taskOutcomes[docTaskKey] : null;
            const documentCount = this.getDocumentCount(docOutcome);
            const hasDocuments = documentCount > 0;
            const pdfDocLines = [];
            const pdfDefaultReminder = 'Check the report pdf for evidence or obtain from the client and review manually';
            const pdfShouldShowManualReview = (!hasSomeMatches || matchedTxs.length === 0) && type !== 'fund:mortgage';

            if (hasDocuments) {
                const uploadedLabel = `${documentCount} document${documentCount === 1 ? '' : 's'} uploaded`;
                pdfDocLines.push({ status: 'clear', text: uploadedLabel });
            } else {
                pdfDocLines.push({ status: 'consider', text: pdfDefaultReminder });
            }

            if (pdfShouldShowManualReview) {
                pdfDocLines.push({ status: 'consider', text: 'No linked bank transactions detected, manual review required.' });
            }

            if (pdfDocLines.length === 0) {
                pdfDocLines.push({ status: hasDocuments ? 'clear' : 'consider', text: pdfDefaultReminder });
            }

            fundingCardsHTML += `
                <div class="funding-doc-status pdf">
                    ${pdfDocLines.map(line => {
                        const icon = this.getTaskCheckIconCSS(line.status === 'clear' ? 'CL' : line.status === 'fail' ? 'FA' : 'CO');
                        return `<div class="doc-status-line">${icon}<span>${line.text}</span></div>`;
                    }).join('')}
                </div>
            `;
            
            // Red Flags
            if (allFundRedFlags.length > 0) {
                allFundRedFlags.forEach(flag => {
                    const flagStatus = flag.status || 'consider';
                    const flagNote = flag.investigationNote || '';
                    const statusBadgeBg = flagStatus === 'confirmed' ? '#fff3cd' : (flagStatus === 'dismissed' ? '#d4edda' : '#f8d7da');
                    const statusBadgeColor = flagStatus === 'confirmed' ? '#856404' : (flagStatus === 'dismissed' ? '#155724' : '#721c24');
                    const statusLabel = flagStatus.charAt(0).toUpperCase() + flagStatus.slice(1);
                    
                    fundingCardsHTML += `
                        <div style="background: #fff3e0; border: 1px solid #f7931e; border-radius: 6px; padding: 12px; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <div style="width: 16px; height: 16px; border-radius: 50%; background: #d32f2f; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"><span style="color: white; font-size: 16px; font-weight: bold; line-height: 1;">&#x2212;</span></div>
                                <strong style="font-size: 13px; color: #d32f2f; flex: 1;">${flag.description || 'Red Flag'}</strong>
                                <span style="padding: 3px 8px; background: ${statusBadgeBg}; border-radius: 4px; font-size: 11px; font-weight: bold; color: ${statusBadgeColor};">${statusLabel}</span>
                            </div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 8px;">${flag.reason || ''}</div>
                            ${flagNote ? `<div style="font-size: 12px; color: #333;"><strong>Note:</strong> ${flagNote}</div>` : ''}
                        </div>
                    `;
                });
            }
            
            // Investigation Notes
            if (latestNote) {
                fundingCardsHTML += `
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; border-left: 3px solid #1d71b8;">
                        <div style="font-size: 11px; font-weight: bold; color: #6c757d; margin-bottom: 4px;">INVESTIGATION NOTES:</div>
                        <div style="font-size: 13px; color: #333;">${latestNote}</div>
                    </div>
                `;
            }
            
            fundingCardsHTML += `</div></div>`;
        });
        
        // Build detailed bank analysis (including recurring, largest transactions, flags)
        let bankAnalysisHTML = '';
        const totalAccounts = Object.keys(accounts).length;
        if (totalAccounts > 0) {
            let totalTxs = 0;
            Object.values(accounts).forEach(acc => {
                totalTxs += (acc.statement || []).length;
            });
            
            // Summary header
            bankAnalysisHTML = `
                <div style="background: white; border-radius: 8px; border-left: 4px solid #39b549; padding: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); margin-bottom: 24px;">
                    <div style="padding: 12px 16px;">
                        <div style="font-size: 13px; color: #666; margin-bottom: 12px;">
                            <div><strong>Total Accounts Linked:</strong> ${totalAccounts}</div>
                            <div><strong>Statement Period:</strong> 6 months</div>
                            <div><strong>Total Transactions Analyzed:</strong> ${totalTxs}</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Get bank analysis from task outcome
            const analysis = bankSummary?.breakdown?.analysis || bankStatement?.breakdown?.analysis || docsBankStatement?.breakdown?.analysis;
            
            if (analysis) {
                // Build detailed analysis sections (recurring, largest, etc.)
                bankAnalysisHTML += '<div style="margin-top: 20px;">';
                
                // Recurring Payments
                if (analysis.recurring_payment_groups && analysis.recurring_payment_groups.length > 0) {
                    bankAnalysisHTML += '<div style="margin-bottom: 16px;"><div style="font-weight: bold; font-size: 14px; color: var(--primary-blue); margin-bottom: 8px;">&#xD83D;&#xDD01; Recurring Payments</div>';
                    analysis.recurring_payment_groups.forEach((group, gIdx) => {
                        const count = group.occurrences?.length || 0;
                        const avgAmount = group.average_amount || 0;
                        const merchant = group.merchant_name || 'Unknown';
                        bankAnalysisHTML += `<div style="padding: 8px; background: #f8f9fa; border-radius: 4px; margin-bottom: 6px; font-size: 12px;">`;
                        bankAnalysisHTML += `<strong>${merchant}</strong> - ${count} payments, avg &#xA3;${Math.abs(avgAmount).toFixed(2)}`;
                        bankAnalysisHTML += `</div>`;
                    });
                    bankAnalysisHTML += '</div>';
                }
                
                // Transaction Chains
                if (analysis.chain_analysis && analysis.chain_analysis.length > 0) {
                    bankAnalysisHTML += '<div style="margin-bottom: 16px;"><div style="font-weight: bold; font-size: 14px; color: var(--primary-blue); margin-bottom: 8px;">&#xD83D;&#xDD17; Transaction Chains</div>';
                    analysis.chain_analysis.slice(0, 5).forEach((chain, cIdx) => {
                        const count = chain.transactions?.length || 0;
                        bankAnalysisHTML += `<div style="padding: 8px; background: #f8f9fa; border-radius: 4px; margin-bottom: 6px; font-size: 12px;">`;
                        bankAnalysisHTML += `<strong>Chain ${cIdx + 1}</strong> - ${count} transactions`;
                        bankAnalysisHTML += `</div>`;
                    });
                    bankAnalysisHTML += '</div>';
                }
                
                // Largest Transactions
                if (analysis.largest_individual_transactions && analysis.largest_individual_transactions.length > 0) {
                    bankAnalysisHTML += '<div style="margin-bottom: 16px;"><div style="font-weight: bold; font-size: 14px; color: var(--primary-blue); margin-bottom: 8px;">&#xD83D;&#xDCB0; Largest Transactions</div>';
                    analysis.largest_individual_transactions.slice(0, 10).forEach((tx, tIdx) => {
                        const amount = tx.amount || 0;
                        const desc = tx.description || tx.merchant_name || 'Transaction';
                        const date = tx.timestamp ? new Date(tx.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }) : '';
                        const sign = amount >= 0 ? '+' : '';
                        const amountColor = amount >= 0 ? '#39b549' : '#d32f2f';
                        bankAnalysisHTML += `<div style="padding: 8px; background: #f8f9fa; border-radius: 4px; margin-bottom: 6px; font-size: 12px;">`;
                        bankAnalysisHTML += `<span style="color: ${amountColor}; font-weight: bold;">${sign}&#xA3;${Math.abs(amount).toFixed(2)}</span> - ${desc} <span style="color: #6c757d;">(${date})</span>`;
                        bankAnalysisHTML += `</div>`;
                    });
                    bankAnalysisHTML += '</div>';
                }
                
                bankAnalysisHTML += '</div>';
            }
        }
        
        const htmlContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    :root { --primary-blue: #003c71; --secondary-blue: #1d71b8; --green: #39b549; --orange: #f7931e; --red: #d32f2f; --grey: #6c757d; --light-grey: #f8f9fa; --border-grey: #dee2e6; }
                    body { font-family: 'Trebuchet MS', 'Lucida Grande', sans-serif; padding: 40px; background: white; color: #111; line-height: 1.5; font-size: 14px; }
                    .pdf-header { border-bottom: 3px solid var(--primary-blue); padding-bottom: 20px; margin-bottom: 30px; }
                    .pdf-title { font-size: 26px; font-weight: bold; color: var(--primary-blue); margin-bottom: 15px; }
                    .check-info { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 13px; }
                    .check-info-item { display: flex; gap: 8px; }
                    .check-info-label { font-weight: bold; color: var(--grey); min-width: 140px; }
                    .check-info-value { color: #333; }
                    .section-title { font-size: 18px; font-weight: bold; color: var(--primary-blue); margin: 30px 0 20px 0; padding-bottom: 8px; border-bottom: 2px solid var(--border-grey); }
                    .pdf-footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid var(--border-grey); text-align: center; font-size: 11px; color: #999; }
                    @media print { body { padding: 20px; } }
                    .funding-meta-container { display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px; }
                    .funding-meta-row { display: flex; align-items: flex-start; gap: 8px; font-size: 12px; color: #333; margin: 4px 0; }
                    .funding-meta-row.compact { font-size: 11px; }
                    .funding-meta-label { min-width: 110px; font-weight: 600; color: #003c71; }
                    .funding-meta-value { flex: 1; display: flex; flex-wrap: wrap; gap: 6px; color: #333; }
                    .funding-meta-empty { font-size: 12px; font-style: italic; color: #777; margin: 6px 0; }
                    .funding-origin-badge { display: inline-flex; align-items: center; gap: 6px; padding: 2px 8px; border-radius: 12px; background: #eef2f7; font-size: 11px; font-weight: 600; color: #003c71; }
                    .funding-bank-card { display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #e1e4e8; border-radius: 8px; background: #f8f9fb; margin-bottom: 12px; }
                    .funding-bank-logo { display: flex; align-items: center; justify-content: center; max-width: 200px; }
                    .funding-bank-logo img { max-height: 80px; max-width: 200px; object-fit: contain; }
                    .funding-bank-copy { display: flex; flex-direction: column; gap: 4px; }
                    .funding-bank-label { font-size: 10px; font-weight: 600; letter-spacing: 0.6px; text-transform: uppercase; color: #6c757d; }
                    .funding-bank-name { font-size: 14px; font-weight: 600; color: #003c71; }
                    .funding-section-heading { font-size: 13px; font-weight: 600; color: #003c71; margin: 12px 0 8px 0; }
                    .funding-person-card { border: 1px solid #e1e4e8; border-radius: 8px; padding: 12px; background: #ffffff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 10px; }
                    .funding-person-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; }
                    .funding-person-name { font-size: 13px; font-weight: 600; color: #003c71; }
                    .funding-person-role { font-size: 11px; font-weight: 600; color: #6c757d; }
                    .income-card-list { display: grid; gap: 10px; margin-top: 10px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
                    .income-card { border: 1px solid #dbe2ea; border-radius: 6px; padding: 10px; background: #f9fbfd; }
                    .income-card.salary { background: #f1f8f5; border-color: #cfe8d6; }
                    .income-card.other { background: #f8f9fa; }
                    .income-card-title { font-size: 12px; font-weight: 600; color: #003c71; margin-bottom: 6px; }
                    .income-card-row { display: flex; justify-content: space-between; gap: 12px; font-size: 11px; color: #333; margin: 2px 0; }
                    .income-label { font-weight: 600; color: #6c757d; }
                    .income-value { flex: 1; text-align: right; color: #333; }
                    .funding-detail-card { border: 1px solid #e1e4e8; border-radius: 8px; padding: 12px; background: #fdfdfd; box-shadow: 0 1px 3px rgba(0,0,0,0.04); margin-bottom: 12px; }
                    .funding-detail-card-title { font-size: 13px; font-weight: 600; color: #003c71; margin-bottom: 8px; }
                    .funding-doc-status.pdf { margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(0,0,0,0.08); display: flex; align-items: center; gap: 6px; }
                    .funding-doc-count-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 12px; background: #e3f2fd; font-size: 11px; font-weight: 600; color: #1976d2; margin-left: auto; }
                </style>
            </head>
            <body>
                <div class="pdf-header">
                    <div class="pdf-title">Source of Funds Investigation</div>
                    <div class="check-info">
                        <div class="check-info-item"><span class="check-info-label">Check Type:</span><span class="check-info-value">${checkType}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Consumer:</span><span class="check-info-value">${checkName}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Check Reference:</span><span class="check-info-value">${checkRef}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Check ID:</span><span class="check-info-value">${check.checkId || check.transactionId}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Matter:</span><span class="check-info-value">${matterName}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Property:</span><span class="check-info-value">${property.address ? `${property.address.building_number || ''} ${property.address.street || ''}, ${property.address.town || ''}, ${property.address.postcode || ''}`.trim() : '&#x2014;'}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Generated:</span><span class="check-info-value">${generatedDate}, ${generatedTime}</span></div>
                    </div>
                </div>
                ${propertyHTML ? `<div class="section-title">Property Information</div>${propertyHTML}` : ''}
                <div class="section-title">Funding Methods</div>
                ${fundingCardsHTML}
                ${bankAnalysisHTML ? `<div class="section-title">Bank Analysis</div>${bankAnalysisHTML}` : ''}
                <div class="pdf-footer">
                    <p>This report was generated from Thurstan Hoskin's Thirdfort ID Management System</p>
                    <p>Report ID: SOF-${Date.now()} | Page 1 of 1</p>
                </div>
            </body>
            </html>
        `;
        
        const element = document.createElement('div');
        element.innerHTML = htmlContent;
        
        const opt = {
            margin: [10, 10, 10, 10],
            filename: `sof-investigation-${checkRef}-${Date.now()}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true, logging: false },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
            pagebreak: { mode: 'css', avoid: 'div[style*="page-break-inside: avoid"]' }
        };
        
        if (typeof html2pdf !== 'undefined') {
            console.log('&#xD83D;&#xDCC4; Generating SoF PDF with html2pdf...');
            html2pdf().set(opt).from(element).outputPdf('blob').then((pdfBlob) => {
                console.log('&#x2705; SoF PDF generated:', pdfBlob.size, 'bytes');
                
                // Check if Print.js is available
                if (typeof printJS !== 'undefined') {
                    console.log('&#xD83D;&#xDCC4; Opening SoF print dialog with Print.js...');
                const pdfUrl = URL.createObjectURL(pdfBlob);
                    
                    // Use Print.js to open print dialog with PDF
                    printJS({
                        printable: pdfUrl,
                        type: 'pdf',
                        onPrintDialogClose: () => {
                            // Clean up blob URL after print dialog closes
                            URL.revokeObjectURL(pdfUrl);
                        }
                    });
                } else {
                    // Fallback to new tab if Print.js not loaded
                    console.warn(' Print.js not loaded, opening in new tab');
                    const pdfUrl = URL.createObjectURL(pdfBlob);
                const printWindow = window.open(pdfUrl, '_blank');
                if (!printWindow) {
                    console.error('&#x274C; Popup blocked by browser');
                    alert('PDF generated but popup was blocked. Please allow popups for this site.');
                } else {
                    // Trigger print dialogue when PDF loads
                    printWindow.addEventListener('load', () => {
                        setTimeout(() => {
                            printWindow.print();
                        }, 100);
                    });
                    }
                }
                
                // Notify parent that PDF is generated and opened (only if auto-save)
                if (autoSave) {
                    console.log('&#xD83D;&#xDCE4; Sending pdf-generated message to parent');
                    this.sendMessage('pdf-generated', { 
                        type: 'sof', 
                        checkId: check.checkId || check.transactionId 
                    });
                } else {
                    console.log('&#x2139;&#xFE0F; Manual export - not sending pdf-generated message');
                }
            }).catch(err => {
                console.error('&#x274C; Error generating SoF PDF:', err);
                alert('Error generating SoF PDF: ' + err.message);
                // Still notify parent even on error so data can refresh (only if auto-save)
                if (autoSave) {
                    this.sendMessage('pdf-generated', { 
                        type: 'sof',
                        error: err.message 
                    });
                }
            });
        } else {
            console.error('&#x274C; html2pdf library not loaded');
            alert('PDF library not loaded. Please refresh the page.');
            // Notify parent so data can refresh (only if auto-save)
            if (autoSave) {
                this.sendMessage('pdf-generated', { 
                    type: 'sof',
                    error: 'html2pdf not loaded' 
                });
            }
        }
    }
    
    generatePepDismissalsPDF(autoSave = false) {
        const check = this.currentCheck;
        if (!check) return;
        
        const outcomes = check.taskOutcomes || {};
        const dismissals = check.pepDismissals || [];
        const checkName = check.consumerName || check.companyName || 'Unknown';
        const checkRef = check.thirdfortResponse?.ref || check.transactionId || check.checkId;
        const checkType = this.getElectronicIDType(check) || check.checkType || 'Thirdfort Check';
        const now = new Date();
        const generatedDate = now.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
        const generatedTime = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        
        // Build dismissals map for quick lookup
        const dismissalsMap = {};
        dismissals.forEach(d => {
            dismissalsMap[d.hitId] = d;
        });
        
        // Collect all PEP/Sanctions hits with full details
        const allHits = [];
        
        // Get hits from various task outcomes
        const pepsTask = outcomes['peps'] || outcomes['screening:lite'] || outcomes['screening'];
        const sanctionsTask = outcomes['sanctions'];
        const companyPepsTask = outcomes['company:peps'];
        const companySanctionsTask = outcomes['company:sanctions'];
        
        // Individual PEPs
        if (pepsTask?.breakdown?.hits) {
            pepsTask.breakdown.hits.forEach(hit => {
                const dismissal = dismissalsMap[hit.id];
                allHits.push({
                    id: hit.id,
                    name: hit.name,
                    aka: hit.aka?.join(', ') || 'None',
                    type: 'PEP',
                    countries: hit.countries?.join(', ') || 'N/A',
                    flagTypes: hit.flag_types?.join(', ') || 'N/A',
                    score: hit.score || 'N/A',
                    dismissed: !!dismissal,
                    dismissal: dismissal
                });
            });
        }
        
        // Sanctions
        if (sanctionsTask?.breakdown?.hits) {
            sanctionsTask.breakdown.hits.forEach(hit => {
                const dismissal = dismissalsMap[hit.id];
                allHits.push({
                    id: hit.id,
                    name: hit.name,
                    aka: hit.aka?.join(', ') || 'None',
                    type: 'Sanctions',
                    countries: hit.countries?.join(', ') || 'N/A',
                    flagTypes: hit.flag_types?.join(', ') || 'N/A',
                    score: hit.score || 'N/A',
                    dismissed: !!dismissal,
                    dismissal: dismissal
                });
            });
        }
        
        // Company Sanctions
        if (companySanctionsTask?.breakdown?.hits) {
            companySanctionsTask.breakdown.hits.forEach(hit => {
                const dismissal = dismissalsMap[hit.id];
                allHits.push({
                    id: hit.id,
                    name: hit.name,
                    aka: hit.aka?.join(', ') || 'None',
                    type: 'Company Sanctions',
                    countries: hit.countries?.join(', ') || 'N/A',
                    flagTypes: hit.flag_types?.join(', ') || 'N/A',
                    score: hit.score || 'N/A',
                    dismissed: !!dismissal,
                    dismissal: dismissal
                });
            });
        }
        
        // Calculate summary
        const totalHits = allHits.length;
        const dismissedCount = allHits.filter(h => h.dismissed).length;
        const outstandingCount = totalHits - dismissedCount;
        
        // Get report ID from check
        const reportId = pepsTask?.id || sanctionsTask?.id || companySanctionsTask?.id || 'N/A';
        const monitoringStatus = pepsTask?.monitored || check.pepMonitoring ? 'Monitoring Active' : 'Monitoring Inactive';
        
        // Build hit cards HTML
        let hitCardsHTML = '';
        allHits.forEach(hit => {
            const borderColor = hit.dismissed ? '#39b549' : '#f7931e';
            const statusBadgeBg = hit.dismissed ? '#d4edda' : '#fff3cd';
            const statusBadgeColor = hit.dismissed ? '#155724' : '#856404';
            const statusLabel = hit.dismissed ? 'DISMISSED' : 'ACTIVE';
            const statusIcon = hit.dismissed ? this.getStatusIconCSS('clear') : this.getStatusIconCSS('consider');
            
            hitCardsHTML += `
                <div style="background: white; border-radius: 8px; border-left: 4px solid ${borderColor}; padding: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); margin-bottom: 16px; page-break-inside: avoid;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div style="font-size: 14px; font-weight: 500; color: #003c71; flex: 1;">${hit.name}</div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: bold; background: ${statusBadgeBg}; color: ${statusBadgeColor};">${statusLabel}</span>
                            ${statusIcon}
                        </div>
                    </div>
                    <div style="padding: 8px 16px; border-top: 1px solid #dee2e6;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 12px; color: #666; margin-bottom: 12px;">
                            <div><strong>Type:</strong> ${hit.type}</div>
                            <div><strong>Countries:</strong> ${hit.countries}</div>
                            <div><strong>Match Score:</strong> ${hit.score}</div>
                            <div><strong>Flag Types:</strong> ${hit.flagTypes}</div>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <div style="font-size: 11px; font-weight: bold; color: #6c757d; margin-bottom: 4px;">ALSO KNOWN AS:</div>
                            <div style="font-size: 12px; color: #333;">${hit.aka}</div>
                        </div>
            `;
            
            // Add dismissal info if dismissed
            if (hit.dismissed && hit.dismissal) {
                const dismissDate = new Date(hit.dismissal.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
                const dismissTime = new Date(hit.dismissal.timestamp).toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
                
                hitCardsHTML += `
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 6px; padding: 12px; margin-top: 12px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <div style="width: 16px; height: 16px; border-radius: 50%; background: #39b549; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"><span style="color: white; font-size: 12px; font-weight: bold; line-height: 1;">&#x2713;</span></div>
                                <strong style="font-size: 13px; color: #155724;">Dismissal Confirmed</strong>
                            </div>
                            <div style="font-size: 12px; color: #155724; margin-bottom: 6px;">
                                <strong>Reason:</strong> ${hit.dismissal.reason}
                            </div>
                            <div style="font-size: 11px; color: #155724;">
                                <strong>Dismissed by:</strong> ${hit.dismissal.userName || hit.dismissal.user}<br>
                                <strong>Date:</strong> ${dismissDate}, ${dismissTime}
                            </div>
                        </div>
                `;
            }
            
            hitCardsHTML += `
                    </div>
                </div>
            `;
        });
        
        // Build summary card
        const summaryBorderColor = outstandingCount === 0 ? '#39b549' : '#f7931e';
        const summaryMessage = outstandingCount === 0 
            ? '&#x2713; All hits have been reviewed and dismissed'
            : `&#x26A0; ${outstandingCount} hit${outstandingCount > 1 ? 's' : ''} require${outstandingCount === 1 ? 's' : ''} review`;
        const summaryBgColor = outstandingCount === 0 ? '#e8f5e9' : '#fff3e0';
        const summaryTextColor = outstandingCount === 0 ? '#155724' : '#856404';
        
        const htmlContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    :root { --primary-blue: #003c71; --secondary-blue: #1d71b8; --green: #39b549; --orange: #f7931e; --red: #d32f2f; --grey: #6c757d; --light-grey: #f8f9fa; --border-grey: #dee2e6; }
                    body { font-family: 'Trebuchet MS', 'Lucida Grande', sans-serif; padding: 40px; background: white; color: #111; line-height: 1.5; font-size: 14px; }
                    .pdf-header { border-bottom: 3px solid var(--primary-blue); padding-bottom: 20px; margin-bottom: 30px; page-break-after: avoid; }
                    .pdf-title { font-size: 26px; font-weight: bold; color: var(--primary-blue); margin-bottom: 15px; }
                    .check-info { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 13px; }
                    .check-info-item { display: flex; gap: 8px; }
                    .check-info-label { font-weight: bold; color: var(--grey); min-width: 140px; }
                    .check-info-value { color: #333; }
                    .section-title { font-size: 18px; font-weight: bold; color: var(--primary-blue); margin: 30px 0 20px 0; padding-bottom: 8px; border-bottom: 2px solid var(--border-grey); page-break-after: avoid; }
                    .hit-card { page-break-inside: avoid; margin-bottom: 16px; }
                    .pdf-footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid var(--border-grey); text-align: center; font-size: 11px; color: #999; page-break-before: avoid; }
                    @media print { body { padding: 20px; } }
                </style>
            </head>
            <body>
                <div class="pdf-header">
                    <div class="pdf-title">PEP & Sanctions Screening</div>
                    <div class="check-info">
                        <div class="check-info-item"><span class="check-info-label">Check Type:</span><span class="check-info-value">${checkType}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Consumer:</span><span class="check-info-value">${checkName}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Check Reference:</span><span class="check-info-value">${checkRef}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Check ID:</span><span class="check-info-value">${check.checkId || check.transactionId}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Report ID:</span><span class="check-info-value">${reportId}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Generated:</span><span class="check-info-value">${generatedDate}, ${generatedTime}</span></div>
                        <div class="check-info-item"><span class="check-info-label">Status:</span><span class="check-info-value">${monitoringStatus}</span></div>
                    </div>
                </div>
                <div class="section-title">PEP/Sanctions Screening Results</div>
                ${hitCardsHTML}
                <div style="background: white; border-radius: 8px; border-left: 4px solid ${summaryBorderColor}; padding: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); margin-top: 24px; page-break-inside: avoid;">
                    <div style="padding: 12px 16px;">
                        <h4 style="font-size: 14px; font-weight: bold; color: #003c71; margin-bottom: 12px;">Screening Summary</h4>
                        <div style="font-size: 13px; color: #666; margin-bottom: 8px;">
                            <div><strong>Total Hits:</strong> ${totalHits}</div>
                            <div><strong>Dismissed:</strong> ${dismissedCount}</div>
                            <div><strong>Outstanding:</strong> ${outstandingCount}</div>
                        </div>
                        <div style="background: ${summaryBgColor}; padding: 10px; border-radius: 4px; border-left: 3px solid ${summaryBorderColor}; margin-top: 12px;">
                            <div style="font-size: 12px; color: ${summaryTextColor}; font-weight: bold;">${summaryMessage}</div>
                        </div>
                    </div>
                </div>
                <div class="pdf-footer">
                    <p>This report was generated from Thurstan Hoskin's Thirdfort ID Management System</p>
                    <p>Report ID: PEP-${Date.now()} | Page 1 of 1</p>
                </div>
            </body>
            </html>
        `;
        
        const element = document.createElement('div');
        element.innerHTML = htmlContent;
        
        const opt = {
            margin: [10, 10, 10, 10],
            filename: `pep-screening-${checkName.replace(/\s+/g, '-')}-${Date.now()}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true, logging: false },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
            pagebreak: { mode: 'css', avoid: 'div[style*="page-break-inside: avoid"]' }
        };
        
        if (typeof html2pdf !== 'undefined') {
            console.log('&#xD83D;&#xDCC4; Generating PEP dismissals PDF with html2pdf...');
            // Generate PDF as blob and open in print dialog
            html2pdf().set(opt).from(element).outputPdf('blob').then((pdfBlob) => {
                console.log('&#x2705; PEP dismissals PDF generated:', pdfBlob.size, 'bytes');
                
                // Check if Print.js is available
                if (typeof printJS !== 'undefined') {
                    console.log('&#xD83D;&#xDCC4; Opening PEP print dialog with Print.js...');
                const pdfUrl = URL.createObjectURL(pdfBlob);
                    
                    // Use Print.js to open print dialog with PDF
                    printJS({
                        printable: pdfUrl,
                        type: 'pdf',
                        onPrintDialogClose: () => {
                            // Clean up blob URL after print dialog closes
                            URL.revokeObjectURL(pdfUrl);
                        }
                    });
                } else {
                    // Fallback to new tab if Print.js not loaded
                    console.warn(' Print.js not loaded, opening in new tab');
                    const pdfUrl = URL.createObjectURL(pdfBlob);
                const printWindow = window.open(pdfUrl, '_blank');
                if (!printWindow) {
                    console.error('&#x274C; Popup blocked by browser');
                    alert('PDF generated but popup was blocked. Please allow popups for this site.');
                } else {
                    // Trigger print dialogue when PDF loads
                    printWindow.addEventListener('load', () => {
                        setTimeout(() => {
                            printWindow.print();
                        }, 100);
                    });
                    }
                }
                
                // Notify parent that PDF is generated and opened (only if auto-save)
                if (autoSave) {
                    console.log('&#xD83D;&#xDCE4; Sending pdf-generated message to parent');
                    this.sendMessage('pdf-generated', { 
                        type: 'pep-dismissal',
                        checkId: check.checkId || check.transactionId 
                    });
                } else {
                    console.log('&#x2139;&#xFE0F; Manual export - not sending pdf-generated message');
                }
            }).catch(err => {
                console.error('&#x274C; Error generating PEP dismissals PDF:', err);
                alert('Error generating PDF: ' + err.message);
                // Still notify parent even on error so data can refresh (only if auto-save)
                if (autoSave) {
                    this.sendMessage('pdf-generated', { 
                        type: 'pep-dismissal',
                        error: err.message 
                    });
                }
            });
        } else {
            console.error('&#x274C; html2pdf library not loaded');
            alert('PDF library not loaded. Please refresh the page.');
            // Notify parent so data can refresh (only if auto-save)
            if (autoSave) {
                this.sendMessage('pdf-generated', { 
                    type: 'pep-dismissal',
                    error: 'html2pdf not loaded' 
                });
            }
        }
    }
}

// Global toggle functions for collapsible annotation cards
function toggleSofAnnotationCard(event, idx) {
    event.stopPropagation();
    const card = document.querySelector(`[data-sof-annotation-idx="${idx}"]`);
    if (card) {
        card.classList.toggle('collapsed');
    }
}

function toggleBankReviewCard(event, idx) {
    event.stopPropagation();
    const card = document.querySelector(`[data-bank-review-idx="${idx}"]`);
    if (card) {
        card.classList.toggle('collapsed');
    }
}


let manager;

document.addEventListener('DOMContentLoaded', () => {
    manager = new ThirdfortChecksManager();
    window.manager = manager; // Make accessible globally for inline onclick handlers
    window.thirdfortManager = manager; // Keep for backwards compatibility
});



