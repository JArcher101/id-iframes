<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Client Details Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="request-iframe-styles.css" />
</head>
<body>
    <!-- Mock Data Buttons (for testing) -->
    
    
    <div style="display: flex; gap: 10px; margin-bottom: 10px; padding: 10px; background: #f0f0f0; border-radius: 8px;">
      <button type="button" id="mockIndividualBtn" style="flex: 1; padding: 8px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-family: 'Transport', 'Quicksand', sans-serif; font-weight: 500;">
        Mock Individual
      </button>
      <button type="button" id="mockBusinessBtn" style="flex: 1; padding: 8px; background: #10a37f; color: white; border: none; border-radius: 6px; cursor: pointer; font-family: 'Transport', 'Quicksand', sans-serif; font-weight: 500;">
        Mock Business
      </button>
      <button type="button" id="mockCharityBtn" style="flex: 1; padding: 8px; background: #d4a574; color: white; border: none; border-radius: 6px; cursor: pointer; font-family: 'Transport', 'Quicksand', sans-serif; font-weight: 500;">
        Mock Charity
      </button>
    </div>
    
    <!-- Client Details Section -->
    <div class="section" id="detailsSection" style="max-height: none !important; height: auto !important; overflow: visible !important;">
      <!-- Header: Client info display (FE initials, client number, name) -->
      <div id="headerInfo">
        <div class="header-left">
          <div class="header-badge client-number" id="clientNumberBadge">
            <div class="header-badge" id="titleBadge"><span></span></div>
            <span id="clientMatterNumber"></span>
          </div>
          <div class="header-name" id="clientName"></div>
        </div>
        
        <!-- Status Icons (Individual mode only) -->
        <div class="header-icons" id="headerIcons">
          <!-- Address ID Taken Icon -->
          <img 
            src="https://static.wixstatic.com/media/a86acc_e7a12ea3b5b84594bb3768ccf1271339~mv2.png" 
            alt="Address ID" 
            class="icon" 
            id="addressIdIcon"
            title="Address ID Uploaded"
          />
          
          <!-- Photo ID Taken Icon -->
          <img 
            src="https://static.wixstatic.com/shapes/a86acc_a27d29e447fd40d58f51ddc48752cc5f.svg" 
            alt="Photo ID" 
            class="icon" 
            id="photoIdIcon"
            title="Photo ID Uploaded"
          />
          
          <!-- Likeness Confirmed Icon (only if photo ID taken AND likeness NOT confirmed is false) -->
          <img 
            src="https://static.wixstatic.com/shapes/a86acc_c0791819480d4257976efb1136cf67a5.svg" 
            alt="Likeness Confirmed" 
            class="icon" 
            id="likenessIcon"
            title="Likeness Confirmed"
          />
        </div>
      </div>
      
      <!-- Request Type Tag Selector -->
      <h3 style="margin: 0 0 10px 0; color: #666; font-size: 0.95rem; font-weight: 500;">Select a tag to submit a request/update</h3>
      <div class="tag-selector">
        <button type="button" class="request-tag" data-type="formJ">Form J Request</button>
        <button type="button" class="request-tag" data-type="formK">Form K Request</button>
        <button type="button" class="request-tag" data-type="formE">Form E Request</button>
        <button type="button" class="request-tag" data-type="esof">eSoF Request</button>
        <button type="button" class="request-tag" data-type="note">Note</button>
        <button type="button" class="request-tag" data-type="update">Issue Update</button>
        <button type="button" class="request-tag" data-type="updatePep">PEP Update</button>
      </div>
      
      <!-- Form J Eligibility Warning (shown when Form E meets Form J requirements) -->
      <div id="formJEligibilityWarning" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; font-size: 0.75rem; color: #856404; line-height: 1.3;">
        âš ï¸ This entry appears to meet Form J requirements, please double check the client's chosen ID route
      </div>
      
      <!-- eSoF Selected Hint (blue - shown when Form E + eSoF selected) -->
      <div id="esofSelectedHint" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: rgba(74, 144, 226, 0.1); border: 1px solid #4A90E2; border-radius: 6px; font-size: 0.75rem; color: rgb(0, 60, 113); line-height: 1.3;">
        â„¹ï¸ This ID check will include an electronic source of funds questionnaire and source of wealth bank linking task
      </div>
      
      <!-- eSoF Deselected Warning (red - shown when Form E Purchase WITHOUT eSoF) -->
      <div id="esofDeselectedWarning" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: #fee; border: 1px solid #dc3545; border-radius: 6px; font-size: 0.75rem; color: #dc3545; line-height: 1.3;">
        âš ï¸ This client will not undergo eSoF and you MUST collect evidence and complete investigations using the manual route
      </div>
      
      <!-- eSoF Standalone Hint (blue - shown when eSoF selected WITHOUT Form E) -->
      <div id="esofStandaloneHint" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: rgba(74, 144, 226, 0.1); border: 1px solid #4A90E2; border-radius: 6px; font-size: 0.75rem; color: rgb(0, 60, 113); line-height: 1.3;">
        â„¹ï¸ This is just the source of funds questionnaire and source of wealth bank linking task, to include address and photo ID checks please select Form E
      </div>
      
      <!-- Form K Rule 3 Financial Transaction Warning (orange) -->
      <div id="rule3FinancialWarning" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: #fff3cd; border: 1px solid #ff8c00; border-radius: 6px; font-size: 0.75rem; color: #cc7000; line-height: 1.3;">
        âš ï¸ If there is any financial transaction or aspect, i.e. Property & Financial LPA or Beneficiary receiving a legacy, this route is not sufficient and a Form J or E must be used
      </div>
      
      <!-- Rule Selector (for Form J/K/E and eSoF requests) -->
    
    .carousel-image-actions {
    <!-- Mock Data Buttons (for testing) -->
    <div style="display: flex; gap: 10px; margin-bottom: 10px; padding: 10px; background: #f0f0f0; border-radius: 8px;">
      <button type="button" id="mockIndividualBtn" style="flex: 1; padding: 8px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-family: 'Transport', 'Quicksand', sans-serif; font-weight: 500;">
        Mock Individual
      </button>
      <button type="button" id="mockBusinessBtn" style="flex: 1; padding: 8px; background: #10a37f; color: white; border: none; border-radius: 6px; cursor: pointer; font-family: 'Transport', 'Quicksand', sans-serif; font-weight: 500;">
        Mock Business
      </button>
      <button type="button" id="mockCharityBtn" style="flex: 1; padding: 8px; background: #d4a574; color: white; border: none; border-radius: 6px; cursor: pointer; font-family: 'Transport', 'Quicksand', sans-serif; font-weight: 500;">
        Mock Charity
      </button>
    </div>
    
    <!-- Client Details Section -->
    <div class="section" id="detailsSection" style="max-height: none !important; height: auto !important; overflow: visible !important;">
      <!-- Header: Client info display (FE initials, client number, name) -->
      <div id="headerInfo">
        <div class="header-left">
          <div class="header-badge client-number" id="clientNumberBadge">
            <div class="header-badge" id="titleBadge"><span></span></div>
            <span id="clientMatterNumber"></span>
          </div>
          <div class="header-name" id="clientName"></div>
        </div>
        
        <!-- Status Icons (Individual mode only) -->
        <div class="header-icons" id="headerIcons">
          <!-- Address ID Taken Icon -->
          <img 
            src="https://static.wixstatic.com/media/a86acc_e7a12ea3b5b84594bb3768ccf1271339~mv2.png" 
            alt="Address ID" 
            class="icon" 
            id="addressIdIcon"
            title="Address ID Uploaded"
          />
          
          <!-- Photo ID Taken Icon -->
          <img 
            src="https://static.wixstatic.com/shapes/a86acc_a27d29e447fd40d58f51ddc48752cc5f.svg" 
            alt="Photo ID" 
            class="icon" 
            id="photoIdIcon"
            title="Photo ID Uploaded"
          />
          
          <!-- Likeness Confirmed Icon (only if photo ID taken AND likeness NOT confirmed is false) -->
          <img 
            src="https://static.wixstatic.com/shapes/a86acc_c0791819480d4257976efb1136cf67a5.svg" 
            alt="Likeness Confirmed" 
            class="icon" 
            id="likenessIcon"
            title="Likeness Confirmed"
          />
        </div>
      </div>
      
      <!-- Request Type Tag Selector -->
      <h3 style="margin: 0 0 10px 0; color: #666; font-size: 0.95rem; font-weight: 500;">Select a tag to submit a request/update</h3>
      <div class="tag-selector">
        <button type="button" class="request-tag" data-type="formJ">Form J Request</button>
        <button type="button" class="request-tag" data-type="formK">Form K Request</button>
        <button type="button" class="request-tag" data-type="formE">Form E Request</button>
        <button type="button" class="request-tag" data-type="esof">eSoF Request</button>
        <button type="button" class="request-tag" data-type="note">Note</button>
        <button type="button" class="request-tag" data-type="update">Issue Update</button>
        <button type="button" class="request-tag" data-type="updatePep">PEP Update</button>
      </div>
      
      <!-- Form J Eligibility Warning (shown when Form E meets Form J requirements) -->
      <div id="formJEligibilityWarning" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; font-size: 0.75rem; color: #856404; line-height: 1.3;">
        âš ï¸ This entry appears to meet Form J requirements, please double check the client's chosen ID route
      </div>
      
      <!-- eSoF Selected Hint (blue - shown when Form E + eSoF selected) -->
      <div id="esofSelectedHint" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: rgba(74, 144, 226, 0.1); border: 1px solid #4A90E2; border-radius: 6px; font-size: 0.75rem; color: rgb(0, 60, 113); line-height: 1.3;">
        â„¹ï¸ This ID check will include an electronic source of funds questionnaire and source of wealth bank linking task
      </div>
      
      <!-- eSoF Deselected Warning (red - shown when Form E Purchase WITHOUT eSoF) -->
      <div id="esofDeselectedWarning" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: #fee; border: 1px solid #dc3545; border-radius: 6px; font-size: 0.75rem; color: #dc3545; line-height: 1.3;">
        âš ï¸ This client will not undergo eSoF and you MUST collect evidence and complete investigations using the manual route
      </div>
      
      <!-- eSoF Standalone Hint (blue - shown when eSoF selected WITHOUT Form E) -->
      <div id="esofStandaloneHint" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: rgba(74, 144, 226, 0.1); border: 1px solid #4A90E2; border-radius: 6px; font-size: 0.75rem; color: rgb(0, 60, 113); line-height: 1.3;">
        â„¹ï¸ This is just the source of funds questionnaire and source of wealth bank linking task, to include address and photo ID checks please select Form E
      </div>
      
      <!-- Form K Rule 3 Financial Transaction Warning (orange) -->
      <div id="rule3FinancialWarning" class="field-hint hidden" style="margin-top: 10px; margin-bottom: 15px; padding: 8px; background: #fff3cd; border: 1px solid #ff8c00; border-radius: 6px; font-size: 0.75rem; color: #cc7000; line-height: 1.3;">
        âš ï¸ If there is any financial transaction or aspect, i.e. Property & Financial LPA or Beneficiary receiving a legacy, this route is not sufficient and a Form J or E must be used
      </div>
      
      <!-- Rule Selector (for Form J/K/E and eSoF requests) -->
      <div class="row" id="ruleSelectRow" style="display: none;">
        <label for="ruleSelect">Select the rule you are submitting under</label>
        <select id="ruleSelect" name="ruleSelect">
          <option value="">Select rule...</option>
          <option value="We already hold a [Pass/ePass] result valid to ....-...... on matter ........../... for this client which is sufficient to process a form K [RULE 1] AND this matter is not a sale. I attach both the CDF and a recent OFSI for the client.">Rule 1 - Pass/ePass already held</option>
          <option value="We already hold an [ID Held] result valid to ....-...... on matter ........../... for this client which is sufficient to contuct an electronic check under form K [RULE 2] AND this is not a sale. I attach both the CDF and a recent OFSI for the client.">Rule 2 - ID already Held</option>
          <option value="This matter is out of scope and we hold TWO valid forms of address ID and ONE valid form of Photo ID for the client sufficient to process a form K [RULE 3]. I attach both the CDF and a recent OFSI for the client.">Rule 3 - This matter is out of scope</option>
          <option value="The client is a company and we enclose a print out from companies house of the register entry">Rule 4 - Company</option>
          <option value="The client is a partnership and we enclose a print out from companies house of the register entry or proof of address for the partnership sufficient to process a form K [RULE 5]. I attach a recent OFSI for the client.">Rule 5 - Partnership</option>
          <option value="The client is a charity and we enclose a print out from the charity register of the entry including a list of all registered officers">Rule 6 - Charity</option>
          <option value="The client is a PLC and we enclose a print out from the stock exchange of the registration sufficient to process a form K [RULE 7]. I attach a recent OFSI check for the client.">Rule 7 - PLC</option>
          <option value="The client is a governemnt/council department and we enclose proof of its status sufficient to process a form K [RULE 8]. I attach a recent OFSI check for the client.">Rule 8 - Government/Council</option>
          <option value="The client is a regulated professional and we enclose proof of the registration with the regulatory body sufficient to process a form K [RULE 9]. I attach a recent OFSI check for the client.">Rule 9 - Regulated Institution</option>
          <option value="The client has been identified by a regulated professional and proof of reliance on thier checks is included along with a recent OFSI check sufficient to process a form K [RULE 10]">Rule 10 - Regulated referral</option>
          <option value="The client has conducted a Thirdfort Check in the last 6 months which has been securely shared to ...........@thurstanhoskin.co.uk succificent to process a form K [RULE 11].">Rule 11 - Thirdfort Secure Share</option>
        </select>
      </div>
      
      <!-- Message Input and File Uploader (Always Visible) -->
      <div class="message-upload-row">
        <textarea class="message-input" placeholder="Type your message here..." id="messageInput"></textarea>
        <div class="upload-area" onclick="triggerFileInput()" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" id="uploadArea">
          <div class="upload-icon" id="uploadIcon">
            <svg viewBox="0 0 24 24" fill="none" stroke="rgb(0, 60, 113)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17,8 12,3 7,8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
          </div>
          <div class="upload-text" id="uploadText">Upload</div>
          <input type="file" class="file-input" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.rtf" id="fileInput" onchange="handleFileSelect(event)">
        </div>
      </div>
      
      <hr style="border: none; border-top: 2px solid #ccc; margin: 15px 0;" />
      
      <!-- Work Type, Relation, Matter Description (Always Visible) -->
      <!-- Row 1: Work Type + Matter Description -->
      <div class="row row-grid-50-50">
        <div>
          <label for="worktype" class="required">Work Type</label>
          <input type="text" id="worktype" name="worktype" required class="worktype-input" />
          <select id="worktypeDropdown" class="worktype-dropdown">
            <option value="">or choose from list...</option>
            <option value="Sale of">Sale of</option>
            <option value="Purchase of">Purchase of</option>
            <option value="Transfer of">Transfer of</option>
            <option value="1st Registration">1st Registration</option>
            <option value="Equity Release">Equity Release</option>
            <option value="Auction">Auction</option>
            <option value="Wills">Wills</option>
            <option value="Lasting Power of Attorney">Lasting Power of Attorney</option>
            <option value="Change of Name Deed">Change of Name Deed</option>
            <option value="Estates">Estates</option>
            <option value="Deeds & Declarations">Deeds & Declarations</option>
            <option value="Assent">Assent</option>
            <option value="Adverse Possesion">Adverse Possesion</option>
          </select>
        </div>
        <div>
          <label for="matterDescription">Matter Description</label>
          <input type="text" id="matterDescription" name="matterDescription" />
        </div>
      </div>

      <!-- Row 2: Relation + Business/Charity Checkboxes -->
      <div class="row row-grid-50-50">
        <div>
          <label for="relation" class="required">Relation</label>
          <input type="text" id="relation" name="relation" required class="relation-input" />
          <select id="relationDropdown" class="relation-dropdown">
            <option value="">or choose from list...</option>
            <option value="Our Client">Our Client</option>
            <option value="Gifter">Gifter</option>
            <option value="Executor">Executor</option>
            <option value="Beneficiary">Beneficiary</option>
            <option value="Occupier">Occupier</option>
            <option value="Leaseholder">Leaseholder</option>
            <option value="Freeholder">Freeholder</option>
            <option value="Tenant">Tenant</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div id="entityCheckboxContainer" style="display: flex; gap: 20px; align-items: center;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="businessCheckbox" class="address-checkbox" title="Check if client is a business" style="margin: 0 !important; padding: 0 !important;" />
            <label for="businessCheckbox" style="margin: 0; cursor: pointer;">Business</label>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="charityCheckbox" class="address-checkbox" title="Check if client is a charity" style="margin: 0 !important; padding: 0 !important;" />
            <label for="charityCheckbox" style="margin: 0; cursor: pointer;">Charity</label>
          </div>
        </div>
      </div>
      
      <hr style="border: none; border-top: 2px solid #ccc; margin: 15px 0;" />
      
      <form id="clientForm">
        <!-- Entity Mode Fields (hidden by default) -->
        <div id="entityFields" class="hidden">
          <!-- Row 1: Business Name (Full Width) with buttons -->
          <div class="row">
            <label for="businessName">Business Name</label>
            <div class="company-buttons-container">
              <div class="address-autocomplete-container">
                <input type="text" id="businessName" name="businessName" autocomplete="off" placeholder="Search by company name..." />
                <div id="businessNameDropdown" class="address-dropdown hidden"></div>
              </div>
              <!-- Companies House Link Button (shows when company data linked) -->
              <button type="button" id="companyLinkBtn" class="hidden" title="View on Companies House" style="flex-shrink: 0; width: 36px; height: 36px; background: white; border: 2px solid var(--primary); border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--primary); transition: all 0.2s;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                  <polyline points="15 3 21 3 21 9"></polyline>
                  <line x1="10" y1="14" x2="21" y2="3"></line>
                </svg>
              </button>
              <!-- Refresh Company Data Button (shows when company data linked) -->
              <button type="button" id="companyRefreshBtn" class="hidden" title="Refresh company data from Companies House" style="flex-shrink: 0; width: 36px; height: 36px; background: white; border: 2px solid var(--primary); border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--primary); transition: all 0.2s;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="23 4 23 10 17 10"></polyline>
                  <polyline points="1 20 1 14 7 14"></polyline>
                  <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
              </button>
              <!-- Download Company Summary Button (shows when company data linked) -->
              <button type="button" id="downloadSummaryBtn" class="hidden" title="Download company summary as PDF" style="flex-shrink: 0; width: 36px; height: 36px; background: white; border: 2px solid var(--primary); border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--primary); transition: all 0.2s;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="7 10 12 15 17 10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
              </button>
            </div>
          </div>
          
          <!-- Row 2: Split Grid - Left (Country + Number) | Right (People Cards) -->
          <div class="entity-grid">
            <!-- Left Column: Registration Country + Company Number -->
            <div class="entity-left">
              <div>
                <label for="registrationCountry">Registration Country</label>
                <select id="registrationCountry" name="registrationCountry" class="country-dropdown">
                  <option value="GB">United Kingdom</option>
                  <option value="US">United States</option>
                  <option value="IE">Ireland</option>
                  <option value="AU">Australia</option>
                  <option value="CA">Canada</option>
                  <option value="NZ">New Zealand</option>
                  <option value="SG">Singapore</option>
                  <option value="HK">Hong Kong</option>
                  <option value="OTHER">Other</option>
                </select>
              </div>
              
              <div>
                <label for="entityNumber">Company Number</label>
                <div class="address-autocomplete-container">
                  <input type="text" id="entityNumber" name="entityNumber" autocomplete="off" placeholder="Search by company number..." />
                  <div id="entityNumberDropdown" class="address-dropdown hidden"></div>
                </div>
              </div>
            </div>
            
            <!-- Right Column: People Cards (Officers, Directors, PSCs) -->
            <div class="entity-right">
              <h3 style="margin: 0 0 4px 0; font-size: 0.9rem; color: #666;">People</h3>
              <div style="margin-top: 4px; margin-bottom: 8px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; font-size: 0.75rem; color: #856404; line-height: 1.3;">
                âš ï¸ Ensure all directors and people with &gt; 25% share have undergone appropriate AML &amp; ID checks
              </div>
              <div class="people-scrollable">
                <div id="peopleRepeater">
                  <div class="no-people-message">Link a company to view officers, directors, and PSCs</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Individual Mode Fields (shown by default) -->
        <div id="individualFields" class="">
        <div class="row name-row">
          <div>
            <label for="titlePrefix">Title</label>
            <select id="titlePrefix" name="titlePrefix">
              <option value="">Select...</option>
              <option value="Mr">Mr</option>
              <option value="Mrs">Mrs</option>
              <option value="Ms">Ms</option>
              <option value="Miss">Miss</option>
              <option value="Master">Master</option>
              <option value="Dr">Dr</option>
              <option value="Lord">Lord</option>
              <option value="Rev">Rev</option>
              <option value="Mx">Mx</option>
              <option value="Lad">Lad</option>
              <option value="Dame">Dame</option>
            </select>
          </div>
          <div>
            <label for="firstName">First Name</label>
            <input type="text" id="firstName" name="firstName" />
          </div>
          <div>
            <label for="middleName">Middle Name</label>
            <input type="text" id="middleName" name="middleName" />
          </div>
          <div>
            <label for="lastName">Surname</label>
            <input type="text" id="lastName" name="lastName" />
          </div>
        </div>
        
        <!-- Hint for Form J, E, eSoF (shown only for these request types) -->
        <div id="nameHint" class="field-hint hidden" style="margin-top: -10px; margin-bottom: 10px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; font-size: 0.75rem; color: #856404; line-height: 1.3;">
          âš ï¸ Enter exactly as shown on their Photo ID document, enter a known as name below
        </div>

        <!-- Entity Number Row (shown only in entity mode, replaces DOB row) -->
        <div id="entityNumberRow" class="hidden">
          <div class="row">
            <label for="entityNumber" class="required">Entity Number</label>
            <input type="text" id="entityNumber" name="entityNumber" placeholder="Company registration number" />
          </div>
        </div>

        <div class="row phone-email-row">
          <div>
            <label for="phoneCountryCode">Code</label>
            <select id="phoneCountryCode" name="phoneCountryCode">
              <!-- UK Default -->
              <option value="+44">ğŸ‡¬ğŸ‡§ +44 UK</option>
              
              <!-- EU Countries -->
              <option value="+43">ğŸ‡¦ğŸ‡¹ +43 Austria</option>
              <option value="+32">ğŸ‡§ğŸ‡ª +32 Belgium</option>
              <option value="+359">ğŸ‡§ğŸ‡¬ +359 Bulgaria</option>
              <option value="+385">ğŸ‡­ğŸ‡· +385 Croatia</option>
              <option value="+357">ğŸ‡¨ğŸ‡¾ +357 Cyprus</option>
              <option value="+420">ğŸ‡¨ğŸ‡¿ +420 Czech Republic</option>
              <option value="+45">ğŸ‡©ğŸ‡° +45 Denmark</option>
              <option value="+372">ğŸ‡ªğŸ‡ª +372 Estonia</option>
              <option value="+358">ğŸ‡«ğŸ‡® +358 Finland</option>
              <option value="+33">ğŸ‡«ğŸ‡· +33 France</option>
              <option value="+49">ğŸ‡©ğŸ‡ª +49 Germany</option>
              <option value="+30">ğŸ‡¬ğŸ‡· +30 Greece</option>
              <option value="+36">ğŸ‡­ğŸ‡º +36 Hungary</option>
              <option value="+353">ğŸ‡®ğŸ‡ª +353 Ireland</option>
              <option value="+39">ğŸ‡®ğŸ‡¹ +39 Italy</option>
              <option value="+371">ğŸ‡±ğŸ‡» +371 Latvia</option>
              <option value="+370">ğŸ‡±ğŸ‡¹ +370 Lithuania</option>
              <option value="+352">ğŸ‡±ğŸ‡º +352 Luxembourg</option>
              <option value="+356">ğŸ‡²ğŸ‡¹ +356 Malta</option>
              <option value="+31">ğŸ‡³ğŸ‡± +31 Netherlands</option>
              <option value="+48">ğŸ‡µğŸ‡± +48 Poland</option>
              <option value="+351">ğŸ‡µğŸ‡¹ +351 Portugal</option>
              <option value="+40">ğŸ‡·ğŸ‡´ +40 Romania</option>
              <option value="+421">ğŸ‡¸ğŸ‡° +421 Slovakia</option>
              <option value="+386">ğŸ‡¸ğŸ‡® +386 Slovenia</option>
              <option value="+34">ğŸ‡ªğŸ‡¸ +34 Spain</option>
              <option value="+46">ğŸ‡¸ğŸ‡ª +46 Sweden</option>
              
              <!-- IAV Supported Countries (from api.v2.yaml) -->
              <option value="+54">ğŸ‡¦ğŸ‡· +54 Argentina</option>
              <option value="+61">ğŸ‡¦ğŸ‡º +61 Australia</option>
              <option value="+55">ğŸ‡§ğŸ‡· +55 Brazil</option>
              <option value="+1">ğŸ‡¨ğŸ‡¦ +1 Canada</option>
              <option value="+86">ğŸ‡¨ğŸ‡³ +86 China</option>
              <option value="+52">ğŸ‡²ğŸ‡½ +52 Mexico</option>
              <option value="+64">ğŸ‡³ğŸ‡¿ +64 New Zealand</option>
              <option value="+47">ğŸ‡³ğŸ‡´ +47 Norway</option>
              <option value="+65">ğŸ‡¸ğŸ‡¬ +65 Singapore</option>
              <option value="+27">ğŸ‡¿ğŸ‡¦ +27 South Africa</option>
              <option value="+41">ğŸ‡¨ğŸ‡­ +41 Switzerland</option>
              <option value="+90">ğŸ‡¹ğŸ‡· +90 Turkey</option>
              <option value="+1">ğŸ‡ºğŸ‡¸ +1 USA</option>
              
              <!-- Other Countries (Alphabetical) -->
              <option value="+93">ğŸ‡¦ğŸ‡« +93 Afghanistan</option>
              <option value="+355">ğŸ‡¦ğŸ‡± +355 Albania</option>
              <option value="+213">ğŸ‡©ğŸ‡¿ +213 Algeria</option>
              <option value="+376">ğŸ‡¦ğŸ‡© +376 Andorra</option>
              <option value="+244">ğŸ‡¦ğŸ‡´ +244 Angola</option>
              <option value="+374">ğŸ‡¦ğŸ‡² +374 Armenia</option>
              <option value="+994">ğŸ‡¦ğŸ‡¿ +994 Azerbaijan</option>
              <option value="+973">ğŸ‡§ğŸ‡­ +973 Bahrain</option>
              <option value="+880">ğŸ‡§ğŸ‡© +880 Bangladesh</option>
              <option value="+375">ğŸ‡§ğŸ‡¾ +375 Belarus</option>
              <option value="+501">ğŸ‡§ğŸ‡¿ +501 Belize</option>
              <option value="+975">ğŸ‡§ğŸ‡¹ +975 Bhutan</option>
              <option value="+591">ğŸ‡§ğŸ‡´ +591 Bolivia</option>
              <option value="+387">ğŸ‡§ğŸ‡¦ +387 Bosnia</option>
              <option value="+267">ğŸ‡§ğŸ‡¼ +267 Botswana</option>
              <option value="+673">ğŸ‡§ğŸ‡³ +673 Brunei</option>
              <option value="+855">ğŸ‡°ğŸ‡­ +855 Cambodia</option>
              <option value="+237">ğŸ‡¨ğŸ‡² +237 Cameroon</option>
              <option value="+56">ğŸ‡¨ğŸ‡± +56 Chile</option>
              <option value="+57">ğŸ‡¨ğŸ‡´ +57 Colombia</option>
              <option value="+506">ğŸ‡¨ğŸ‡· +506 Costa Rica</option>
              <option value="+225">ğŸ‡¨ğŸ‡® +225 CÃ´te d'Ivoire</option>
              <option value="+593">ğŸ‡ªğŸ‡¨ +593 Ecuador</option>
              <option value="+20">ğŸ‡ªğŸ‡¬ +20 Egypt</option>
              <option value="+503">ğŸ‡¸ğŸ‡» +503 El Salvador</option>
              <option value="+251">ğŸ‡ªğŸ‡¹ +251 Ethiopia</option>
              <option value="+995">ğŸ‡¬ğŸ‡ª +995 Georgia</option>
              <option value="+233">ğŸ‡¬ğŸ‡­ +233 Ghana</option>
              <option value="+502">ğŸ‡¬ğŸ‡¹ +502 Guatemala</option>
              <option value="+504">ğŸ‡­ğŸ‡³ +504 Honduras</option>
              <option value="+852">ğŸ‡­ğŸ‡° +852 Hong Kong</option>
              <option value="+354">ğŸ‡®ğŸ‡¸ +354 Iceland</option>
              <option value="+91">ğŸ‡®ğŸ‡³ +91 India</option>
              <option value="+62">ğŸ‡®ğŸ‡© +62 Indonesia</option>
              <option value="+98">ğŸ‡®ğŸ‡· +98 Iran</option>
              <option value="+964">ğŸ‡®ğŸ‡¶ +964 Iraq</option>
              <option value="+972">ğŸ‡®ğŸ‡± +972 Israel</option>
              <option value="+81">ğŸ‡¯ğŸ‡µ +81 Japan</option>
              <option value="+962">ğŸ‡¯ğŸ‡´ +962 Jordan</option>
              <option value="+7">ğŸ‡°ğŸ‡¿ +7 Kazakhstan</option>
              <option value="+254">ğŸ‡°ğŸ‡ª +254 Kenya</option>
              <option value="+965">ğŸ‡°ğŸ‡¼ +965 Kuwait</option>
              <option value="+996">ğŸ‡°ğŸ‡¬ +996 Kyrgyzstan</option>
              <option value="+856">ğŸ‡±ğŸ‡¦ +856 Laos</option>
              <option value="+961">ğŸ‡±ğŸ‡§ +961 Lebanon</option>
              <option value="+218">ğŸ‡±ğŸ‡¾ +218 Libya</option>
              <option value="+853">ğŸ‡²ğŸ‡´ +853 Macau</option>
              <option value="+389">ğŸ‡²ğŸ‡° +389 Macedonia</option>
              <option value="+261">ğŸ‡²ğŸ‡¬ +261 Madagascar</option>
              <option value="+60">ğŸ‡²ğŸ‡¾ +60 Malaysia</option>
              <option value="+960">ğŸ‡²ğŸ‡» +960 Maldives</option>
              <option value="+223">ğŸ‡²ğŸ‡± +223 Mali</option>
              <option value="+212">ğŸ‡²ğŸ‡¦ +212 Morocco</option>
              <option value="+258">ğŸ‡²ğŸ‡¿ +258 Mozambique</option>
              <option value="+95">ğŸ‡²ğŸ‡² +95 Myanmar</option>
              <option value="+264">ğŸ‡³ğŸ‡¦ +264 Namibia</option>
              <option value="+977">ğŸ‡³ğŸ‡µ +977 Nepal</option>
              <option value="+505">ğŸ‡³ğŸ‡® +505 Nicaragua</option>
              <option value="+234">ğŸ‡³ğŸ‡¬ +234 Nigeria</option>
              <option value="+968">ğŸ‡´ğŸ‡² +968 Oman</option>
              <option value="+92">ğŸ‡µğŸ‡° +92 Pakistan</option>
              <option value="+507">ğŸ‡µğŸ‡¦ +507 Panama</option>
              <option value="+595">ğŸ‡µğŸ‡¾ +595 Paraguay</option>
              <option value="+51">ğŸ‡µğŸ‡ª +51 Peru</option>
              <option value="+63">ğŸ‡µğŸ‡­ +63 Philippines</option>
              <option value="+974">ğŸ‡¶ğŸ‡¦ +974 Qatar</option>
              <option value="+7">ğŸ‡·ğŸ‡º +7 Russia</option>
              <option value="+966">ğŸ‡¸ğŸ‡¦ +966 Saudi Arabia</option>
              <option value="+381">ğŸ‡·ğŸ‡¸ +381 Serbia</option>
              <option value="+82">ğŸ‡°ğŸ‡· +82 South Korea</option>
              <option value="+94">ğŸ‡±ğŸ‡° +94 Sri Lanka</option>
              <option value="+249">ğŸ‡¸ğŸ‡© +249 Sudan</option>
              <option value="+963">ğŸ‡¸ğŸ‡¾ +963 Syria</option>
              <option value="+886">ğŸ‡¹ğŸ‡¼ +886 Taiwan</option>
              <option value="+992">ğŸ‡¹ğŸ‡¯ +992 Tajikistan</option>
              <option value="+255">ğŸ‡¹ğŸ‡¿ +255 Tanzania</option>
              <option value="+66">ğŸ‡¹ğŸ‡­ +66 Thailand</option>
              <option value="+216">ğŸ‡¹ğŸ‡³ +216 Tunisia</option>
              <option value="+993">ğŸ‡¹ğŸ‡² +993 Turkmenistan</option>
              <option value="+256">ğŸ‡ºğŸ‡¬ +256 Uganda</option>
              <option value="+380">ğŸ‡ºğŸ‡¦ +380 Ukraine</option>
              <option value="+971">ğŸ‡¦ğŸ‡ª +971 UAE</option>
              <option value="+598">ğŸ‡ºğŸ‡¾ +598 Uruguay</option>
              <option value="+998">ğŸ‡ºğŸ‡¿ +998 Uzbekistan</option>
              <option value="+58">ğŸ‡»ğŸ‡ª +58 Venezuela</option>
              <option value="+84">ğŸ‡»ğŸ‡³ +84 Vietnam</option>
              <option value="+967">ğŸ‡¾ğŸ‡ª +967 Yemen</option>
              <option value="+260">ğŸ‡¿ğŸ‡² +260 Zambia</option>
              <option value="+263">ğŸ‡¿ğŸ‡¼ +263 Zimbabwe</option>
            </select>
          </div>
          <div>
            <label for="phoneNumber">Mobile Number</label>
            <input type="tel" id="phoneNumber" name="phoneNumber" />
          </div>
          <div>
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" placeholder="name@example.com" />
          </div>
        </div>

        <div class="row toggle-dob-row" id="nameChangeDobRow">
          <div>
            <label>Known as/Name change</label>
            <label class="toggle" title="If the client has changed their name in the last three years or is known by another name please select the toggle">
              <input type="checkbox" id="recentNameChange" />
              <span class="slider"></span>
            </label>
          </div>
          <div>
            <label>Date of Birth</label>
            <div class="birthdate-inputs">
              <input type="text" maxlength="1" id="dob1" />
              <input type="text" maxlength="1" id="dob2" />
              <input type="text" maxlength="1" id="dob3" />
              <input type="text" maxlength="1" id="dob4" />
              <input type="text" maxlength="1" id="dob5" />
              <input type="text" maxlength="1" id="dob6" />
              <input type="text" maxlength="1" id="dob7" />
              <input type="text" maxlength="1" id="dob8" />
            </div>
          </div>
        </div>

        <div id="nameChangeFields" class="hidden">
          <div class="row name-change-row">
            <div>
              <label for="previousName">Previous/Known as name</label>
              <input type="text" id="previousName" name="previousName" />
            </div>
            <div>
              <label for="reasonForNameChange">Reason for Name Change</label>
              <input type="text" id="reasonForNameChange" name="reasonForNameChange" placeholder="Marriage/Divorce, Name change by deed poll, Known as..." />
            </div>
          </div>
        </div>
        <!-- End Individual Fields -->

        <!-- Address Fields (shown for both entity and individual) -->
        <div class="row name-change-row">
          <div>
            <label for="currentCountry">Country</label>
            <select id="currentCountry" name="currentCountry" class="country-dropdown">
              <option value="GBR">United Kingdom</option>
              <option value="USA">United States</option>
              <option value="CAN">Canada</option>
              <option value="AUS">Australia</option>
              <option value="NZL">New Zealand</option>
              <option value="IRL">Ireland</option>
              <option value="FRA">France</option>
              <option value="DEU">Germany</option>
              <option value="ESP">Spain</option>
              <option value="ITA">Italy</option>
              <option value="PRT">Portugal</option>
              <option value="NLD">Netherlands</option>
              <option value="BEL">Belgium</option>
              <option value="CHE">Switzerland</option>
              <option value="AUT">Austria</option>
              <option value="DNK">Denmark</option>
              <option value="SWE">Sweden</option>
              <option value="NOR">Norway</option>
              <option value="FIN">Finland</option>
              <option value="POL">Poland</option>
              <option value="GRC">Greece</option>
              <option value="TUR">Turkey</option>
              <option value="RUS">Russia</option>
              <option value="CHN">China</option>
              <option value="JPN">Japan</option>
              <option value="IND">India</option>
              <option value="BRA">Brazil</option>
              <option value="MEX">Mexico</option>
              <option value="ZAF">South Africa</option>
              <option value="ARE">United Arab Emirates</option>
              <option value="SAU">Saudi Arabia</option>
              <option value="SGP">Singapore</option>
              <option value="HKG">Hong Kong</option>
              <option value="KOR">South Korea</option>
              <option value="OTHER">Other</option>
            </select>
          </div>
          <div id="currentAddressAutocompleteRow">
            <label for="currentAddress" id="currentAddressLabel">Search Address</label>
            <div class="address-autocomplete-container">
              <input type="text" id="currentAddress" name="currentAddress" autocomplete="off" placeholder="Start typing address or postcode..." />
              <div id="currentAddressDropdown" class="address-dropdown hidden"></div>
            </div>
          </div>
        </div>

        <div class="row name-change-row">
          <div>
            <label>Recent Move (within last year)</label>
            <label class="toggle" title="If the client has moved home in the past 1 year please enter their previous address">
              <input type="checkbox" id="recentMove" />
              <span class="slider"></span>
            </label>
          </div>
          <div id="addressNotListedRow">
            <div class="checkbox-container">
              <input type="checkbox" id="addressNotListed" />
              <label for="addressNotListed">Address not listed (enter manually)</label>
            </div>
          </div>
        </div>

        <!-- Manual address entry fields -->
        <div id="manualAddressFields" class="hidden">
        <div class="row row-grid-50-50">
          <div>
            <label for="flatNumber">Flat Number</label>
            <input type="text" id="flatNumber" name="flatNumber" />
          </div>
          <div>
            <label for="buildingNumber">Building Number</label>
            <input type="text" id="buildingNumber" name="buildingNumber" />
          </div>
        </div>
        
        <div class="row">
          <label for="buildingName">Building Name</label>
          <input type="text" id="buildingName" name="buildingName" />
        </div>
        
        <div class="row row-grid-50-50">
          <div>
            <label for="street">Street</label>
            <input type="text" id="street" name="street" />
          </div>
          <div>
            <label for="subStreet">Sub Street</label>
            <input type="text" id="subStreet" name="subStreet" />
          </div>
        </div>
        
        <div class="row row-grid-50-50">
          <div>
            <label for="town">Town/City</label>
            <input type="text" id="town" name="town" />
          </div>
          <div>
            <label for="postcode">Postcode</label>
            <input type="text" id="postcode" name="postcode" />
          </div>
        </div>
        </div>

        <div id="previousAddressFields" class="hidden">
          <div class="row name-change-row">
            <div>
              <label for="previousCountry">Country</label>
              <select id="previousCountry" name="previousCountry" class="country-dropdown">
                <option value="GBR">United Kingdom</option>
                <option value="USA">United States</option>
                <option value="CAN">Canada</option>
                <option value="AUS">Australia</option>
                <option value="NZL">New Zealand</option>
                <option value="IRL">Ireland</option>
                <option value="FRA">France</option>
                <option value="DEU">Germany</option>
                <option value="ESP">Spain</option>
                <option value="ITA">Italy</option>
                <option value="PRT">Portugal</option>
                <option value="NLD">Netherlands</option>
                <option value="BEL">Belgium</option>
                <option value="CHE">Switzerland</option>
                <option value="AUT">Austria</option>
                <option value="DNK">Denmark</option>
                <option value="SWE">Sweden</option>
                <option value="NOR">Norway</option>
                <option value="FIN">Finland</option>
                <option value="POL">Poland</option>
                <option value="GRC">Greece</option>
                <option value="TUR">Turkey</option>
                <option value="RUS">Russia</option>
                <option value="CHN">China</option>
                <option value="JPN">Japan</option>
                <option value="IND">India</option>
                <option value="BRA">Brazil</option>
                <option value="MEX">Mexico</option>
                <option value="ZAF">South Africa</option>
                <option value="ARE">United Arab Emirates</option>
                <option value="SAU">Saudi Arabia</option>
                <option value="SGP">Singapore</option>
                <option value="HKG">Hong Kong</option>
                <option value="KOR">South Korea</option>
                <option value="OTHER">Other</option>
              </select>
            </div>
            <div id="previousAddressAutocompleteRow">
              <label for="previousAddress" id="previousAddressLabel">Search Address</label>
              <div class="address-autocomplete-container">
                <input type="text" id="previousAddress" name="previousAddress" autocomplete="off" placeholder="Start typing address or postcode..." />
                <div id="previousAddressDropdown" class="address-dropdown hidden"></div>
              </div>
            </div>
          </div>

          <div class="row name-change-row">
            <div></div>
            <div id="previousAddressNotListedRow">
              <div class="checkbox-container">
                <input type="checkbox" id="previousAddressNotListed" />
                <label for="previousAddressNotListed">Address not listed (enter manually)</label>
              </div>
            </div>
          </div>
        
        <!-- Manual previous address entry fields -->
        <div id="manualPreviousAddressFields" class="hidden">
          <div class="row row-grid-50-50">
            <div>
              <label for="prevFlatNumber">Flat Number</label>
              <input type="text" id="prevFlatNumber" name="prevFlatNumber" />
            </div>
            <div>
              <label for="prevBuildingNumber">Building Number</label>
              <input type="text" id="prevBuildingNumber" name="prevBuildingNumber" />
            </div>
          </div>
          
          <div class="row">
            <label for="prevBuildingName">Building Name</label>
            <input type="text" id="prevBuildingName" name="prevBuildingName" />
          </div>
          
          <div class="row row-grid-50-50">
            <div>
              <label for="prevStreet">Street</label>
              <input type="text" id="prevStreet" name="prevStreet" />
            </div>
            <div>
              <label for="prevSubStreet">Sub Street</label>
              <input type="text" id="prevSubStreet" name="prevSubStreet" />
            </div>
          </div>
          
          <div class="row row-grid-50-50">
            <div>
              <label for="prevTown">Town/City</label>
              <input type="text" id="prevTown" name="prevTown" />
            </div>
            <div>
              <label for="prevPostcode">Postcode</label>
              <input type="text" id="prevPostcode" name="prevPostcode" />
            </div>
          </div>
        </div>
        </div>

        <!-- Image Carousel (Form J only) -->
        <div id="imageCarouselSection" class="hidden" style="margin-top: 20px;">
          <hr style="border: none; border-top: 2px solid #ccc; margin: 15px 0;" />
          
          <h3 style="margin: 0 0 15px 0; color: #666; font-size: 0.95rem; font-weight: 500;">ID Documents</h3>
          
          <div id="imageCarousel" style="display: flex; gap: 10px; overflow-x: auto; padding: 10px 0;">
            <!-- Images will be populated here -->
          </div>
          
          <!-- ID Verification Confirmation Checkbox -->
          <div id="idVerificationCheckboxWrapper" class="hidden" style="margin-top: 15px; padding: 12px; background: #f5f5f5; border-radius: 8px; border: 1px solid #ddd;">
            <div style="display: flex; align-items: flex-start; gap: 10px;">
              <input type="checkbox" id="idVerificationCheckbox" class="address-checkbox" style="margin-top: 3px; flex-shrink: 0;" />
              <label for="idVerificationCheckbox" style="margin: 0; cursor: pointer; font-size: 0.85rem; line-height: 1.4; color: #333;">
                I confirm there are two forms of Address ID and one form of Photo ID attached for the client. I have verified the details match those presented by the client across all sources. I have verified the photos meet the requirements and are not blurry. All documents pictured are valid and meet our standards.
              </label>
            </div>
          </div>
          
          <hr style="border: none; border-top: 2px solid #ccc; margin: 15px 0;" />
          
          <!-- Required Documents Section (CDF & OFSI) -->
          <h3 style="margin: 0 0 15px 0; color: #666; font-size: 0.95rem; font-weight: 500;">Required Documents</h3>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <!-- Left Column: Client/Beneficiary Details Form -->
            <div>
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                <label style="margin: 0; font-weight: 500; color: #333; font-size: 0.9rem;">Client Details Form</label>
              </div>
              
              <!-- CDF Hint -->
              <div id="cdfHint" style="margin-bottom: 10px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; font-size: 0.75rem; color: #856404; line-height: 1.3;">
                âš ï¸ Please supply<br><br>Client Basic Details Form or Beneficiary details form for individuals
              </div>
              
              <!-- Existing CDF Document Card (if present) -->
              <div id="cdfDocumentCard" class="hidden" style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 6px; padding: 10px; margin-bottom: 10px; box-sizing: border-box;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                  <div style="font-weight: 500; color: #2c3e50; font-size: 0.85rem;" id="cdfDocumentName">Document Name</div>
                </div>
                <div style="font-size: 0.7rem; color: #666; margin-bottom: 8px;" id="cdfDocumentInfo">Upload info</div>
                <div style="display: flex; gap: 6px;">
                  <button class="carousel-btn" onclick="openDocument('cdf')" title="Open document" style="font-size: 0.7rem; padding: 6px 10px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 14px; height: 14px;">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14,2 14,8 20,8"/>
                      <line x1="16" y1="13" x2="8" y2="13"/>
                      <line x1="16" y1="17" x2="8" y2="17"/>
                      <polyline points="10,9 9,9 8,9"/>
                    </svg>
                    Open
                  </button>
                  <button class="carousel-btn" onclick="downloadDocument('cdf')" title="Download document" style="font-size: 0.7rem; padding: 6px 10px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 14px; height: 14px;">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="7,14 12,19 17,14"/>
                      <line x1="12" y1="19" x2="12" y2="7"/>
                    </svg>
                    Download
                  </button>
                </div>
              </div>
              
              <!-- CDF Document Type Dropdown -->
              <select id="cdfDocumentType" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.85rem; margin-bottom: 10px;">
                <option value="Client Details form">Client Details form</option>
                <option value="Beneficiary details form">Beneficiary details form</option>
              </select>
              
              <!-- CDF Upload Area (always shown) -->
              <div id="cdfUploadArea" onclick="triggerCDFUpload()" ondrop="handleCDFDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" style="border: 2px dashed #4A90E2; border-radius: 8px; padding: 12px; cursor: pointer; background: rgba(74, 144, 226, 0.1); display: flex !important; flex-direction: row; align-items: center; justify-content: center; gap: 8px; flex: none !important; box-sizing: border-box;">
                <svg viewBox="0 0 24 24" fill="none" stroke="rgb(0, 60, 113)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 20px; height: 20px; flex-shrink: 0;">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17,8 12,3 7,8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                <span style="font-weight: 500; color: rgb(0, 60, 113); font-size: 0.8rem;">Upload CDF</span>
                <input type="file" id="cdfFileInput" accept=".pdf,.doc,.docx" onchange="handleCDFFileSelect(event)" style="display: none;">
              </div>
            </div>
            
            <!-- Right Column: OFSI Sanctions Search -->
            <div>
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                <label style="margin: 0; font-weight: 500; color: #333; font-size: 0.9rem;">OFSI Sanctions Search</label>
                <button type="button" onclick="openOFSISearch()" style="background: none; color: rgb(0, 60, 113); border: 1px solid rgb(0, 60, 113); padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-weight: 500; transition: all 0.2s ease;" onmouseover="this.style.background='rgb(0, 60, 113)'; this.style.color='white';" onmouseout="this.style.background='none'; this.style.color='rgb(0, 60, 113)';">
                  Open OFSI Search
                </button>
              </div>
              
              <!-- OFSI Hint -->
              <div id="ofsiHint" style="margin-bottom: 10px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; font-size: 0.75rem; color: #856404; line-height: 1.3;">
                âš ï¸ Please supply<br><br>Most recent OFSI Sanction Search for the individual or entity
              </div>
              
              <!-- Existing OFSI Document Card (if present - always shown alongside uploader) -->
              <div id="ofsiDocumentCard" class="hidden" style="background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 6px; padding: 10px; margin-bottom: 10px; box-sizing: border-box;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                  <div style="font-weight: 500; color: #2c3e50; font-size: 0.85rem;" id="ofsiDocumentName">Document Name</div>
                </div>
                <div style="font-size: 0.7rem; color: #666; margin-bottom: 8px;" id="ofsiDocumentInfo">Upload info</div>
                <div style="display: flex; gap: 6px;">
                  <button class="carousel-btn" onclick="openDocument('ofsi')" title="Open document" style="font-size: 0.7rem; padding: 6px 10px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 14px; height: 14px;">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14,2 14,8 20,8"/>
                      <line x1="16" y1="13" x2="8" y2="13"/>
                      <line x1="16" y1="17" x2="8" y2="17"/>
                      <polyline points="10,9 9,9 8,9"/>
                    </svg>
                    Open
                  </button>
                  <button class="carousel-btn" onclick="downloadDocument('ofsi')" title="Download document" style="font-size: 0.7rem; padding: 6px 10px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 14px; height: 14px;">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="7,14 12,19 17,14"/>
                      <line x1="12" y1="19" x2="12" y2="7"/>
                    </svg>
                    Download
                  </button>
                </div>
              </div>
              
              <!-- OFSI Upload Area (always shown) -->
              <div id="ofsiUploadArea" onclick="triggerOFSIUpload()" ondrop="handleOFSIDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" style="border: 2px dashed #4A90E2; border-radius: 8px; padding: 12px; cursor: pointer; background: rgba(74, 144, 226, 0.1); display: flex !important; flex-direction: row; align-items: center; justify-content: center; gap: 8px; flex: none !important; box-sizing: border-box;">
                <svg viewBox="0 0 24 24" fill="none" stroke="rgb(0, 60, 113)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 20px; height: 20px; flex-shrink: 0;">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="17,8 12,3 7,8"/>
                  <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                <span style="font-weight: 500; color: rgb(0, 60, 113); font-size: 0.8rem;">Upload OFSI</span>
                <input type="file" id="ofsiFileInput" accept=".pdf,.doc,.docx" onchange="handleOFSIFileSelect(event)" style="display: none;">
              </div>
            </div>
          </div>
          
          <!-- Form J Submission Confirmation Checkbox -->
          <div style="margin-top: 15px; padding: 12px; background: #f5f5f5; border-radius: 8px; border: 1px solid #ddd;">
            <div style="display: flex; align-items: flex-start; gap: 10px;">
              <input type="checkbox" id="submissionConfirmationCheckbox" class="address-checkbox" style="margin-top: 3px; flex-shrink: 0;" />
              <label for="submissionConfirmationCheckbox" style="margin: 0; cursor: pointer; font-size: 0.85rem; line-height: 1.4; color: #333;">
                I understand if incomplete this request will NOT be processed and will be placed in the relevant F/E's 'ISSUE' Section. All of the information submitted here is correct and accurate to the best of my knowledge and I confirm I have cross-checked the details across all sources.
              </label>
            </div>
          </div>
        </div>

      </form>

  <!-- Fixed Bottom Container with Progress and Submit Button -->
  <div class="fixed-bottom-container" id="bottomContainer">
    <div class="bottom-compact">
      <!-- Progress Container -->
      <div class="progress-container">
        <div class="progress-bar-wrapper">
          <div class="progress-bar-fill" id="progressBarFill"></div>
        </div>
        <div class="progress-text" id="progressText">0%</div>
      </div>
      
      <!-- Expand Button Tab -->
      <button type="button" class="expand-button" id="expandButton" title="View Requirements">
        <span class="expand-icon" id="expandIcon">â–²</span>
      </button>
      
      <!-- Submit Button -->
      <div class="submit-button-container">
        <button type="submit" class="btn-primary" id="submitButton" form="clientForm">Submit Request</button>
      </div>
    </div>
    
    <!-- Expandable Requirements Section -->
    <div class="requirements-section" id="requirementsSection">
      <div class="requirements-content" id="requirementsContent">
        <!-- Requirements will be dynamically populated here -->
      </div>
    </div>
  </div>

  <!-- Error popup -->
  <div id="errorPopup" class="error-popup hidden">
    <h4 class="error-popup-header">Validation Error</h4>
    <div class="error-popup-content">
      <span id="errorMessage" style="white-space:pre-wrap;"></span>
      <button type="button" id="closeError">Ã—</button>
    </div>
  </div>

  <!-- Uploading popup (matches message-iframe.html) -->
  <div class="uploading-popup" id="uploadingPopup">
    <div class="uploading-content">
      <div class="uploading-title">Uploading Files</div>
      <div class="file-details" id="fileDetails">
        <div class="file-name" id="fileName">Preparing upload...</div>
        <div class="file-size" id="fileSize"></div>
      </div>
      <div class="uploading-spinner"></div>
      <div class="uploading-text">Please wait while we upload your files...</div>
    </div>
  </div>

  <script src="request-iframe.js"></script>
  
  <!-- jsPDF library for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</body>
</html>
